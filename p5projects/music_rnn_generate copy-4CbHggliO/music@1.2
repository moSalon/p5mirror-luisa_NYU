/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@magenta/music@1.2.3/dist/magentamusic.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mm=e()}}((function(){var define,module,exports;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){var n=t[a][1][e];return i(n||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))}},{}],2:[function(e,t,n){"use strict";var r=n;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;r.encode=function(e,t,n){for(var r,o=null,a=[],s=0,u=0;t<n;){var l=e[t++];switch(u){case 0:a[s++]=i[l>>2],r=(3&l)<<4,u=1;break;case 1:a[s++]=i[r|l>>4],r=(15&l)<<2,u=2;break;case 2:a[s++]=i[r|l>>6],a[s++]=i[63&l],u=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return u&&(a[s++]=i[r],a[s++]=61,1===u&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var s="invalid encoding";r.decode=function(e,t,n){for(var r,i=n,a=0,u=0;u<e.length;){var l=e.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=o[l]))throw Error(s);switch(a){case 0:r=l,a=1;break;case 1:t[n++]=r<<2|(48&l)>>4,r=l,a=2;break;case 2:t[n++]=(15&r)<<4|(60&l)>>2,r=l,a=3;break;case 3:t[n++]=(3&r)<<6|l,a=0}}if(1===a)throw Error(s);return n-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,n){"use strict";function r(){this._listeners={}}t.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},{}],4:[function(e,t,n){"use strict";function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function s(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?a:s,e.readFloatBE=r?s:a}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,a=8388607&r;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=n.bind(null,a),e.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function s(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?a:s,e.readDoubleBE=r?s:a}():function(){function t(e,t,n,r,i,o){var a=r<0?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>17976931348623157e292)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=r*Math.pow(2,-u))>>>0,i,o+t),e((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),a=e(r,i+n),s=2*(a>>31)+1,u=a>>>20&2047,l=4294967296*(1048575&a)+o;return 2047===u?l?NaN:s*(1/0):0===u?5e-324*s*l:s*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=n.bind(null,a,0,4),e.readDoubleBE=n.bind(null,s,4,0)}(),e}function i(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=r(r)},{}],5:[function(require,module,exports){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],6:[function(e,t,n){"use strict";t.exports=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(o=e(r),a=0);var s=t.call(o,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},{}],7:[function(e,t,n){"use strict";var r=n;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],a=0;t<n;)(r=e[t++])<128?o[a++]=r:r>191&&r<224?o[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}},{}],8:[function(e,t,n){"use strict";var r,i,o,a=e("protobufjs/minimal"),s=a.Reader,u=a.util,l=a.roots.default||(a.roots.default={});l.tensorflow=((o={}).Any=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.typeUrl="",e.prototype.value=u.newBuffer([]),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.Any;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.typeUrl=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),o.DataType=(r={},(i=Object.create(r))[r[0]="DT_INVALID"]=0,i[r[1]="DT_FLOAT"]=1,i[r[2]="DT_DOUBLE"]=2,i[r[3]="DT_INT32"]=3,i[r[4]="DT_UINT8"]=4,i[r[5]="DT_INT16"]=5,i[r[6]="DT_INT8"]=6,i[r[7]="DT_STRING"]=7,i[r[8]="DT_COMPLEX64"]=8,i[r[9]="DT_INT64"]=9,i[r[10]="DT_BOOL"]=10,i[r[11]="DT_QINT8"]=11,i[r[12]="DT_QUINT8"]=12,i[r[13]="DT_QINT32"]=13,i[r[14]="DT_BFLOAT16"]=14,i[r[101]="DT_FLOAT_REF"]=101,i[r[102]="DT_DOUBLE_REF"]=102,i[r[103]="DT_INT32_REF"]=103,i[r[104]="DT_UINT8_REF"]=104,i[r[105]="DT_INT16_REF"]=105,i[r[106]="DT_INT8_REF"]=106,i[r[107]="DT_STRING_REF"]=107,i[r[108]="DT_COMPLEX64_REF"]=108,i[r[109]="DT_INT64_REF"]=109,i[r[110]="DT_BOOL_REF"]=110,i[r[111]="DT_QINT8_REF"]=111,i[r[112]="DT_QUINT8_REF"]=112,i[r[113]="DT_QINT32_REF"]=113,i[r[114]="DT_BFLOAT16_REF"]=114,i),o.TensorShape=function(){function e(e){if(this.dim=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dim=u.emptyArray,e.prototype.unknownRank=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorShape;e.pos<n;){var i=e.uint32();switch(i>>>3){case 2:r.dim&&r.dim.length||(r.dim=[]),r.dim.push(l.tensorflow.TensorShape.Dim.decode(e,e.uint32()));break;case 3:r.unknownRank=e.bool();break;default:e.skipType(7&i)}}return r},e.Dim=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.size=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.name="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorShape.Dim;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.size=e.int64();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.Tensor=function(){function e(e){if(this.floatVal=[],this.doubleVal=[],this.intVal=[],this.stringVal=[],this.scomplexVal=[],this.int64Val=[],this.boolVal=[],this.uint32Val=[],this.uint64Val=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dtype=0,e.prototype.tensorShape=null,e.prototype.versionNumber=0,e.prototype.tensorContent=u.newBuffer([]),e.prototype.floatVal=u.emptyArray,e.prototype.doubleVal=u.emptyArray,e.prototype.intVal=u.emptyArray,e.prototype.stringVal=u.emptyArray,e.prototype.scomplexVal=u.emptyArray,e.prototype.int64Val=u.emptyArray,e.prototype.boolVal=u.emptyArray,e.prototype.uint32Val=u.emptyArray,e.prototype.uint64Val=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.Tensor;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.dtype=e.int32();break;case 2:r.tensorShape=l.tensorflow.TensorShape.decode(e,e.uint32());break;case 3:r.versionNumber=e.int32();break;case 4:r.tensorContent=e.bytes();break;case 5:if(r.floatVal&&r.floatVal.length||(r.floatVal=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.floatVal.push(e.float());else r.floatVal.push(e.float());break;case 6:if(r.doubleVal&&r.doubleVal.length||(r.doubleVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.doubleVal.push(e.double());else r.doubleVal.push(e.double());break;case 7:if(r.intVal&&r.intVal.length||(r.intVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.intVal.push(e.int32());else r.intVal.push(e.int32());break;case 8:r.stringVal&&r.stringVal.length||(r.stringVal=[]),r.stringVal.push(e.bytes());break;case 9:if(r.scomplexVal&&r.scomplexVal.length||(r.scomplexVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.scomplexVal.push(e.float());else r.scomplexVal.push(e.float());break;case 10:if(r.int64Val&&r.int64Val.length||(r.int64Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.int64Val.push(e.int64());else r.int64Val.push(e.int64());break;case 11:if(r.boolVal&&r.boolVal.length||(r.boolVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.boolVal.push(e.bool());else r.boolVal.push(e.bool());break;case 16:if(r.uint32Val&&r.uint32Val.length||(r.uint32Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.uint32Val.push(e.uint32());else r.uint32Val.push(e.uint32());break;case 17:if(r.uint64Val&&r.uint64Val.length||(r.uint64Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.uint64Val.push(e.uint64());else r.uint64Val.push(e.uint64());break;default:e.skipType(7&i)}}return r},e}(),o.AttrValue=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.list=null,e.prototype.s=u.newBuffer([]),e.prototype.i=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.f=0,e.prototype.b=!1,e.prototype.type=0,e.prototype.shape=null,e.prototype.tensor=null,e.prototype.placeholder="",e.prototype.func=null,Object.defineProperty(e.prototype,"value",{get:u.oneOfGetter(t=["list","s","i","f","b","type","shape","tensor","placeholder","func"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AttrValue;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.list=l.tensorflow.AttrValue.ListValue.decode(e,e.uint32());break;case 2:r.s=e.bytes();break;case 3:r.i=e.int64();break;case 4:r.f=e.float();break;case 5:r.b=e.bool();break;case 6:r.type=e.int32();break;case 7:r.shape=l.tensorflow.TensorShape.decode(e,e.uint32());break;case 8:r.tensor=l.tensorflow.Tensor.decode(e,e.uint32());break;case 9:r.placeholder=e.string();break;case 10:r.func=l.tensorflow.NameAttrList.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.ListValue=function(){function e(e){if(this.s=[],this.i=[],this.f=[],this.b=[],this.type=[],this.shape=[],this.tensor=[],this.func=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.s=u.emptyArray,e.prototype.i=u.emptyArray,e.prototype.f=u.emptyArray,e.prototype.b=u.emptyArray,e.prototype.type=u.emptyArray,e.prototype.shape=u.emptyArray,e.prototype.tensor=u.emptyArray,e.prototype.func=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AttrValue.ListValue;e.pos<n;){var i=e.uint32();switch(i>>>3){case 2:r.s&&r.s.length||(r.s=[]),r.s.push(e.bytes());break;case 3:if(r.i&&r.i.length||(r.i=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.i.push(e.int64());else r.i.push(e.int64());break;case 4:if(r.f&&r.f.length||(r.f=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.f.push(e.float());else r.f.push(e.float());break;case 5:if(r.b&&r.b.length||(r.b=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.b.push(e.bool());else r.b.push(e.bool());break;case 6:if(r.type&&r.type.length||(r.type=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.type.push(e.int32());else r.type.push(e.int32());break;case 7:r.shape&&r.shape.length||(r.shape=[]),r.shape.push(l.tensorflow.TensorShape.decode(e,e.uint32()));break;case 8:r.tensor&&r.tensor.length||(r.tensor=[]),r.tensor.push(l.tensorflow.Tensor.decode(e,e.uint32()));break;case 9:r.func&&r.func.length||(r.func=[]),r.func.push(l.tensorflow.NameAttrList.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),e}(),o.NameAttrList=function(){function e(e){if(this.attr={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.attr=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.NameAttrList;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.name=e.string();break;case 2:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e}(),o.NodeDef=function(){function e(e){if(this.input=[],this.attr={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.op="",e.prototype.input=u.emptyArray,e.prototype.device="",e.prototype.attr=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.NodeDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.name=e.string();break;case 2:i.op=e.string();break;case 3:i.input&&i.input.length||(i.input=[]),i.input.push(e.string());break;case 4:i.device=e.string();break;case 5:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e}(),o.VersionDef=function(){function e(e){if(this.badConsumers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.producer=0,e.prototype.minConsumer=0,e.prototype.badConsumers=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.VersionDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.producer=e.int32();break;case 2:r.minConsumer=e.int32();break;case 3:if(r.badConsumers&&r.badConsumers.length||(r.badConsumers=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.badConsumers.push(e.int32());else r.badConsumers.push(e.int32());break;default:e.skipType(7&i)}}return r},e}(),o.GraphDef=function(){function e(e){if(this.node=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.node=u.emptyArray,e.prototype.versions=null,e.prototype.library=null,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.GraphDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.node&&r.node.length||(r.node=[]),r.node.push(l.tensorflow.NodeDef.decode(e,e.uint32()));break;case 4:r.versions=l.tensorflow.VersionDef.decode(e,e.uint32());break;case 2:r.library=l.tensorflow.FunctionDefLibrary.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),o.CollectionDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.nodeList=null,e.prototype.bytesList=null,e.prototype.int64List=null,e.prototype.floatList=null,e.prototype.anyList=null,Object.defineProperty(e.prototype,"kind",{get:u.oneOfGetter(t=["nodeList","bytesList","int64List","floatList","anyList"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.nodeList=l.tensorflow.CollectionDef.NodeList.decode(e,e.uint32());break;case 2:r.bytesList=l.tensorflow.CollectionDef.BytesList.decode(e,e.uint32());break;case 3:r.int64List=l.tensorflow.CollectionDef.Int64List.decode(e,e.uint32());break;case 4:r.floatList=l.tensorflow.CollectionDef.FloatList.decode(e,e.uint32());break;case 5:r.anyList=l.tensorflow.CollectionDef.AnyList.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.NodeList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.NodeList;e.pos<n;){var i=e.uint32();i>>>3==1?(r.value&&r.value.length||(r.value=[]),r.value.push(e.string())):e.skipType(7&i)}return r},e}(),e.BytesList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.BytesList;e.pos<n;){var i=e.uint32();i>>>3==1?(r.value&&r.value.length||(r.value=[]),r.value.push(e.bytes())):e.skipType(7&i)}return r},e}(),e.Int64List=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.Int64List;e.pos<n;){var i=e.uint32();if(i>>>3==1)if(r.value&&r.value.length||(r.value=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.value.push(e.int64());else r.value.push(e.int64());else e.skipType(7&i)}return r},e}(),e.FloatList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.FloatList;e.pos<n;){var i=e.uint32();if(i>>>3==1)if(r.value&&r.value.length||(r.value=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.value.push(e.float());else r.value.push(e.float());else e.skipType(7&i)}return r},e}(),e.AnyList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.AnyList;e.pos<n;){var i=e.uint32();i>>>3==1?(r.value&&r.value.length||(r.value=[]),r.value.push(l.tensorflow.Any.decode(e,e.uint32()))):e.skipType(7&i)}return r},e}(),e}(),o.SaverDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.filenameTensorName="",e.prototype.saveTensorName="",e.prototype.restoreOpName="",e.prototype.maxToKeep=0,e.prototype.sharded=!1,e.prototype.keepCheckpointEveryNHours=0,e.prototype.version=0,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.SaverDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.filenameTensorName=e.string();break;case 2:r.saveTensorName=e.string();break;case 3:r.restoreOpName=e.string();break;case 4:r.maxToKeep=e.int32();break;case 5:r.sharded=e.bool();break;case 6:r.keepCheckpointEveryNHours=e.float();break;case 7:r.version=e.int32();break;default:e.skipType(7&i)}}return r},e.CheckpointFormatVersion=function(){var e={},t=Object.create(e);return t[e[0]="LEGACY"]=0,t[e[1]="V1"]=1,t[e[2]="V2"]=2,t}(),e}(),o.TensorInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.name="",e.prototype.cooSparse=null,e.prototype.dtype=0,e.prototype.tensorShape=null,Object.defineProperty(e.prototype,"encoding",{get:u.oneOfGetter(t=["name","cooSparse"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 4:r.cooSparse=l.tensorflow.TensorInfo.CooSparse.decode(e,e.uint32());break;case 2:r.dtype=e.int32();break;case 3:r.tensorShape=l.tensorflow.TensorShape.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.CooSparse=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.valuesTensorName="",e.prototype.indicesTensorName="",e.prototype.denseShapeTensorName="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorInfo.CooSparse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.valuesTensorName=e.string();break;case 2:r.indicesTensorName=e.string();break;case 3:r.denseShapeTensorName=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.SignatureDef=function(){function e(e){if(this.inputs={},this.outputs={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.inputs=u.emptyObject,e.prototype.outputs=u.emptyObject,e.prototype.methodName="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.SignatureDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:e.skip().pos++,i.inputs===u.emptyObject&&(i.inputs={}),n=e.string(),e.pos++,i.inputs[n]=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 2:e.skip().pos++,i.outputs===u.emptyObject&&(i.outputs={}),n=e.string(),e.pos++,i.outputs[n]=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 3:i.methodName=e.string();break;default:e.skipType(7&o)}}return i},e}(),o.AssetFileDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.tensorInfo=null,e.prototype.filename="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AssetFileDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.tensorInfo=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 2:r.filename=e.string();break;default:e.skipType(7&i)}}return r},e}(),o.OpDef=function(){function e(e){if(this.inputArg=[],this.outputArg=[],this.attr=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.inputArg=u.emptyArray,e.prototype.outputArg=u.emptyArray,e.prototype.attr=u.emptyArray,e.prototype.deprecation=null,e.prototype.summary="",e.prototype.description="",e.prototype.isCommutative=!1,e.prototype.isAggregate=!1,e.prototype.isStateful=!1,e.prototype.allowsUninitializedInput=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.inputArg&&r.inputArg.length||(r.inputArg=[]),r.inputArg.push(l.tensorflow.OpDef.ArgDef.decode(e,e.uint32()));break;case 3:r.outputArg&&r.outputArg.length||(r.outputArg=[]),r.outputArg.push(l.tensorflow.OpDef.ArgDef.decode(e,e.uint32()));break;case 4:r.attr&&r.attr.length||(r.attr=[]),r.attr.push(l.tensorflow.OpDef.AttrDef.decode(e,e.uint32()));break;case 8:r.deprecation=l.tensorflow.OpDef.OpDeprecation.decode(e,e.uint32());break;case 5:r.summary=e.string();break;case 6:r.description=e.string();break;case 18:r.isCommutative=e.bool();break;case 16:r.isAggregate=e.bool();break;case 17:r.isStateful=e.bool();break;case 19:r.allowsUninitializedInput=e.bool();break;default:e.skipType(7&i)}}return r},e.ArgDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.description="",e.prototype.type=0,e.prototype.typeAttr="",e.prototype.numberAttr="",e.prototype.typeListAttr="",e.prototype.isRef=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.ArgDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.description=e.string();break;case 3:r.type=e.int32();break;case 4:r.typeAttr=e.string();break;case 5:r.numberAttr=e.string();break;case 6:r.typeListAttr=e.string();break;case 16:r.isRef=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e.AttrDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.type="",e.prototype.defaultValue=null,e.prototype.description="",e.prototype.hasMinimum=!1,e.prototype.minimum=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.allowedValues=null,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.AttrDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.type=e.string();break;case 3:r.defaultValue=l.tensorflow.AttrValue.decode(e,e.uint32());break;case 4:r.description=e.string();break;case 5:r.hasMinimum=e.bool();break;case 6:r.minimum=e.int64();break;case 7:r.allowedValues=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.OpDeprecation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=0,e.prototype.explanation="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.OpDeprecation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.version=e.int32();break;case 2:r.explanation=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.OpList=function(){function e(e){if(this.op=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.op=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpList;e.pos<n;){var i=e.uint32();i>>>3==1?(r.op&&r.op.length||(r.op=[]),r.op.push(l.tensorflow.OpDef.decode(e,e.uint32()))):e.skipType(7&i)}return r},e}(),o.MetaGraphDef=function(){function e(e){if(this.collectionDef={},this.signatureDef={},this.assetFileDef=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metaInfoDef=null,e.prototype.graphDef=null,e.prototype.saverDef=null,e.prototype.collectionDef=u.emptyObject,e.prototype.signatureDef=u.emptyObject,e.prototype.assetFileDef=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.MetaGraphDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.metaInfoDef=l.tensorflow.MetaGraphDef.MetaInfoDef.decode(e,e.uint32());break;case 2:i.graphDef=l.tensorflow.GraphDef.decode(e,e.uint32());break;case 3:i.saverDef=l.tensorflow.SaverDef.decode(e,e.uint32());break;case 4:e.skip().pos++,i.collectionDef===u.emptyObject&&(i.collectionDef={}),n=e.string(),e.pos++,i.collectionDef[n]=l.tensorflow.CollectionDef.decode(e,e.uint32());break;case 5:e.skip().pos++,i.signatureDef===u.emptyObject&&(i.signatureDef={}),n=e.string(),e.pos++,i.signatureDef[n]=l.tensorflow.SignatureDef.decode(e,e.uint32());break;case 6:i.assetFileDef&&i.assetFileDef.length||(i.assetFileDef=[]),i.assetFileDef.push(l.tensorflow.AssetFileDef.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return i},e.MetaInfoDef=function(){function e(e){if(this.tags=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metaGraphVersion="",e.prototype.strippedOpList=null,e.prototype.anyInfo=null,e.prototype.tags=u.emptyArray,e.prototype.tensorflowVersion="",e.prototype.tensorflowGitVersion="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.MetaGraphDef.MetaInfoDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.metaGraphVersion=e.string();break;case 2:r.strippedOpList=l.tensorflow.OpList.decode(e,e.uint32());break;case 3:r.anyInfo=l.tensorflow.Any.decode(e,e.uint32());break;case 4:r.tags&&r.tags.length||(r.tags=[]),r.tags.push(e.string());break;case 5:r.tensorflowVersion=e.string();break;case 6:r.tensorflowGitVersion=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.SavedModel=function(){function e(e){if(this.metaGraphs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.savedModelSchemaVersion=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.metaGraphs=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.SavedModel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.savedModelSchemaVersion=e.int64();break;case 2:r.metaGraphs&&r.metaGraphs.length||(r.metaGraphs=[]),r.metaGraphs.push(l.tensorflow.MetaGraphDef.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),o.FunctionDefLibrary=function(){function e(e){if(this.function=[],this.gradient=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.function=u.emptyArray,e.prototype.gradient=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.FunctionDefLibrary;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.function&&r.function.length||(r.function=[]),r.function.push(l.tensorflow.FunctionDef.decode(e,e.uint32()));break;case 2:r.gradient&&r.gradient.length||(r.gradient=[]),r.gradient.push(l.tensorflow.GradientDef.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),o.FunctionDef=function(){function e(e){if(this.attr={},this.nodeDef=[],this.ret={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.signature=null,e.prototype.attr=u.emptyObject,e.prototype.nodeDef=u.emptyArray,e.prototype.ret=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.FunctionDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.signature=l.tensorflow.OpDef.decode(e,e.uint32());break;case 5:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;case 3:i.nodeDef&&i.nodeDef.length||(i.nodeDef=[]),i.nodeDef.push(l.tensorflow.NodeDef.decode(e,e.uint32()));break;case 4:e.skip().pos++,i.ret===u.emptyObject&&(i.ret={}),n=e.string(),e.pos++,i.ret[n]=e.string();break;default:e.skipType(7&o)}}return i},e}(),o.GradientDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.functionName="",e.prototype.gradientFunc="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.GradientDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.functionName=e.string();break;case 2:r.gradientFunc=e.string();break;default:e.skipType(7&i)}}return r},e}(),o),t.exports=l},{"protobufjs/minimal":48}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId})).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e}();n.ExecutionContext=r},{}],10:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../data/compiled_api"),s=e("../operations/operation_mapper"),u=e("./graph_executor"),l=function(){function e(e,t,n){this.modelUrl=e,this.weightManifestUrl=t,this.requestOption=n,this.version="n/a"}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=[this.modelUrl,this.weightManifestUrl];if(this.requestOption)this.handler=o.io.browserHTTPRequest(e,this.requestOption);else{var t=o.io.getLoadHandlers(e);if(0===t.length)t.push(o.io.browserHTTPRequest(e,this.requestOption));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return e=r.sent(),t=a.tensorflow.GraphDef.decode(new Uint8Array(e.modelTopology)),this.version=t.versions.producer+"."+t.versions.minConsumer,n=o.io.decodeWeights(e.weightData,e.weightSpecs),this.executor=new u.GraphExecutor(s.OperationMapper.Instance.transformGraph(t)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}}))}))},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.constructTensorMap=function(e){var t=e instanceof o.Tensor?[e]:e;if(t.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the frozen model has "+this.inputNodes.length+" placeholders, while there are "+t.length+" input tensors.");return this.inputNodes.reduce((function(e,n,r){return e[n]=t[r],e}),{})},e.prototype.execute=function(e,t){if(t=t||this.outputNodes,(e instanceof o.Tensor||Array.isArray(e))&&(e=this.constructTensorMap(e)),this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)throw new Error("The model contains control flow or dynamic shape ops, please use executeAsync method");var n=this.executor.execute(this.convertTensorMapToTensorsMap(e),t),r=Object.keys(n);return Array.isArray(t)&&t.length>1?t.map((function(e){return n[e]})):n[r[0]]},e.prototype.executeAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:if(!this.executor.isControlFlowModel&&!this.executor.isDynamicShapeModel)throw new Error("The model does not contain control flow or dynamic shape ops, please use execute method for better performance.");return t=t||this.outputNodes,(e instanceof o.Tensor||Array.isArray(e))&&(e=this.constructTensorMap(e)),[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(e),t)];case 1:return n=i.sent(),r=Object.keys(n),[2,Array.isArray(t)&&t.length>1?t.map((function(e){return n[e]})):n[r[0]]]}}))}))},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})},e.prototype.dispose=function(){this.executor.dispose()},e}();n.FrozenModel=l,n.loadFrozenModel=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return[4,(r=new l(e,t,n)).load()];case 1:return i.sent(),[2,r]}}))}))}},{"../data/compiled_api":8,"../operations/operation_mapper":46,"./graph_executor":11,"@tensorflow/tfjs-core":66}],11:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),s=e("../operations/executors/utils"),u=e("../operations/operation_executor"),l=e("./execution_context"),c=function(){function e(e){this.graph=e,this.compiledOrder=[],this._weightMap={},this.placeholders=e.placeholders,this._outputs=e.outputs,this.compile()}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.placeholders.map((function(e){return{name:e.name,shape:e.params.shape?e.params.shape.value:void 0,dtype:e.params.dtype?e.params.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.params.shape?e.params.shape.value:void 0,dtype:e.params.dtype?e.params.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.placeholders.map((function(e){return e.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.outputs.map((function(e){return e.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:!0,configurable:!0}),e.prototype.compile=function(){if(!this.graph.withControlFlow&&!this.graph.withDynamicShape)for(var e=this.graph.inputs.slice(),t={};e.length>0;){var n=e.pop();t[n.name]=!0,this.compiledOrder.push(n),n.children.forEach((function(n){!t[n.name]&&n.inputNames.every((function(e){var n=s.getNodeNameAndIndex(e)[0];return t[n]}))&&e.push(n)}))}},e.prototype.execute=function(e,t){var n=this;this.checkInput(e),this.checkInputShapeAndType(e);var i={};return a.tidy((function(){var o=new l.ExecutionContext(n._weightMap,i),a=n.compiledOrder.reduce((function(e,t){return e[t.name]=u.executeOp(t,e,o),e}),r({},n.weightMap,e));return n.findOutputs(a,o,t)}))},e.prototype.executeAsync=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,p=this;return o(this,(function(o){switch(o.label){case 0:return this.checkInput(e),this.checkInputShapeAndType(e),n={},r=new l.ExecutionContext(this._weightMap,n),[4,this.executeWithControlFlow(e,r)];case 1:return i=o.sent(),a=this.findOutputs(i,r,t),s=Object.keys(a).map((function(e){return a[e].id})),u=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))})),c=[].concat.apply([],u),Object.keys(i).forEach((function(e){i[e].forEach((function(e){e&&-1===s.indexOf(e.id)&&-1===c.indexOf(e.id)&&-1===p.weightIds.indexOf(e.id)&&e.dispose()}))})),[2,a]}}))}))},e.prototype.executeWithControlFlow=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,s;return o(this,(function(o){switch(o.label){case 0:n=this.graph.inputs.map((function(e){return{node:e,contexts:t.currentContext}})),i=r({},this.weightMap,e),a={},o.label=1;case 1:return n.length>0?(s=this.processStack(n,t,i,a),[4,Promise.all(s)]):[3,3];case 2:return o.sent(),[3,1];case 3:return[2,i]}}))}))},e.prototype.processStack=function(e,t,n,r){for(var i=this,o=[],a=function(){var a=e.pop();t.currentContext=a.contexts;var c="";"enter"===a.node.op&&s.getParamValue("isConstant",a.node,n,t)&&(c=s.getNodeNameAndIndex(a.node.name,t)[0]);var p=u.executeOp(a.node,n,t);c||(c=s.getNodeNameAndIndex(a.node.name,t)[0]);var h=t.currentContext;p instanceof Promise?o.push(p.then((function(o){return n[c]=o,t.currentContext=h,i.processChildNodes(a.node,e,t,n,r),o}))):(n[c]=p,l.processChildNodes(a.node,e,t,n,r))},l=this;e.length>0;)a();return o},e.prototype.processChildNodes=function(e,t,n,r,i){e.children.forEach((function(e){var o=s.getNodeNameAndIndex(e.name,n)[0];i[o]||("merge"===e.op?e.inputNames.some((function(e){return!!s.getTensor(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!s.getTensor(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))}))},e.prototype.findOutputs=function(e,t,n){return!n||n instanceof Array||(n=[n]),(n||this.graph.outputs.map((function(e){return e.name}))).reduce((function(n,r){return n[r]=s.getTensor(r,e,t),n}),{})},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))},e.prototype.checkInputShapeAndType=function(e){this.placeholders.forEach((function(t){var n=e[t.name][0];if(t.params.shape&&t.params.shape.value){var r=t.params.shape.value,i=r.length===n.shape.length&&n.shape.every((function(e,t){return-1===r[t]||r[t]===e}));a.util.assert(i,"The shape of dict['"+t.name+"'] provided in model.execute(dict) must be ["+r+"], but was ["+n.shape+"]")}t.params.dtype&&t.params.dtype.value&&a.util.assert(n.dtype===t.params.dtype.value,"The dtype of dict['"+t.name+"'] provided in model.execute(dict) must be "+t.params.dtype.value+", but was "+n.dtype)}))},e.prototype.checkInput=function(e){var t=this,n=Object.keys(e),r=[],i=[];if(this.inputNodes.forEach((function(e){-1===n.indexOf(e)&&r.push(e)})),n.forEach((function(e){-1===t.inputNodes.indexOf(e)&&i.push(e)})),r.length>0)throw new Error("The dict provided in model.execute(dict) has the keys ["+n+"], but is missing the required keys: ["+r+"].");if(i.length>0)throw new Error("The dict provided in model.execute(dict) has unused keys: ["+i+"]. Please provide only the following keys: ["+this.inputNodes+"].")},e}();n.GraphExecutor=c},{"../operations/executors/utils":29,"../operations/operation_executor":45,"./execution_context":9,"@tensorflow/tfjs-core":66}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=function(){function e(t,n,r,i,o,a,s){this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(){this.tensors.forEach((function(e){return e.tensor.dispose()})),this.tensors=[],this.closed_=!0},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map((function(e){return t.read(e)}))},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0===this.size()&&0===this.elementShape.length&&(this.elementShape=t.shape),this.assertShapesMatch(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},e.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach((function(e,r){return n.write(e,t[r])}))},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return r.tensor([],[0].concat(this.elementShape));var i=this.readMany(e);return this.assertShapesMatch(this.elementShape,i[0].shape,"TensorArray shape mismatch: "),r.stack(i,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return r.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var i=this.readMany(t);return this.assertShapesMatch(this.elementShape,i[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+i[0].shape+")"),r.concat(i,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,r.unstack(t,0))},e.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var i=0,o=e.map((function(e){return i+=e}));if(i!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+i+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var a=0===i?0:t.size/i,s=[];r.tidy((function(){t=t.reshape([1,i,a]);for(var u=0;u<e.length;++u){var l=[0,0===u?0:o[u-1],0],c=[1,e[u],a];s[u]=r.slice(t,l,c).reshape(n.elementShape)}return s}));for(var u=[],l=0;l<e.length;l++)u[l]=l;this.writeMany(u,s)},e.prototype.assertShapesMatch=function(e,t,n){void 0===n&&(n=""),r.util.assert(this.arraysEqual(e,t),n+" Shapes "+e+" and "+t+" must match")},e.prototype.arraysEqual=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0},e.nextId=0,e}();n.TensorArray=i},{"@tensorflow/tfjs-core":66}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./executor/frozen_model");n.FrozenModel=r.FrozenModel,n.loadFrozenModel=r.loadFrozenModel;var i=e("./version");n.version_converter=i.version},{"./executor/frozen_model":10,"./version":47}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"add":return[r.add(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"addN":return[r.addN(i.getParamValue("tensors",e,t,n))];case"mod":return[r.mod(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"mul":return[r.mul(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"div":return[r.div(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"floorDiv":return[r.floorDiv(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"sub":return[r.sub(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"minimum":return[r.minimum(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"maximum":return[r.maximum(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"pow":return[r.pow(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"squaredDifference":return[r.squaredDifference(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="arithmetic"},{"./utils":29,"@tensorflow/tfjs-core":66}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"abs":return[r.abs(i.getParamValue("x",e,t,n))];case"acos":return[r.acos(i.getParamValue("x",e,t,n))];case"acosh":return[r.acosh(i.getParamValue("x",e,t,n))];case"asin":return[r.asin(i.getParamValue("x",e,t,n))];case"asinh":return[r.asinh(i.getParamValue("x",e,t,n))];case"atan":return[r.atan(i.getParamValue("x",e,t,n))];case"atanh":return[r.atanh(i.getParamValue("x",e,t,n))];case"ceil":return[r.ceil(i.getParamValue("x",e,t,n))];case"cos":return[r.cos(i.getParamValue("x",e,t,n))];case"cosh":return[r.cosh(i.getParamValue("x",e,t,n))];case"elu":return[r.elu(i.getParamValue("x",e,t,n))];case"erf":return[r.erf(i.getParamValue("x",e,t,n))];case"exp":return[r.exp(i.getParamValue("x",e,t,n))];case"expm1":return[r.expm1(i.getParamValue("x",e,t,n))];case"floor":return[r.floor(i.getParamValue("x",e,t,n))];case"log":return[r.log(i.getParamValue("x",e,t,n))];case"log1p":return[r.log1p(i.getParamValue("x",e,t,n))];case"neg":return[r.neg(i.getParamValue("x",e,t,n))];case"reciprocal":return[r.reciprocal(i.getParamValue("x",e,t,n))];case"relu":return[r.relu(i.getParamValue("x",e,t,n))];case"round":return[r.round(i.getParamValue("x",e,t,n))];case"selu":return[r.selu(i.getParamValue("x",e,t,n))];case"sigmoid":return[r.sigmoid(i.getParamValue("x",e,t,n))];case"sin":return[r.sin(i.getParamValue("x",e,t,n))];case"sign":return[r.sign(i.getParamValue("x",e,t,n))];case"sinh":return[r.sinh(i.getParamValue("x",e,t,n))];case"softplus":return[r.softplus(i.getParamValue("x",e,t,n))];case"sqrt":return[r.sqrt(i.getParamValue("x",e,t,n))];case"square":return[r.square(i.getParamValue("x",e,t,n))];case"tanh":return[r.tanh(i.getParamValue("x",e,t,n))];case"tan":return[r.tan(i.getParamValue("x",e,t,n))];case"clipByValue":return[r.clipByValue(i.getParamValue("x",e,t,n),i.getParamValue("clipValueMin",e,t,n),i.getParamValue("clipValueMax",e,t,n))];case"rsqrt":return[r.div(r.scalar(1,"float32"),r.sqrt(i.getTensor(e.inputNames[0],t,n)))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="basic_math"},{"./utils":29,"@tensorflow/tfjs-core":66}],16:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../../executor/tensor_array"),s=e("./utils");n.executeOp=function(e,t,n){return r(this,void 0,void 0,(function(){var r,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,N,A,k,E,O,I,M,C,R,z,D,L,F,V,q,j;return i(this,(function(i){switch(i.label){case 0:switch(e.op){case"loopCond":return[3,1];case"switch":return[3,2];case"merge":return[3,4];case"enter":return[3,5];case"exit":return[3,6];case"nextIteration":return[3,7];case"tensorArray":return[3,8];case"tensorArrayWrite":return[3,9];case"tensorArrayRead":return[3,10];case"tensorArrayGather":return[3,11];case"tensorArrayScatter":return[3,12];case"tensorArrayConcat":return[3,13];case"tensorArraySplit":return[3,14];case"tensorArraySize":return[3,15];case"tensorArrayClose":return[3,16]}return[3,17];case 1:return[2,[s.getParamValue("pred",e,t,n)]];case 2:return r=s.getParamValue("pred",e,t,n),u=s.getParamValue("data",e,t,n),[4,r.data()];case 3:return[2,i.sent()[0]?[void 0,u]:[u,void 0]];case 4:return[2,(l=e.inputNames.find((function(e){return void 0!==s.getTensor(e,t,n)})))?[s.getTensor(l,t,n)]:void 0];case 5:return c=s.getParamValue("frameName",e,t,n),p=s.getParamValue("tensor",e,t,n),n.enterFrame(c),[2,[p]];case 6:return h=s.getParamValue("tensor",e,t,n),n.exitFrame(),[2,[h]];case 7:return f=s.getParamValue("tensor",e,t,n),n.nextIteration(),[2,[f]];case 8:return d=s.getParamValue("size",e,t,n),m=s.getParamValue("dtype",e,t,n),y=s.getParamValue("elementShape",e,t,n),g=s.getParamValue("dynamicSize",e,t,n),v=s.getParamValue("clearAfterRead",e,t,n),b=s.getParamValue("identicalElementShapes",e,t,n),_=s.getParamValue("name",e,t,n),w=new a.TensorArray(_,m,d,y,b,g,v),n.addTensorArray(w),[2,[o.scalar(w.id),o.scalar(1)]];case 9:return S=s.getParamValue("tensorArrayId",e,t,n),x=s.getParamValue("index",e,t,n),T=s.getParamValue("tensor",e,t,n),n.getTensorArray(S).write(x,T),[2,[o.scalar(1)]];case 10:return P=s.getParamValue("tensorArrayId",e,t,n),N=s.getParamValue("index",e,t,n),[2,[n.getTensorArray(P).read(N)]];case 11:return A=s.getParamValue("tensorArrayId",e,t,n),k=s.getParamValue("indices",e,t,n),E=s.getParamValue("dtype",e,t,n),[2,[n.getTensorArray(A).gather(k,E)]];case 12:return O=s.getParamValue("tensorArrayId",e,t,n),I=s.getParamValue("indices",e,t,n),M=s.getParamValue("tensor",e,t,n),n.getTensorArray(O).scatter(I,M),[2,[o.scalar(1)]];case 13:return C=s.getParamValue("tensorArrayId",e,t,n),R=n.getTensorArray(C),z=s.getParamValue("dtype",e,t,n),[2,[R.concat(z)]];case 14:return D=s.getParamValue("tensorArrayId",e,t,n),L=s.getParamValue("tensor",e,t,n),F=s.getParamValue("lengths",e,t,n),n.getTensorArray(D).split(F,L),[2,[o.scalar(1)]];case 15:return V=s.getParamValue("tensorArrayId",e,t,n),q=n.getTensorArray(V),[2,[o.scalar(q.size(),"int32")]];case 16:return j=s.getParamValue("tensorArrayId",e,t,n),n.getTensorArray(j).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+e.op+" is not implemented")}}))}))},n.CATEGORY="control"},{"../../executor/tensor_array":12,"./utils":29,"@tensorflow/tfjs-core":66}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"conv1d":var o=i.getParamValue("stride",e,t,n),a=i.getParamValue("pad",e,t,n),s=i.getParamValue("dataFormat",e,t,n).toUpperCase(),u=i.getParamValue("dilation",e,t,n);return[r.conv1d(i.getParamValue("x",e,t,n),i.getParamValue("filter",e,t,n),o,a,s,u)];case"conv2d":o=i.getParamValue("strides",e,t,n),a=i.getParamValue("pad",e,t,n),s=i.getParamValue("dataFormat",e,t,n).toUpperCase();var l=i.getParamValue("dilations",e,t,n);return[r.conv2d(i.getParamValue("x",e,t,n),i.getParamValue("filter",e,t,n),[o[1],o[2]],a,s,[l[0],l[1]])];case"conv2dTranspose":var c=i.getParamValue("outputShape",e,t,n);o=i.getParamValue("strides",e,t,n),a=i.getParamValue("pad",e,t,n);return[r.conv2dTranspose(i.getParamValue("x",e,t,n),i.getParamValue("filter",e,t,n),c,[o[1],o[2]],a)];case"depthwiseConv2d":o=i.getParamValue("strides",e,t,n),a=i.getParamValue("pad",e,t,n),l=i.getParamValue("dilations",e,t,n),s=i.getParamValue("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(i.getParamValue("input",e,t,n),i.getParamValue("filter",e,t,n),[o[1],o[2]],a,s,[l[0],l[1]])];case"avgPool":o=i.getParamValue("strides",e,t,n),a=i.getParamValue("pad",e,t,n);var p=i.getParamValue("kernelSize",e,t,n);return[r.avgPool(i.getParamValue("x",e,t,n),[p[1],p[2]],[o[1],o[2]],a)];case"maxPool":o=i.getParamValue("strides",e,t,n),a=i.getParamValue("pad",e,t,n),p=i.getParamValue("kernelSize",e,t,n);return[r.maxPool(i.getParamValue("x",e,t,n),[p[1],p[2]],[o[1],o[2]],a)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="convolution"},{"./utils":29,"@tensorflow/tfjs-core":66}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"fill":var o=i.getParamValue("shape",e,t,n),a=i.getParamValue("dtype",e,t,n),s=i.getParamValue("value",e,t,n);return[r.fill(o,s,a)];case"linspace":var u=i.getParamValue("start",e,t,n),l=i.getParamValue("stop",e,t,n),c=i.getParamValue("num",e,t,n);return[r.linspace(u,l,c)];case"oneHot":var p=i.getParamValue("indices",e,t,n),h=i.getParamValue("depth",e,t,n),f=i.getParamValue("onValue",e,t,n),d=i.getParamValue("offValue",e,t,n);return[r.oneHot(p,h,f,d)];case"ones":return[r.ones(i.getParamValue("shape",e,t,n),i.getParamValue("dtype",e,t,n))];case"onesLike":return[r.onesLike(i.getParamValue("x",e,t,n))];case"randomUniform":return[r.randomUniform(i.getParamValue("shape",e,t,n),i.getParamValue("minval",e,t,n),i.getParamValue("maxval",e,t,n),i.getParamValue("dtype",e,t,n))];case"range":u=i.getParamValue("start",e,t,n);var m=i.getParamValue("stop",e,t,n),y=i.getParamValue("step",e,t,n);return[r.range(u,m,y,i.getParamValue("dtype",e,t,n))];case"truncatedNormal":o=i.getParamValue("shape",e,t,n);var g=i.getParamValue("mean",e,t,n),v=i.getParamValue("stdDev",e,t,n),b=i.getParamValue("seed",e,t,n);return[r.truncatedNormal(o,g,v,i.getParamValue("dtype",e,t,n),b)];case"zeros":return[r.zeros(i.getParamValue("shape",e,t,n),i.getParamValue("dtype",e,t,n))];case"zerosLike":return[r.zerosLike(i.getParamValue("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="creation"},{"./utils":29,"@tensorflow/tfjs-core":66}],19:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("./utils");n.executeOp=function(e,t,n){return r(this,void 0,void 0,(function(){var r,s,u,l,c;return i(this,(function(i){switch(i.label){case 0:switch(e.op){case"nonMaxSuppression":return[3,1];case"whereAsync":return[3,3]}return[3,5];case 1:return r=a.getParamValue("boxes",e,t,n),s=a.getParamValue("scores",e,t,n),u=a.getParamValue("maxOutputSize",e,t,n),l=a.getParamValue("iouThreshold",e,t,n),c=a.getParamValue("scoreThreshold",e,t,n),[4,o.image.nonMaxSuppressionAsync(r,s,u,l,c)];case 2:case 4:return[2,[i.sent()]];case 3:return[4,o.whereAsync(a.getParamValue("condition",e,t,n))];case 5:throw TypeError("Node type "+e.op+" is not implemented")}}))}))},n.CATEGORY="dynamic"},{"./utils":29,"@tensorflow/tfjs-core":66}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){if("topK"===e.op){var o=i.getParamValue("x",e,t,n),a=i.getParamValue("k",e,t,n),s=i.getParamValue("sorted",e,t,n),u=r.topk(o,a,s);return[u.values,u.indices]}throw TypeError("Node type "+e.op+" is not implemented")},n.CATEGORY="evaluation"},{"./utils":29,"@tensorflow/tfjs-core":66}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"const":return t[e.name];case"placeholder":var o=i.getParamValue("default",e,t,n);return[i.getTensor(e.name,t,n)||o];case"identity":case"stopGradient":case"fakeQuantWithMinMaxVars":return[i.getParamValue("x",e,t,n)];case"snapshot":return[i.getParamValue("x",e,t,n).clone()];case"shape":return[r.tensor1d(i.getParamValue("x",e,t,n).shape,"int32")];case"size":return[r.scalar(i.getParamValue("x",e,t,n).size,"int32")];case"rank":return[r.scalar(i.getParamValue("x",e,t,n).rank,"int32")];case"noop":return[];case"print":var a=i.getParamValue("x",e,t,n),s=i.getParamValue("data",e,t,n),u=i.getParamValue("message",e,t,n),l=i.getParamValue("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(var c=0;c<s.length;c++)console.log(Array.prototype.slice.call(s[0].dataSync()).slice(0,l));return[a];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="graph"},{"./utils":29,"@tensorflow/tfjs-core":66}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"resizeBilinear":var o=i.getParamValue("images",e,t,n),a=i.getParamValue("size",e,t,n),s=i.getParamValue("alignCorners",e,t,n);return[r.image.resizeBilinear(o,[a[0],a[1]],s)];case"resizeNearestNeighbor":o=i.getParamValue("images",e,t,n),a=i.getParamValue("size",e,t,n),s=i.getParamValue("alignCorners",e,t,n);return[r.image.resizeNearestNeighbor(o,[a[0],a[1]],s)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="image"},{"./utils":29,"@tensorflow/tfjs-core":66}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"equal":return[r.equal(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"notEqual":return[r.notEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"greater":return[r.greater(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"greaterEqual":return[r.greaterEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"less":return[r.less(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"lessEqual":return[r.lessEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"logicalAnd":return[r.logicalAnd(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"logicalNot":return[r.logicalNot(i.getParamValue("a",e,t,n))];case"logicalOr":return[r.logicalOr(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"where":return[r.where(i.getParamValue("condition",e,t,n),i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="logical"},{"./utils":29,"@tensorflow/tfjs-core":66}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"matMul":return[r.matMul(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n),i.getParamValue("transposeA",e,t,n),i.getParamValue("transposeB",e,t,n))];case"transpose":return[r.transpose(i.getParamValue("x",e,t,n),i.getParamValue("perm",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="matrices"},{"./utils":29,"@tensorflow/tfjs-core":66}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"batchNormalization":return[r.batchNormalization(i.getParamValue("x",e,t,n),i.getParamValue("mean",e,t,n),i.getParamValue("variance",e,t,n),i.getParamValue("epsilon",e,t,n),i.getParamValue("scale",e,t,n),i.getParamValue("offset",e,t,n))];case"localResponseNormalization":return[r.localResponseNormalization(i.getParamValue("x",e,t,n),i.getParamValue("radius",e,t,n),i.getParamValue("bias",e,t,n),i.getParamValue("alpha",e,t,n),i.getParamValue("beta",e,t,n))];case"softmax":return[r.softmax(i.getParamValue("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="normalization"},{"./utils":29,"@tensorflow/tfjs-core":66}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"max":var o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.max(i.getParamValue("x",e,t,n),o,a)];case"mean":o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.mean(i.getParamValue("x",e,t,n),o,a)];case"min":o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.min(i.getParamValue("x",e,t,n),o,a)];case"sum":o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.sum(i.getParamValue("x",e,t,n),o,a)];case"all":o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.all(i.getParamValue("x",e,t,n),o,a)];case"any":o=i.getParamValue("axis",e,t,n),a=i.getParamValue("keepDims",e,t,n);return[r.any(i.getParamValue("x",e,t,n),o,a)];case"argMax":o=i.getParamValue("axis",e,t,n);return[r.argMax(i.getParamValue("x",e,t,n),o)];case"argMin":o=i.getParamValue("axis",e,t,n);return[r.argMin(i.getParamValue("x",e,t,n),o)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="reduction"},{"./utils":29,"@tensorflow/tfjs-core":66}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"concat":var o=i.getParamValue("axis",e,t,n),a=i.getParamValue("tensors",e,t,n);return[r.concat(a,o)];case"gather":o=i.getParamValue("axis",e,t,n);var s=i.getParamValue("x",e,t,n),u=i.getParamValue("indices",e,t,n);return[r.gather(s,u,o)];case"reverse":o=i.getParamValue("axis",e,t,n),s=i.getParamValue("x",e,t,n);return[r.reverse(s,o)];case"slice":var l=i.getParamValue("begin",e,t,n),c=i.getParamValue("size",e,t,n);return[r.slice(i.getParamValue("x",e,t,n),l,c)];case"stridedSlice":l=i.getParamValue("begin",e,t,n);var p=i.getParamValue("end",e,t,n),h=i.getParamValue("strides",e,t,n),f=i.getParamValue("beginMask",e,t,n),d=i.getParamValue("endMask",e,t,n),m=i.getParamValue("ellipsisMask",e,t,n),y=i.getParamValue("newAxisMask",e,t,n),g=i.getParamValue("shrinkAxisMask",e,t,n),v=i.getParamValue("x",e,t,n);if(1===l.length&&v.shape.length>1)for(var b=1;b<v.shape.length;b++)l.push(0),p.push(v.shape[b]),h.push(h[0]);return[r.stridedSlice(v,l,p,h,f,d,m,y,g)];case"stack":return r.tidy((function(){var o=i.getParamValue("axis",e,t,n),a=i.getParamValue("tensors",e,t,n),s=a[0].shape,u=a[0].squeeze().shape,l=a.map((function(e){var t=r.util.arraysEqual(e.shape,s);if(!t&&!r.util.arraysEqual(e.squeeze().shape,u))throw new Error("the input tensors shape does not match");return t?e:e.reshape(s)}));return[r.stack(l,o)]}));case"unstack":return r.tidy((function(){var o=i.getParamValue("axis",e,t,n),a=i.getParamValue("tensor",e,t,n);return r.unstack(a,o)}));case"tile":var _=i.getParamValue("reps",e,t,n);return[r.tile(i.getParamValue("x",e,t,n),_)];case"split":o=i.getParamValue("axis",e,t,n);var w=i.getParamValue("numOrSizeSplits",e,t,n);return r.split(i.getParamValue("x",e,t,n),w,o);default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="slice_join"},{"./utils":29,"@tensorflow/tfjs-core":66}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"cast":return[r.cast(i.getParamValue("x",e,t,n),i.getParamValue("dtype",e,t,n))];case"expandDims":var o=i.getParamValue("axis",e,t,n);return[r.expandDims(i.getParamValue("x",e,t,n),o)];case"squeeze":o=i.getParamValue("axis",e,t,n);return[r.squeeze(i.getParamValue("x",e,t,n),o)];case"reshape":return[r.reshape(i.getParamValue("x",e,t,n),i.getParamValue("shape",e,t,n))];case"pad":return[r.pad(i.getParamValue("x",e,t,n),i.split(i.getParamValue("padding",e,t,n),2),i.getParamValue("constantValue",e,t,n))];case"spaceToBatchND":var a=i.getParamValue("blockShape",e,t,n),s=i.split(i.getParamValue("paddings",e,t,n),2);return[r.spaceToBatchND(i.getParamValue("x",e,t,n),a,s)];case"batchToSpaceND":a=i.getParamValue("blockShape",e,t,n);var u=i.split(i.getParamValue("crops",e,t,n),2);return[r.batchToSpaceND(i.getParamValue("x",e,t,n),a,u)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="transformation"},{"./utils":29,"@tensorflow/tfjs-core":66}],29:[function(e,t,n){"use strict";function r(e,t,n){var r=o(e),a=r[0],s=r[1],u=n.currentContextIds.find((function(e){return!!t[i(a,e)]}));return void 0!==u?t[i(a,u)][s]:void 0}function i(e,t){return t?e+"-"+t:e}function o(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}Object.defineProperty(n,"__esModule",{value:!0}),n.getParamValue=function(e,t,n,i){var o=t.params[e];if(o&&void 0!==o.inputIndex){if("tensor"===o.type)return r(t.inputNames[o.inputIndex],n,i);if("tensors"===o.type)return(0===o.inputIndex?0===o.inputParamLength?t.inputNames:t.inputNames.slice(o.inputIndex,-o.inputParamLength):t.inputNames.splice(o.inputIndex)).map((function(e){return r(e,n,i)}));var a=Array.prototype.slice.call(r(t.inputNames.slice(o.inputIndex)[0],n,i).dataSync());return"number"===o.type?a[0]:a}return o&&o.value},n.getTensor=r,n.getNodeNameAndIndex=function(e,t){var n=o(e),r=n[0],a=n[1];return[i(r,t&&t.currentContextId),a]},n.parseNodeName=o,n.split=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Add",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",dlOpName:"addN",category:"arithmetic",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",dlOpName:"sub",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",dlOpName:"floorDiv",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",dlOpName:"mul",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",dlOpName:"maximum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Minimum",dlOpName:"minimum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Pow",dlOpName:"pow",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",dlOpName:"squaredDifference",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Abs",dlOpName:"abs",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",dlOpName:"acos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",dlOpName:"asin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"atan",dlOpName:"atan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",dlOpName:"ceil",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"clip_value_min",dlParamName:"clipValueMin",type:"number"},{tfParamName:"clip_value_max",dlParamName:"clipValueMax",type:"number"}]},{tfOpName:"Cos",dlOpName:"cos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",dlOpName:"cosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",dlOpName:"elu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",dlOpName:"exp",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",dlOpName:"floor",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",dlOpName:"log",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",dlOpName:"neg",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",dlOpName:"relu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{dlParamName:"clipValueMin",type:"number",defaultValue:0},{dlParamName:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",dlOpName:"selu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",dlOpName:"sigmoid",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",dlOpName:"sin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",dlOpName:"sinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",dlOpName:"sqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",dlOpName:"rsqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",dlOpName:"square",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",dlOpName:"tan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",dlOpName:"tanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",dlOpName:"sign",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",dlOpName:"round",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",dlOpName:"expm1",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",dlOpName:"log1p",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",dlOpName:"softplus",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",dlOpName:"asinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",dlOpName:"acosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",dlOpName:"atanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",dlOpName:"erf",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"LoopCond",dlOpName:"loopCond",category:"control",params:[{tfInputIndex:0,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Switch",dlOpName:"switch",category:"control",params:[{tfInputIndex:0,dlParamName:"data",type:"tensor"},{tfInputIndex:1,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Merge",dlOpName:"merge",category:"control",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"Enter",dlOpName:"enter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"frame_name",dlParamName:"frameName",type:"string"},{tfParamName:"is_constant",dlParamName:"isConstant",type:"bool"}]},{tfOpName:"Exit",dlOpName:"exit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",dlOpName:"nextIteration",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",dlOpName:"tensorArray",category:"control",params:[{tfInputIndex:0,dlParamName:"size",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"},{tfParamName:"dynamic_size",dlParamName:"dynamicSize",type:"bool"},{tfParamName:"clear_after_read",dlParamName:"clearAfterRead",type:"bool"},{tfParamName:"identical_element_shapes",dlParamName:"identicalElementShapes",type:"bool"},{tfParamName:"tensor_array_name",dlParamName:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",dlOpName:"tensorArrayWrite",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",dlOpName:"tensorArrayRead",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",dlOpName:"tensorArrayGather",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",dlOpName:"tensorArrayScatter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",dlOpName:"tensorArrayConcat",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape_except0",dlParamName:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",dlOpName:"tensorArraySplit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"tensor",type:"tensor"},{tfInputIndex:2,dlParamName:"lengths",type:"number[]"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",dlOpName:"tensorArraySize",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",dlOpName:"tensorArrayClose",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"}]}]},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"AvgPool",dlOpName:"avgPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",dlOpName:"maxPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",dlOpName:"conv1d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"stride",dlParamName:"stride",type:"number"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NWC"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"dilation",dlParamName:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",dlOpName:"conv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"useCudnnOnGpu",dlParamName:"useCudnnOnGpu",type:"bool"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",dlOpName:"conv2dTranspose",category:"convolution",params:[{tfInputIndex:2,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfInputIndex:0,dlParamName:"outputShape",type:"number[]"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]}]},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Fill",dlOpName:"fill",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfInputIndex:1,dlParamName:"value",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",dlOpName:"linspace",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"num",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",dlOpName:"oneHot",category:"creation",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"depth",type:"number"},{tfInputIndex:2,dlParamName:"onValue",type:"number",defaultValue:1},{tfInputIndex:3,dlParamName:"offValue",type:"number",defaultValue:0},{tfParamName:"axis",dlParamName:"axis",type:"number",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",dlOpName:"ones",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",dlOpName:"onesLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",dlOpName:"randomUniform",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"minval",dlParamName:"minval",type:"number",defaultValue:0},{tfParamName:"maxval",dlParamName:"maxval",type:"number",defaultValue:1},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"seed",dlParamName:"seed",type:"number",defaultValue:0},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",dlOpName:"range",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"step",type:"number",defaultValue:0},{tfParamName:"Tidx",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"truncatedNormal",dlOpName:"truncatedNormal",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"means",dlParamName:"mean",type:"number",defaultValue:0},{tfParamName:"stddev",dlParamName:"stdDev",type:"number",defaultValue:1},{tfParamName:"seed",dlParamName:"seed",type:"number"},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",dlOpName:"zeros",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",dlOpName:"zerosLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]}]},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"NonMaxSuppressionV2",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"},{tfInputIndex:4,dlParamName:"scoreThreshold",type:"number"}]},{tfOpName:"Where",dlOpName:"whereAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"TopKV2",dlOpName:"topK",category:"evaluation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"k",type:"number"},{tfParamName:"sorted",dlParamName:"sorted",type:"bool"}]}]},{}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"PlaceholderWithDefault",dlOpName:"placeholder",category:"graph",params:[{tfInputIndex:0,dlParamName:"default",type:"tensor"},{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",dlOpName:"placeholder",category:"graph",params:[{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Const",dlOpName:"const",category:"graph"},{tfOpName:"Identity",dlOpName:"identity",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Snapshot",dlOpName:"snapshot",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Rank",dlOpName:"rank",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Size",dlOpName:"size",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Shape",dlOpName:"shape",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Print",dlOpName:"print",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfInputParamLength:1,dlParamName:"data",type:"tensors"},{tfParamName:"message",dlParamName:"message",type:"string"},{tfParamName:"first_n",dlParamName:"firstN",type:"number",notSupprted:!0},{tfParamName:"summarize",dlParamName:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",dlOpName:"noop",category:"graph",params:[]},{tfOpName:"StopGradient",dlOpName:"stopGradient",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",dlOpName:"fakeQuantWithMinMaxVars",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"min",dlParamName:"min",type:"number"},{tfParamName:"max",dlParamName:"max",type:"number"}]}]},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"ResizeBilinear",dlOpName:"resizeBilinear",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",dlOpName:"resizeNearestNeighbor",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Equal",dlOpName:"equal",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",dlOpName:"notEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",dlOpName:"greater",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",dlOpName:"greaterEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",dlOpName:"less",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",dlOpName:"lessEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",dlOpName:"logicalAnd",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",dlOpName:"logicalNot",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",dlOpName:"logicalOr",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",dlOpName:"where",category:"logical",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfInputIndex:1,dlParamName:"a",type:"tensor"},{tfInputIndex:2,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"MatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"transpose_a",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"transpose_b",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",dlOpName:"transpose",category:"matrices",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"perm",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"FusedBatchNorm",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",dlOpName:"localResponseNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"depth_radius",dlParamName:"radius",type:"number",defaultValue:5},{tfParamName:"bias",dlParamName:"bias",type:"number",defaultValue:1},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:1},{tfParamName:"beta",dlParamName:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",dlOpName:"softmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]}]},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Max",dlOpName:"max",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Mean",dlOpName:"mean",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Min",dlOpName:"min",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Sum",dlOpName:"sum",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"All",dlOpName:"all",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Any",dlOpName:"any",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",dlOpName:"argMax",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ArgMin",dlOpName:"argMin",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]}]},{}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"ConcatV2",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:-1,dlParamName:"axis",type:"number"}]},{tfOpName:"Concat",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:1,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:0,dlParamName:"axis",type:"number"}]},{tfOpName:"GatherV2",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ReverseV2",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"Slice",dlOpName:"slice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"size",type:"number[]"}]},{tfOpName:"StridedSlice",dlOpName:"stridedSlice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"end",type:"number[]"},{tfInputIndex:3,dlParamName:"strides",type:"number[]"},{tfParamName:"begin_mask",dlParamName:"beginMask",type:"number",defaultValue:0},{tfParamName:"end_mask",dlParamName:"endMask",type:"number",defaultValue:0},{tfParamName:"new_axis_mask",dlParamName:"newAxisMask",type:"number",defaultValue:0},{tfParamName:"ellipsis_mask",dlParamName:"ellipsisMask",type:"number",defaultValue:0},{tfParamName:"shrink_axis_mask",dlParamName:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",dlOpName:"stack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",dlOpName:"unstack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"num",dlParamName:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",dlOpName:"tile",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"reps",type:"number[]"}]},{tfOpName:"Split",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"axis",type:"number",defaultValue:0},{tfInputIndex:1,dlParamName:"x",type:"tensor"},{tfParamName:"num_split",dlParamName:"numOrSizeSplits",type:"number",defaultValue:1}]}]},{}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Cast",dlOpName:"cast",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"SrcT",dlParamName:"sdtype",type:"dtype",notSupported:!0},{tfParamName:"DstT",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",dlOpName:"expandDims",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfParamNameDeprecated:"dim",dlParamName:"axis",type:"number"}]},{tfOpName:"Pad",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfParamName:"constant_value",dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfInputIndex:2,dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",dlOpName:"reshape",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"shape",type:"number[]"}]},{tfOpName:"Squeeze",dlOpName:"squeeze",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"axis",tfParamNameDeprecated:"squeeze_dims",dlParamName:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",dlOpName:"spaceToBatchND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",dlOpName:"batchToSpaceND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"crops",type:"number[]"}]}]},{}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./executors/arithmetic_executor"),i=e("./executors/basic_math_executor"),o=e("./executors/control_executor"),a=e("./executors/convolution_executor"),s=e("./executors/creation_executor"),u=e("./executors/dynamic_executor"),l=e("./executors/evaluation_executor"),c=e("./executors/graph_executor"),p=e("./executors/image_executor"),h=e("./executors/logical_executor"),f=e("./executors/matrices_executor"),d=e("./executors/normalization_executor"),m=e("./executors/reduction_executor"),y=e("./executors/slice_join_executor"),g=e("./executors/transformation_executor");n.executeOp=function(e,t,n){switch(e.category){case"arithmetic":return r.executeOp(e,t,n);case"basic_math":return i.executeOp(e,t,n);case"control":return o.executeOp(e,t,n);case"convolution":return a.executeOp(e,t,n);case"creation":return s.executeOp(e,t,n);case"dynamic":return u.executeOp(e,t,n);case"evaluation":return l.executeOp(e,t,n);case"image":return p.executeOp(e,t,n);case"graph":return c.executeOp(e,t,n);case"logical":return h.executeOp(e,t,n);case"matrices":return f.executeOp(e,t,n);case"normalization":return d.executeOp(e,t,n);case"reduction":return m.executeOp(e,t,n);case"slice_join":return y.executeOp(e,t,n);case"transformation":return g.executeOp(e,t,n);default:throw TypeError("Node type "+e.op+" is not implemented")}}},{"./executors/arithmetic_executor":14,"./executors/basic_math_executor":15,"./executors/control_executor":16,"./executors/convolution_executor":17,"./executors/creation_executor":18,"./executors/dynamic_executor":19,"./executors/evaluation_executor":20,"./executors/graph_executor":21,"./executors/image_executor":22,"./executors/logical_executor":23,"./executors/matrices_executor":24,"./executors/normalization_executor":25,"./executors/reduction_executor":26,"./executors/slice_join_executor":27,"./executors/transformation_executor":28}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../data/compiled_api"),i=e("./executors/utils"),o=e("./op_list/arithmetic"),a=e("./op_list/basic_math"),s=e("./op_list/control"),u=e("./op_list/convolution"),l=e("./op_list/creation"),c=e("./op_list/dynamic"),p=e("./op_list/evaluation"),h=e("./op_list/graph"),f=e("./op_list/image"),d=e("./op_list/logical"),m=e("./op_list/matrices"),y=e("./op_list/normalization"),g=e("./op_list/reduction"),v=e("./op_list/slice_join"),b=e("./op_list/transformation"),_=["Switch","Merge","Enter","Exit","NextIteration"],w=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"],S=function(){function e(){var e=[o,a,s,u,l,c,p,d,f,h,m,y,g,v,b],t=[].concat.apply([],e.map((function(e){return e.json})));this.opMappers=t.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.isControlFlow=function(e){return _.some((function(t){return t===e.op}))},e.prototype.isDynamicShape=function(e){return w.some((function(t){return t===e.op}))},e.prototype.transformGraph=function(e){var t=this,n=e.node,r=!1,o=!1,a=[],s=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),t.isControlFlow(n)&&(r=!0),t.isDynamicShape(n)&&(o=!0),"Placeholder"===n.op&&a.push(e[n.name]),e}),{}),u=[],l=[];return Object.keys(s).forEach((function(e){var t=s[e];t.inputNames.forEach((function(e){var n=i.getNodeNameAndIndex(e)[0];t.inputs.push(s[n]),s[n].children.push(t)})),0===t.inputs.length&&u.push(t)})),Object.keys(s).forEach((function(e){var t=s[e];0===t.children.length&&l.push(t)})),{nodes:s,inputs:u,outputs:l,placeholders:a,withControlFlow:r,withDynamicShape:o}},e.prototype.mapNode=function(e){var t=this,n=this.opMappers[e.op];if(void 0===n)throw new Error("Tensorflow Op is not supported: "+e.op);var r={name:e.name,op:n.dlOpName,category:n.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],params:{}};return n.params&&(r.params=n.params.reduce((function(n,r){var i=r.tfInputIndex,o=r.tfInputParamLength,a=r.type,s=void 0;if(void 0===i)switch(r.type){case"string":void 0===(s=t.getStringParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getStringParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"number":void 0===(s=t.getNumberParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getNumberParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"number[]":void 0===(s=t.getNumericArrayParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getNumericArrayParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"bool":void 0===(s=t.getBoolParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getBoolParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"shape":void 0===(s=t.getTensorShapeParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getTensorShapeParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"dtype":void 0===(s=t.getDtypeParam(e.attr,r.tfParamName,r.defaultValue))&&r.tfParamNameDeprecated&&(s=t.getDtypeParam(e.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+e.op)}return n[r.dlParamName]={value:s,inputIndex:i,type:a,inputParamLength:o},n}),{})),r},e.prototype.getStringParam=function(e,t,n,r){void 0===r&&(r=!1);var i=e[t];if(void 0!==i){var o=String.fromCharCode.apply(null,i.s);return r?o:o.toLowerCase()}return n},e.prototype.getBoolParam=function(e,t,n){var r=e[t];return r?r.b:n},e.prototype.getNumberParam=function(e,t,n){var r=e[t],i=r?r[r.value]:n;return"number"==typeof i?i:i.toInt()},e.prototype.getDtypeParam=function(e,t,n){var i=e[t];if(i&&i.type)switch(i.type){case r.tensorflow.DataType.DT_FLOAT:return"float32";case r.tensorflow.DataType.DT_INT32:return"int32";case r.tensorflow.DataType.DT_BOOL:return"bool";default:return n}return n},e.prototype.getTensorShapeParam=function(e,t,n){var r=e[t];return r&&r.shape?r.shape.dim.map((function(e){return"number"==typeof e.size?e.size:e.size.toInt()})):n},e.prototype.getNumericArrayParam=function(e,t,n){var r=e[t];return r?(r.list.f&&r.list.f.length?r.list.f:r.list.i).map((function(e){return"number"==typeof e?e:e.toInt()})):n},e}();n.OperationMapper=S},{"../data/compiled_api":8,"./executors/utils":29,"./op_list/arithmetic":30,"./op_list/basic_math":31,"./op_list/control":32,"./op_list/convolution":33,"./op_list/creation":34,"./op_list/dynamic":35,"./op_list/evaluation":36,"./op_list/graph":37,"./op_list/image":38,"./op_list/logical":39,"./op_list/matrices":40,"./op_list/normalization":41,"./op_list/reduction":42,"./op_list/slice_join":43,"./op_list/transformation":44}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.5.9"},{}],48:[function(e,t,n){"use strict";t.exports=e("./src/index-minimal")},{"./src/index-minimal":49}],49:[function(e,t,n){"use strict";var r=n;function i(){r.Reader._configure(r.BufferReader),r.util._configure()}r.build="minimal",r.Writer=e("./writer"),r.BufferWriter=e("./writer_buffer"),r.Reader=e("./reader"),r.BufferReader=e("./reader_buffer"),r.util=e("./util/minimal"),r.rpc=e("./rpc"),r.roots=e("./roots"),r.configure=i,r.Writer._configure(r.BufferWriter),i()},{"./reader":50,"./reader_buffer":51,"./roots":52,"./rpc":53,"./util/minimal":56,"./writer":57,"./writer_buffer":58}],50:[function(e,t,n){"use strict";t.exports=u;var r,i=e("./util/minimal"),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function p(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},{"./util/minimal":56}],51:[function(e,t,n){"use strict";t.exports=o;var r=e("./reader");(o.prototype=Object.create(r.prototype)).constructor=o;var i=e("./util/minimal");function o(e){r.call(this,e)}i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},{"./reader":50,"./util/minimal":56}],52:[function(e,t,n){"use strict";t.exports={}},{}],53:[function(e,t,n){"use strict";n.Service=e("./rpc/service")},{"./rpc/service":54}],54:[function(e,t,n){"use strict";t.exports=i;var r=e("../util/minimal");function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return r.asPromise(e,s,t,n,i,o);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return s.emit("error",e,t),a(e);if(null!==n){if(!(n instanceof i))try{n=i[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",n,t),a(null,n)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{"../util/minimal":56}],55:[function(e,t,n){"use strict";t.exports=i;var r=e("../util/minimal");function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},{"../util/minimal":56}],56:[function(e,t,n){(function(t){"use strict";var r=n;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=e("@protobufjs/aspromise"),r.base64=e("@protobufjs/base64"),r.EventEmitter=e("@protobufjs/eventemitter"),r.float=e("@protobufjs/float"),r.inquire=e("@protobufjs/inquire"),r.utf8=e("@protobufjs/utf8"),r.pool=e("@protobufjs/pool"),r.LongBits=e("./longbits"),r.global="undefined"!=typeof window&&window||void 0!==t&&t||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isNode=Boolean(r.global.process&&r.global.process.versions&&r.global.process.versions.node),r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./longbits":55,"@protobufjs/aspromise":1,"@protobufjs/base64":2,"@protobufjs/eventemitter":3,"@protobufjs/float":4,"@protobufjs/inquire":5,"@protobufjs/pool":6,"@protobufjs/utf8":7}],57:[function(e,t,n){"use strict";t.exports=p;var r,i=e("./util/minimal"),o=i.LongBits,a=i.base64,s=i.utf8;function u(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function l(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function p(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}function h(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function d(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function m(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}p.create=i.Buffer?function(){return(p.create=function(){return new r})()}:function(){return new p},p.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(p.alloc=i.pool(p.alloc,i.Array.prototype.subarray)),p.prototype._push=function(e,t,n){return this.tail=this.tail.next=new u(e,t,n),this.len+=t,this},f.prototype=Object.create(u.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},p.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},p.prototype.int32=function(e){return e<0?this._push(d,10,o.fromNumber(e)):this.uint32(e)},p.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},p.prototype.uint64=function(e){var t=o.from(e);return this._push(d,t.length(),t)},p.prototype.int64=p.prototype.uint64,p.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(d,t.length(),t)},p.prototype.bool=function(e){return this._push(h,1,e?1:0)},p.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},p.prototype.sfixed32=p.prototype.fixed32,p.prototype.fixed64=function(e){var t=o.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},p.prototype.sfixed64=p.prototype.fixed64,p.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},p.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var y=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};p.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(i.isString(e)){var n=p.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(y,t,e)},p.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(h,1,0)},p.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new u(l,0,0),this.len=0,this},p.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},p.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},p.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},p._configure=function(e){r=e}},{"./util/minimal":56}],58:[function(e,t,n){"use strict";t.exports=a;var r=e("./writer");(a.prototype=Object.create(r.prototype)).constructor=a;var i=e("./util/minimal"),o=i.Buffer;function a(){r.call(this)}a.alloc=function(e){return(a.alloc=i._Buffer_allocUnsafe)(e)};var s=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]};function u(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write(e,n)}a.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s,t,e),this},a.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},{"./util/minimal":56,"./writer":57}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:setImmediate;n.nextFrame=function(){return new Promise((function(e){return r((function(){return e()}))}))}},{}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isMobile=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}},{}],61:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./profiler"),a=e("./tape"),s=e("./tensor"),u=e("./tensor_util"),l=e("./util"),c=e("./util"),p=function(){function e(e,t,n){this.backend=e,this.safeMode=t,this.debugMode=n,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.keepTensors=new Set,this.activeScope={track:[],name:"default scope"},this.scopeStack=[this.activeScope],this.profiler=new o.Profiler(e)}return e.prototype.tidy=function(e,t,n){var r=this;void 0===n&&(n=!1);var i,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return r.startScope(o,n)}),(function(){return r.endScope(i,n)}),(function(){return(i=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.runKernel=function(e,t,n){var r,i=this,o=[],a=function(e){return o.push(e),e},s=this.activeScope.name;if(this.scopedRun((function(){return i.customGradientDepth++}),(function(){return i.customGradientDepth--}),(function(){r=i.debugMode()?i.profiler.profileKernel(s,(function(){return e(i.backend,a)})):e(i.backend,a)})),this.shouldRecord()){var u={id:this.nextTapeNodeId++,name:s,inputs:t,outputs:Array.isArray(r)?r:[r]};null!=n&&(u.gradient=function(e){return n(e,o)}),this.activeTape.push(u)}return r},e.prototype.registerTensor=function(e){var t=this.refCounter.has(e.dataId)?this.refCounter.get(e.dataId):0;this.numTensors++,0===t&&(this.numDataBuffers++,"complex64"!==e.dtype&&(this.numBytes+=l.sizeFromShape(e.shape)*l.bytesPerElement(e.dtype)),this.backend.register(e.dataId,e.shape,e.dtype)),this.refCounter.set(e.dataId,t+1),e instanceof s.Variable||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.refCounter.has(e.dataId)){this.keepTensors.has(e.id)&&this.keepTensors.delete(e.id),this.numTensors--;var t=this.refCounter.get(e.dataId);t<=1?(this.refCounter.delete(e.dataId),this.backend.disposeData(e.dataId),this.numDataBuffers--,"complex64"!==e.dtype&&(this.numBytes-=l.sizeFromShape(e.shape)*l.bytesPerElement(e.dtype))):this.refCounter.set(e.dataId,t-1)}},e.prototype.disposeVariables=function(){for(var e in this.registeredVariables){var t=this.registeredVariables[e];this.disposeTensor(t),delete this.registeredVariables[e]}},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,e},e.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},e.prototype.addTapeNode=function(e,t,n){var r={};e.forEach((function(e,t){r[t]=e}));var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[t],gradient:function(e){var t=n(e),r={};return t.forEach((function(e,t){r[t]=function(){return e}})),r}};this.activeTape.push(i)},e.prototype.keep=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(e.id),e},e.prototype.startScope=function(e,t){void 0===t&&(t=!1),t&&0===this.gradientScopeCount&&(this.activeTape=[]),t&&this.gradientScopeCount++;var n={track:[],name:"unnamed scope"};e&&(n.name=e),this.scopeStack.push(n),this.activeScope=n},e.prototype.endScope=function(e,t){var n=this;void 0===t&&(t=!1),t&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),i=u.getTensorsInContainer(e);i.forEach((function(e){return r.add(e.id)}));for(var o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];r.has(a.id)||(null!=this.activeTape?i.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?{track:[],name:"default scope"}:this.scopeStack[this.scopeStack.length-1],i.forEach((function(e){!n.keepTensors.has(e.id)&&u.isTensorInList(e,s.track)&&n.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;return void 0===r&&(r=!1),l.assert(t.length>0,"gradients() received an empty list of xs."),this.tidy("gradients",(function(){var o=e();l.assert(o instanceof s.Tensor,"The result y returned by f() must be a tensor.");var u=a.getFilteredNodesXToY(i.activeTape,t,o);if(!r&&0===u.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var p,h,f={};return f[o.id]=null==n?(p=o.shape,h=c.makeOnesTypedArray(c.sizeFromShape(p),"float32"),s.Tensor.make(p,{values:h})):n,a.backpropagateGradients(f,u),{value:o,grads:t.map((function(e){return f[e.id]}))}}),!0)},e.prototype.customGrad=function(e){var t=this;return l.assert(l.isFunction(e),"The f passed in customGrad(f) must be a function."),function(){for(var n,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(l.assert(i.every((function(e){return e instanceof s.Tensor})),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),t.scopedRun((function(){return t.customGradientDepth++}),(function(){return t.customGradientDepth--}),(function(){r=t.tidy(e.name,(function(){var t=e.apply(void 0,i),r=t.value,o=t.gradFunc;return l.assert(r instanceof s.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),l.assert(l.isFunction(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n=o,r}),!0)})),t.shouldRecord()){t.addTapeNode(i,r,(function(e){var t=n(e),r=Array.isArray(t)?t:[t];return l.assert(r.length===i.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),l.assert(r.every((function(e){return e instanceof s.Tensor})),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),r}))}return r}},e.prototype.write=function(e,t){this.backend.write(e,t)},e.prototype.readSync=function(e){return this.backend.readSync(e)},e.prototype.read=function(e){return this.backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=c.now(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=c.now()-t,[2,n]}}))}))},e.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(e),e},e}();n.Engine=p},{"./profiler":182,"./tape":184,"./tensor":185,"./tensor_util":187,"./util":192}],62:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./device_util"),o=e("./engine"),a=e("./environment_util"),s=e("./tensor"),u=e("./tensor_util"),l=function(){function e(e){this.features={},this.engines={},this.registry={},null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in n.ENV.registry))throw new Error("Backend name '"+e+"' not found in registry");n.ENV.initBackend(e,t)},e.getBackend=function(){return n.ENV.initDefaultBackend(),n.ENV.backendName},e.disposeVariables=function(){n.ENV.engine.disposeVariables()},e.memory=function(){return n.ENV.engine.memory()},e.tidy=function(e,t,r){return void 0===r&&(r=!1),n.ENV.engine.tidy(e,t,r)},e.dispose=function(e){u.getTensorsInContainer(e).forEach((function(e){return e.dispose()}))},e.keep=function(e){return n.ENV.engine.keep(e)},e.time=function(e){return n.ENV.engine.time(e)},e.prototype.get=function(e){return e in this.features||(this.features[e]=this.evaluateFeature(e)),this.features[e]},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendName=function(){var e=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map((function(t){return{name:t,entry:e.registry[t]}})).sort((function(e,t){return t.entry.priority-e.entry.priority}))[0].name},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return"undefined"!=typeof window;if("IS_NODE"===e)return void 0!==t&&void 0!==t.versions.node;if("IS_CHROME"===e)return a.isChrome();if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var n=this.get("WEBGL_VERSION");return 0===n||n>0?0:a.getWebGLDisjointQueryTimerVersion(n,this.get("IS_BROWSER"))}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!i.isMobile();if("HAS_WEBGL"===e)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===e)return a.isWebGLVersionEnabled(2,this.get("IS_BROWSER"))?2:a.isWebGLVersionEnabled(1,this.get("IS_BROWSER"))?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return a.isRenderToFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return a.isDownloadFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_FENCE_API_ENABLED"===e)return a.isWebGLFenceEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("TEST_EPSILON"===e)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===e)return 32===this.backend.floatPrecision()?1e-7:.001;throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.features=Object.assign({},e)},e.prototype.reset=function(){this.features=a.getFeaturesFromURL(),null!=this.globalEngine&&(this.globalEngine=null)},e.prototype.initBackend=function(e,t){var n=this;if(void 0===t&&(t=!1),this.backendName=e,this.engines[e])this.globalEngine=this.engines[e];else{var r=this.findBackend(e);this.globalEngine=new o.Engine(r,t,(function(){return n.get("DEBUG")})),this.engines[e]=this.globalEngine}},Object.defineProperty(e.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),e.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},e.prototype.registerBackend=function(e,t,n,r){var i=this;if(void 0===n&&(n=1),e in this.registry)return console.warn(e+" backend was already registered. Reusing existing backend"),null!=r&&r((function(){return i.engine})),!1;try{var o=t();return this.registry[e]={backend:o,priority:n},!0}catch(t){return console.warn("Registration of backend "+e+" failed"),console.warn(t.stack||t.message),!1}},e.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e],e in this.engines&&delete this.engines[e]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initDefaultBackend(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initDefaultBackend=function(){null==this.globalEngine&&this.initBackend(this.get("BACKEND"),!1)},e}();n.Environment=l,n.ENV=(null==(r=function(){var e;if("undefined"!=typeof window)e=window;else{if(void 0===t)throw new Error("Could not find a global object");e=t}return e}()).ENV&&(r.ENV=new l(a.getFeaturesFromURL()),s.setTensorTracker((function(){return r.ENV.engine}))),r.ENV)}).call(this,e("_process"))},{"./device_util":60,"./engine":61,"./environment_util":63,"./tensor":185,"./tensor_util":187,_process:266}],63:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"}(r=n.Type||(n.Type={})),n.URL_PROPERTIES=[{name:"DEBUG",type:r.BOOLEAN},{name:"IS_BROWSER",type:r.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:r.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:r.BOOLEAN},{name:"WEBGL_VERSION",type:r.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:r.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:r.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:r.BOOLEAN},{name:"BACKEND",type:r.STRING},{name:"EPSILON",type:r.NUMBER}],n.isWebGLVersionEnabled=function(e,t){var n;try{n=a(e,t)}catch(e){return!1}return null!=n&&(s(n),!0)},n.getWebGLDisjointQueryTimerVersion=function(e,t){if(0===e)return 0;var n,r=a(e,t);return n=o(r,"EXT_disjoint_timer_query_webgl2")&&2===e?2:o(r,"EXT_disjoint_timer_query")?1:0,null!=r&&s(r),n},n.isRenderToFloatTextureEnabled=function(e,t){if(0===e)return!1;var n=a(e,t);if(1===e){if(!o(n,"OES_texture_float"))return!1}else if(!o(n,"EXT_color_buffer_float"))return!1;var r=u(n,e);return s(n),r},n.isDownloadFloatTextureEnabled=function(e,t){if(0===e)return!1;var n=a(e,t);if(1===e){if(!o(n,"OES_texture_float"))return!1;if(!o(n,"WEBGL_color_buffer_float"))return!1}else if(!o(n,"EXT_color_buffer_float"))return!1;var r=u(n,e);return s(n),r},n.isWebGLFenceEnabled=function(e,t){if(2!==e)return!1;var n=a(e,t),r=null!=n.fenceSync;return s(n),r},n.isChrome=function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)};var i="tfjsflags";function o(e,t){return null!=e.getExtension(t)}function a(e,t){if(0===e||!t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=document.createElement("canvas");return 1===e?n.getContext("webgl")||n.getContext("experimental-webgl"):n.getContext("webgl2")}function s(e){if(null!=e){var t=e.getExtension("WEBGL_lose_context");if(null==t)throw new Error("Extension WEBGL_lose_context not supported on this browser.");t.loseContext()}}function u(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var i=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,i,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),o}function l(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")})),t}n.getFeaturesFromURL=function(){var e={};if("undefined"==typeof window||void 0===window.location)return e;var t=l(window.location.search);if(i in t){var o={};t[i].split(",").forEach((function(e){var t=e.split(":"),n=t[0],r=t[1];o[n]=r})),n.URL_PROPERTIES.forEach((function(t){t.name in o&&(console.log("Setting feature override from URL "+t.name+": "+o[t.name]),t.type===r.NUMBER?e[t.name]=+o[t.name]:t.type===r.BOOLEAN?e[t.name]="true"===o[t.name]:t.type===r.STRING?e[t.name]=o[t.name]:console.warn("Unknown URL param: "+t.name+"."))}))}return e},n.getQueryParams=l},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment"),i=e("./gradients");n.customGrad=i.customGrad,n.grad=i.grad,n.grads=i.grads,n.valueAndGrad=i.valueAndGrad,n.valueAndGrads=i.valueAndGrads,n.variableGrads=i.variableGrads,n.tidy=r.Environment.tidy,n.keep=r.Environment.keep,n.dispose=r.Environment.dispose,n.time=r.Environment.time},{"./environment":62,"./gradients":65}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment"),i=e("./tensor"),o=e("./util");function a(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}n.gradScope=function(e,t){return r.ENV.engine.tidy(e,t,!0)},n.grad=function(e){return o.assert(o.isFunction(e),"The f passed in grad(f) must be a function"),function(t,n){return o.assert(t instanceof i.Tensor,"The x passed in grad(f)(x) must be a tensor"),o.assert(null==n||n instanceof i.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor"),r.ENV.engine.tidy((function(){var i=r.ENV.engine.gradients((function(){return e(t)}),[t],n),s=i.value,u=i.grads;return null!=n&&o.assertShapesMatch(s.shape,n.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),a(u),u[0]}))}},n.grads=function(e){return o.assert(o.isFunction(e),"The f passed in grads(f) must be a function"),function(t,n){return o.assert(Array.isArray(t)&&t.every((function(e){return e instanceof i.Tensor})),"The args passed in grads(f)(args) must be an array of tensors"),o.assert(null==n||n instanceof i.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor"),r.ENV.engine.tidy((function(){var i=r.ENV.engine.gradients((function(){return e.apply(void 0,t)}),t,n),s=i.value,u=i.grads;return null!=n&&o.assertShapesMatch(s.shape,n.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),a(u),u}))}},n.valueAndGrad=function(e){return o.assert(o.isFunction(e),"The f passed in valueAndGrad(f) must be a function"),function(t,n){o.assert(t instanceof i.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),o.assert(null==n||n instanceof i.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var s=r.ENV.engine.gradients((function(){return e(t)}),[t],n),u=s.grads,l=s.value;return a(u),{grad:u[0],value:l}}},n.valueAndGrads=function(e){return o.assert(o.isFunction(e),"The f passed in valueAndGrads(f) must be a function"),function(t,n){o.assert(Array.isArray(t)&&t.every((function(e){return e instanceof i.Tensor})),"The args passed in valueAndGrads(f)(args) must be array of tensors"),o.assert(null==n||n instanceof i.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var s=r.ENV.engine.gradients((function(){return e.apply(void 0,t)}),t,n);return null!=n&&o.assertShapesMatch(s.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),a(s.grads),s}},n.variableGrads=function(e,t){if(o.assert(o.isFunction(e),"The f passed in variableGrads(f) must be a function"),o.assert(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof i.Variable})),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==t)for(var n in t=[],r.ENV.engine.registeredVariables)t.push(r.ENV.engine.registeredVariables[n]);var a=t.length;t=t.filter((function(e){return e.trainable})),o.assert(t.length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable.");var s=r.ENV.engine.gradients(e,t,null,!0),u=s.value,l=s.grads;o.assert(l.some((function(e){return null!=e})),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),o.assert(0===u.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor");var c={};return t.forEach((function(e,t){null!=l[t]&&(c[e.name]=l[t])})),{value:u,grads:c}},n.customGrad=function(e){return r.ENV.engine.customGrad(e)}},{"./environment":62,"./tensor":185,"./util":192}],66:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),e("./kernels/backend_webgl"),e("./kernels/backend_cpu");var i=e("./browser_util");n.nextFrame=i.nextFrame;var o=e("./environment");n.environment=o;var a=e("./environment"),s=e("./io/io");n.io=s;var u=e("./serialization");n.serialization=u;var l=e("./tensor"),c=e("./test_util");n.test_util=c;var p=e("./util");n.util=p;var h=e("./version");n.version_core=h.version;var f=e("./webgl");n.webgl=f;var d=e("./optimizers/adadelta_optimizer");n.AdadeltaOptimizer=d.AdadeltaOptimizer;var m=e("./optimizers/adagrad_optimizer");n.AdagradOptimizer=m.AdagradOptimizer;var y=e("./optimizers/adam_optimizer");n.AdamOptimizer=y.AdamOptimizer;var g=e("./optimizers/adamax_optimizer");n.AdamaxOptimizer=g.AdamaxOptimizer;var v=e("./optimizers/momentum_optimizer");n.MomentumOptimizer=v.MomentumOptimizer;var b=e("./optimizers/optimizer");n.Optimizer=b.Optimizer;var _=e("./optimizers/rmsprop_optimizer");n.RMSPropOptimizer=_.RMSPropOptimizer;var w=e("./optimizers/sgd_optimizer");n.SGDOptimizer=w.SGDOptimizer;var S=e("./tensor");n.Tensor=S.Tensor,n.TensorBuffer=S.TensorBuffer,n.variable=S.variable,n.Variable=S.Variable;var x=e("./types");n.Rank=x.Rank,r(e("./ops/ops"));var T=e("./ops/loss_ops");n.Reduction=T.Reduction,r(e("./train")),r(e("./globals"));var P=e("./environment");n.ENV=P.ENV,n.Environment=P.Environment,n.setBackend=a.Environment.setBackend,n.getBackend=a.Environment.getBackend,n.disposeVariables=a.Environment.disposeVariables,n.memory=a.Environment.memory;var N=e("./ops/ops");l.setOpHandler(N)},{"./browser_util":59,"./environment":62,"./globals":64,"./io/io":70,"./kernels/backend_cpu":78,"./kernels/backend_webgl":80,"./ops/loss_ops":148,"./ops/ops":155,"./optimizers/adadelta_optimizer":173,"./optimizers/adagrad_optimizer":174,"./optimizers/adam_optimizer":175,"./optimizers/adamax_optimizer":176,"./optimizers/momentum_optimizer":177,"./optimizers/optimizer":178,"./optimizers/rmsprop_optimizer":180,"./optimizers/sgd_optimizer":181,"./serialization":183,"./tensor":185,"./test_util":189,"./train":190,"./types":191,"./util":192,"./version":193,"./webgl":194}],67:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("./io_utils"),s=e("./router_registry"),u=function(){function e(t){if(!o.ENV.get("IS_BROWSER"))throw new Error("triggerDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s,u;return i(this,(function(i){if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),e.modelTopology instanceof ArrayBuffer)throw new Error("DownloadTrigger.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,s.click(),null!=e.weightData&&((u=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=t,u.click()),[2,{modelArtifactsInfo:a.getModelArtifactsInfoForJSON(e)}]}))}))},e.URL_SCHEME="downloads://",e}();n.BrowserDownloads=u;var l=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var o=new FileReader;o.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(null!=u){0===t.length&&r({modelTopology:u});var l=s.weightsManifest;if(null!=l){var c;try{c=n.checkManifestAndWeightFiles(l,t)}catch(e){return void i(e)}var p=[],h=[],f=[];l.forEach((function(e){e.paths.forEach((function(e){h.push(e),f.push(null)})),p.push.apply(p,e.weights)})),l.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=h.indexOf(e);f[i]=n,-1===f.indexOf(null)&&r({modelTopology:u,weightSpecs:p,weightData:a.concatenateArrayBuffers(f)})},t.onerror=function(t){i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},o.onerror=function(t){i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return a.basename(e.name)})),i={},o=0,s=e;o<s.length;o++){s[o].paths.forEach((function(e){var o=a.basename(e);if(-1!==n.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(n.push(o),-1===r.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[e]=t[r.indexOf(o)]}))}if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function c(e){return void 0===e&&(e="model"),new u(e)}n.browserDownloadsRouter=function(e){return o.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(u.URL_SCHEME)?c(e.slice(u.URL_SCHEME.length)):null},s.IORouterRegistry.registerSaveRouter(n.browserDownloadsRouter),n.browserDownloads=c,n.browserFiles=function(e){return new l(e)}},{"../environment":62,"./io_utils":71,"./router_registry":75}],68:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../util"),a=e("./io_utils"),s=e("./router_registry"),u=e("./weights_loader"),l=function(){function e(e,t){if(this.DEFAULT_METHOD="POST","undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");if(o.assert(null!=e&&e.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(e)&&o.assert(2===e.length,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."),this.path=e,null!=t&&null!=t.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t||{}}return e.prototype.save=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o;return i(this,(function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,fetch(this.path,t)];case 1:if(200===(o=i.sent()).status)return[2,{modelArtifactsInfo:a.getModelArtifactsInfoForJSON(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},e.prototype.load=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]}))}))},e.prototype.loadBinaryTopology=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch(this.path[0],this.requestInit)];case 1:return[4,t.sent().arrayBuffer()];case 2:return[2,t.sent()];case 3:throw e=t.sent(),new Error(this.path[0]+" not found. "+e);case 4:return[2]}}))}))},e.prototype.loadBinaryModel=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,a,s,u;return i(this,(function(i){switch(i.label){case 0:return e=this.loadBinaryTopology(),[4,fetch(this.path[1],this.requestInit)];case 1:return t=i.sent(),[4,Promise.all([e,t])];case 2:return n=i.sent(),r=n[0],[4,n[1].json()];case 3:return null==(o=i.sent())?[3,5]:[4,this.loadWeights(o)];case 4:u=i.sent(),a=u[0],s=u[1],i.label=5;case 5:return[2,{modelTopology:r,weightSpecs:a,weightData:s}]}}))}))},e.prototype.loadJSONModel=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,a,s;return i(this,(function(i){switch(i.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:return[4,i.sent().json()];case 2:if(e=i.sent(),t=e.modelTopology,n=e.weightsManifest,null==t&&null==n)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==n?[3,4]:(a=e.weightsManifest,[4,this.loadWeights(a)]);case 3:s=i.sent(),r=s[0],o=s[1],i.label=4;case 4:return[2,{modelTopology:t,weightSpecs:r,weightData:o}]}}))}))},e.prototype.loadWeights=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s,l,c,p,h;return i(this,(function(i){switch(i.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=[],r=0,o=e;r<o.length;r++)s=o[r],n.push.apply(n,s.weights);return(l=t.substring(0,t.lastIndexOf("/"))).endsWith("/")||(l+="/"),c=[],e.forEach((function(e){e.paths.forEach((function(e){c.push(l+e)}))})),p=[n],h=a.concatenateArrayBuffers,[4,u.loadWeightsAsArrayBuffer(c,this.requestInit)];case 1:return[2,p.concat([h.apply(void 0,[i.sent()])])]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function c(e){return null!=e.match(l.URL_SCHEME_REGEX)}function p(e,t){return new l(e,t)}n.BrowserHTTPRequest=l,n.httpRequestRouter=function(e){if("undefined"==typeof fetch)return null;return(Array.isArray(e)?e.every((function(e){return c(e)})):c(e))?p(e):null},s.IORouterRegistry.registerSaveRouter(n.httpRequestRouter),s.IORouterRegistry.registerLoadRouter(n.httpRequestRouter),n.browserHTTPRequest=p},{"../util":192,"./io_utils":71,"./router_registry":75,"./weights_loader":77}],69:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("./io_utils"),s=e("./model_management"),u=e("./router_registry"),l="tensorflowjs",c="models_store",p="model_info_store";function h(){if(!o.ENV.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function f(e){var t=e.result;t.createObjectStore(c,{keyPath:"modelPath"}),t.createObjectStore(p,{keyPath:"modelPath"})}n.deleteDatabase=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=h(),[2,new Promise((function(t,n){var r=e.deleteDatabase(l);r.onsuccess=function(){return t()},r.onerror=function(e){return n(e)}}))]}))}))};var d=function(){function e(e){if(this.indexedDB=h(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open(l,1);i.onupgradeneeded=function(){return f(i)},i.onsuccess=function(){var o=i.result;if(null==t){var s=o.transaction(c,"readonly"),u=s.objectStore(c).get(n.modelPath);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(u.result.modelArtifacts)},u.onerror=function(e){return o.close(),r(u.error)},s.oncomplete=function(){return o.close()}}else{var l,h=a.getModelArtifactsInfoForJSON(t),f=o.transaction(p,"readwrite"),d=f.objectStore(p),m=d.put({modelPath:n.modelPath,modelArtifactsInfo:h});m.onsuccess=function(){var i=(l=o.transaction(c,"readwrite")).objectStore(c).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:h});i.onsuccess=function(){return e({modelArtifactsInfo:h})},i.onerror=function(e){var t=(d=f.objectStore(p)).delete(n.modelPath);t.onsuccess=function(){return o.close(),r(i.error)},t.onerror=function(e){return o.close(),r(i.error)}}},m.onerror=function(e){return o.close(),r(m.error)},f.oncomplete=function(){null==l?o.close():l.oncomplete=function(){return o.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}();function m(e){return new d(e)}n.BrowserIndexedDB=d,n.indexedDBRouter=function(e){return o.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(d.URL_SCHEME)?m(e.slice(d.URL_SCHEME.length)):null},u.IORouterRegistry.registerSaveRouter(n.indexedDBRouter),u.IORouterRegistry.registerLoadRouter(n.indexedDBRouter),n.browserIndexedDB=m;var y=function(){function e(){this.indexedDB=h()}return e.prototype.listModels=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open(l,1);r.onupgradeneeded=function(){return f(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(p,"readonly"),o=i.objectStore(p).getAll();o.onsuccess=function(){for(var e={},n=0,r=o.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},o.onerror=function(t){return e.close(),n(o.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){var r;return e=(r=e).startsWith(d.URL_SCHEME)?r.slice(d.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open(l,1);i.onupgradeneeded=function(){return f(i)},i.onsuccess=function(){var t,o=i.result,a=o.transaction(p,"readwrite"),s=a.objectStore(p),u=s.get(e);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),a=function(){var i=(t=o.transaction(c,"readwrite")).objectStore(c).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=a,i.onerror=function(e){return a(),o.close(),r(u.error)}},u.onerror=function(e){return o.close(),r(u.error)},a.oncomplete=function(){null==t?o.close():t.oncomplete=function(){return o.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(n.BrowserIndexedDBManager=y,o.ENV.get("IS_BROWSER"))try{s.ModelStoreManagerRegistry.registerManager(d.URL_SCHEME,new y)}catch(e){}},{"../environment":62,"./io_utils":71,"./model_management":73,"./router_registry":75}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("./indexed_db"),e("./local_storage");var r=e("./browser_files");n.browserFiles=r.browserFiles;var i=e("./browser_http");n.browserHTTPRequest=i.browserHTTPRequest;var o=e("./io_utils");n.concatenateArrayBuffers=o.concatenateArrayBuffers,n.decodeWeights=o.decodeWeights,n.encodeWeights=o.encodeWeights,n.getModelArtifactsInfoForJSON=o.getModelArtifactsInfoForJSON;var a=e("./passthrough");n.fromMemory=a.fromMemory,n.withSaveHandler=a.withSaveHandler;var s=e("./router_registry"),u=e("./weights_loader");n.loadWeights=u.loadWeights;var l=s.IORouterRegistry.registerSaveRouter;n.registerSaveRouter=l;var c=s.IORouterRegistry.registerLoadRouter;n.registerLoadRouter=c;var p=s.IORouterRegistry.getSaveHandlers;n.getSaveHandlers=p;var h=s.IORouterRegistry.getLoadHandlers;n.getLoadHandlers=h;var f=e("./model_management");n.copyModel=f.copyModel,n.listModels=f.listModels,n.moveModel=f.moveModel,n.removeModel=f.removeModel},{"./browser_files":67,"./browser_http":68,"./indexed_db":69,"./io_utils":71,"./local_storage":72,"./model_management":73,"./passthrough":74,"./router_registry":75,"./weights_loader":77}],71:[function(e,t,n){(function(t){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../ops/tensor_ops"),a=e("../util"),s=e("./types");function u(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}n.encodeWeights=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o;return i(this,(function(i){switch(i.label){case 0:for(r in t=[],n=[],e){if("float32"!==(o=e[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);t.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:u(i.sent()),specs:t}]}}))}))},n.decodeWeights=function(e,t){for(var n={},r=0,i=function(t){var i=t.name,u=t.dtype,l=t.shape,c=a.sizeFromShape(l),p=void 0;if("quantization"in t){var h=t.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var f=s.DTYPE_VALUE_SIZE_MAP[h.dtype],d=e.slice(r,r+c*f),m="uint8"===h.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===u)p=Float32Array.from(m,(function(e){return e*h.scale+h.min}));else{if("int32"!==u)throw new Error("Unsupported dtype in weight '"+i+"': "+u);p=Int32Array.from(m,(function(e){return Math.round(e*h.scale+h.min)}))}r+=c*f}else{var y=s.DTYPE_VALUE_SIZE_MAP[u];d=e.slice(r,r+c*y);if("float32"===u)p=new Float32Array(d);else if("int32"===u)p=new Int32Array(d);else{if("bool"!==u)throw new Error("Unsupported dtype in weight '"+i+"': "+u);p=new Uint8Array(d)}r+=c*y}var g=void 0;if("float32"===u)g=o.tensor(p,l,"float32");else if("int32"===u)g=o.tensor(p,l,"int32");else{if("bool"!==u)throw new Error("Unsupported dtype in weight '"+i+"': "+u);g=o.tensor(p,l,"bool")}n[i]=g},u=0,l=t;u<l.length;u++){i(l[u])}return n},n.concatenateTypedArrays=u;var l=void 0!==t&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function c(e){return l?t.byteLength(e):new Blob([e]).size}n.stringByteLength=c,n.arrayBufferToBase64String=function(e){return l?t.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},n.base64StringToArrayBuffer=function(e){if(l){var n=t.from(e,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}for(var r=atob(e),i=new Uint8Array(r.length),o=0;o<r.length;++o)i.set([r.charCodeAt(o)],o);return i.buffer},n.concatenateArrayBuffers=function(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer},n.basename=function(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]},n.getModelArtifactsInfoForJSON=function(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:c(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:c(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}}).call(this,e("buffer").Buffer)},{"../ops/tensor_ops":169,"../util":192,"./types":76,buffer:249}],72:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../util"),s=e("./io_utils"),u=e("./model_management"),l=e("./router_registry"),c="/",p="tensorflowjs_models",h="info",f="model_topology",d="weight_specs",m="weight_data";function y(e){return{info:[p,e,h].join(c),topology:[p,e,f].join(c),weightSpecs:[p,e,d].join(c),weightData:[p,e,m].join(c)}}function g(e){var t=e.split(c);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(c)}n.purgeLocalStorageArtifacts=function(){if(!o.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var e=window.localStorage,t=[],n=0;n<e.length;++n){var r=e.key(n),i=p+c;if(r.startsWith(i)&&r.length>i.length){e.removeItem(r);var a=g(r);-1===t.indexOf(a)&&t.push(a)}}return t};var v=function(){function e(e){if(!o.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=y(this.modelPath)}return e.prototype.save=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o;return i(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=s.getModelArtifactsInfoForJSON(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,s.arrayBufferToBase64String(e.weightData)),[2,{modelArtifactsInfo:r}]}catch(e){for(o in this.keys)this.LS.removeItem(this.keys[o]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=s.base64StringToArrayBuffer(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}();function b(e){return new v(e)}n.BrowserLocalStorage=v,n.localStorageRouter=function(e){return o.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(v.URL_SCHEME)?b(e.slice(v.URL_SCHEME.length)):null},l.IORouterRegistry.registerSaveRouter(n.localStorageRouter),l.IORouterRegistry.registerLoadRouter(n.localStorageRouter),n.browserLocalStorage=b;var _=function(){function e(){a.assert(o.ENV.get("IS_BROWSER"),"Current environment is not a web browser"),a.assert(void 0!==window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return e.prototype.listModels=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,a;return i(this,(function(i){for(e={},t=p+c,n=c+h,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=g(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},e.prototype.removeModel=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){var i;if(e=(i=e).startsWith(v.URL_SCHEME)?i.slice(v.URL_SCHEME.length):i,t=y(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(n.BrowserLocalStorageManager=_,o.ENV.get("IS_BROWSER"))try{u.ModelStoreManagerRegistry.registerManager(v.URL_SCHEME,new _)}catch(e){}},{"../environment":62,"../util":192,"./io_utils":71,"./model_management":73,"./router_registry":75}],73:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../util"),a=e("./router_registry"),s="://",u=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){o.assert(null!=t,"scheme must not be undefined or null."),t.endsWith(s)&&(t=t.slice(0,t.indexOf(s))),o.assert(t.length>0,"scheme must not be an empty string.");var r=e.getInstance();o.assert(null==r.managers[t],"A model store manager is already registered for scheme '"+t+"'."),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function l(e){if(-1===e.indexOf(s))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+u.getSchemes().join(","));return{scheme:e.split(s)[0],path:e.split(s)[1]}}function c(e,t,n){return void 0===n&&(n=!1),r(this,void 0,void 0,(function(){var r,s,c,p,h,f,d,m,y;return i(this,(function(i){switch(i.label){case 0:return o.assert(e!==t,"Old path and new path are the same: '"+e+"'"),r=a.IORouterRegistry.getLoadHandlers(e),o.assert(r.length>0,"Copying failed because no load handler is found for source URL "+e+"."),o.assert(r.length<2,"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."),s=r[0],c=a.IORouterRegistry.getSaveHandlers(t),o.assert(c.length>0,"Copying failed because no save handler is found for destination URL "+t+"."),o.assert(c.length<2,"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."),p=c[0],h=l(e).scheme,f=l(e).path,d=h===l(e).scheme,[4,s.load()];case 1:return m=i.sent(),n&&d?[4,u.getManager(h).removeModel(f)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[4,p.save(m)];case 4:return y=i.sent(),!n||d?[3,6]:[4,u.getManager(h).removeModel(f)];case 5:i.sent(),i.label=6;case 6:return[2,y.modelArtifactsInfo]}}))}))}n.ModelStoreManagerRegistry=u,n.listModels=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,a,l;return i(this,(function(i){switch(i.label){case 0:e=u.getSchemes(),t={},n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],[4,u.getManager(o).listModels()]):[3,4];case 2:for(l in a=i.sent())t[o+s+l]=a[l];i.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},n.removeModel=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=l(e),[4,u.getManager(t.scheme).removeModel(t.path)];case 1:return[2,n.sent()]}}))}))},n.copyModel=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return!1,[4,c(e,t,false)];case 1:return[2,n.sent()]}}))}))},n.moveModel=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return!0,[4,c(e,t,true)];case 1:return[2,n.sent()]}}))}))}},{"../util":192,"./router_registry":75}],74:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.modelTopology=e,this.weightSpecs=t,this.weightData=n}return e.prototype.load=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e={},null!=this.modelTopology&&(e=r({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=r({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=r({weightData:this.weightData},e)),[2,e]}))}))},e}(),s=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}();n.fromMemory=function(e,t,n){return new a(e,t,n)},n.withSaveHandler=function(e){return new s(e)}},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t){return e.getHandlers(t,"load")},e.getHandlers=function(e,t){var n=[];return("load"===t?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach((function(t){var r=t(e);null!==r&&n.push(r)})),n},e}();n.IORouterRegistry=r},{}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},{}],77:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../util"),a=e("./io_utils"),s=e("./types");function u(e,t){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return n=e.map((function(e){return fetch(e,t)})),[4,Promise.all(n)];case 1:return r=i.sent(),[4,Promise.all(r.map((function(e){return e.arrayBuffer()})))];case 2:return[2,i.sent()]}}))}))}n.loadWeightsAsArrayBuffer=u,n.loadWeights=function(e,t,n,l){return void 0===t&&(t=""),r(this,void 0,void 0,(function(){var r,c,p,h,f,d,m,y,g,v;return i(this,(function(i){switch(i.label){case 0:if(r=e.map((function(){return!1})),c={},p=null!=n?n.map((function(){return!1})):[],h=[],e.forEach((function(e,t){var i=0;e.weights.forEach((function(e){var a="quantization"in e?e.quantization.dtype:e.dtype,u=s.DTYPE_VALUE_SIZE_MAP[a]*o.sizeFromShape(e.shape),l=function(){r[t]=!0,null==c[t]&&(c[t]=[]),c[t].push({manifestEntry:e,groupOffset:i,sizeBytes:u})};null!=n?n.forEach((function(t,n){t===e.name&&(l(),p[n]=!0)})):l(),h.push(e.name),i+=u}))})),!p.every((function(e){return e})))throw f=n.filter((function(e,t){return!p[t]})),new Error("Could not find weights in manifest with names: "+f.join(", ")+". \nManifest JSON has weights with names: "+h.join(", ")+".");return d=r.reduce((function(e,t,n){return t&&e.push(n),e}),[]),m=[],d.forEach((function(n){e[n].paths.forEach((function(e){var n=t+(t.endsWith("/")?"":"/")+e;m.push(n)}))})),[4,u(m,l)];case 1:return y=i.sent(),g={},v=0,d.forEach((function(t){for(var n=e[t].paths.length,r=0,i=0;i<n;i++)r+=y[v+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,l=0;l<n;l++){var p=new Uint8Array(y[v+l]);s.set(p,u),u+=p.byteLength}c[t].forEach((function(e){var t=o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),n=a.decodeWeights(t,[e.manifestEntry]);for(var r in n)g[r]=n[r]})),v+=n})),[2,g]}}))}))}},{"../util":192,"./io_utils":71,"./types":76}],78:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("seedrandom"),a=e("../environment"),s=e("../log"),u=e("../ops/array_ops_util"),l=e("../ops/axis_util"),c=e("../ops/broadcast_util"),p=e("../ops/concat_util"),h=e("../ops/erf_util"),f=e("../ops/ops"),d=e("../ops/ops"),m=e("../ops/selu_util"),y=e("../ops/slice_util"),g=e("../tensor"),v=e("../types"),b=e("../util"),_=e("../util"),w=e("./backend_util"),S=e("./complex_util"),x=e("./non_max_suppression_impl"),T=e("./split_shared"),P=e("./topk_impl"),N=e("./where_impl"),A=function(){function e(){this.blockSize=48,this.data=new WeakMap,this.firstUse=!0,a.ENV.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas"))}return e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,a.ENV.get("IS_NODE")&&s.warn("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(e),this.data.get(e).values=t},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.fromPixels() can not be null");var n,r;if(a.ENV.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.getContext("2d").drawImage(e,0,0,e.width,e.height),n=this.canvas.getContext("2d").getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var i=e.width*e.height;r=new Int32Array(i*t);for(var o=0;o<i;o++)for(var s=0;s<t;++s)r[o*t+s]=n[4*o+s]}var u=[e.height,e.width,t];return d.tensor3d(r,u,"int32")},e.prototype.read=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.readSync(e)]}))}))},e.prototype.readSync=function(e){this.throwIfNoData(e);var t=this.data.get(e),n=t.dtype,r=t.complexTensors;if("complex64"===n){var i=r.real.dataSync(),o=r.imag.dataSync();return S.mergeRealAndImagArrays(i,o)}return this.data.get(e).values},e.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},e.prototype.time=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){return t=_.now(),e(),[2,{kernelMs:_.now()-t}]}))}))},e.prototype.memory=function(){return{unreliable:!0}},e.prototype.throwIfNoData=function(e){if(!this.data.has(e))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.complex=function(e,t){var n=g.Tensor.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:a.ENV.engine.keep(e.clone()),imag:a.ENV.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&b.assert("complex64"!==e.dtype,t+" does not support complex64 tensors.")}))},e.prototype.slice=function(e,t,n){this.assertNotComplex(e,"slice");for(var r=f.buffer(n,e.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i),a=o.map((function(e,n){return e+t[n]}));r.set.apply(r,[e.get.apply(e,a)].concat(o))}return r.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,i,o,a,s,u){this.assertNotComplex(e,"stridedSlice");var l=y.getStridedSlicedInfo(e.shape,t,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],d=p.filter((function(e,t){return-1===h.indexOf(t)}));if(d.some((function(e){return 0===e})))return f.tensor([],d);for(var m=f.buffer(p,e.dtype),g=0;g<m.size;g++){for(var v=m.indexToLoc(g),b=new Array(v.length),_=0;_<b.length;_++)b[_]=v[_]*r[_]+c[_];m.set.apply(m,[e.get.apply(e,b)].concat(v))}return m.toTensor().reshape(d)},e.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=f.buffer(e.shape,e.dtype),r=e.buffer(),i=function(i){var o=n.indexToLoc(i),a=o.slice();t.forEach((function(t){return a[t]=e.shape[t]-1-a[t]})),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},e.prototype.concat=function(e,t){this.assertNotComplex(e,"concat");var n=e.map((function(e){var n=b.sizeFromShape(e.shape.slice(t));return e.as2D(-1,n)})),r=p.computeOutShape(n.map((function(e){return e.shape})),1),i=f.buffer(r,e[0].dtype).values;if(1===n[0].shape[0]){var o=0;n.forEach((function(e){i.set(e.dataSync(),o),o+=e.size}))}else{var a=0;n.forEach((function(e){for(var t=e.dataSync(),n=0,o=0;o<e.shape[0];++o)for(var s=o*r[1]+a,u=0;u<e.shape[1];++u)i[s+u]=t[n++];a+=e.shape[1]}))}var s=p.computeOutShape(e.map((function(e){return e.shape})),t);return d.tensor(i,s,e[0].dtype)},e.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(f.scalar(-1),e)},e.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,v.upcastType(e.dtype,t.dtype),(function(e,t){return e+t}))},e.prototype.addN=function(e){this.assertNotComplex(e,"addN");for(var t=e.map((function(e){return e.dataSync()})),n=f.buffer(e[0].shape,e[0].dtype),r=n.values,i=0;i<e.length;i++)for(var o=t[i],a=0;a<r.length;a++)r[a]+=o[a];return n.toTensor()},e.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,v.upcastType(e.dtype,t.dtype),(function(e,t){return e-t}))},e.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},e.prototype.batchMatMul=function(e,t,n,r){this.assertNotComplex([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],s=e.shape[0],u=e.dataSync(),l=t.dataSync(),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],p=c[0],h=c[1],d=c[2],m=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],y=m[0],g=m[1],v=m[2],b=o*a,_=new Float32Array(s*b),w=this.blockSize,S=0;S<s;S++)for(var x=0;x<o;x+=w)for(var T=0;T<a;T+=w)for(var P=0;P<i;P+=w)for(var N=Math.min(x+w,o),A=Math.min(T+w,a),k=Math.min(P+w,i),E=x;E<N;E++)for(var O=T;O<A;O++){for(var I=0,M=P;M<k;M++)I+=u[S*p+E*h+M*d]*l[M*y+O*g+S*v];_[S*b+(E*a+O)]+=I}return f.tensor3d(_,[s,o,a])},e.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,v.upcastType(e.dtype,t.dtype),(function(e,t){return e*t}))},e.prototype.realDivide=function(e,t){this.assertNotComplex([e,t],"realDivide");return this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},e.prototype.floorDiv=function(e,t){this.assertNotComplex([e,t],"floorDiv");return this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},e.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),l.assertAxesAreInnerMostDims("sum",t,e.rank);for(var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.upcastType(e.dtype,"int32"),a=f.zeros(r,o),s=b.sizeFromShape(i),u=a.dataSync(),c=e.dataSync(),p=0;p<u.length;++p){for(var h=p*s,d=0,m=0;m<s;++m)d+=c[h+m];u[p]=d}return a},e.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,o=0;o<i;++o)t=t.expandDims(o+1);for(o=0;o<n;++o){var a=f.scalar(o,"int32"),s=f.equal(a,t).asType("float32").mul(e).sum(0);r.push(s)}return f.stack(r)},e.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];l.assertAxesAreInnerMostDims("argMin",n,e.rank);for(var r=l.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=f.zeros(i,"int32"),s=b.sizeFromShape(o),u=a.dataSync(),c=e.dataSync(),p=0;p<u.length;++p){for(var h=p*s,d=c[h],m=0,y=0;y<s;++y){var g=c[h+y];g<d&&(d=g,m=y)}u[p]=m}return a},e.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];l.assertAxesAreInnerMostDims("argMax",n,e.rank);for(var r=l.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=f.zeros(i,"int32"),s=b.sizeFromShape(o),u=a.dataSync(),c=e.dataSync(),p=0;p<u.length;++p){for(var h=p*s,d=c[h],m=0,y=0;y<s;++y){var g=c[h+y];g>d&&(d=g,m=y)}u[p]=m}return a},e.prototype.cumsum=function(e,t,n,r){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=v.upcastType(e.dtype,"int32"),o=f.zeros(e.shape,i),a=o.dataSync(),s=e.dataSync(),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var d=l(c,p-1);a[h]=n?s[d]+a[d]:s[h]+a[d]}}return o},e.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},e.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},e.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},e.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},e.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},e.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},e.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=e.dataSync(),n=new Int32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return g.Tensor.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},e.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},e.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var r=e.dataSync(),i=t.dataSync(),o=n.dataSync(),a=f.zeros(t.shape,v.upcastType(t.dtype,n.dtype)),s=a.dataSync(),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)1===r[c]?s[u++]=i[c]:s[u++]=o[c];return a},e.prototype.where=function(e){this.assertNotComplex([e],"where");var t=e.dataSync();return N.whereImpl(e.shape,t)},e.prototype.topk=function(e,t,n){this.assertNotComplex(e,"topk");var r=e.dataSync();return P.topkImpl(r,e.shape,e.dtype,t,n)},e.prototype.min=function(e,t){this.assertNotComplex(e,"min"),l.assertAxesAreInnerMostDims("min",t,e.rank);for(var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=f.zeros(r,e.dtype),a=b.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],d=0;d<a;++d){var m=u[p+d];m<h&&(h=m)}s[c]=h}return o},e.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},e.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},e.prototype.max=function(e,t){this.assertNotComplex(e,"max"),l.assertAxesAreInnerMostDims("max",t,e.rank);for(var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=f.zeros(r,e.dtype),a=b.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],d=0;d<a;++d){var m=u[p+d];m>h&&(h=m)}s[c]=h}return o},e.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},e.prototype.all=function(e,t){this.assertNotComplex(e,"all"),l.assertAxesAreInnerMostDims("all",t,e.rank);for(var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=f.zeros(r,e.dtype),a=b.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],d=0;d<a;++d){var m=u[p+d];h=h&&m}s[c]=h}return o},e.prototype.any=function(e,t){this.assertNotComplex(e,"any"),l.assertAxesAreInnerMostDims("any",t,e.rank);for(var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=f.zeros(r,e.dtype),a=b.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],d=0;d<a;++d){var m=u[p+d];h=h||m}s[c]=h}return o},e.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},e.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return g.Tensor.make(e.shape,{values:n})},e.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return g.Tensor.make(e.shape,{values:n})},e.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return g.Tensor.make(e.shape,{values:n})},e.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return g.Tensor.make(e.shape,{values:n})},e.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return g.Tensor.make(e.shape,{values:n})},e.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return g.Tensor.make(e.shape,{values:n})},e.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return g.Tensor.make(e.shape,{values:n})},e.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return g.Tensor.make(e.shape,{values:n})},e.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return g.Tensor.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return g.Tensor.make(e.shape,{values:n})},e.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=i*i}return g.Tensor.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return g.Tensor.make(e.shape,{values:n})},e.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=f.zeros(e.shape,e.dtype),n=t.dataSync(),r=e.dataSync(),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},e.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return g.Tensor.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),r=t.dataSync(),i=e.dataSync(),o=0;o<r.length;++o){var a=r[o];n[o]=a>=1?i[o]:i[o]*(a+1)}return g.Tensor.make(t.shape,{values:n})},e.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=m.SELU_SCALEALPHA,n=m.SELU_SCALE,r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?n*a:t*(Math.exp(a)-1)}return g.Tensor.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o];r[o]=a>n?n:a<t?t:a}return g.Tensor.make(e.shape,{values:r})},e.prototype.abs=function(e){this.assertNotComplex(e,"abs");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=n[r];return g.Tensor.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return g.Tensor.make(e.shape,{values:t})},e.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i){var o=r[i]>-t,a=r[i]<t,s=Math.exp(r[i]),u=void 0;u=a?s:o?r[i]:Math.log(1+s),n[i]=u}return g.Tensor.make(e.shape,{values:n})},e.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},e.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=b.tanh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return g.Tensor.make(e.shape,{values:t})},e.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=e.dataSync(),r=h.ERF_P,i=h.ERF_A1,o=h.ERF_A2,a=h.ERF_A3,s=h.ERF_A4,u=h.ERF_A5,l=0;l<n.length;++l){var c=n[l],p=1/(1+r*c);t[l]=1-((((u*p+s)*p+a)*p+o)*p+i)*p*Math.exp(-c*c)}return g.Tensor.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:t}return g.Tensor.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=f.buffer(n.outShape,e.dtype),c=e.dataSync(),p=t.dataSync(),h=l.values,d=0;d<n.batchSize;++d)for(var m=d*e.strides[0],y=d*l.strides[0],g=0;g<n.outHeight;++g)for(var v=y+g*l.strides[1],b=g*n.strideHeight-s,_=0;_<r;_++){var w=b+_*o;if(!(w<0||w>=n.inHeight))for(var S=_*t.strides[0],x=m+w*e.strides[1],T=0;T<n.outWidth;++T)for(var P=v+T*n.outChannels,N=T*n.strideWidth-u,A=0;A<i;A++){var k=N+A*a;if(!(k<0||k>=n.inWidth))for(var E=S+A*t.strides[1],O=x+k*n.inChannels,I=E,M=0;M<n.inChannels;++M){for(var C=c[O+M],R=0;R<n.outChannels;++R)h[P+R]+=C*p[I+R];I+=n.outChannels}}}return l.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var r=f.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=e.dataSync(),c=e.strides,p=c[0],h=c[1],d=c[2],m=t.dataSync(),y=t.strides,g=y[0],v=y[1],b=y[2],_=n.batchSize,w=n.filterHeight,S=n.filterWidth,x=n.inChannels,T=n.inHeight,P=n.inWidth,N=n.outChannels,A=n.outHeight,k=n.outWidth,E=n.strideHeight,O=n.strideWidth,I=w-1-n.padInfo.top,M=S-1-n.padInfo.left,C=0;C<_;++C)for(var R=0;R<x;++R)for(var z=0;z<T;++z)for(var D=z-I,L=Math.max(0,Math.ceil(D/E)),F=Math.min(A,(w+D)/E),V=0;V<P;++V){for(var q=V-M,j=Math.max(0,Math.ceil(q/O)),B=Math.min(k,(S+q)/O),U=0,G=L;G<F;++G)for(var W=G*E-D,H=j;H<B;++H)for(var Q=p*C+h*G+d*H,K=g*(w-1-W)+v*(S-1-(H*O-q))+b*R,$=0;$<N;++$){U+=l[Q+$]*m[K+$]}i[a*C+s*z+u*V+R]=U}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=f.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=0;c<o;++c)for(var p=Math.max(0,Math.ceil((l-c)/r)),h=Math.min(n.outHeight,(n.inHeight+l-c)/r),d=0;d<a;++d)for(var m=Math.max(0,Math.ceil((u-d)/i)),y=Math.min(n.outWidth,(n.inWidth+u-d)/i),g=0;g<n.inChannels;++g)for(var v=0;v<n.outChannels;++v){for(var b=0,_=0;_<n.batchSize;++_)for(var w=p;w<h;++w)for(var S=c+w*r-l,x=m;x<y;++x){var T=d+x*i-u;b+=e.get(_,S,T,g)*t.get(_,w,x,v)}s.set(b,c,d,g,v)}return s.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=f.buffer(n.outShape,e.dtype),p=e.dataSync(),h=t.dataSync(),d=c.values,m=0;m<n.batchSize;++m)for(var y=m*e.strides[0],g=m*c.strides[0],v=0;v<n.outHeight;++v)for(var b=g+v*c.strides[1],_=v*n.strideHeight-s,w=0;w<r;++w){var S=_+w*o;if(!(S<0||S>=n.inHeight))for(var x=w*t.strides[0],T=y+S*e.strides[1],P=0;P<n.outWidth;++P)for(var N=b+P*c.strides[2],A=P*n.strideWidth-u,k=0;k<i;++k){var E=A+k*a;if(!(E<0||E>=n.inWidth))for(var O=x+k*t.strides[1],I=T+E*n.inChannels,M=N,C=O,R=0;R<n.inChannels;++R){for(var z=p[I+R],D=0;D<l;++D)d[M+D]+=z*h[C+D];M+=l,C+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=f.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=e.dataSync(),c=e.strides,p=c[0],h=c[1],d=c[2],m=t.dataSync(),y=t.strides,g=y[0],v=y[1],b=y[2],_=n.batchSize,w=n.filterHeight,S=n.filterWidth,x=n.inChannels,T=n.inHeight,P=n.inWidth,N=n.outChannels,A=n.outHeight,k=n.outWidth,E=n.strideHeight,O=n.strideWidth,I=w-1-n.padInfo.top,M=S-1-n.padInfo.left,C=N/x,R=0;R<_;++R)for(var z=0;z<x;++z)for(var D=0;D<T;++D)for(var L=D-I,F=Math.max(0,Math.ceil(L/E)),V=Math.min(A,(w+L)/E),q=0;q<P;++q){for(var j=q-M,B=Math.max(0,Math.ceil(j/O)),U=Math.min(k,(S+j)/O),G=0,W=F;W<V;++W)for(var H=W*E-L,Q=B;Q<U;++Q)for(var K=p*R+h*W+d*Q,$=g*(w-1-H)+v*(S-1-(Q*O-j))+b*z,X=0;X<C;++X){G+=l[K+(z*C+X)]*m[$+X]}i[a*R+s*D+u*q+z]=G}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=f.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=0;p<o;++p)for(var h=Math.max(0,Math.ceil((l-p)/r)),d=Math.min(n.outHeight,(n.inHeight+l-p)/r),m=0;m<a;++m)for(var y=Math.max(0,Math.ceil((u-m)/i)),g=Math.min(n.outWidth,(n.inWidth+u-m)/i),v=0;v<n.outChannels;++v){for(var b=Math.trunc(v/c),_=v%c,w=0,S=0;S<n.batchSize;++S)for(var x=h;x<d;++x)for(var T=p+x*r-l,P=y;P<g;++P){var N=m+P*i-u;w+=e.get(S,T,N,b)*t.get(S,x,P,v)}s.set(w,p,m,b,_)}return s.toTensor()},e.prototype.tile=function(e,t){this.assertNotComplex(e,"tile");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=f.buffer(n,e.dtype),o=e.buffer();for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=a[u]%e.shape[u];var l=o.locToIndex(s);i.values[r]=o.values[l]}return i.toTensor()},e.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),o=e.buffer(),a=f.buffer(r,e.dtype);0!==n&&a.values.fill(n);for(var s=0;s<e.size;s++){var u=o.indexToLoc(s),l=u.map((function(e,t){return e+i[t]}));a.set.apply(a,[e.get.apply(e,u)].concat(l))}return a.toTensor()},e.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=e.dataSync(),o=d.buffer(n,e.dtype),a=e.buffer();for(r=0;r<e.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=o.locToIndex(u);o.values[c]=i[r]}return o.toTensor()},e.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var r=e.shape.slice(),i=t.dataSync();r[n]=i.length;for(var o=d.buffer(r,e.dtype),a=e.buffer(),s=0;s<o.size;++s){var u=o.indexToLoc(s),l=u.slice();l[n]=i[u[n]];var c=a.locToIndex(l);o.values[s]=a.values[c]}return o.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=u.getReshaped(e.shape,t,r),o=u.getPermuted(i.length,t.length),a=u.getReshapedPermuted(e.shape,t,r),s=u.getSliceBeginCoords(n,t.length),l=u.getSliceSize(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,l)},e.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=u.getReshaped(a.shape,t,r,!1),l=u.getPermuted(s.length,t.length,!1),c=u.getReshapedPermuted(a.shape,t,r,!1);return a.reshape(s).transpose(l).reshape(c)},e.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,o=t.filterHeight,a=t.filterWidth,s=f.buffer(t.outShape,"float32"),u=t.padInfo.top,l=t.padInfo.left,c="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=0;p<t.batchSize;++p)for(var h=0;h<t.inChannels;++h)for(var d=0;d<t.outHeight;++d)for(var m=d*r-u,y=Math.max(0,m),g=Math.min(t.inHeight,o+m),v=0;v<t.outWidth;++v){for(var b=v*i-l,_=Math.max(0,b),w=Math.min(t.inWidth,a+b),S=c,x=0,T=0,P=y;P<g;++P){for(var N=_;N<w;++N){var A=e.get(p,P,N,h);"max"===n&&A>S?S=A:"avg"===n&&(x+=A,T++)}if(isNaN(S))break}s.set("avg"===n?x/T:S,p,d,v,h)}return s.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=f.buffer(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,o=t.filterHeight,a=t.filterWidth,s=t.padInfo.top,u=t.padInfo.left,l=0;l<t.batchSize;++l)for(var c=0;c<t.inChannels;++c)for(var p=0;p<t.outHeight;++p)for(var h=p*r-s,d=Math.max(0,h),m=Math.min(t.inHeight,o+h),y=0;y<t.outWidth;++y){for(var g=y*i-u,v=Math.max(0,g),b=Math.min(t.inWidth,a+g),_=Number.NEGATIVE_INFINITY,w=-1,S=d;S<m;++S)for(var x=S-h,T=v;T<b;++T){var P=T-g,N=e.get(l,S,T,c);N>_&&(_=N,w=x*a+P)}n.set(w,l,p,y,c)}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){this.assertNotComplex([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),o=r.strideHeight,a=r.strideWidth,s=r.filterHeight,u=r.filterWidth,l=u-1-r.padInfo.left,c=s-1-r.padInfo.top,p=f.buffer(t.shape,"float32"),h=0;h<r.batchSize;++h)for(var d=0;d<r.inChannels;++d)for(var m=0;m<r.inHeight;++m)for(var y=0;y<r.inWidth;++y){for(var g=m-c,v=y-l,b=0,_=0;_<s;++_){var w=(g+_)/o;if(!(w<0||w>=r.outHeight||Math.floor(w)!==w))for(var S=0;S<u;++S){var x=(v+S)/a;if(!(x<0||x>=r.outWidth||Math.floor(x)!==x)){var T=s*u-1-i.get(h,w,x,d)===_*u+S?1:0;if(0!==T)b+=e.get(h,w,x,d)*T}}}p.set(b,h,m,y,d)}return p.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=a-1-n.padInfo.left,u=o-1-n.padInfo.top,l=f.buffer(t.shape,"float32"),c=1/(o*a),p=0;p<n.batchSize;++p)for(var h=0;h<n.inChannels;++h)for(var d=0;d<n.inHeight;++d)for(var m=0;m<n.inWidth;++m){for(var y=d-u,g=m-s,v=0,b=0;b<o;++b){var _=(y+b)/r;if(!(_<0||_>=n.outHeight||Math.floor(_)!==_))for(var w=0;w<a;++w){var S=(g+w)/i;if(!(S<0||S>=n.outWidth||Math.floor(S)!==S))v+=e.get(p,_,S,h)}}l.set(v*c,p,d,m,h)}return l.toTensor()},e.prototype.cast=function(e,t){return w.castTensor(e,t,this)},e.prototype.reshape=function(e,t){return w.reshapeTensor(e,t)},e.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){this.assertNotComplex(e,"resizeBilinear");for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=f.buffer([o,t,n,u],e.dtype),c=[r&&t>1?a-1:a,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0;h<o;h++)for(var d=0;d<t;d++)for(var m=0;m<n;m++)for(var y=0;y<u;y++){var g=c[0]*d/p[0],v=c[1]*m/p[1],b=Math.floor(g),_=Math.min(a-1,Math.ceil(g)),w=Math.floor(v),S=Math.min(s-1,Math.ceil(v)),x=e.get(h,b,w,y),T=e.get(h,_,w,y),P=v-w,N=x+(e.get(h,b,S,y)-x)*P,A=N+(T+(e.get(h,_,S,y)-T)*P-N)*(g-b);l.set(A,h,d,m,y)}return l.toTensor()},e.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],p=f.buffer([i,o,a,s],t.dtype),h=[n&&l>1?o-1:o,n&&c>1?a-1:a],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=h[0]/d[0],y=h[1]/d[1],g=0;g<i;g++)for(var v=0;v<l;v++)for(var b=v*m,_=Math.floor(b),w=Math.min(Math.ceil(b),o-1),S=b-_,x=1-S,T=0;T<c;T++)for(var P=T*y,N=Math.floor(P),A=Math.min(Math.ceil(P),a-1),k=P-N,E=1-k,O=0;O<s;O++){var I=e.get(g,v,T,O),M=p.get(g,_,N,O);M+=I*x*E,p.set(M,g,_,N,O);var C=p.get(g,_,A,O);C+=I*x*k,p.set(C,g,_,A,O);var R=p.get(g,w,N,O);R+=I*S*E,p.set(R,g,w,N,O);var z=p.get(g,w,A,O);z+=I*S*k,p.set(z,g,w,A,O)}return p.toTensor()},e.prototype.resizeNearestNeighbor=function(e,t,n,r){this.assertNotComplex(e,"resizeNearestNeighbor");for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=f.buffer([o,t,n,u],e.dtype),c=[r&&t>1?a-1:a,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0;h<o;h++)for(var d=0;d<t;d++)for(var m=0;m<n;m++)for(var y=0;y<u;y++){var g=c[0]*d/p[0],v=c[1]*m/p[1],b=Math.min(a-1,r?Math.round(g):Math.floor(g)),_=Math.min(s-1,r?Math.round(v):Math.floor(v)),w=e.get(h,b,_,y);l.set(w,h,d,m,y)}return l.toTensor()},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],p=f.buffer([i,o,a,s],t.dtype),h=[n&&l>1?o-1:o,n&&c>1?a-1:a],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=1/(h[0]/d[0]),y=1/(h[1]/d[1]),g=2*Math.ceil(m)+2,v=2*Math.ceil(y)+2,b=0;b<i;b++)for(var _=0;_<o;_++)for(var w=0;w<a;w++)for(var S=Math.floor(_*m),x=Math.floor(S-g/2),T=Math.floor(w*y),P=Math.floor(T-v/2),N=0;N<s;N++){for(var A=0,k=0;k<g;k++){var E=k+x;if(!(E<0||E>=l))for(var O=0;O<v;O++){var I=O+P;if(!(I<0||I>=c)){var M=h[0]*(E/d[0]),C=h[1]*(I/d[1]),R=Math.min(o-1,n?Math.round(M):Math.floor(M)),z=Math.min(a-1,n?Math.round(C):Math.floor(C));_===R&&w===z&&(A+=e.get(b,E,I,N))}}}p.set(A,b,_,w,N)}return p.toTensor()},e.prototype.batchNormalization=function(e,t,n,r,i,o){this.assertNotComplex([e,t,n,i,o],"batchNormalization");for(var a=e.dataSync(),s=t.dataSync(),u=n.dataSync(),l=i?i.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,m=u.length,y=s.length,g=0,v=0,b=0,_=0,w=0;w<a.length;++w)p[w]=c[g++]+(a[w]-s[v++])*l[b++]/Math.sqrt(u[_++]+r),g>=h&&(g=0),v>=y&&(v=0),b>=f&&(b=0),_>=m&&(_=0);return d.tensor4d(p,e.shape)},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){this.assertNotComplex(e,"localResponseNormalization4D");var o=e.shape[3],a=o-1,s=e.dataSync(),u=b.sizeFromShape(e.shape),l=new Float32Array(u);function c(e){for(var n=e%o,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,a),u=0;r<=i;r++){var l=s[r];u+=l*l}return u}for(var p=0;p<u;p++){var h=c(p),d=s[p]*Math.pow(n+r*h,-i);l[p]=d}return f.tensor4d(l,e.shape)},e.prototype.LRNGrad=function(e,t,n,r,i,o,a){this.assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],u=e.dataSync(),l=t.dataSync(),c=n.dataSync(),p=new Float32Array(b.sizeFromShape(e.shape)),h=b.sizeFromShape(e.shape),d=0;d<h;d++){for(var m=d%s,y=d-m+Math.max(0,m-r),g=d-m+Math.min(s,m+r+1),v=0,_=y;_<g;_++)v+=Math.pow(l[_],2);v=o*v+i;for(_=y;_<g;_++){var w=-2*o*a*l[_]*c[d]/v;d===_&&(w+=Math.pow(v,-a)),w*=u[d],p[_]+=w}}return f.tensor4d(p,e.shape)},e.prototype.multinomial=function(e,t,n,r){this.assertNotComplex(e,"multinomial");for(var i=t?e:f.softmax(e),a=i.shape[0],s=i.shape[1],u=f.zeros([a,n],"int32"),l=u.dataSync(),c=i.dataSync(),p=0;p<a;++p){var h=p*s,d=new Float32Array(s-1);d[0]=c[h];for(var m=1;m<d.length;++m)d[m]=d[m-1]+c[h+m];for(var y=o.alea(r.toString()),g=p*n,v=0;v<n;++v){var b=y();l[g+v]=d.length;for(var _=0;_<d.length;_++)if(b<d[_]){l[g+v]=_;break}}}return u},e.prototype.oneHot=function(e,t,n,r){this.assertNotComplex(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var o=0;o<e.size;++o)e.get(o)>=0&&e.get(o)<t&&(i[o*t+e.get(o)]=n);return f.tensor2d(i,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){this.assertNotComplex(e,"nonMaxSuppression");var o=e.dataSync(),a=t.dataSync();return x.nonMaxSuppressionImpl(o,a,n,r,i)},e.prototype.depthToSpace=function(e,t,n){b.assert("NHWC"===n,"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n),b.assert(t>1,"blockSize should be > 1 for depthToSpace, but was: "+t);for(var r=e.shape[0],i=e.shape[1],o=e.shape[2],a=e.shape[3],s=i*t,u=o*t,l=a/(t*t),c=e.dataSync(),p=new Float32Array(r*s*u*l),h=0,d=0;d<r;++d)for(var m=0;m<s;++m)for(var y=Math.floor(m/t),g=m%t,v=0;v<u;++v)for(var _=Math.floor(v/t),w=(g*t+v%t)*l,S=0;S<l;++S){var x=S+w+a*(_+o*(y+i*d));p[h++]=c[x]}return f.tensor4d(p,[r,s,u,l])},e.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=c.assertAndGetBroadcastShape(e.shape,t.shape),o=f.buffer(i,n),a=e.dataSync(),s=t.dataSync(),u=c.getBroadcastDims(e.shape,i),l=c.getBroadcastDims(t.shape,i),p=o.values;if(u.length+l.length===0)for(var h=0;h<p.length;++h)p[h]=r(a[h%a.length],s[h%s.length]);else{var d=e.buffer(),m=t.buffer(),y=function(n){var i=o.indexToLoc(n),c=i.slice(-e.rank);u.forEach((function(e){return c[e]=0}));var h=d.locToIndex(c),f=i.slice(-t.rank);l.forEach((function(e){return f[e]=0}));var y=m.locToIndex(f);p[n]=r(a[h],s[y])};for(h=0;h<p.length;++h)y(h)}return o.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=c.assertAndGetBroadcastShape(e.shape,t.shape),i=f.buffer(r,"float32"),o=f.buffer(r,"float32"),a=e.dataSync(),s=t.dataSync(),u=c.getBroadcastDims(e.shape,r),l=c.getBroadcastDims(t.shape,r),p=i.values,h=o.values;if(u.length+l.length===0)for(var d=0;d<p.length;d++){var m=d%a.length,y=d%s.length,g=n(a[2*m],a[2*m+1],s[2*y],s[2*y+1]);p[d]=g.real,h[d]=g.imag}else{var v=this.data.get(e.dataId).complexTensors.real.buffer(),b=this.data.get(t.dataId).complexTensors.real.buffer(),_=function(r){var o=i.indexToLoc(r),c=o.slice(-e.rank);u.forEach((function(e){return c[e]=0}));var f=v.locToIndex(c),d=o.slice(-t.rank);l.forEach((function(e){return d[e]=0}));var m=b.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);p[r]=y.real,h[r]=y.imag};for(d=0;d<p.length;d++)_(d)}return this.complex(i.toTensor(),o.toTensor())},e.prototype.split=function(e,t,n){return T.split(e,t,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.cropAndResize=function(e,t,n,r,i,o){for(var a=e.shape,s=a[0],u=a[1],l=a[2],c=a[3],p=t.shape[0],h=r[0],d=r[1],m=f.buffer([p,h,d,c]),y=t.dataSync(),g=n.dataSync(),v=e.dataSync(),b=e.strides,_=m.strides,w=0;w<p;w++){var S=4*w,x=y[S],T=y[S+1],P=y[S+2],N=y[S+3],A=g[w];if(!(A>=s))for(var k=h>1?(P-x)*(u-1)/(h-1):0,E=d>1?(N-T)*(l-1)/(d-1):0,O=0;O<h;O++){var I=h>1?x*(u-1)+O*k:.5*(x+P)*(u-1);if(I<0||I>u-1)for(var M=0;M<d;M++)for(var C=0;C<c;C++){var R=C+M*_[2]+O*_[1]+w*_[0];m.values[R]=o}else if("bilinear"===i){var z=Math.floor(I),D=Math.ceil(I),L=I-z;for(M=0;M<d;M++){if((H=d>1?T*(l-1)+M*E:.5*(T+N)*(l-1))<0||H>l-1)for(C=0;C<c;C++){R=C+M*_[2]+O*_[1]+w*_[0];m.values[R]=o}else{var F=Math.floor(H),V=Math.ceil(H),q=H-F;for(C=0;C<c;C++){var j=v[R=C+F*b[2]+z*b[1]+A*b[0]],B=v[R=C+V*b[2]+z*b[1]+A*b[0]],U=v[R=C+F*b[2]+D*b[1]+A*b[0]],G=j+(B-j)*q,W=U+(v[R=C+V*b[2]+D*b[1]+A*b[0]]-U)*q;R=C+M*_[2]+O*_[1]+w*_[0],m.values[R]=G+(W-G)*L}}}}else for(M=0;M<d;++M){var H;if((H=d>1?T*(l-1)+M*E:.5*(T+N)*(l-1))<0||H>l-1)for(C=0;C<c;C++){R=C+M*_[2]+O*_[1]+w*_[0];m.values[R]=o}else{var Q=Math.round(H),K=Math.round(I);for(C=0;C<c;C++){var $=C+Q*b[2]+K*b[1]+A*b[0],X=C+M*_[2]+O*_[1]+w*_[0];m.values[X]=v[$]}}}}}return m.toTensor()},e}();n.MathBackendCPU=A,a.ENV.registerBackend("cpu",(function(){return new A}),1,g.setTensorTracker)},{"../environment":62,"../log":131,"../ops/array_ops_util":133,"../ops/axis_util":134,"../ops/broadcast_util":137,"../ops/concat_util":141,"../ops/erf_util":144,"../ops/ops":155,"../ops/selu_util":164,"../ops/slice_util":166,"../tensor":185,"../types":191,"../util":192,"./backend_util":79,"./complex_util":81,"./non_max_suppression_impl":82,"./split_shared":83,"./topk_impl":84,"./where_impl":130,seedrandom:278}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../ops/tensor_ops"),i=e("../tensor"),o=e("../util");n.castTensor=function(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var a=r.zeros(e.shape),s=e.toFloat(),u=n.complex(s,a);return a.dispose(),s.dispose(),u}if(!o.hasEncodingLoss(e.dtype,t))return i.Tensor.make(e.shape,{dataId:e.dataId},t);if("complex64"===e.dtype){var l=n.real(e);u=l.cast(t);return l.dispose(),u}if("int32"===t)return n.int(e);if("bool"===t){var c=r.scalar(0,e.dtype);u=n.notEqual(e,c);return c.dispose(),u}throw new Error("Error in Cast: unknown dtype argument ("+t+")")},n.reshapeTensor=function(e,t){return i.Tensor.make(t,{dataId:e.dataId},e.dtype)}},{"../ops/tensor_ops":169,"../tensor":185,"../util":192}],80:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../log"),u=e("../ops/array_ops_util"),l=e("../ops/axis_util"),c=e("../ops/concat_util"),p=e("../ops/reduce_util"),h=e("../ops/segment_util"),f=e("../ops/slice_util"),d=e("../ops/softmax"),m=e("../ops/tensor_ops"),y=e("../tensor"),g=e("../types"),v=e("../util"),b=e("../util"),_=e("./backend_util"),w=e("./complex_util"),S=e("./non_max_suppression_impl"),x=e("./split_shared"),T=e("./topk_impl"),P=e("./webgl/argminmax_gpu"),N=e("./webgl/avg_pool_backprop_gpu"),A=e("./webgl/batchnorm_gpu"),k=e("./webgl/binaryop_complex_gpu"),E=e("./webgl/binaryop_complex_gpu"),O=e("./webgl/binaryop_gpu"),I=e("./webgl/binaryop_gpu"),M=e("./webgl/clip_gpu"),C=e("./webgl/concat_gpu"),R=e("./webgl/conv_backprop_gpu"),z=e("./webgl/conv_backprop_gpu_depthwise"),D=e("./webgl/conv_gpu"),L=e("./webgl/crop_and_resize_gpu"),F=e("./webgl/conv_gpu_depthwise"),V=e("./webgl/cumsum_gpu"),q=e("./webgl/depth_to_space_gpu"),j=e("./webgl/encode_float_gpu"),B=e("./webgl/from_pixels_gpu"),U=e("./webgl/gather_gpu"),G=e("./webgl/gpgpu_context"),W=e("./webgl/gpgpu_math"),H=e("./webgl/gpgpu_util"),Q=e("./webgl/lrn_gpu"),K=e("./webgl/lrn_grad_gpu"),$=e("./webgl/max_pool_backprop_gpu"),X=e("./webgl/mulmat_gpu"),Y=e("./webgl/multinomial_gpu"),J=e("./webgl/onehot_gpu"),Z=e("./webgl/pad_gpu"),ee=e("./webgl/pool_gpu"),te=e("./webgl/reduce_gpu"),ne=e("./webgl/resize_bilinear_backprop_gpu"),re=e("./webgl/resize_bilinear_gpu"),ie=e("./webgl/resize_nearest_neighbor_backprop_gpu"),oe=e("./webgl/resize_nearest_neighbor_gpu"),ae=e("./webgl/reverse_gpu"),se=e("./webgl/segment_gpu"),ue=e("./webgl/select_gpu"),le=e("./webgl/slice_gpu"),ce=e("./webgl/strided_slice_gpu"),pe=e("./webgl/tex_util"),he=e("./webgl/texture_manager"),fe=e("./webgl/tile_gpu"),de=e("./webgl/transpose_gpu"),me=e("./webgl/unaryop_gpu"),ye=e("./webgl/unaryop_gpu"),ge=e("./webgl/webgl_util"),ve=e("./where_impl");n.SIZE_UPLOAD_UNIFORM=32;var be=function(){function e(e,t){if(void 0===t&&(t=!0),this.gpgpu=e,this.delayedStorage=t,this.texData=new WeakMap,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,o.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");o.ENV.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas")),null==e?(this.gpgpu=new G.GPGPUContext(H.createWebGLContext(this.canvas)),this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*300,this.textureManager=new he.TextureManager(this.gpgpu)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n,values:null,texture:null,complexTensors:null,texShape:null,usage:pe.TextureUsage.RENDER})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixelsCanvas){if(!o.ENV.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixelsCanvas=document.createElement("canvas")}this.fromPixelsCanvas.width=e.width,this.fromPixelsCanvas.height=e.height,this.fromPixelsCanvas.getContext("2d").drawImage(e,0,0,e.width,e.height),e=this.fromPixelsCanvas}var i=y.Tensor.make(n,{},"int32");this.texData.get(i.dataId).usage=pe.TextureUsage.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),e);var a=new B.FromPixelsProgram(r),s=this.compileAndRun(a,[i]);return i.dispose(),s},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(e);var n=this.texData.get(e),r=n.texture,i=n.texShape,o=n.usage;if("complex64"===n.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=r&&(this.releaseTexture(e,r,i,o),n.texture=null,n.texShape=null),n.usage=pe.TextureUsage.UPLOAD,n.values=t,this.delayedStorage||this.uploadToGPU(e)},e.prototype.readSync=function(e){this.throwIfNoData(e);var t=this.texData.get(e),n=t.shape,r=t.texture,i=t.values,o=t.texShape,a=t.dtype,s=t.complexTensors;if(null!=i)return this.cacheOnCPU(e),i;var u,l,c=null!=this.activeTimers;if(c&&(u=performance.now()),"complex64"===a){var p=s.real.dataSync(),h=s.imag.dataSync();l=w.mergeRealAndImagArrays(p,h)}else l=this.getValuesFromTexture(r,e,a,o,n);return c&&(this.downloadWaitMs+=performance.now()-u),this.cacheOnCPU(e,l),t.values},e.prototype.read=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,u,l,c,p,h;return i(this,(function(i){switch(i.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(this.throwIfNoData(e),n=this.texData.get(e),r=n.shape,a=n.texture,s=n.values,u=n.texShape,l=n.dtype,null!=s)return this.cacheOnCPU(e),[2,s];if(this.pendingRead.set(e,[]),!o.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===o.ENV.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return c=this.gpgpu.maybeCreateBufferFromTexture(a,u[0],u[1]),[4,this.gpgpu.createAndWaitForFence()];case 1:return i.sent(),p=c instanceof WebGLTexture?this.getValuesFromTexture(a,e,l,u,r):this.gpgpu.downloadFloat32MatrixFromBuffer(c,u[0],u[1]),this.cacheOnCPU(e,p),h=this.pendingRead.get(e),this.pendingRead.delete(e),h.forEach((function(e){return e(p)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,p]}}))}))},e.prototype.getValuesFromTexture=function(e,t,n,r,i){if(o.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED"))return this.gpgpu.downloadFloat32MatrixFromOutputTexture(e,r[0],r[1]);var a=y.Tensor.make(i,{});this.texData.get(a.dataId).usage=pe.TextureUsage.DOWNLOAD;var s=y.Tensor.make(i,{dataId:t},n),u=new j.EncodeFloatProgram(i);this.compileAndRun(u,[s],a,null,!1);var l=this.texData.get(a.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture,l.texShape[0],l.texShape[1]);return s.dispose(),a.dispose(),c},e.prototype.time=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s;return i(this,(function(i){switch(i.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=v.flatten(this.activeTimers),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(o).then((function(e){var t=0;return e.forEach((function(e){return t+=e})),t}))];case 1:return a=i.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:a,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){return o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),n=t.texture,r=t.texShape,i=t.usage,o=t.complexTensors;null!=n&&this.releaseTexture(e,n,r,i),null!=o&&(o.real.dispose(),o.imag.dispose()),this.texData.delete(e)}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.complex=function(e,t){var n=y.Tensor.make(e.shape,{},"complex64");return this.texData.get(n.dataId).complexTensors={real:o.ENV.engine.keep(e.clone()),imag:o.ENV.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},e.prototype.slice=function(e,t,n){var r=new le.SliceProgram(n),i=r.getCustomSetupFunc(t);return this.compileAndRun(r,[e],null,i)},e.prototype.stridedSlice=function(e,t,n,r,i,o,a,s,u){var l=f.getStridedSlicedInfo(e.shape,t,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],d=p.filter((function(e,t){return-1===h.indexOf(t)}));if(d.some((function(e){return 0===e})))return m.tensor([],d);var y=new ce.StridedSliceProgram(c,r,p,h);return this.compileAndRun(y,[e])},e.prototype.reverse=function(e,t){var n=new ae.ReverseProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat2Tensors=function(e,t,n){var r=c.computeOutShape([e.shape,t.shape],n),i=e.as2D(-1,b.sizeFromShape(e.shape.slice(n))),o=t.as2D(-1,b.sizeFromShape(t.shape.slice(n))),a=new C.ConcatProgram(i.shape,o.shape);return this.compileAndRun(a,[i,o]).reshape(r)},e.prototype.concat=function(e,t){if(1===e.length)return e[0];for(var n=e[0],r=1;r<e.length;++r)n=this.concat2Tensors(n,e[r],t);return n},e.prototype.neg=function(e){var t=new ye.UnaryOpProgram(e.shape,me.NEG);return this.compileAndRun(t,[e])},e.prototype.batchMatMul=function(e,t,n,r){var i=new X.MatMulProgram(e.shape,t.shape,n,r);return this.compileAndRun(i,[e,t])},e.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new E.BinaryOpComplexProgram(k.COMPLEX_MULTIPLY.REAL,e.shape,t.shape),o=new E.BinaryOpComplexProgram(k.COMPLEX_MULTIPLY.IMAG,e.shape,t.shape),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),l=this.complex(s,u);return s.dispose(),u.dispose(),l}var c=new I.BinaryOpProgram(O.MUL,e.shape,t.shape),p=this.makeOutputArray(c.outputShape,e.dtype);return this.compileAndRun(c,[e,t],p)},e.prototype.batchNormalization=function(e,t,n,r,i,o){var a=[e,t,n],s=null;null!=o&&(s=o.shape,a.push(o));var u=null;null!=i&&(u=i.shape,a.push(i));var l=new A.BatchNormProgram(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){var o=new Q.LRNProgram(e.shape,t,n,r,i);return this.compileAndRun(o,[e])},e.prototype.LRNGrad=function(e,t,n,r,i,o,a){var s=new K.LRNGradProgram(t.shape,r,i,o,a);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){var n=new fe.TileProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=new Z.PadProgram(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){var n=new de.TransposeProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){var r=new U.GatherProgram(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){v.assert(e.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var r=t.reduce((function(e,t){return e*t})),i=u.getReshaped(e.shape,t,r),o=u.getPermuted(i.length,t.length),a=u.getReshapedPermuted(e.shape,t,r),s=u.getSliceBeginCoords(n,t.length),l=u.getSliceSize(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,l)},e.prototype.spaceToBatchND=function(e,t,n){v.assert(e.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=u.getReshaped(a.shape,t,r,!1),l=u.getPermuted(s.length,t.length,!1),c=u.getReshapedPermuted(a.shape,t,r,!1);return a.reshape(s).transpose(l).reshape(c)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],o={windowSize:p.computeOptimalWindowSize(i),inSize:i,batchSize:r},a=new te.ReduceProgram(o,t),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(a,[e],c),1===c.shape[1]?c:this.reduce(c,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o={windowSize:p.computeOptimalWindowSize(i),inSize:i,batchSize:r},a=new P.ArgMinMaxProgram(o,t,null==n),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),h=[e];return null!=n&&h.push(n),this.compileAndRun(a,h,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.sum=function(e,t){l.assertAxesAreInnerMostDims("sum",t,e.rank);var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.sizeFromShape(i),a=e.as2D(-1,o),s=g.sumOutType(e.dtype);return this.reduce(a,"sum",s).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=l.getAxesPermutation([r],e.rank),o=e;null!=i&&(o=e.transpose(i),r=l.getInnerMostAxes(1,e.rank)[0]);var a=h.computeOutShape(o.shape,r,n),s=v.sizeFromShape([o.shape[r]]),u=o.as2D(-1,s),c=g.sumOutType(e.dtype),p=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(a);return null!=i&&(p=p.transpose(l.getUndoAxesPermutation(i))),p},e.prototype.segOpCompute=function(e,t,n,r,i){var o=e.shape[0],a=e.shape[1],s=h.segOpComputeOptimalWindowSize(a,i),u={windowSize:s,inSize:a,batchSize:o,numSegments:i},l=new se.SegmentOpProgram(u,t),c=l.outputShape,p=c[0],f=c[1],d=this.makeOutputArray([p,f],r);return this.compileAndRun(l,[e,n],d),d.shape[1]===i?d:(n=m.range(0,i).tile([a/s]),this.segOpCompute(d,t,n,r,i))},e.prototype.argMin=function(e,t){var n=[t];l.assertAxesAreInnerMostDims("argMin",n,e.rank);var r=l.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=v.sizeFromShape(o),s=e.as2D(-1,a);return this.argReduce(s,"min").reshape(i)},e.prototype.argMax=function(e,t){var n=[t];l.assertAxesAreInnerMostDims("argMax",n,e.rank);var r=l.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=v.sizeFromShape(o),s=e.as2D(-1,a);return this.argReduce(s,"max").reshape(i)},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new V.CumSumProgram(e.shape,n,r);return this.compileAndRun(i,[e])},e.prototype.equal=function(e,t){var n=new I.BinaryOpProgram(O.EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){var n=new I.BinaryOpProgram(O.NOT_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){var n=new I.BinaryOpProgram(O.LESS,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){var n=new I.BinaryOpProgram(O.LESS_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){var n=new I.BinaryOpProgram(O.GREATER,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){var n=new I.BinaryOpProgram(O.GREATER_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new ye.UnaryOpProgram(e.shape,me.LOGICAL_NOT);return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){var n=new I.BinaryOpProgram(O.LOGICAL_AND,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){var n=new I.BinaryOpProgram(O.LOGICAL_OR,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new ue.SelectProgram(e.rank,t.shape,t.rank),i=this.makeOutputArray(r.outputShape,g.upcastType(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],i)},e.prototype.where=function(e){s.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return ve.whereImpl(e.shape,t)},e.prototype.topk=function(e,t,n){var r=e.dataSync();return T.topkImpl(r,e.shape,e.dtype,t,n)},e.prototype.min=function(e,t){l.assertAxesAreInnerMostDims("min",t,e.rank);var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){var n=new I.BinaryOpProgram(O.MIN,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=new I.BinaryOpProgram(O.MOD,e.shape,t.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[e,t],null,r)},e.prototype.max=function(e,t){l.assertAxesAreInnerMostDims("max",t,e.rank);var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){var n=new I.BinaryOpProgram(O.MAX,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){l.assertAxesAreInnerMostDims("all",t,e.rank);var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){l.assertAxesAreInnerMostDims("any",t,e.rank);var n=l.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=v.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=new I.BinaryOpProgram(O.SQUARED_DIFFERENCE,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){var n=O.DIV,r=new I.BinaryOpProgram(n,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],i)},e.prototype.floorDiv=function(e,t){var n=O.INT_DIV,r=new I.BinaryOpProgram(n,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[e,t],i)},e.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,O.ADD);var n=new I.BinaryOpProgram(O.ADD,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,g.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],r)},e.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),o=this.texData.get(t.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map((function(i){var o=i[0],a=i[1],s=new I.BinaryOpProgram(n,e.shape,t.shape),u=r.makeOutputArray(s.outputShape,g.upcastType(o.dtype,a.dtype)),l=r.makeComplexComponentTensorHandle(e,o),c=r.makeComplexComponentTensorHandle(t,a);return r.compileAndRun(s,[l,c],u)})),s=a[0],u=a[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},e.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},e.prototype.addN=function(e){for(var t=e[0],n=1;n<e.length;n++)t=this.add(t,e[n]);return t},e.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,O.SUB);var n=new I.BinaryOpProgram(O.SUB,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,g.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],r)},e.prototype.pow=function(e,t){var n=new I.BinaryOpProgram(O.POW,e.shape,t.shape),r=n.getCustomSetupFunc(),i=this.makeOutputArray(n.outputShape,g.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],i,r)},e.prototype.ceil=function(e){var t=new ye.UnaryOpProgram(e.shape,me.CEIL);return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new ye.UnaryOpProgram(e.shape,me.FLOOR);return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SIGN);return this.compileAndRun(t,[e])},e.prototype.round=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ROUND);return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t=new ye.UnaryOpProgram(e.shape,me.EXP);return this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new ye.UnaryOpProgram(e.shape,me.EXPM1);return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t=new ye.UnaryOpProgram(e.shape,me.LOG),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.log1p=function(e){var t=new ye.UnaryOpProgram(e.shape,me.LOG1P);return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SQRT);return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){var t=new ye.UnaryOpProgram(e.shape,me.RSQRT);return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SQUARE);return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new ye.UnaryOpProgram(e.shape,me.RECIPROCAL);return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t=new ye.UnaryOpProgram(e.shape,me.RELU);return this.compileAndRun(t,[e])},e.prototype.elu=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ELU);return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=new I.BinaryOpProgram(O.ELU_DER,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SELU);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new ye.UnaryOpProgram(e.shape,me.TO_INT),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r=new M.ClipProgram(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.abs=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ABS);return this.compileAndRun(t,[e])},e.prototype.sigmoid=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SIGMOID);return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SOFTPLUS);return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SIN);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new ye.UnaryOpProgram(e.shape,me.COS);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new ye.UnaryOpProgram(e.shape,me.TAN);return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ASIN);return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ACOS);return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ATAN);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=new I.BinaryOpProgram(O.ATAN2,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.SINH);return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.COSH);return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.TANH);return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ASINH);return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ACOSH),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.atanh=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ATANH),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.erf=function(e){var t=new ye.UnaryOpProgram(e.shape,me.ERF);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new ye.UnaryOpProgram(e.shape,me.STEP(t));return this.compileAndRun(n,[e])},e.prototype.conv2d=function(e,t,n){var r=new D.Conv2DProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new R.Conv2DDerInputProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new R.Conv2DDerFilterProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r=new F.DepthwiseConv2DProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new z.DepthwiseConv2DDerInputProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new z.DepthwiseConv2DDerFilterProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new ee.Pool2DProgram(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new ee.Pool2DProgram(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var i=new ee.Pool2DProgram(r,"max",!0),o=this.compileAndRun(i,[t]),a=new $.MaxPool2DBackpropProgram(r),s=this.makeOutputArray(a.outputShape,t.dtype),u=this.compileAndRun(a,[e,o],s);return o.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,n){var r=new N.AvgPool2DBackpropProgram(n),i=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],i)},e.prototype.cast=function(e,t){return _.castTensor(e,t,this)},e.prototype.reshape=function(e,t){return _.reshapeTensor(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var i=new re.ResizeBilinearProgram(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new ne.ResizeBilinearBackpropProgram(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new oe.ResizeNearestNeighborProgram(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new ie.ResizeNearestNeigborBackpropProgram(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var i=t?e:d.softmax(e),o=i.shape[0],a=i.shape[1],s=new Y.MultinomialProgram(o,a,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],u,l)},e.prototype.oneHot=function(e,t,n,r){var i=new J.OneHotProgram(e.size,t,n,r);return this.compileAndRun(i,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,i){s.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e.dataSync(),a=t.dataSync();return S.nonMaxSuppressionImpl(o,a,n,r,i)},e.prototype.cropAndResize=function(e,t,n,r,i,o){var a=new L.CropAndResizeProgram(e.shape,t.shape,r,i,o);return this.compileAndRun(a,[e,t,n])},e.prototype.depthToSpace=function(e,t,n){v.assert(t>1,"blockSize should be > 1 for depthToSpace, but was: "+t);var r=e.shape[0],i=("NHWC"===n?e.shape[1]:e.shape[2])*t,o=("NHWC"===n?e.shape[2]:e.shape[3])*t,a=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),s="NHWC"===n?[r,i,o,a]:[r,a,i,o],u=new q.DepthToSpaceProgram(s,t,n);return this.compileAndRun(u,[e])},e.prototype.split=function(e,t,n){return x.split(e,t,n)},e.prototype.makeOutputArray=function(e,t){return y.Tensor.make(e,{},t)},e.prototype.compileAndRun=function(e,t,r,i,o){var a=this;if(void 0===o&&(o=!0),null==r&&(r=this.makeOutputArray(e.outputShape,t[0].dtype)),0===r.size)return this.texData.get(r.dataId).values=b.getTypedArrayFromDType(r.dtype,0),r;var s=t.map((function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var t=a.texData.get(e.dataId);return null==t.texture&&v.sizeFromShape(e.shape)<=n.SIZE_UPLOAD_UNIFORM?{shape:e.shape,texData:null,isUniform:!0,uniformValues:a.readSync(e.dataId)}:(a.uploadToGPU(e.dataId),{shape:e.shape,texData:t,isUniform:!1})}));this.uploadToGPU(r.dataId);var u,l={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},c=W.makeShaderKey(e,s,l),p=this.getAndSaveBinary(c,(function(){return W.compileProgram(a.gpgpu,e,s,l)})),h=null!=this.activeTimers;if(h&&(u=this.startTimer()),W.runProgram(p,s,l,i),o&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var f=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;f>0&&this.lruDataGPU.length>0;){var d=this.lruDataGPU.shift(),m=this.texData.get(d),y=m.shape,g=m.dtype;f-=this.computeBytes(y,g),this.read(d)}return h&&(u=this.endTimer(u),this.activeTimers.push(this.getQueryTime(u))),r},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var e in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixelsCanvas&&this.fromPixelsCanvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.floatPrecision=function(){var e=this;return a.tidy((function(){return e.abs(m.scalar(1e-8)).get()>0?32:16}))},e.prototype.throwIfNoData=function(e){if(!this.texData.has(e))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.uploadToGPU=function(e){this.throwIfNoData(e);var t=this.texData.get(e),n=t.shape,r=t.values,i=t.texture,o=(t.dtype,t.usage);if(null==i){var a,s=null!=this.activeTimers;s&&(a=performance.now());var u=ge.getTextureShapeFromLogicalShape(this.gpgpu.gl,n);t.texShape=u;var l,c=this.acquireTexture(e,u,o);t.texture=c,null!=r&&(this.gpgpu.uploadMatrixToTexture(c,u[0],u[1],(l=r)instanceof Float32Array?l:new Float32Array(l)),t.values=null,s&&(this.uploadWaitMs+=performance.now()-a))}else{this.lruDataGPU.indexOf(e)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))}},e.prototype.cacheOnCPU=function(e,t){var n=this.delayedStorage,r=this.texData.get(e),i=r.texture,o=r.texShape,a=r.dtype,s=r.usage;n&&null!=i&&(this.releaseTexture(e,i,o,s),r.texture=null,r.texShape=null),r.usage=pe.TextureUsage.UPLOAD,null!=t&&(r.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,a))},e.prototype.releaseTexture=function(e,t,n,r){var i=this.texData.get(e),o=i.shape,a=i.dtype,s=this.lruDataGPU.indexOf(e);s>=0&&this.lruDataGPU.splice(s,1),this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(t,n,r)},e.prototype.acquireTexture=function(e,t,n){var r=this.texData.get(e),i=r.shape,o=r.dtype;return this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(i,o),this.textureManager.acquireTexture(t,n)},e.prototype.computeBytes=function(e,t){return v.sizeFromShape(e)*v.bytesPerElement(t)},e}();n.MathBackendWebGL=be,o.ENV.get("IS_BROWSER")&&o.ENV.registerBackend("webgl",(function(){return new be}),2,y.setTensorTracker)},{"../environment":62,"../globals":64,"../log":131,"../ops/array_ops_util":133,"../ops/axis_util":134,"../ops/concat_util":141,"../ops/reduce_util":158,"../ops/segment_util":163,"../ops/slice_util":166,"../ops/softmax":167,"../ops/tensor_ops":169,"../tensor":185,"../types":191,"../util":192,"./backend_util":79,"./complex_util":81,"./non_max_suppression_impl":82,"./split_shared":83,"./topk_impl":84,"./webgl/argminmax_gpu":85,"./webgl/avg_pool_backprop_gpu":86,"./webgl/batchnorm_gpu":87,"./webgl/binaryop_complex_gpu":88,"./webgl/binaryop_gpu":89,"./webgl/clip_gpu":90,"./webgl/concat_gpu":91,"./webgl/conv_backprop_gpu":92,"./webgl/conv_backprop_gpu_depthwise":93,"./webgl/conv_gpu":94,"./webgl/conv_gpu_depthwise":95,"./webgl/crop_and_resize_gpu":96,"./webgl/cumsum_gpu":97,"./webgl/depth_to_space_gpu":98,"./webgl/encode_float_gpu":99,"./webgl/from_pixels_gpu":100,"./webgl/gather_gpu":101,"./webgl/gpgpu_context":102,"./webgl/gpgpu_math":103,"./webgl/gpgpu_util":104,"./webgl/lrn_gpu":105,"./webgl/lrn_grad_gpu":106,"./webgl/max_pool_backprop_gpu":107,"./webgl/mulmat_gpu":108,"./webgl/multinomial_gpu":109,"./webgl/onehot_gpu":110,"./webgl/pad_gpu":111,"./webgl/pool_gpu":112,"./webgl/reduce_gpu":113,"./webgl/resize_bilinear_backprop_gpu":114,"./webgl/resize_bilinear_gpu":115,"./webgl/resize_nearest_neighbor_backprop_gpu":116,"./webgl/resize_nearest_neighbor_gpu":117,"./webgl/reverse_gpu":118,"./webgl/segment_gpu":119,"./webgl/select_gpu":120,"./webgl/slice_gpu":122,"./webgl/strided_slice_gpu":123,"./webgl/tex_util":124,"./webgl/texture_manager":125,"./webgl/tile_gpu":126,"./webgl/transpose_gpu":127,"./webgl/unaryop_gpu":128,"./webgl/webgl_util":129,"./where_impl":130}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mergeRealAndImagArrays=function(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n},n.splitRealAndImagArrays=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}},{}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../ops/tensor_ops");function i(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-o)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(o,l),y=Math.max(a,c),g=Math.min(s,p),v=Math.min(u,h),b=Math.max(g-m,0)*Math.max(v-y,0);return b/(f+d-b)}n.nonMaxSuppressionImpl=function(e,t,n,o,a){for(var s=Array.from(t).map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=[],l=0;l<s.length;l++){var c=s[l],p=c.score,h=c.boxIndex;if(p<a)break;for(var f=!1,d=u.length-1;d>=0;--d){if(i(e,h,u[d])>=o){f=!0;break}}if(!f&&(u.push(h),u.length>=n))break}return r.tensor1d(u,"int32")}},{"../ops/tensor_ops":169}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.split=function(e,t,n){var r=Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var o=e.slice(r,i);return r[n]+=t,o}))}},{}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../ops/tensor_ops"),i=e("../util");n.topkImpl=function(e,t,n,o,a){for(var s=t[t.length-1],u=[e.length/s,s],l=u[0],c=u[1],p=i.getTypedArrayFromDType(n,l*o),h=i.getTypedArrayFromDType("int32",l*o),f=0;f<l;f++){for(var d=f*c,m=e.subarray(d,d+c),y=[],g=0;g<m.length;g++)y.push({value:m[g],index:g});y.sort((function(e,t){return t.value-e.value}));var v=f*o,b=p.subarray(v,v+o),_=h.subarray(v,v+o);for(g=0;g<o;g++)b[g]=y[g].value,_[g]=y[g].index}var w=t.slice();return w[w.length-1]=o,[r.tensor(p,w,n),r.tensor(h,w,"int32")]}},{"../ops/tensor_ops":169,"../util":192}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,o=e.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};n.ArgMinMaxProgram=r},{}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n      const float avgMultiplier = float("+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.AvgPool2DBackpropProgram=r},{}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/broadcast_util"),i=function(e,t,n,i,o,a){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],r.assertAndGetBroadcastShape(e,t),r.assertAndGetBroadcastShape(e,n);var s="0.0";null!=i&&(r.assertAndGetBroadcastShape(e,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=o&&(r.assertAndGetBroadcastShape(e,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+u+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "};n.BatchNormProgram=i},{"../../ops/broadcast_util":137}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/broadcast_util");n.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var i=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "};n.BinaryOpComplexProgram=i},{"../../ops/broadcast_util":137}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/broadcast_util"),i="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";n.ADD="return a + b;",n.SUB="return a - b;",n.MUL="return a * b;",n.DIV="if (a == b) return 1.0;\n  return a / b;",n.INT_DIV="\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",n.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",n.SQUARED_DIFFERENCE="return (a - b) * (a - b);",n.EQUAL="return float(a == b);",n.NOT_EQUAL="return float(a != b);",n.LESS="return float(a < b);",n.LESS_EQUAL="return float(a <= b);",n.GREATER="return float(a > b);",n.GREATER_EQUAL="return float(a >= b);",n.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",n.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",n.MAX=i+"\n  return max(a, b);\n",n.MIN=i+"\n  return min(a, b);\n",n.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",n.ATAN2=i+"\n  return atan(a, b);\n",n.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);";var o=function(){function e(e,t,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(t,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(){var e=this;return function(t,n){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(n,"NAN"),null==e.startLoc)||t.gl.uniform1f(e.startLoc,NaN)}},e}();n.BinaryOpProgram=o},{"../../ops/broadcast_util":137}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, float("+t+"), float("+n+")));\n      }\n    "};n.ClipProgram=r},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/concat_util"),i=function(e,t){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=r.computeOutShape([e,t],1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+e[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+e[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "};n.ConcatProgram=i},{"../../ops/concat_util":141}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerFilterProgram=r;var i=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerInputProgram=i},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DDerFilterProgram=r;var i=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DDerInputProgram=i},{}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.filterHeight,u=e.filterWidth,l=4*Math.floor(e.inChannels/4),c=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DProgram=r},{}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,p=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DProgram=r},{}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=e[0],a=e[1],s=e[2],u=e[3],l=t[0],c=n[0],p=n[1];this.outputShape=[l,c,p,u];var h="bilinear"===r?1:0,f=[a-1+".0",s-1+".0"],d=f[0],m=f[1],y=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+d+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+d],g=y[0],v=y[1],b=y[2],_=p>1?[""+(s-1)/(p-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=_[0],S=_[1],x=_[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+S+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+d+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+x+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "};n.CropAndResizeProgram=r},{}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var i=e.length,a=e[e.length-1],s=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+r.getCoordsDataType(i)+" coords = getOutputCoords();\n        int end = "+o(i,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+s+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+o(i,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(i,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function o(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}n.CumSumProgram=i},{"./shader_compiler":121}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}();n.DepthToSpaceProgram=r},{}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "};n.EncodeFloatProgram=r},{}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+t+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "};n.FromPixelsProgram=r},{}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t,n){this.variableNames=["A","indices"];var i=e.slice();i[n]=t,this.outputShape=i,this.rank=i.length;var o=r.getCoordsDataType(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<e.length;o++)o===t?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};n.GatherProgram=i},{"./shader_compiler":121}],102:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../environment"),a=e("../../util"),s=e("./gpgpu_util"),u=e("./tex_util"),l=e("./webgl_util"),c=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=null!=e?e:s.createWebGLContext(),1===o.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=l.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),o.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=l.getExtensionOrThrow(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=l.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=l.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),this.vertexBuffer=s.createVertexBuffer(this.gl),this.indexBuffer=s.createIndexBuffer(this.gl),this.framebuffer=l.createFramebuffer(this.gl),this.textureConfig=s.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;l.callAndCheck(t,(function(){return t.finish()})),l.callAndCheck(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),l.callAndCheck(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),l.callAndCheck(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),l.callAndCheck(t,(function(){return t.deleteBuffer(e.vertexBuffer)})),l.callAndCheck(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),l.callAndCheck(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.loseContextExtension.loseContext(),this.disposed=!0}},e.prototype.enableAutomaticDebugValidation=function(e){this.autoDebugValidate=e,l.enableDebugWebGLErrorChecking(e)},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),s.createFloat32MatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),s.createFloat16MatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),s.createUnsignedBytesMatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),s.uploadPixelDataToTexture(this.gl,e,t)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),s.createPackedMatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(l.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),l.callAndCheck(this.gl,(function(){return t.gl.deleteTexture(e)}))},e.prototype.uploadMatrixToTexture=function(e,t,n,r){this.throwIfDisposed();var i=l.getNumChannels();return s.uploadMatrixToTexture(this.gl,e,t,n,r,i,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(e,t,n,r){return this.throwIfDisposed(),s.uploadMatrixToPackedTexture(this.gl,e,t,n,r,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return s.downloadFloat32MatrixFromOutputTexture(r.gl,t,n,r.textureConfig)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return s.downloadByteEncodedFloatMatrixFromOutputTexture(r.gl,t,n,r.textureConfig)}))},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t,n){return s.downloadFloat32MatrixFromBuffer(this.gl,e,t,n,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=s.maybeCreateBufferFromOutputTexture(this.gl,e,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(o.ENV.get("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return s.downloadMatrixFromPackedOutputTexture(r.gl,t,n,r.textureConfig)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=l.createFragmentShader(t,e),r=s.createVertexShader(t),i=l.createProgram(t);return l.callAndCheck(t,(function(){return t.attachShader(i,r)})),l.callAndCheck(t,(function(){return t.attachShader(i,n)})),l.linkProgram(t,i),this.autoDebugValidate&&l.validateProgram(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=s.bindVertexProgramAttributeStreams(t,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&l.callAndCheck(this.gl,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.autoDebugValidate&&l.validateProgram(this.gl,this.program),l.callAndCheck(this.gl,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?l.getProgramUniformLocationOrThrow(this.gl,e,t):l.getProgramUniformLocation(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),l.callAndCheck(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),l.bindTextureToProgramUniformSampler(this.gl,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=u.getPackedMatrixTextureShapeWidthHeight(t,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(e,i,o)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&l.validateProgram(this.gl,this.program),l.validateFramebuffer(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.autoDebugValidate&&this.debugValidate(),l.callAndCheck(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),l.callAndCheck(this.gl,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=l.getExtensionOrThrow(this.gl,2===o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return[4,a.repeatedTry((function(){return t.isQueryAvailable(e,o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=p(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||a.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),l.bindColorTextureToFramebuffer(this.gl,e,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(l.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(this.gl)):l.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;l.bindColorTextureToFramebuffer(r,e,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(r),this.outputTexture=e,l.callAndCheck(r,(function(){return r.viewport(0,0,t,n)})),l.callAndCheck(r,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),l.callAndCheck(this.gl,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function p(e){for(var t=0,n=e.length-1,r=-1;t<=n;){var i=t+n>>1;e[i]()?(r=i,t=i+1):n=i-1}return r}n.GPGPUContext=c,n.binSearchLastTrue=p},{"../../environment":62,"../../util":192,"./gpgpu_util":104,"./tex_util":124,"./webgl_util":129}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../util"),i=e("./shader_compiler");function o(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var i=e.logicalShape,o=t[n],a=o.shape;if(!r.arraysEqual(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var s=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!r.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}}))}n.compileProgram=function(e,t,n,r){for(var o=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform};return{name:t.variableNames[n],shapeInfo:r}})),s=a.map((function(e){return e.shapeInfo})),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1},l=i.makeShader(a,u,o,!0===t.supportsBroadcasting),c=e.createProgram(l),p={},h=0;h<t.variableNames.length;h++){var f=t.variableNames[h];p[f]=e.getUniformLocation(c,f,!1)}return{program:t,source:l,webGLProgram:c,uniformLocations:p,gpgpu:e,inShapeInfos:s,outShapeInfo:u}},n.runProgram=function(e,t,n,i){o(e.inShapeInfos,t),o([e.outShapeInfo],[n]);var a=n.texData.texture,s=n.texData.texShape,u=e.gpgpu;u.setOutputMatrixTexture(a,s[0],s[1]),u.setProgram(e.webGLProgram),t.forEach((function(t,n){var i=e.program.variableNames[n],o=e.uniformLocations[i];if(null!=o){if(t.isUniform){if(1===r.sizeFromShape(t.shape))u.gl.uniform1f(o,t.uniformValues[0]);else{var a=t.uniformValues;a instanceof Float32Array||(a=new Float32Array(a)),u.gl.uniform1fv(o,a)}return}var s=t.texData.texture;u.setInputMatrixTexture(s,o,n)}})),null!=i&&i(u,e.webGLProgram),u.executeProgram()},n.makeShaderKey=function(e,t,n){var r="";t.concat(n).forEach((function(e){r+=e.shape+"_"+(e.isUniform?"uniform":e.texData.texShape)}));var i=e.userCode,o=(!0===e.supportsBroadcasting).toString(),a=e.constructor.name;return a+="_"+o+"_"+r+"_"+i}},{"../../util":192,"./shader_compiler":121}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../environment"),i=e("./tex_util"),o=e("./webgl_util");function a(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function s(e,t,n,r,i,a){o.validateTextureSize(e,t,n);var s=o.createTexture(e),u=e.TEXTURE_2D;return o.callAndCheck(e,(function(){return e.bindTexture(u,s)})),o.callAndCheck(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),o.callAndCheck(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),o.callAndCheck(e,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),o.callAndCheck(e,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),o.callAndCheck(e,(function(){return e.texImage2D(u,0,r,t,n,0,i,a,null)})),o.callAndCheck(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function u(e,t,n,r,i,a){o.validateTextureSize(e,n,r),o.callAndCheck(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),o.callAndCheck(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,a,e.FLOAT,i)})),o.callAndCheck(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}n.getWebGLContextAttributes=a,n.createWebGLContext=function(e){var t,n={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};return t=null!=e?o.createWebGLRenderingContextFromCanvas(e,n):o.createWebGLRenderingContext(n),o.callAndCheck(t,(function(){return t.disable(t.DEPTH_TEST)})),o.callAndCheck(t,(function(){return t.disable(t.STENCIL_TEST)})),o.callAndCheck(t,(function(){return t.disable(t.BLEND)})),o.callAndCheck(t,(function(){return t.disable(t.DITHER)})),o.callAndCheck(t,(function(){return t.disable(t.POLYGON_OFFSET_FILL)})),o.callAndCheck(t,(function(){return t.disable(t.SAMPLE_COVERAGE)})),o.callAndCheck(t,(function(){return t.enable(t.SCISSOR_TEST)})),o.callAndCheck(t,(function(){return t.enable(t.CULL_FACE)})),o.callAndCheck(t,(function(){return t.cullFace(t.BACK)})),t},n.createVertexShader=function(e){return o.createVertexShader(e,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")},n.createVertexBuffer=function(e){var t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return o.createStaticVertexBuffer(e,t)},n.createIndexBuffer=function(e){var t=new Uint16Array([0,1,2,2,1,3]);return o.createStaticIndexBuffer(e,t)},n.getTextureConfig=function(e,t){var n,i,o,a,s,u,l,c=e;return 2===r.ENV.get("WEBGL_VERSION")?(n=c.R32F,i=c.R16F,o=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=e.RGBA,i=e.RGBA,o=c.RGBA,a=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}},n.createFloat32MatrixTexture=function(e,t,n,r){var o=i.getUnpackedMatrixTextureShapeWidthHeight(t,n);return s(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,e.FLOAT)},n.createFloat16MatrixTexture=function(e,t,n,r){var o=i.getUnpackedMatrixTextureShapeWidthHeight(t,n);return s(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)},n.createUnsignedBytesMatrixTexture=function(e,t,n,r){var o=i.getUnpackedMatrixTextureShapeWidthHeight(t,n);return s(e,o[0],o[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)},n.createPackedMatrixTexture=function(e,t,n,r){var o=i.getPackedMatrixTextureShapeWidthHeight(t,n);return s(e,o[0],o[1],r.internalFormatPackedFloat,e.RGBA,e.FLOAT)},n.bindVertexProgramAttributeStreams=function(e,t,n){return o.callAndCheck(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),o.bindVertexBufferToProgramAttribute(e,t,"clipSpacePos",n,3,20,0)&&o.bindVertexBufferToProgramAttribute(e,t,"uv",n,2,20,12)},n.uploadPixelDataToTexture=function(e,t,n){o.callAndCheck(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),o.callAndCheck(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),o.callAndCheck(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},n.uploadMatrixToTexture=function(e,t,n,r,o,a,s){var l,c=i.getUnpackedMatrixTextureShapeWidthHeight(n,r),p=c[0],h=c[1];1===s.defaultNumChannels?l=o:(l=new Float32Array(i.getUnpackedArraySizeFromMatrixSize(o.length,a)),i.encodeMatrixToUnpackedArray(o,l,a)),u(e,t,p,h,l,s.textureFormatFloat)},n.uploadMatrixToPackedTexture=function(e,t,n,r,o,a){var s=i.getPackedMatrixTextureShapeWidthHeight(n,r),l=s[0],c=s[1],p=new Float32Array(i.getPackedRGBAArraySizeFromMatrixShape(n,r));i.encodeMatrixToPackedRGBA(o,n,r,p),u(e,t,l,c,p,e.RGBA)},n.maybeCreateBufferFromOutputTexture=function(e,t,n,a,s){var u=t;if(2===r.ENV.get("WEBGL_VERSION")){var l=e,c=l.createBuffer();o.callAndCheck(e,(function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,c)}));var p=4*i.getUnpackedArraySizeFromMatrixSize(n*a,s.downloadUnpackNumChannels);o.callAndCheck(e,(function(){return e.bufferData(l.PIXEL_PACK_BUFFER,p,e.STATIC_DRAW)})),o.callAndCheck(e,(function(){return l.readPixels(0,0,a,n,e.RGBA,e.FLOAT,0)})),o.callAndCheck(e,(function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,null)})),u=c}return u},n.downloadFloat32MatrixFromBuffer=function(e,t,n,r,o){var a=e,s=new Float32Array(i.getUnpackedArraySizeFromMatrixSize(n*r,o.downloadUnpackNumChannels));a.bindBuffer(e.ARRAY_BUFFER,t),a.getBufferSubData(e.ARRAY_BUFFER,0,s),a.bindBuffer(e.ARRAY_BUFFER,null);var u=new Float32Array(n*r);return i.decodeMatrixFromUnpackedArray(s,u,o.downloadUnpackNumChannels),u},n.downloadFloat32MatrixFromOutputTexture=function(e,t,n,r){var a=i.getUnpackedMatrixTextureShapeWidthHeight(t,n),s=a[0],u=a[1],l=new Float32Array(i.getUnpackedArraySizeFromMatrixSize(t*n,r.downloadUnpackNumChannels));o.callAndCheck(e,(function(){return e.readPixels(0,0,s,u,r.downloadTextureFormat,e.FLOAT,l)}));var c=new Float32Array(t*n);return i.decodeMatrixFromUnpackedArray(l,c,r.downloadUnpackNumChannels),c},n.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n,r){var a=i.getUnpackedMatrixTextureShapeWidthHeight(t,n),s=a[0],u=a[1],l=new Uint8Array(i.getUnpackedArraySizeFromMatrixSize(t*n,4));return o.callAndCheck(e,(function(){return e.readPixels(0,0,s,u,r.downloadTextureFormat,e.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)},n.downloadMatrixFromPackedOutputTexture=function(e,t,n,r){var a=i.getPackedMatrixTextureShapeWidthHeight(t,n),s=a[0],u=a[1],l=new Float32Array(i.getPackedRGBAArraySizeFromMatrixShape(t,n));o.callAndCheck(e,(function(){return e.readPixels(0,0,s,u,e.RGBA,e.FLOAT,l)}));var c=new Float32Array(t*n);return i.decodeMatrixFromPackedRGBA(l,t,n,c)}},{"../../environment":62,"./tex_util":124,"./webgl_util":129}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+o+";\n        setOutput(val);\n      }\n    "};n.LRNProgram=r},{}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "};n.LRNGradProgram=r},{}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=t*n-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+s+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.MaxPool2DBackpropProgram=r},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=e[0],o=n?e[2]:e[1],a=r?t[1]:t[2],s=n?e[1]:e[2];this.outputShape=[i,o,a];var u=function(e,t){return n?"batch, "+t+" + "+e+", aRow":"batch, aRow, "+t+" + "+e},l=function(e,t){return r?"batch, bCol, "+t+" + "+e:"batch, "+t+" + "+e+", bCol"},c=4*Math.floor(s/4),p=s%4;this.userCode=" float dotARowBCol(int batch, int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+c+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+u(0,"i")+"),\n          getMatrixA("+u(1,"i")+"),\n          getMatrixA("+u(2,"i")+"),\n          getMatrixA("+u(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+l(0,"i")+"),\n          getMatrixB("+l(1,"i")+"),\n          getMatrixB("+l(2,"i")+"),\n          getMatrixB("+l(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===p)+") {\n        result += getMatrixA("+u(0,c)+") *\n          getMatrixB("+l(0,c)+");\n      } else if ("+(2===p)+") {\n        vec2 a = vec2(\n          getMatrixA("+u(0,c)+"),\n          getMatrixA("+u(1,c)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+l(0,c)+"),\n          getMatrixB("+l(1,c)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===p)+") {\n        vec3 a = vec3(\n          getMatrixA("+u(0,c)+"),\n          getMatrixA("+u(1,c)+"),\n          getMatrixA("+u(2,c)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+l(0,c)+"),\n          getMatrixB("+l(1,c)+"),\n          getMatrixB("+l(2,c)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec3 resBRC = getOutputCoords();\n      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));\n    }\n    "};n.MatMulProgram=r},{}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}();n.MultinomialProgram=r},{}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "};n.OneHotProgram=r},{}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var i=e.length,o=r.getCoordsDataType(i),a=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+s+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+u+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "};n.PadProgram=i},{"./shader_compiler":121}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterHeight,i=e.filterWidth,o=e.strideHeight,a=e.strideWidth,s=e.padInfo.top,u=e.padInfo.left;this.outputShape=e.outShape;var l="avg"===t,c="0.0";if(l||(c="-1.0 / 0.0"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+s+", "+u+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+i+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+i+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var h=4*Math.floor(i/4),f=i%4,d="\n      if ("+l+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+s+", "+u+");\n      const float initializationValue = "+c+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+c+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+r+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+d+"\n          }\n\n          int xC = xCCorner + "+h+";\n          if ("+(1===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(2===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(3===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+d+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}};n.Pool2DProgram=r},{}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"min"===t?(a="1.0 / 0.0",s="min"):"max"===t&&(a="-1.0 / 0.0",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "};n.ReduceProgram=r},{}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "};n.ResizeBilinearBackpropProgram=r},{}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?o-1:o,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "};n.ResizeBilinearProgram=r},{}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "};n.ResizeNearestNeigborBackpropProgram=r},{}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?o-1:o,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "};n.ResizeNearestNeighborProgram=r},{}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var i=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "};n.ReverseProgram=i},{"./shader_compiler":121}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, filter);\n    ",c="";i%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var p="";i%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "};n.SegmentOpProgram=r},{}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t,n){var i,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",i="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],l=0;l<t.length;l++)u.push(""+a[l]),l<e&&s.push(""+a[l]);i=s.join(),o=u.join()}var c=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+i+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "};n.SelectProgram=i},{"./shader_compiler":121}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/broadcast_util"),i=e("../../util");function o(e){var t,n,r=e.shapeInfo.logicalShape;switch(r.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";return"\n    float "+n+"() {\n      return sampleTexture("+t+", halfCR);\n    }\n  "}(e);case 1:return t=e.name,"\n    float "+(n="get"+t.charAt(0).toUpperCase()+t.slice(1))+"(int index) {\n      return "+n+"Flat(index);\n    }\n  ";case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&i.arraysEqual(t,a)){var s=a[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+s+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var u=i.squeezeShape(t),p=u.newShape,h=u.keptDims,f=p;if(f.length<t.length){var d=["row","col"];return"\n      "+o(l(e,f))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+c(d,h)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = row * "+t[1]+" + col;\n        return "+r+"Flat(index);\n      }\n    ";var m=a[0],y=a[1];if(1===y)return"\n    float "+r+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+m+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ";if(1===m)return"\n    float "+r+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+y+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ";return"\n  float "+r+"(int row, int col) {\n    vec2 uv = UVfrom2D("+m+", "+y+", "+t[1]+", row, col);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],s=t[2],u=i.squeezeShape(t),p=u.newShape,h=u.keptDims,f=p;if(f.length<t.length){var d=["row","col","depth"];return"\n        "+o(l(e,f))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+c(d,h)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = row * "+a+" + col * "+s+" + depth;\n        return "+r+"Flat(index);\n      }\n    ";var m=e.shapeInfo.texShape,y=m[0],g=m[1];if(g===a)return"\n        float "+r+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+s+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+y+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ";if(g===s)return"\n    float "+r+"(int row, int col, int depth) {\n      int texR = row * "+t[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+y+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ";return"\n      float "+r+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+y+", "+g+", "+a+", "+s+", row, col, depth);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],s=t[2]*a,u=t[1]*s,p=i.squeezeShape(t),h=p.newShape,f=p.keptDims;if(h.length<t.length){var d=["row","col","depth","depth2"];return"\n      "+o(l(e,h))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+c(d,f)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = row * "+u+" + col * "+s+" +\n            depth * "+a+" + depth2;\n        return "+r+"Flat(index);\n      }\n    ";var m=e.shapeInfo.texShape,y=m[0],g=m[1];if(g===u)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+s+" + depth * "+a+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+y+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(g===a)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+y+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+y+", "+g+", "+u+", "+s+",\n          "+a+", row, col, depth, depth2);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],s=t[3]*a,u=t[2]*s,p=t[1]*u,h=i.squeezeShape(t),f=h.newShape,d=h.keptDims;if(f.length<t.length){var m=["row","col","depth","depth2","depth3"];return"\n      "+o(l(e,f))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+c(m,d)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int index = row * "+p+" + col * "+u+" +\n            depth * "+s+" + depth2 * "+a+" + depth3;\n        return "+r+"Flat(index);\n      }\n    ";var y=e.shapeInfo.texShape,g=y[0],v=y[1];if(v===p)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        int texC = col * "+u+" + depth * "+s+" +\n                   depth2 * "+a+" + depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(v===a)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" +\n                   depth * "+t[3]+" + depth2;\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+g+", "+v+", "+p+", "+u+",\n          "+s+", "+a+", row, col, depth, depth2, depth3);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[5],s=t[4]*a,u=t[3]*s,p=t[2]*u,h=t[1]*p,f=i.squeezeShape(t),d=f.newShape,m=f.keptDims;if(d.length<t.length){var y=["row","col","depth","depth2","depth3","depth4"];return"\n      "+o(l(e,d))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+c(y,m)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = row * "+h+" + col * "+p+" +\n            depth * "+u+" + depth2 * "+s+" + depth3 * "+s+"\n            + depth4\n        return "+r+"Flat(index);\n      }\n    ";var g=e.shapeInfo.texShape,v=g[0],b=g[1];if(b===h)return"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        int texC = col * "+p+" + depth * "+u+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+b+".0, "+v+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(b===a)return"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" + depth;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+b+".0, "+v+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+v+", "+b+", "+h+", "+p+",\n          "+u+", "+s+", "+a+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(r.length+"-D input sampling is not yet supported")}}n.makeShader=function(e,t,n,l){var c=e.map((function(e){var t=i.sizeFromShape(e.shapeInfo.logicalShape);return e.shapeInfo.isUniform?"uniform float "+e.name+(t>1?"["+t+"]":"")+";":"uniform sampler2D "+e.name+";"}));c=c.join("\n");var p=e.map((function(e){return function(e,t,n){var a=function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1)+"Flat",r=i.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform)return 1===r?"float "+n+"(int index) {return "+t+";}":"\n      float "+n+"(int index) {\n        for (int i = 0; i < "+r+"; i++) {\n          if (i == index) {\n            return "+t+"[i];\n          }\n        }\n      }\n    ";var o=e.shapeInfo.texShape,a=o[0],s=o[1];if(1===s&&1===a)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";if(1===s)return"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+a+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ";if(1===a)return"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ";return"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+a+", "+s+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);a+=o(e),(n||i.arraysEqual(e.shapeInfo.logicalShape,t.logicalShape))&&(a+=function(e,t,n){var o=e.name,a=o.charAt(0).toUpperCase()+o.slice(1),s="get"+a+"AtOutCoords",u=r.getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),l=e.shapeInfo.logicalShape.length,c=t.logicalShape.length,p=n&&(c>l||u.length>0),h=r.broadcastDimsAreOuter(u),f=e.shapeInfo.isUniform;if(p&&!h)return function(e,t,n,i){var o=e.shapeInfo.logicalShape.length,a=t.logicalShape.length,s="int";2===a?s="ivec2":3===a?s="ivec3":4===a&&(s="ivec4");var u,l=r.getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),c=a-o;u=0===o?"":a<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords["+(e+c)+"] = 0;"})).join("\n");var p="";p=a<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords["+(t+c)+"]"})).join(", ");return"\n    float "+i+"() {\n      "+s+" coords = getOutputCoords();\n      "+u+"\n      return get"+n+"("+p+");\n    }\n  "}(e,t,a,s);var d=i.sizeFromShape(e.shapeInfo.logicalShape),m="";p&&h&&(m="\n        int mainPart = index / "+d+";\n        index -= mainPart * "+d+";\n      ");var y=t.texShape;if(f)return 1===d?"float "+s+"() {return "+o+";}":"\n      float "+s+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        "+m+"\n        return get"+a+"Flat(index);\n      }\n    ";var g=e.shapeInfo.texShape;if(i.arraysEqual(g,y))return"\n      float "+s+"() {\n        return sampleTexture("+o+", resultUV);\n      }\n    ";return"\n    float "+s+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      "+m+"\n      int texR = index / "+g[1]+";\n      int texC = index - texR * "+g[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+g[1]+".0, "+g[0]+".0);\n\n      return sampleTexture("+o+", uv);\n    }\n  "}(e,t,n));return a}(e,t,l)})).join("\n"),h=t.texShape,f=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){if(1===t[0])return"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ";if(1===t[1])return"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){if(i.arraysEqual(e,t))return"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ";if(1===e[1])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ";if(1===e[0])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return r=t,o=(n=e)[1]*n[2],a=n[2],"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      int r = index / "+o+";\n      index -= r * "+o+";\n      int c = index / "+a+";\n      int d = index - c * "+a+";\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=e[3],r=e[2]*n,i=e[1]*r;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int r = index / "+i+";\n      index -= r * "+i+";\n\n      int c = index / "+r+";\n      index -= c * "+r+";\n\n      int d = index / "+n+";\n      int d2 = index - d * "+n+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=e[4],r=e[3]*n,i=e[2]*r,o=e[1]*i;return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int r = index / "+o+";\n      index -= r * "+o+";\n\n      int c = index / "+i+";\n      index -= c * "+i+";\n\n      int d = index / "+r+";\n      index -= d * "+r+";\n\n      int d2 = index  / "+n+";\n      int d3 = index - d2 * "+n+";\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=e[5],r=e[4]*n,i=e[3]*r,o=e[2]*i,a=e[1]*o;return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int r = index / "+a+";\n      index -= r * "+a+";\n\n      int c = index / "+o+";\n      index -= c * "+o+";\n\n      int d = index / "+i+";\n      index -= d * "+i+";\n\n      int d2 = index / "+r+";\n      index -= d2 * "+r+";\n\n      int d3 = index / "+n+";\n      int d4 = index - d3 * "+n+";\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r,o,a}(t.logicalShape,h);return[u,a,s,c,f,p,n].join("\n")};var a="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",s="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",u="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  bool isNaN(float val) {\n    return (val < 0.0 || 0.0 < val || val == 0.0) ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n";function l(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function c(e,t){return t.map((function(t){return e[t]})).join(", ")}n.getCoordsDataType=function(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}},{"../../ops/broadcast_util":137,"../../util":192}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=r.getCoordsDataType(this.rank),n=function(e){if(1===e)return"sourceLoc";if(2===e)return"sourceLoc.x, sourceLoc.y";if(3===e)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===e)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);this.userCode="\n      uniform "+t+" start;\n\n      void main() {\n        "+t+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){if(null!=t.startLoc||(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null!=t.startLoc))if(1===t.rank)n.gl.uniform1i(t.startLoc,e[0]);else if(2===t.rank)n.gl.uniform2i(t.startLoc,e[0],e[1]);else if(3===t.rank)n.gl.uniform3i(t.startLoc,e[0],e[1],e[2]);else{if(4!==t.rank)throw Error("Slicing for rank "+t.rank+" is not yet supported");n.gl.uniform4i(t.startLoc,e[0],e[1],e[2],e[3])}}},e}();n.SliceProgram=i},{"./shader_compiler":121}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t,n,i){this.variableNames=["x"];var o=n.filter((function(e,t){return-1===i.indexOf(t)}));this.outputShape=o;var a=n.length,s=r.getCoordsDataType(n.length),u=r.getCoordsDataType(o.length),l="";if(1===a)l="coords * strides + begin";else{var c=0;l=n.map((function(e,t){return-1===i.indexOf(t)?(c++,1===o.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(c-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"})).join(",")}this.userCode="\n      "+s+" begin = "+s+"("+e+");\n      "+s+" strides = "+s+"("+t+");\n\n      void main() {\n        "+u+" coords = getOutputCoords();\n        setOutput(getX("+l+"));\n      }\n    "};n.StridedSliceProgram=i},{"./shader_compiler":121}],124:[function(e,t,n){"use strict";function r(e,t){return e*t}function i(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}function o(e,t){return[Math.ceil(t/2),Math.ceil(e/2)]}function a(e,t){var n=o(e,t);return n[0]*n[1]*4}Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(n.TextureUsage||(n.TextureUsage={})),function(e){e[e.FLOAT16=0]="FLOAT16",e[e.FLOAT32=1]="FLOAT32",e[e.UNSIGNED_BYTE=2]="UNSIGNED_BYTE"}(n.PhysicalTextureType||(n.PhysicalTextureType={})),n.getUnpackedMatrixTextureShapeWidthHeight=function(e,t){return[t,e]},n.getUnpackedArraySizeFromMatrixSize=r,n.getColorMatrixTextureShapeWidthHeight=function(e,t){return[4*t,e]},n.getMatrixSizeFromUnpackedArraySize=i,n.encodeMatrixToUnpackedArray=function(e,t,n){var i=r(e.length,n);if(t.length<i)throw new Error("unpackedArray length ("+t.length+") must be >= "+i);for(var o=0,a=0;a<e.length;++a)t[o]=e[a],o+=n},n.decodeMatrixFromUnpackedArray=function(e,t,n){var r=i(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<e.length;a+=n)t[o++]=e[a]},n.decodeMatrixFromUnpackedColorRGBAArray=function(e,t,n){var r=e.length*n/4;if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var i=0,o=0;o<e.length;o+=4)for(var a=0;a<n;a++)t[i++]=e[o+a]},n.getPackedMatrixTextureShapeWidthHeight=o,n.getPackedRGBAArraySizeFromMatrixShape=a,n.encodeMatrixToPackedRGBA=function(e,t,n,r){var i=a(t,n);if(r.length<i)throw new Error("packedRGBA length ("+r.length+") must be >= "+i);for(var s=o(t,n),u=s[0],l=s[1],c=n%2==1,p=t%2==1,h=Math.floor(n/2),f=Math.floor(t/2),d=c?4:0,m=n,y=0,g=0;g<f;++g){for(var v=2*g*n,b=0;b<h;++b){var _=v+2*b;r[y]=e[_],r[y+1]=e[_+1],r[y+2]=e[_+m],r[y+3]=e[_+m+1],y+=4}y+=d}if(c){_=n-1,y=4*(u-1);var w=2*n;for(d=4*u,g=0;g<f;++g)r[y]=e[_],r[y+2]=e[_+n],_+=w,y+=d}if(p)for(_=(t-1)*n,y=(l-1)*u*4,b=0;b<h;++b)r[y++]=e[_++],r[y++]=e[_++],y+=2;return c&&p&&(r[r.length-4]=e[e.length-1]),r},n.decodeMatrixFromPackedRGBA=function(e,t,n,r){var i=t*n;if(i<r.length)throw new Error("matrix length ("+r.length+") must be >= "+i);for(var a=n%2==1,s=t%2==1,u=Math.floor(n/2),l=Math.floor(t/2),c=o(t,n),p=c[0],h=c[1],f=a?4:0,d=n+(a?1:0),m=0,y=0,g=n,v=0;v<l;++v){for(var b=0;b<u;++b)r[y++]=e[m++],r[y++]=e[m++],r[g++]=e[m++],r[g++]=e[m++];m+=f,y+=d,g+=d}if(a){m=4*(p-1);var _=n-1;for(f=4*p,d=2*n,v=0;v<l;++v)r[_]=e[m],r[_+n]=e[m+2],m+=f,_+=d}if(s)for(m=(h-1)*p*4,_=(t-1)*n,b=0;b<u;++b)r[_++]=e[m++],r[_++]=e[m++],m+=2;return a&&s&&(r[r.length-1]=e[e.length-4]),r}},{}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../environment"),i=e("./tex_util"),o=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t){var n,r=a(t),o=s(e,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}return this.numUsedTextures++,this.log(),r===i.PhysicalTextureType.FLOAT32?n=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===i.PhysicalTextureType.FLOAT16?n=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===i.PhysicalTextureType.UNSIGNED_BYTE&&(n=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(n),n},e.prototype.releaseTexture=function(e,t,n){var r=s(t,a(n));r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[r],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function a(e){if(e===i.TextureUsage.DOWNLOAD||e===i.TextureUsage.PIXELS)return i.PhysicalTextureType.UNSIGNED_BYTE;if(e===i.TextureUsage.UPLOAD)return i.PhysicalTextureType.FLOAT32;if(e===i.TextureUsage.RENDER)return r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?i.PhysicalTextureType.FLOAT32:i.PhysicalTextureType.FLOAT16;throw new Error("Unknown logical texture type "+e)}function s(e,t){return e[0]+"_"+e[1]+"_"+t}n.TextureManager=o},{"../../environment":62,"./tex_util":124}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;var o=r.getCoordsDataType(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};n.TileProgram=i},{"./shader_compiler":121}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;var o=r.getCoordsDataType(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "};n.TransposeProgram=i},{"./shader_compiler":121}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/erf_util"),i=e("../../ops/selu_util"),o=function(){function e(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(){var e=this;return function(t,n){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(n,"NAN"),null==e.startLoc)||t.gl.uniform1f(e.startLoc,NaN)}},e}();n.UnaryOpProgram=o;var a="if (isNaN(x)) return x;";n.ABS="return abs(x);",n.RELU=a+"\n  return (x < 0.0) ? 0.0 : x;\n",n.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",n.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+i.SELU_SCALEALPHA+";\n  float scale = "+i.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",n.STEP=function(e){return void 0===e&&(e=0),a+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "},n.NEG="return -x;",n.CEIL="return ceil(x);",n.FLOOR="return floor(x);",n.SIGN="\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n",n.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",n.EXP="return exp(x);",n.EXPM1="return exp(x) - 1.0;",n.LOG="if (x < 0.0) return NAN;\n  return log(x);",n.LOG1P="return log(1.0 + x);",n.SQRT="return sqrt(x);",n.RSQRT="return inversesqrt(x);",n.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",n.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",n.SIN=a+"\n  return sin(x);\n",n.COS=a+"\n  return cos(x);\n",n.TAN="return tan(x);",n.ASIN="return asin(x);",n.ACOS="return acos(x);",n.ATAN=a+"\n  return atan(x);\n",n.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",n.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",n.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",n.ASINH="return log(x + sqrt(x * x + 1.0));",n.ACOSH=a+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",n.ATANH=a+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",n.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+r.ERF_P+";\n  float a1 = "+r.ERF_A1+";\n  float a2 = "+r.ERF_A2+";\n  float a3 = "+r.ERF_A3+";\n  float a4 = "+r.ERF_A4+";\n  float a5 = "+r.ERF_A5+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",n.SQUARE="return x * x;",n.RECIPROCAL="return 1.0 / x;",n.LOGICAL_NOT="return float(!(x >= 1.0));",n.TO_INT="return float(int(x));"},{"../../ops/erf_util":144,"../../ops/selu_util":164}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=null,i=e("../../util"),o=e("../../environment");function a(e,t){var n,r=o.ENV.get("WEBGL_VERSION");if(2===r?n=e.getContext("webgl2",t):1===r&&(n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),0===r||null==n)throw new Error("This browser does not support WebGL.");return n}function s(e,t){var n=t();return l(e),n}n.createWebGLRenderingContext=function(e){var t=document.createElement("canvas");return t.width=1,t.height=1,a(t,e)},n.createWebGLRenderingContextFromCanvas=a,n.callAndCheck=s;var u=!1;function l(e){if(u){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+c(e,t))}}function c(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}n.enableDebugWebGLErrorChecking=function(e){u=e},n.checkWebGLError=l,n.getWebGLErrorMessage=c,n.getExtensionOrThrow=function(e,t){return m(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')},n.createVertexShader=function(e,t){var n=m(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(s(e,(function(){return e.shaderSource(n,t)})),s(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n},n.createFragmentShader=function(e,t){var n=m(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(s(e,(function(){return e.shaderSource(n,t)})),s(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=p.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,s=o.map((function(e,t){return i.rightPad((t+1).toString(),a)+e})),u=0,l=0;l<s.length;l++)u=Math.max(s[l].length,u);var c=s.slice(0,r-1),h=s.slice(r-1,r),f=s.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+i.rightPad(h[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n};var p=/ERROR: [0-9]+:([0-9]+):/g;function h(e){return null!=r?r:r=s(e,(function(){return e.getParameter(e.MAX_TEXTURE_SIZE)}))}function f(e,t,n){y(e,n),s(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),s(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function d(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function m(e,t,n){var r=s(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function y(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}n.createProgram=function(e){return m(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")},n.linkProgram=function(e,t){if(s(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")},n.validateProgram=function(e,t){if(s(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")},n.createStaticVertexBuffer=function(e,t){var n=m(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return s(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),s(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n},n.createStaticIndexBuffer=function(e,t){var n=m(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return s(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),s(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n},n.queryMaxTextureSize=h,n.getNumChannels=function(){return 2===o.ENV.get("WEBGL_VERSION")?1:4},n.createTexture=function(e){return m(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")},n.validateTextureSize=function(e,t,n){var r=h(e);if(t<=0||n<=0){var i="["+t+"x"+n+"]";throw new Error("Requested texture size "+i+" is invalid.")}if(t>r||n>r){i="["+t+"x"+n+"]";throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+("["+r+"x"+r+"]")+".")}},n.createFramebuffer=function(e){return m(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")},n.bindVertexBufferToProgramAttribute=function(e,t,n,r,i,o,a){var u=e.getAttribLocation(t,n);return-1!==u&&(s(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),s(e,(function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,o,a)})),s(e,(function(){return e.enableVertexAttribArray(u)})),!0)},n.bindTextureUnit=f,n.unbindTextureUnit=function(e,t){y(e,t),s(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),s(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},n.getProgramUniformLocationOrThrow=function(e,t,n){return m(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')},n.getProgramUniformLocation=function(e,t,n){return e.getUniformLocation(t,n)},n.bindTextureToProgramUniformSampler=function(e,t,n,r,i){s(e,(function(){return f(e,n,i)})),s(e,(function(){return e.uniform1i(r,i)}))},n.bindCanvasToFramebuffer=function(e){s(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),s(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),s(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},n.bindColorTextureToFramebuffer=function(e,t,n){s(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),s(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))},n.unbindColorTextureFromFramebuffer=function(e,t){s(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),s(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))},n.validateFramebuffer=function(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+d(e,t))},n.getFramebufferErrorMessage=d,n.getTextureShapeFromLogicalShape=function(e,t){2!==t.length&&(t=i.squeezeShape(t).newShape);var n=h(e),r=i.sizeFromShape(t);return t.length<=1&&r<=n?[r,1]:2===t.length&&t[0]<=n&&t[1]<=n?t:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?[t[0],t[1]*t[2]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n?[t[0],t[1]*t[2]*t[3]]:i.sizeToSquarishShape(r)}},{"../../environment":62,"../../util":192}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../ops/array_ops");n.whereImpl=function(e,t){for(var n=[],i=0;i<t.length;i++)t[i]&&n.push(i);var o=r.buffer(e,"int32"),a=r.buffer([n.length,e.length],"int32");for(i=0;i<n.length;i++){var s=o.indexToLoc(n[i]),u=i*e.length;a.values.set(s,u)}return a.toTensor()}},{"../ops/array_ops":132}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment");n.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENV.get("IS_TEST")||console.warn.apply(console,e)},n.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENV.get("IS_TEST")||console.log.apply(console,e)}},{"./environment":62}],132:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../tensor"),s=e("../tensor_util_env"),u=e("../util"),l=e("./axis_util"),c=e("./concat_split"),p=e("./operation"),h=e("./rand"),f=e("./tensor_ops");function d(e,t,n){return void 0===t&&(t="float32"),new a.TensorBuffer(e,t,n)}n.toPixels=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,a,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x;return i(this,(function(i){switch(i.label){case 0:if(2!==(n=s.convertToTensor(e,"img","toPixels","int32")).rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(u=2===n.rank?1:n.shape[2])>4||2===u)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+u);return l=n.min(),c=n.max(),[4,l.data()];case 1:return p=i.sent()[0],[4,c.data()];case 2:if(h=i.sent()[0],l.dispose(),c.dispose(),"float32"===n.dtype){if(p<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+h+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+h+"].")}return[4,n.data()];case 3:for(f=i.sent(),d="float32"===n.dtype?255:1,m=new Uint8ClampedArray(a*o*4),y=0;y<o*a;++y)g=void 0,v=void 0,b=void 0,_=void 0,1===u?(g=f[y]*d,v=f[y]*d,b=f[y]*d,_=255):3===u?(g=f[3*y]*d,v=f[3*y+1]*d,b=f[3*y+2]*d,_=255):4===u&&(g=f[4*y]*d,v=f[4*y+1]*d,b=f[4*y+2]*d,_=f[4*y+3]*d),m[(w=4*y)+0]=Math.round(g),m[w+1]=Math.round(v),m[w+2]=Math.round(b),m[w+3]=Math.round(_);return null!=t&&(t.width=a,t.height=o,S=t.getContext("2d"),x=new ImageData(m,a,o),S.putImageData(x,0,0)),n!==e&&n.dispose(),[2,m]}}))}))},n.buffer=d,n.print=function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},n.batchToSpaceND=p.op({batchToSpaceND_:function(e,t,n){var r=s.convertToTensor(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return u.assert(r.rank>=1+t.length,"input rank should be > than [blockShape] but got "+r.rank),u.assert(n.length===t.length,"crops.shape[0] must be equal to [blockShape] but got "+n.length),u.assert(r.shape[0]%i==0,"input tensor batch must be divisible by prod( blockShape )"),o.ENV.engine.runKernel((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),n.cast=p.op({cast_:function(e,t){var n=s.convertToTensor(e,"x","cast");return o.ENV.engine.runKernel((function(e){return e.cast(n,t)}),{$x:n},(function(e){return{$x:function(){return e.clone()}}}))}}),n.clone=p.op({clone_:function(e){var t=s.convertToTensor(e,"x","clone");return o.ENV.engine.runKernel((function(e){return a.Tensor.make(t.shape,{dataId:t.dataId},t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),n.cumsum=p.op({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=s.convertToTensor(e,"x","cumsum");t|=0;var a=l.getAxesPermutation([t],i.rank),u=i;null!=a&&(u=i.transpose(a));var c=l.getInnerMostAxes(1,i.rank)[0],p=o.ENV.engine.runKernel((function(e){return e.cumsum(u,c,n,r)}),{permutedX:u},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(p=p.transpose(a)),p}}),n.depthToSpace=p.op({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=s.convertToTensor(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],l="NHWC"===n?r.shape[3]:r.shape[1];return u.assert(i*t>=0,"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape),u.assert(a*t>=0,"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape),u.assert(l%(t*t)==0,"Dimension size must be evenly divisible by "+t*t+" but is "+l+" for depthToSpace with input shape "+r.shape),o.ENV.engine.runKernel((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),n.expandDims=p.op({expandDims_:function(e,t){void 0===t&&(t=0);var r=s.convertToTensor(e,"x","expandDims");u.assert(t<=r.rank,"Axis must be <= rank of the tensor");var i=r.shape.slice();return t<0&&(u.assert(-(r.rank+1)<=t,"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"),t=r.rank+t+1),i.splice(t,0,1),n.reshape(r,i)}}),n.eye=p.op({eye_:function(e,t,r,i){void 0===i&&(i="float32"),null==t&&(t=e);for(var o=d([e,t],i),a=e<=t?e:t,s=0;s<a;++s)o.set(1,s,s);var u=o.toTensor().as2D(e,t);if(null==r)return u;if(1===r.length)return n.tile(n.expandDims(u,0),[r[0],1,1]);if(2===r.length)return n.tile(n.expandDims(n.expandDims(u,0),0),[r[0],r[1],1,1]);if(3===r.length)return n.tile(n.expandDims(n.expandDims(n.expandDims(u,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+r.length+"D.")}}),n.fromPixels=p.op({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return o.ENV.engine.fromPixels(e,t)}}),n.multinomial=p.op({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=s.convertToTensor(e,"logits","multinomial"),a=i.size,u=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(u>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+u);n=n||Math.random();var l=1===u?i.as2D(1,-1):i,c=o.ENV.engine.runKernel((function(e){return e.multinomial(l,r,t,n)}),{logits2D:l});return 1===u?c.as1D():c}}),n.oneHot=p.op({oneHot_:function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=0);var i=s.convertToTensor(e,"indices","oneHot","int32");if(u.assert("int32"===i.dtype,"Indices must be of dtype `int32`"),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);return o.ENV.engine.runKernel((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return f.zerosLike(i)}}}))}}),n.pad=p.op({pad_:function(e,t,n){void 0===n&&(n=0);var r=s.convertToTensor(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=t.map((function(e){return e[0]}));return o.ENV.engine.runKernel((function(e){return e.pad(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.slice(i,r.shape)}}}))}}),n.pad1d=p.op({pad1d_:function(e,t,r){return void 0===r&&(r=0),u.assert(2===t.length,"Invalid number of paddings. Must be length of 2."),n.pad(e,[t],r)}}),n.pad2d=p.op({pad2d_:function(e,t,r){return void 0===r&&(r=0),u.assert(2===t.length&&2===t[0].length&&2===t[1].length,"Invalid number of paddings. Must be length of 2 each."),n.pad(e,t,r)}}),n.pad3d=p.op({pad3d_:function(e,t,r){return void 0===r&&(r=0),u.assert(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,"Invalid number of paddings. Must be length of 2 each."),n.pad(e,t,r)}}),n.pad4d=p.op({pad4d_:function(e,t,r){return void 0===r&&(r=0),u.assert(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,"Invalid number of paddings. Must be length of 2 each."),n.pad(e,t,r)}}),n.rand=p.op({rand_:function(e,t,n){var r=u.sizeFromShape(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=t();return a.Tensor.make(e,{values:i},n)}}),n.randomNormal=p.op({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new h.MPRandGauss(t,n,r,!1,i),a=d(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),n.randomUniform=p.op({randomUniform_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=d(e,r),o=0;o<i.values.length;o++)i.values[o]=u.randUniform(t,n);return i.toTensor()}}),n.reshape=p.op({reshape_:function(e,t){var n=s.convertToTensor(e,"x","reshape");return t=u.inferFromImplicitShape(t,n.size),u.assert(n.size===u.sizeFromShape(t),"new shape and old shape must have the same number of elements."),o.ENV.engine.runKernel((function(e){return e.reshape(n,t)}),{$x:n},(function(e){return{$x:function(){return e.reshape(n.shape)}}}))}}),n.spaceToBatchND=p.op({spaceToBatchND_:function(e,t,n){var r=s.convertToTensor(e,"x","spaceToBatchND");return u.assert(r.rank>=1+t.length,"input rank "+r.rank+" should be > than [blockShape] "+t.length),u.assert(n.length===t.length,"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length),u.assert(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()),o.ENV.engine.runKernel((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),n.squeeze=p.op({squeeze_:function(e,t){var r=s.convertToTensor(e,"x","squeeze");return n.reshape(r,u.squeezeShape(r.shape,t).newShape)}}),n.stack=p.op({stack_:function(e,t){void 0===t&&(t=0);var n=s.convertToTensorArray(e,"tensors","stack");if(u.assert(n.length>=1,"Pass at least one tensor to tf.stack"),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;u.assert(t<=r,"Axis must be <= rank of the tensor"),n.forEach((function(e){u.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){u.assert(o===e.dtype,"All tensors passed to stack must have matching dtypes")}));var a=n.map((function(e){return e.expandDims(t)}));return c.concat(a,t)}}),n.tile=p.op({tile_:function(e,t){var n=s.convertToTensor(e,"x","tile");return u.assert(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."),o.ENV.engine.runKernel((function(e){return e.tile(n,t)}),{$x:n},(function(e){return{$x:function(){var r=f.zerosLike(n);if(1===n.rank)for(var i=0;i<t[0];++i)r=r.add(e.slice([i*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(i=0;i<t[0];++i)for(var o=0;o<t[1];++o)r=r.add(e.slice([i*n.shape[0],o*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(i=0;i<t[0];++i)for(o=0;o<t[1];++o)for(var a=0;a<t[2];++a)r=r.add(e.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(i=0;i<t[0];++i)for(o=0;o<t[1];++o)for(a=0;a<t[2];++a)for(var s=0;s<t[3];++s)r=r.add(e.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r}}}))}}),n.truncatedNormal=p.op({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new h.MPRandGauss(t,n,r,!0,i),a=d(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),n.unstack=p.op({unstack_:function(e,t){void 0===t&&(t=0);for(var n,r=s.convertToTensor(e,"x","unstack"),i=r.shape[t],o=Array(r.rank-1).fill(0),a=0,u=0;u<r.rank;u++)u!==t&&(o[a]=r.shape[u],a++);n=Array(i).fill(1);var l=Array(r.rank).fill(0),c=r.shape.slice();return n.map((function(e){c[t]=e;var n=r.slice(l,c);return l[t]+=e,n.reshape(o)}))}})},{"../environment":62,"../tensor":185,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./concat_split":140,"./operation":154,"./rand":157,"./tensor_ops":169}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getReshaped=function(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var o=t.length,a=0;a<o;++a)i=i.concat([e[a+1]/t[a],t[a]]);i=i.concat(e.slice(o+1))}return i},n.getPermuted=function(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r},n.getReshapedPermuted=function(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var o=1;o<e.length;++o)o<=t.length?r?i.push(t[o-1]*e[o]):i.push(e[o]/t[o-1]):i.push(e[o]);return i},n.getSliceBeginCoords=function(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n},n.getSliceSize=function(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}},{}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");function i(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function o(e,t,n){for(var r=e.length+t.length,i=[],o=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[o++]):i.push(t[a++]);return i}n.axesAreInnerMostDims=i,n.combineLocations=o,n.computeOutAndReduceShapes=function(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);var o=t.map((function(t){return e[t]}));return[n,o]},n.expandShapeToKeepDim=function(e,t){return o(e,t.map((function(e){return 1})),t)},n.parseAxisParam=function(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),r.assert(e.every((function(e){return e>=-n&&e<n})),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e),r.assert(e.every((function(e){return r.isInt(e)})),"All values in axis param must be integers but got axis "+e),e.map((function(e){return e<0?n+e:e}))},n.assertAxesAreInnerMostDims=function(e,t,n){r.assert(i(t,n),e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input.")},n.getAxesPermutation=function(e,t){if(i(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n},n.getUndoAxesPermutation=function(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))},n.getInnerMostAxes=function(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},{"../util":192}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./array_ops"),s=e("./broadcast_util"),u=e("./operation"),l=e("./tensor_ops"),c=e("./unary_ops");function p(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}n.batchNormalization2d=u.op({batchNormalization2d_:function(e,t,r,a,s,u){void 0===a&&(a=.001);var l,c,p=i.convertToTensor(e,"x","batchNormalization"),h=i.convertToTensor(t,"mean","batchNormalization"),f=i.convertToTensor(r,"variance","batchNormalization");return null!=s&&(l=i.convertToTensor(s,"scale","batchNormalization")),null!=u&&(c=i.convertToTensor(u,"offset","batchNormalization")),o.assert(2===p.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),o.assert(2===h.rank||1===h.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."),o.assert(2===f.rank||1===f.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+f.rank+"."),null!=l&&o.assert(2===l.rank||1===l.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."),null!=c&&o.assert(2===c.rank||1===c.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+c.rank+"."),n.batchNormalization(p,h,f,a,l,c)}}),n.batchNormalization3d=u.op({batchNormalization3d_:function(e,t,r,a,s,u){void 0===a&&(a=.001);var l,c,p=i.convertToTensor(e,"x","batchNormalization"),h=i.convertToTensor(t,"mean","batchNormalization"),f=i.convertToTensor(r,"variance","batchNormalization");return null!=s&&(l=i.convertToTensor(s,"scale","batchNormalization")),null!=u&&(c=i.convertToTensor(u,"offset","batchNormalization")),o.assert(3===p.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),o.assert(3===h.rank||1===h.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."),o.assert(3===f.rank||1===f.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+f.rank+"."),null!=l&&o.assert(3===l.rank||1===l.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."),null!=c&&o.assert(3===c.rank||1===c.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+c.rank+"."),n.batchNormalization(p,h,f,a,l,c)}}),n.batchNormalization4d=u.op({batchNormalization4d_:function(e,t,r,a,s,u){void 0===a&&(a=.001);var l,c,p=i.convertToTensor(e,"x","batchNormalization"),h=i.convertToTensor(t,"mean","batchNormalization"),f=i.convertToTensor(r,"variance","batchNormalization");return null!=s&&(l=i.convertToTensor(s,"scale","batchNormalization")),null!=u&&(c=i.convertToTensor(u,"offset","batchNormalization")),o.assert(4===p.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+p.rank+"."),o.assert(4===h.rank||1===h.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."),o.assert(4===f.rank||1===f.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+f.rank+"."),null!=l&&o.assert(4===l.rank||1===l.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."),null!=c&&o.assert(4===c.rank||1===c.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+c.rank+"."),n.batchNormalization(p,h,f,a,l,c)}}),n.batchNormalization=u.op({batchNormalization_:function(e,t,n,u,h,f){void 0===u&&(u=.001);var d,m,y,g=i.convertToTensor(e,"x","batchNormalization"),v=i.convertToTensor(t,"mean","batchNormalization"),b=i.convertToTensor(n,"variance","batchNormalization");return null!=h&&(d=i.convertToTensor(h,"scale","batchNormalization")),null!=f&&(m=i.convertToTensor(f,"offset","batchNormalization")),o.assert(v.rank===b.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),o.assert(null==m||v.rank===m.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),o.assert(null==d||v.rank===d.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),y=0===g.rank||1===g.rank?g.as4D(1,1,1,g.size):2===g.rank?g.as4D(1,1,g.shape[0],g.shape[1]):3===g.rank?g.as4D(1,g.shape[0],g.shape[1],g.shape[2]):g,r.ENV.engine.runKernel((function(e){return e.batchNormalization(y,p(v),p(b),u,p(d),p(m))}),{$x:g,$mean:v,$variance:b,$scale:d,$offset:m},(function(e){var t=null==d?l.scalar(1):d,n=s.getReductionAxes(v.shape,y.shape),r=[];if(1===v.rank){for(var i=0;i<y.shape.length-1;++i)r.push(y.shape[i]);r.push(1)}var o=g.sub(v),p=e.mul(t),h=c.rsqrt(b.add(l.scalar(u))),f=h.mul(h).mul(h).mul(l.scalar(-.5));return{$x:function(){return 1===v.rank?e.mul(a.tile(h.as4D(1,1,1,v.shape[0]),r)).mul(t).reshape(g.shape):e.mul(h).mul(t).reshape(g.shape)},$mean:function(){var e=h.mul(l.scalar(-1)).mul(p);return 1===v.rank&&(e=e.sum(n)),e.reshape(v.shape)},$variance:function(){var e=f.mul(o).mul(p);return 1===v.rank&&(e=e.sum(n)),e.reshape(v.shape)},$scale:function(){var t=o.mul(h),r=e.mul(t);return 1===v.rank&&(r=r.sum(n)),r.reshape(v.shape)},$offset:function(){var t=e;return 1===v.rank&&(t=t.sum(n)),t.reshape(v.shape)}}})).reshape(g.shape)}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./array_ops":132,"./broadcast_util":137,"./operation":154,"./tensor_ops":169,"./unary_ops":172}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util"),o=e("../tensor_util_env"),a=e("../types"),s=e("../util"),u=e("./broadcast_util"),l=e("./operation"),c=e("./tensor_ops"),p=e("./unary_ops");n.add=l.op({add_:function(e,t){var n=o.convertToTensor(e,"a","add"),a=o.convertToTensor(t,"b","add");i.assertTypesMatch(n,a);var s=u.assertAndGetBroadcastShape(n.shape,a.shape);return r.ENV.engine.runKernel((function(e){return e.add(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){var t=e,r=u.getReductionAxes(n.shape,s);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},$b:function(){var t=e,n=u.getReductionAxes(a.shape,s);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}}))}}),n.addN=l.op({addN_:function(e){s.assert(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),s.assert(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return o.convertToTensor(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!s.arraysEqual(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var i=t;return r.ENV.engine.runKernel((function(e){return e.addN(t)}),i,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}))}}),n.addStrict=l.op({addStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in addStrict: "),e.add(t)}}),n.atan2=l.op({atan2_:function(e,t){var a=o.convertToTensor(e,"a","atan2"),s=o.convertToTensor(t,"b","atan2");i.assertTypesMatch(a,s);var l=u.assertAndGetBroadcastShape(a.shape,s.shape);return r.ENV.engine.runKernel((function(e){return e.atan2(a,s)}),{$a:a,$b:s},(function(e){return{$a:function(){var t=n.add(a.square(),s.square()),r=e.mul(s.div(t)),i=u.getReductionAxes(a.shape,l);return i.length>0&&(r=r.sum(i)),r.reshape(a.shape)},$b:function(){var t=n.add(a.square(),s.square()),r=p.neg(e.mul(a.div(t))),i=u.getReductionAxes(s.shape,l);return i.length>0&&(r=r.sum(i)),r.reshape(s.shape)}}}))}}),n.div=l.op({div_:function(e,t){var a,s=o.convertToTensor(e,"a","div"),l=o.convertToTensor(t,"b","div");if(i.assertTypesMatch(s,l),"int32"===s.dtype&&"int32"===l.dtype)return n.floorDiv(s,l);a=function(e){return e.realDivide(s,l)};var c=u.assertAndGetBroadcastShape(s.shape,l.shape);return r.ENV.engine.runKernel(a,{$a:s,$b:l},(function(e){return{$a:function(){var t=e.div(l.toFloat()),n=u.getReductionAxes(s.shape,c);return n.length>0?t.sum(n).reshape(s.shape):t},$b:function(){var t=e.mul(s.toFloat()),n=u.getReductionAxes(l.shape,c);n.length>0&&(t=t.sum(n).reshape(l.shape));var r=l.square();return t.div(r.toFloat()).neg()}}}))}}),n.divStrict=l.op({divStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in divideStrict: "),e.div(t)}}),n.floorDiv=l.op({floorDiv_:function(e,t){var n=o.convertToTensor(e,"a","floorDiv"),a=o.convertToTensor(t,"b","floorDiv");i.assertTypesMatch(n,a);var s=u.assertAndGetBroadcastShape(n.shape,a.shape);return r.ENV.engine.runKernel((function(e){return e.floorDiv(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){var t=e.div(a.toFloat()),r=u.getReductionAxes(n.shape,s);return r.length>0?t.sum(r).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),r=u.getReductionAxes(a.shape,s);r.length>0&&(t=t.sum(r).reshape(a.shape));var i=a.square();return t.div(i.toFloat()).neg()}}}))}}),n.maximum=l.op({maximum_:function(e,t){var n=o.convertToTensor(e,"a","maximum"),a=o.convertToTensor(t,"b","maximum");return i.assertTypesMatch(n,a),"bool"===n.dtype&&(n=n.toInt()),"bool"===a.dtype&&(a=a.toInt()),u.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.maximum(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){return e.mul(n.greaterEqual(a).toFloat())},$b:function(){return e.mul(n.less(a).toFloat())}}}))}}),n.maximumStrict=l.op({maximumStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in maximumStrict: "),e.maximum(t)}}),n.minimum=l.op({minimum_:function(e,t){var n=o.convertToTensor(e,"a","minimum"),a=o.convertToTensor(t,"b","minimum");return i.assertTypesMatch(n,a),"bool"===n.dtype&&(n=n.toInt()),"bool"===a.dtype&&(a=a.toInt()),u.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.minimum(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){return e.mul(n.lessEqual(a).toFloat())},$b:function(){return e.mul(n.greater(a).toFloat())}}}))}}),n.minimumStrict=l.op({minimumStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)}}),n.mod=l.op({mod_:function(e,t){var n=o.convertToTensor(e,"a","mod"),a=o.convertToTensor(t,"b","mod");i.assertTypesMatch(n,a);var s=u.assertAndGetBroadcastShape(n.shape,a.shape);return r.ENV.engine.runKernel((function(e){return e.mod(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){var t=u.getReductionAxes(n.shape,s);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(a).floor().neg()),r=u.getReductionAxes(a.shape,s);return r.length>0?t.sum(r).reshape(a.shape):t}}}))}}),n.modStrict=l.op({modStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in modStrict: "),e.mod(t)}}),n.mul=l.op({mul_:function(e,t){var n=o.convertToTensor(e,"a","mul"),a=o.convertToTensor(t,"b","mul");i.assertTypesMatch(n,a);var s=u.assertAndGetBroadcastShape(n.shape,a.shape);return r.ENV.engine.runKernel((function(e){return e.multiply(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){var t=e.mul(a.toFloat()),r=u.getReductionAxes(n.shape,s);return r.length>0?t.sum(r).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),r=u.getReductionAxes(a.shape,s);return r.length>0?t.sum(r).reshape(a.shape):t}}}))}}),n.mulStrict=l.op({mulStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)}}),n.pow=l.op({pow_:function(e,t){var n=o.convertToTensor(e,"base","pow"),i=o.convertToTensor(t,"exp","pow"),s=u.assertAndGetBroadcastShape(n.shape,i.shape);return e=n.cast(a.upcastType(n.dtype,i.dtype)),t=i.cast(a.upcastType(n.dtype,i.dtype)),r.ENV.engine.runKernel((function(e,t){return t(e.pow(n,i))}),{$base:n,$exp:i},(function(e,t){var r=t[0];return{$base:function(){var t=e.mul(i.toFloat().mul(r.div(n))),o=u.getReductionAxes(n.shape,s);return o.length>0&&(t=t.sum(o)),t.reshape(n.shape)},$exp:function(){var t=e.mul(r.mul(n.log()).toFloat()),o=u.getReductionAxes(i.shape,s);return o.length>0&&(t=t.sum(o)),t.reshape(i.shape)}}}))}}),n.powStrict=l.op({powStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),n.squaredDifference=l.op({squaredDifference_:function(e,t){var n=o.convertToTensor(e,"a","squaredDifference"),a=o.convertToTensor(t,"b","squaredDifference");return i.assertTypesMatch(n,a),u.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.squaredDifference(n,a)}),{$a:n,$b:a},(function(e){var t=c.scalar(2);return{$a:function(){return e.mul(n.sub(a).mul(t))},$b:function(){return e.mul(a.sub(n).mul(t))}}}))}}),n.squaredDifferenceStrict=l.op({squaredDifferenceStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(t)}}),n.sub=l.op({sub_:function(e,t){var n=o.convertToTensor(e,"a","sub"),a=o.convertToTensor(t,"b","sub");i.assertTypesMatch(n,a);var s=u.assertAndGetBroadcastShape(n.shape,a.shape);return r.ENV.engine.runKernel((function(e){return e.subtract(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){var t=e,r=u.getReductionAxes(n.shape,s);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},$b:function(){var t=e,n=u.getReductionAxes(a.shape,s);return n.length>0&&(t=t.sum(n)),t.neg().reshape(a.shape)}}}))}}),n.subStrict=l.op({subStrict_:function(e,t){return s.assertShapesMatch(e.shape,t.shape,"Error in subStrict: "),e.sub(t)}})},{"../environment":62,"../tensor_util":187,"../tensor_util_env":188,"../types":191,"../util":192,"./broadcast_util":137,"./operation":154,"./tensor_ops":169,"./unary_ops":172}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getBroadcastDims=function(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var o=n-1-i,a=e[o]||1;(t[t.length-1-i]||1)>1&&1===a&&r.unshift(o)}return r},n.getReductionAxes=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],o=t.length-r-1,a=t[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n},n.broadcastDimsAreOuter=function(e){for(var t=0;t<e.length;t++)if(e[t]!==t)return!1;return!0},n.assertAndGetBroadcastShape=function(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var o=e[e.length-i-1];null==o&&(o=1);var a=t[t.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(o)}}return n}},{}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util"),o=e("../tensor_util_env"),a=e("../util"),s=e("./broadcast_util"),u=e("./operation"),l=e("./tensor_ops");n.equal=u.op({equal_:function(e,t){var n=o.convertToTensor(e,"a","equal"),a=o.convertToTensor(t,"b","equal");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.equal(n,a)}),{$a:n,$b:a})}}),n.equalStrict=u.op({equalStrict_:function(e,t){var n=o.convertToTensor(e,"a","equalStrict"),r=o.convertToTensor(t,"b","equalStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),n.greater=u.op({greater_:function(e,t){var n=o.convertToTensor(e,"a","greater"),a=o.convertToTensor(t,"b","greater");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.greater(n,a)}),{$a:n,$b:a})}}),n.greaterEqual=u.op({greaterEqual_:function(e,t){var n=o.convertToTensor(e,"a","greaterEqual"),a=o.convertToTensor(t,"b","greaterEqual");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.greaterEqual(n,a)}),{$a:n,$b:a},(function(e){return{$a:function(){return l.zerosLike(n)},$b:function(){return l.zerosLike(a)}}}))}}),n.greaterEqualStrict=u.op({greaterEqualStrict_:function(e,t){var n=o.convertToTensor(e,"a","greaterEqualStrict"),r=o.convertToTensor(t,"b","greaterEqualStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),n.greaterStrict=u.op({greaterStrict_:function(e,t){var n=o.convertToTensor(e,"a","greaterStrict"),r=o.convertToTensor(t,"b","greaterStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),n.less=u.op({less_:function(e,t){var n=o.convertToTensor(e,"a","less"),a=o.convertToTensor(t,"b","less");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.less(n,a)}),{$a:n,$b:a})}}),n.lessEqual=u.op({lessEqual_:function(e,t){var n=o.convertToTensor(e,"a","lessEqual"),a=o.convertToTensor(t,"b","lessEqual");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.lessEqual(n,a)}),{$a:n,$b:a})}}),n.lessEqualStrict=u.op({lessEqualStrict_:function(e,t){var n=o.convertToTensor(e,"a","lessEqualStrict"),r=o.convertToTensor(t,"b","lessEqualStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),n.lessStrict=u.op({lessStrict_:function(e,t){var n=o.convertToTensor(e,"a","lessStrict"),r=o.convertToTensor(t,"b","lessStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),n.notEqual=u.op({notEqual_:function(e,t){var n=o.convertToTensor(e,"a","notEqual"),a=o.convertToTensor(t,"b","notEqual");return i.assertTypesMatch(n,a),s.assertAndGetBroadcastShape(n.shape,a.shape),r.ENV.engine.runKernel((function(e){return e.notEqual(n,a)}),{$a:n,$b:a})}}),n.notEqualStrict=u.op({notEqualStrict_:function(e,t){var n=o.convertToTensor(e,"a","notEqualStrict"),r=o.convertToTensor(t,"b","notEqualStrict");return a.assertShapesMatch(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}})},{"../environment":62,"../tensor_util":187,"../tensor_util_env":188,"../util":192,"./broadcast_util":137,"./operation":154,"./tensor_ops":169}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./operation");n.complex=a.op({complex_:function(e,t){var n=i.convertToTensor(e,"real","complex"),a=i.convertToTensor(t,"imag","complex");return o.assertShapesMatch(n.shape,a.shape,"real and imag shapes, "+n.shape+" and "+a.shape+", must match in call to tf.complex()."),r.ENV.engine.runKernel((function(e){return e.complex(n,a)}),{$real:n,$imag:a})}}),n.real=a.op({real_:function(e){var t=i.convertToTensor(e,"input","real");return r.ENV.engine.runKernel((function(e){return e.real(t)}),{$input:t})}}),n.imag=a.op({imag_:function(e){var t=i.convertToTensor(e,"input","imag");return r.ENV.engine.runKernel((function(e){return e.imag(t)}),{$input:t})}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./operation":154}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./axis_util"),s=e("./concat_util"),u=e("./operation"),l=e("./tensor_ops");n.concat=u.op({concat_:function(e,t){void 0===t&&(t=0),o.assert(e.length>=1,"Pass at least one tensor to concat");var u=i.convertToTensorArray(e,"tensors","concat"),c=s.computeOutShape(u.map((function(e){return e.shape})),t);if(0===o.sizeFromShape(c))return l.tensor([],c);if(1===(u=u.filter((function(e){return e.size>0}))).length)return u[0];var p=a.parseAxisParam(t,u[0].shape)[0],h=u.map((function(e){return e.shape}));s.assertParamsConsistent(h,p);var f=u;return r.ENV.engine.runKernel((function(e){return e.concat(u,p)}),f,(function(e){var r=h.map((function(e){return e[t]}));return n.split(e,r,t).map((function(e){return function(){return e}}))}))}}),n.concat1d=u.op({concat1d_:function(e){return n.concat(e,0)}}),n.concat2d=u.op({concat2d_:function(e,t){return n.concat(e,t)}}),n.concat3d=u.op({concat3d_:function(e,t){return n.concat(e,t)}}),n.concat4d=u.op({concat4d_:function(e,t){return n.concat(e,t)}}),n.split=u.op({split_:function(e,t,s){void 0===s&&(s=0);var u,l=i.convertToTensor(e,"x","split");return s=a.parseAxisParam(s,l.shape)[0],"number"==typeof t?(o.assert(l.shape[s]%t==0,"Number of splits must evenly divide the axis."),u=Array(t).fill(l.shape[s]/t)):(o.assert(l.shape[s]===t.reduce((function(e,t){return e+t})),"The sum of sizes must match the size of the axis dimension."),u=t),r.ENV.engine.runKernel((function(e){return e.split(l,u,s)}),{$x:l},(function(e){return{$x:function(){return n.concat(e,s)}}}))}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./concat_util":141,"./operation":154,"./tensor_ops":169}],141:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");n.assertParamsConsistent=function(e,t){var n=e[0].length;e.forEach((function(e,t){r.assert(e.length===n,"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")")})),r.assert(t>=0&&t<n,"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+".");var i=e[0];e.forEach((function(e,o){for(var a=0;a<n;a++)r.assert(a===t||e[a]===i[a],"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+i+") along the non-concatenated axis "+o+".")}))},n.computeOutShape=function(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}},{"../util":192}],142:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./conv_util"),s=e("./operation");function u(e,t,n,i,s,u){o.assert(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var l=e,c=t,p=!1;3===t.rank&&(p=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),l=[1,e[0],e[1],e[2]]);var h=l[3],f=c.shape[3];o.assert(4===l.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."),o.assert(4===c.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank),o.assert(4===n.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),o.assert(h===n.shape[2],"Error in conv2dDerInput: depth of input ("+h+") must match input depth for filter "+n.shape[2]+"."),o.assert(f===n.shape[3],"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."),null!=u&&o.assert(o.isInt(s),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var d=a.computeConv2DInfo(l,n.shape,i,1,s,u),m=r.ENV.engine.runKernel((function(e){return e.conv2dDerInput(c,n,d)}),{dy4D:c});return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function l(e){var t=function(e){return"number"==typeof e?[e,e]:e}(e),n=t[0],r=t[1];return 1===n&&1===r}function c(e,t){return l(e)||l(t)}n.conv1d=s.op({conv1d_:function(e,t,r,a,s,u,l){void 0===s&&(s="NWC"),void 0===u&&(u=1);var p=i.convertToTensor(e,"x","conv1d"),h=i.convertToTensor(t,"filter","conv1d"),f=p,d=!1;2===p.rank&&(d=!0,f=p.as3D(1,p.shape[0],p.shape[1])),o.assert(3===f.rank,"Error in conv1d: input must be rank 3, but got rank "+f.rank+"."),o.assert(3===h.rank,"Error in conv1d: filter must be rank 3, but got rank "+h.rank+"."),null!=l&&o.assert(o.isInt(a),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+a+"."),o.assert(f.shape[2]===h.shape[1],"Error in conv1d: depth of input ("+f.shape[2]+") must match input depth for filter "+h.shape[1]+"."),o.assert(c(r,u),"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+u+"'"),o.assert("NWC"===s,"Error in conv1d: got dataFormat of "+s+" but only NWC is currently supported.");var m=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]),y=f.as4D(f.shape[0],1,f.shape[1],f.shape[2]),g=[1,r],v=[1,u],b=n.conv2d(y,m,g,a,"NHWC",v,l);return d?b.as2D(b.shape[2],b.shape[3]):b.as3D(b.shape[0],b.shape[2],b.shape[3])}}),n.conv2d=s.op({conv2d_:function(e,t,n,s,p,h,f){void 0===p&&(p="NHWC"),void 0===h&&(h=[1,1]);var d=i.convertToTensor(e,"x","conv2d"),m=i.convertToTensor(t,"filter","conv2d"),y=d,g=!1;3===d.rank&&(g=!0,y=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),o.assert(4===y.rank,"Error in conv2d: input must be rank 4, but got rank "+y.rank+"."),o.assert(4===m.rank,"Error in conv2d: filter must be rank 4, but got rank "+m.rank+"."),null!=f&&o.assert(o.isInt(s),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+f+" but got pad "+s+"."),o.assert(y.shape[3]===m.shape[2],"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+m.shape[2]+"."),o.assert(c(n,h),"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+h+"'"),o.assert("NHWC"===p,"Error in conv2d: got dataFormat of "+p+" but only NHWC is currently supported.");var v=a.computeConv2DInfo(y.shape,m.shape,n,h,s,f),b=r.ENV.engine.runKernel((function(e){return e.conv2d(y,m,v)}),{x:y,$filter:m},(function(e){return o.assert(l(h),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+h+"'"),{x:function(){return u(y.shape,e,m,n,s)},$filter:function(){return function(e,t,n,i,s,u){var l=e;3===e.rank&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;3===c.rank&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));o.assert(4===l.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."),o.assert(4===c.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."),o.assert(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),o.assert(l.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+l.shape[3]+") must match input depth in filter ("+n[2]+"."),o.assert(c.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+c.shape[3]+") must match output depth for filter ("+n[3]+")."),null!=u&&o.assert(o.isInt(s),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var p=1,h=a.computeConv2DInfo(l.shape,n,i,p,s,u);return r.ENV.engine.runKernel((function(e){return e.conv2dDerFilter(l,c,h)}),{x4D:l,dy4D:c})}(y,e,m.shape,n,s)}}}));return g?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),n.depthwiseConv2d=s.op({depthwiseConv2d_:function(e,t,n,s,u,p,h){void 0===u&&(u="NHWC"),void 0===p&&(p=[1,1]);var f=i.convertToTensor(e,"x","depthwiseConv2d"),d=i.convertToTensor(t,"filter","depthwiseConv2d"),m=f,y=!1;3===f.rank&&(y=!0,m=f.as4D(1,f.shape[0],f.shape[1],f.shape[2])),o.assert(4===m.rank,"Error in depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."),o.assert(4===d.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+d.rank+"."),o.assert(m.shape[3]===d.shape[2],"Error in depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+d.shape[2]+"."),null==p&&(p=[1,1]),o.assert(c(n,p),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+p+"'"),null!=h&&o.assert(o.isInt(s),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+s+".");var g=a.computeConv2DInfo(m.shape,d.shape,n,p,s,h,!0),v=r.ENV.engine.runKernel((function(e){return e.depthwiseConv2D(m,d,g)}),{x:m,$filter:d},(function(e){return o.assert(l(p),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+p+"'"),{x:function(){return function(e,t,n,i){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=r.ENV.engine.runKernel((function(e){return e.depthwiseConv2DDerInput(o,n,i)}),{dy4D:o});if(a)return s.as3D(s.shape[1],s.shape[2],s.shape[3]);return s}(m.shape,e,d,g)},$filter:function(){return function(e,t,n,i){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));return r.ENV.engine.runKernel((function(e){return e.depthwiseConv2DDerFilter(o,a,i)}),{x4D:o,dy4D:a})}(m,e,d.shape,g)}}}));return y?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),n.separableConv2d=s.op({separableConv2d_:function(e,t,r,a,s,u,l){void 0===u&&(u=[1,1]),void 0===l&&(l="NHWC");var c=i.convertToTensor(e,"x","separableConv2d"),p=i.convertToTensor(t,"depthwiseFilter","separableConv2d"),h=i.convertToTensor(r,"pointwiseFilter","separableConv2d"),f=c,d=!1;if(3===c.rank&&(d=!0,f=c.as4D(1,c.shape[0],c.shape[1],c.shape[2])),"NCHW"===l)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");o.assert(4===f.rank,"Error in separableConv2d: input must be rank 4, but got rank "+f.rank+"."),o.assert(4===p.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+p.rank+"."),o.assert(4===h.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+p.rank+"."),o.assert(1===h.shape[0],"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."),o.assert(1===h.shape[1],"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+h.shape[1]+".");var m=p.shape[2],y=p.shape[3];o.assert(h.shape[2]===m*y,"Error in separableConv2d: the third dimension of pointwise filter must be "+m*y+", but got "+h.shape[2]+".");var g=n.depthwiseConv2d(f,p,a,s,l,u),v=n.conv2d(g,h,1,"valid",l);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),n.conv2dTranspose=s.op({conv2dTranspose_:function(e,t,n,r,o,a){return u(n,i.convertToTensor(e,"x","conv2dTranspose"),i.convertToTensor(t,"filter","conv2dTranspose"),r,o,a)}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./conv_util":143,"./operation":154}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");function i(e,t,n,i,l,c,p,h){void 0===p&&(p=!1),void 0===h&&(h="channelsLast");var f=[-1,-1,-1,-1],d=f[0],m=f[1],y=f[2],g=f[3];if("channelsLast"===h)d=e[0],m=e[1],y=e[2],g=e[3];else{if("channelsFirst"!==h)throw new Error("Unknown dataFormat "+h);d=e[0],g=e[1],m=e[2],y=e[3]}var v,b=t[0],_=t[1],w=t[3],S=a(n),x=S[0],T=S[1],P=a(i),N=P[0],A=P[1],k=function(e,t,n,i,a,s,l,c){var p,h,f;if("number"==typeof e){p={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,i,a,s){null==a&&(a=o(e,t,i));var l=e[0],c=e[1],p=u((l-t+2*a)/i+1,s);r.assert(r.isInt(p),"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters");var h=u((c-t+2*a)/i+1,s);return r.assert(r.isInt(h),"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"),[p,h,n]}([t,n,1],s,1,i,e,c);h=d[0],f=d[1]}else if("same"===e){var m=((h=Math.ceil(t/i))-1)*i+s-t,y=((f=Math.ceil(n/a))-1)*a+l-n,g=Math.floor(m/2),v=m-g,b=Math.floor(y/2);p={top:g,bottom:v,left:b,right:y-b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);p={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-s+1)/i),f=Math.ceil((n-l+1)/a)}return{padInfo:p,outHeight:h,outWidth:f}}(l,m,y,x,T,s(b,N),s(_,A),c),E=k.padInfo,O=k.outHeight,I=k.outWidth,M=p?w*g:w;return"channelsFirst"===h?v=[d,M,O,I]:"channelsLast"===h&&(v=[d,O,I,M]),{batchSize:d,dataFormat:h,inHeight:m,inWidth:y,inChannels:g,outHeight:O,outWidth:I,outChannels:M,padInfo:E,strideHeight:x,strideWidth:T,filterHeight:b,filterWidth:_,dilationHeight:N,dilationWidth:A,inShape:e,outShape:v,filterShape:t}}function o(e,t,n,r){void 0===r&&(r=1);var i=s(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function a(e){return"number"==typeof e?[e,e]:e}function s(e,t){return t<=1?e:e+(e-1)*(t-1)}function u(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}n.computePool2DInfo=function(e,t,n,r,o,s){void 0===s&&(s="channelsLast");var u,l=a(t),c=l[0],p=l[1];if("channelsLast"===s)u=[c,p,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=[c,p,e[1],e[1]]}return i(e,u,n,1,r,o,!1,s)},n.computeConv2DInfo=i,n.computeDefaultPad=o},{"../util":192}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ERF_P=.3275911,n.ERF_A1=.254829592,n.ERF_A2=-.284496736,n.ERF_A3=1.421413741,n.ERF_A4=-1.453152027,n.ERF_A5=1.061405429},{}],145:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../kernels/non_max_suppression_impl"),s=e("../tensor_util_env"),u=e("../util"),l=e("./operation");function c(e,t,n,r,i){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY);var o=e.shape[0];return n=Math.min(n,o),u.assert(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),u.assert(2===e.rank,"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"),u.assert(4===e.shape[1],"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),u.assert(1===t.rank,"scores must be a 1D tensor"),u.assert(t.shape[0]===o,"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i}}n.resizeBilinear=l.op({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=s.convertToTensor(e,"images","resizeBilinear");u.assert(3===r.rank||4===r.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),u.assert(2===t.length,"Error in resizeBilinear: new shape must 2D, but got shape "+t+".");var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],c=t[1],p=o.ENV.engine.runKernel((function(e,t){return e.resizeBilinear(i,l,c,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return o.ENV.engine.runKernel((function(t){return t.resizeBilinearBackprop(e,i,n)}),{})}}}));return a?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),n.resizeNearestNeighbor=l.op({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=s.convertToTensor(e,"images","resizeNearestNeighbor");u.assert(3===r.rank||4===r.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),u.assert(2===t.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),u.assert("float32"===r.dtype||"int32"===r.dtype,"`images` must have `int32` or `float32` as dtype");var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],c=t[1],p=o.ENV.engine.runKernel((function(e,t){return e.resizeNearestNeighbor(i,l,c,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return o.ENV.engine.runKernel((function(t){return t.resizeNearestNeighborBackprop(e,i,n)}),{})}}}));return a?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),n.nonMaxSuppression=l.op({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=s.convertToTensor(e,"boxes","nonMaxSuppression"),u=s.convertToTensor(t,"scores","nonMaxSuppression"),l=c(a,u,n,r,i);return n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,o.ENV.engine.runKernel((function(e){return e.nonMaxSuppression(a,u,n,r,i)}),{$boxes:a})}}),n.nonMaxSuppressionAsync=function(e,t,n,o,u){return void 0===o&&(o=.5),void 0===u&&(u=Number.NEGATIVE_INFINITY),r(this,void 0,void 0,(function(){var r,l,p,h,f,d;return i(this,(function(i){switch(i.label){case 0:return r=s.convertToTensor(e,"boxes","nonMaxSuppressionAsync"),l=s.convertToTensor(t,"scores","nonMaxSuppressionAsync"),p=c(r,l,n,o,u),n=p.maxOutputSize,o=p.iouThreshold,u=p.scoreThreshold,[4,r.data()];case 1:return h=i.sent(),[4,l.data()];case 2:return f=i.sent(),d=a.nonMaxSuppressionImpl(h,f,n,o,u),r!==e&&r.dispose(),l!==t&&l.dispose(),[2,d]}}))}))},n.cropAndResize=function(e,t,n,r,i,a){var l=s.convertToTensor(e,"image","cropAndResize","float32"),c=s.convertToTensor(t,"boxes","cropAndResize","float32"),p=s.convertToTensor(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var h=c.shape[0];return u.assert(4===l.rank,"Error in cropAndResize: image must be rank 4,but got rank "+l.rank+"."),u.assert(2===c.rank&&4===c.shape[1],"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+c.shape+"."),u.assert(1===p.rank&&p.shape[0]===h,"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+c.shape+"."),u.assert("int32"===p.dtype,"Error in cropAndResize: boxInd must be of dtype int32, but got dtype "+p.dtype+"."),u.assert(2===r.length,"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."),u.assert(r[0]>=1&&r[1]>=1,"cropSize must be atleast [1,1], but was "+r),u.assert("bilinear"===i||"nearest"===i,"method must be bilinear or nearest, but was "+i),o.ENV.engine.runKernel((function(e,t){return e.cropAndResize(l,c,p,r,i,a)}),{$image:l,$boxes:c})}},{"../environment":62,"../kernels/non_max_suppression_impl":82,"../tensor_util_env":188,"../util":192,"./operation":154}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../globals"),o=e("../util"),a=e("./array_ops"),s=e("./concat_split"),u=e("./norm"),l=e("./operation"),c=e("./reduction_ops"),p=e("./tensor_ops");function h(e,t){return void 0===t&&(t=!1),r.ENV.engine.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],o=e.shape[1],s=a.eye(n),u=e.clone(),l=p.tensor2d([[1]],[1,1]),c=l.clone(),h=n>=o?o:n,f=function(e){var t,a=u,p=c,h=s;t=r.ENV.engine.tidy((function(){var t=u.slice([e,e],[n-e,1]),r=t.norm(),i=u.slice([e,e],[1,1]),a=i.sign().neg(),p=i.sub(a.mul(r)),h=t.div(p);c=1===h.shape[0]?l.clone():l.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=a.matMul(p).div(r).neg(),d=u.slice([e,0],[n-e,o]),m=f.mul(c);u=0===e?d.sub(m.matMul(c.transpose().matMul(d))):u.slice([0,0],[e,o]).concat(d.sub(m.matMul(c.transpose().matMul(d))),0);var y=s.slice([0,e],[n,s.shape[1]-e]);return s=0===e?y.sub(y.matMul(c).matMul(m.transpose())):s.slice([0,0],[n,e]).concat(y.sub(y.matMul(c).matMul(m.transpose())),1),[c,u,s]})),c=t[0],u=t[1],s=t[2],i.dispose([a,p,h])},d=0;d<h;++d)f(d);return!t&&n>o&&(s=s.slice([0,0],[n,o]),u=u.slice([0,0],[o,o])),[s,u]}))}n.gramSchmidt=l.op({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,o.assert(null!=e&&e.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=e[0].shape[0],i=1;i<e.length;++i)o.assert(e[i].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[i].shape[0]+" vs. "+n+")")}else t=!0,e=s.split(e,e.shape[0],0).map((function(e){return a.squeeze(e,[0])}));o.assert(e.length<=e[0].shape[0],"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+").");var l=[],p=e,h=function(e){l.push(r.ENV.engine.tidy((function(){var t=p[e];if(e>0)for(var n=0;n<e;++n){var r=c.sum(l[n].mulStrict(t)).mul(l[n]);t=t.sub(r)}return t.div(u.norm(t,"euclidean"))})))};for(i=0;i<e.length;++i)h(i);return t?a.stack(l,0):l}}),n.qr=l.op({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return h(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=a.unstack(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],o=[];return r.forEach((function(e){var n=h(e,t),r=n[0],a=n[1];i.push(r),o.push(a)})),[a.stack(i,0).reshape(e.shape),a.stack(o,0).reshape(e.shape)]}})},{"../environment":62,"../globals":64,"../util":192,"./array_ops":132,"./concat_split":140,"./norm":153,"./operation":154,"./reduction_ops":159,"./tensor_ops":169}],147:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../kernels/where_impl"),s=e("../tensor_util_env"),u=e("../util"),l=e("./broadcast_util"),c=e("./operation"),p=e("./tensor_ops");n.logicalAnd=c.op({logicalAnd_:function(e,t){var n=s.convertToTensor(e,"a","logicalAnd","bool"),r=s.convertToTensor(t,"b","logicalAnd","bool");return u.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),l.assertAndGetBroadcastShape(n.shape,r.shape),o.ENV.engine.runKernel((function(e){return e.logicalAnd(n,r)}),{$a:n,$b:r})}}),n.logicalNot=c.op({logicalNot_:function(e){var t=s.convertToTensor(e,"x","logicalNot","bool");return u.assert("bool"===t.dtype,"Error Array must be of type bool."),o.ENV.engine.runKernel((function(e){return e.logicalNot(t)}),{$x:t})}}),n.logicalOr=c.op({logicalOr_:function(e,t){var n=s.convertToTensor(e,"a","logicalOr","bool"),r=s.convertToTensor(t,"b","logicalOr","bool");return u.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),l.assertAndGetBroadcastShape(n.shape,r.shape),o.ENV.engine.runKernel((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),n.logicalXor=c.op({logicalXor_:function(e,t){var r=s.convertToTensor(e,"a","logicalXor","bool"),i=s.convertToTensor(t,"b","logicalXor","bool");return u.assert("bool"===r.dtype&&"bool"===i.dtype,"Error Array must be of type bool."),l.assertAndGetBroadcastShape(r.shape,i.shape),n.logicalOr(e,t).logicalAnd(n.logicalAnd(e,t).logicalNot())}}),n.where=c.op({where_:function(e,t,n){var r=s.convertToTensor(t,"a","where"),i=s.convertToTensor(n,"b","where"),a=s.convertToTensor(e,"condition","where","bool");return u.assert("bool"===a.dtype,"Error Condition must be of type bool."),u.assertShapesMatch(r.shape,i.shape,"Error in where: "),1===a.rank?u.assert(a.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):u.assertShapesMatch(a.shape,i.shape,"Error in where: "),o.ENV.engine.runKernel((function(e){return e.select(a,r,i)}),{$condition:a,$a:r,$b:i},(function(e){return{$condition:function(){return p.zerosLike(a)},$a:function(){return e.mul(a.cast(r.dtype))},$b:function(){return e.mul(a.logicalNot().cast(i.dtype))}}}))}}),n.whereAsync=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=s.convertToTensor(e,"condition","where","bool"),u.assert("bool"===t.dtype,"Condition must be of type bool."),[4,t.data()];case 1:return n=i.sent(),r=a.whereImpl(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))}},{"../environment":62,"../kernels/where_impl":130,"../tensor_util_env":188,"../util":192,"./broadcast_util":137,"./operation":154,"./tensor_ops":169}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("../globals"),o=e("../tensor_util_env"),a=e("../util"),s=e("./axis_util"),u=e("./binary_ops"),l=e("./operation"),c=e("./tensor_ops");!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(r=n.Reduction||(n.Reduction={})),n.absoluteDifference=l.op({absoluteDifference_:function(e,t,i,s){void 0===s&&(s=r.SUM_BY_NONZERO_WEIGHTS);var u=o.convertToTensor(e,"labels","absoluteDifference"),l=o.convertToTensor(t,"predictions","absoluteDifference"),c=null;null!=i&&(c=o.convertToTensor(i,"weights","absoluteDifference")),a.assertShapesMatch(u.shape,l.shape,"Error in absoluteDifference: ");var p=u.sub(l).abs();return n.computeWeightedLoss(p,c,s)}}),n.computeWeightedLoss=l.op({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=r.SUM_BY_NONZERO_WEIGHTS);var i=o.convertToTensor(e,"losses","computeWeightedLoss"),s=null;null!=t&&(s=o.convertToTensor(t,"weights","computeWeightedLoss"));var u=null==s?i:i.mul(s);if(n===r.NONE)return u;if(n===r.SUM)return u.sum();if(n===r.MEAN){if(null==s)return u.mean();var l=a.sizeFromShape(i.shape)/a.sizeFromShape(s.shape),p=u.sum().div(s.sum());return l>1?p.div(c.scalar(l)):p}if(n===r.SUM_BY_NONZERO_WEIGHTS){if(null==s)return u.sum().div(c.scalar(i.size));var h=s.mul(c.ones(i.shape)).notEqual(c.scalar(0)).sum().toFloat();return u.sum().div(h)}throw Error("Unknown reduction: "+n)}}),n.cosineDistance=l.op({cosineDistance_:function(e,t,i,s,u){void 0===u&&(u=r.SUM_BY_NONZERO_WEIGHTS);var l=o.convertToTensor(e,"labels","cosineDistance"),p=o.convertToTensor(t,"predictions","cosineDistance"),h=null;null!=s&&(h=o.convertToTensor(s,"weights","cosineDistance")),a.assertShapesMatch(l.shape,p.shape,"Error in cosineDistance: ");var f=c.scalar(1).sub(l.mul(p).sum(i,!0));return n.computeWeightedLoss(f,h,u)}}),n.hingeLoss=l.op({hingeLoss_:function(e,t,i,s){void 0===s&&(s=r.SUM_BY_NONZERO_WEIGHTS);var u=o.convertToTensor(e,"labels","hingeLoss"),l=o.convertToTensor(t,"predictions","hingeLoss"),p=null;null!=i&&(p=o.convertToTensor(i,"weights","hingeLoss")),a.assertShapesMatch(u.shape,l.shape,"Error in hingeLoss: ");var h=c.scalar(1);u=c.scalar(2).mul(u).sub(h);var f=h.sub(u.mul(l)).relu();return n.computeWeightedLoss(f,p,s)}}),n.huberLoss=l.op({huberLoss_:function(e,t,i,s,l){void 0===s&&(s=1),void 0===l&&(l=r.SUM_BY_NONZERO_WEIGHTS);var p=o.convertToTensor(e,"labels","huberLoss"),h=o.convertToTensor(t,"predictions","huberLoss"),f=null;null!=i&&(f=o.convertToTensor(i,"weights","huberLoss")),a.assertShapesMatch(p.shape,h.shape,"Error in huberLoss: ");var d=c.scalar(s),m=h.sub(p).abs(),y=u.minimum(m,d),g=m.sub(y),v=c.scalar(.5).mul(y.square()).add(d.mul(g));return n.computeWeightedLoss(v,f,l)}}),n.logLoss=l.op({logLoss_:function(e,t,i,s,u){void 0===s&&(s=1e-7),void 0===u&&(u=r.SUM_BY_NONZERO_WEIGHTS);var l=o.convertToTensor(e,"labels","logLoss"),p=o.convertToTensor(t,"predictions","logLoss"),h=null;null!=i&&(h=o.convertToTensor(i,"weights","logLoss")),a.assertShapesMatch(l.shape,p.shape,"Error in logLoss: ");var f=c.scalar(1),d=c.scalar(s),m=l.mul(p.add(d).log()).neg().sub(f.sub(l).mul(f.sub(p).add(d).log()));return n.computeWeightedLoss(m,h,u)}}),n.meanSquaredError=l.op({meanSquaredError_:function(e,t,i,s){void 0===s&&(s=r.SUM_BY_NONZERO_WEIGHTS);var u=o.convertToTensor(e,"labels","meanSquaredError"),l=o.convertToTensor(t,"predictions","meanSquaredError"),c=null;null!=i&&(c=o.convertToTensor(i,"weights","meanSquaredError")),a.assertShapesMatch(u.shape,l.shape,"Error in meanSquaredError: ");var p=u.squaredDifference(l);return n.computeWeightedLoss(p,c,s)}}),n.sigmoidCrossEntropy=l.op({sigmoidCrossEntropy_:function(e,t,i,s,u){void 0===s&&(s=0),void 0===u&&(u=r.SUM_BY_NONZERO_WEIGHTS);var l=o.convertToTensor(e,"multiClassLabels","sigmoidCrossEntropy"),p=o.convertToTensor(t,"logits","sigmoidCrossEntropy"),h=null;if(null!=i&&(h=o.convertToTensor(i,"weights","sigmoidCrossEntropy")),a.assertShapesMatch(l.shape,p.shape,"Error in sigmoidCrossEntropy: "),s>0){var f=c.scalar(s),d=c.scalar(1),m=c.scalar(.5);l=l.mul(d.sub(f)).add(m.mul(f))}var y=function(e,t){var n=o.convertToTensor(e,"labels","sigmoidCrossEntropyWithLogits"),r=o.convertToTensor(t,"logits","sigmoidCrossEntropyWithLogits");a.assertShapesMatch(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),s=r.mul(n),u=r.abs().neg().exp().log1p();return i.sub(s).add(u)}(l,p);return n.computeWeightedLoss(y,h,u)}}),n.softmaxCrossEntropy=l.op({softmaxCrossEntropy_:function(e,t,u,l,p){void 0===l&&(l=0),void 0===p&&(p=r.SUM_BY_NONZERO_WEIGHTS);var h=o.convertToTensor(e,"onehotLabels","softmaxCrossEntropy"),f=o.convertToTensor(t,"logits","softmaxCrossEntropy"),d=null;if(null!=u&&(d=o.convertToTensor(u,"weights","softmaxCrossEntropy")),a.assertShapesMatch(h.shape,f.shape,"Error in softmaxCrossEntropy: "),l>0){var m=c.scalar(l),y=c.scalar(1),g=c.scalar(h.shape[1]);h=h.mul(y.sub(m)).add(m.div(g))}var v=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);var r=i.customGrad((function(e,t){var r=t.logSumExp([n],!0),i=t.toFloat().sub(r);return{value:i.mul(e).neg().sum([n]),gradFunc:function(t){var r=s.expandShapeToKeepDim(t.shape,[n]);return[t.reshape(r).mul(e.toFloat().sub(i.exp())),t.reshape(r).mul(i.exp().sub(e.toFloat()))]}}}));return r(e,t)}(h,f);return n.computeWeightedLoss(v,d,p)}})},{"../globals":64,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./binary_ops":136,"./operation":154,"./tensor_ops":169}],149:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./operation");n.localResponseNormalization=a.op({localResponseNormalization_:function(e,t,n,a,s){void 0===t&&(t=5),void 0===n&&(n=1),void 0===a&&(a=1),void 0===s&&(s=.5);var u=i.convertToTensor(e,"x","localResponseNormalization");o.assert(4===u.rank||3===u.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+u.rank+"."),o.assert(o.isInt(t),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+t+".");var l=u,c=!1;3===u.rank&&(c=!0,l=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]));var p=r.ENV.engine.runKernel((function(e,r){return r(e.localResponseNormalization4D(l,t,n,a,s))}),{x4D:l},(function(e,i){var o=i[0];return{x4D:function(){return r.ENV.engine.runKernel((function(r){return r.LRNGrad(e,l,o,t,n,a,s)}),{})}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./operation":154}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../tensor_util_env"),i=e("./operation");n.basicLSTMCell=i.op({basicLSTMCell_:function(e,t,n,i,o,a){var s=r.convertToTensor(e,"forgetBias","basicLSTMCell"),u=r.convertToTensor(t,"lstmKernel","basicLSTMCell"),l=r.convertToTensor(n,"lstmBias","basicLSTMCell"),c=r.convertToTensor(i,"data","basicLSTMCell"),p=r.convertToTensor(o,"c","basicLSTMCell"),h=r.convertToTensor(a,"h","basicLSTMCell"),f=c.concat(h,1).matMul(u).add(l),d=f.shape[0],m=f.shape[1]/4,y=[d,m],g=f.slice([0,0],y),v=f.slice([0,m],y),b=f.slice([0,2*m],y),_=f.slice([0,3*m],y),w=g.sigmoid().mulStrict(v.tanh()).addStrict(p.mulStrict(s.add(b).sigmoid())),S=w.tanh().mulStrict(_.sigmoid());return[w,S]}}),n.multiRNNCell=i.op({multiRNNCell_:function(e,t,n,i){for(var o=r.convertToTensor(t,"data","multiRNNCell"),a=r.convertToTensorArray(n,"c","multiRNNCell"),s=r.convertToTensorArray(i,"h","multiRNNCell"),u=o,l=[],c=0;c<e.length;c++){var p=e[c](u,a[c],s[c]);l.push(p[0]),l.push(p[1]),u=p[1]}var h=[],f=[];for(c=0;c<l.length;c+=2)h.push(l[c]),f.push(l[c+1]);return[h,f]}})},{"../tensor_util_env":188,"./operation":154}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./operation");n.matMul=a.op({matMul_:function(e,t,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var s=i.convertToTensor(e,"a","matMul"),u=i.convertToTensor(t,"b","matMul"),l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=a?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=a?u.shape[u.rank-2]:u.shape[u.rank-1],f=s.shape.slice(0,-2),d=u.shape.slice(0,-2),m=o.sizeFromShape(f),y=o.sizeFromShape(d);o.assert(s.rank>=2&&u.rank>=2&&s.rank===u.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."),o.assert(o.arraysEqual(f,d),"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."),o.assert(l===c,"Error in matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+a+" must match.");var g=s.shape.slice(0,-2).concat([p,h]),v=n?s.as3D(m,l,p):s.as3D(m,p,l),b=a?u.as3D(y,h,c):u.as3D(y,c,h);return r.ENV.engine.runKernel((function(e){return e.batchMatMul(v,b,n,a)}),{$a:v,$b:b},(function(e){return n||a?!n&&a?{$a:function(){return e.matMul(b.toFloat(),!1,!1)},$b:function(){return e.matMul(v.toFloat(),!0,!1)}}:n&&!a?{$a:function(){return b.toFloat().matMul(e,!1,!0)},$b:function(){return v.toFloat().matMul(e,!1,!1)}}:{$a:function(){return b.toFloat().matMul(e,!0,!0)},$b:function(){return e.matMul(v.toFloat(),!0,!0)}}:{$a:function(){return e.matMul(b.toFloat(),!1,!0)},$b:function(){return v.toFloat().matMul(e,!0,!1)}}})).reshape(g)}}),n.dot=a.op({dot_:function(e,t){var n=i.convertToTensor(e,"t1","dot"),r=i.convertToTensor(t,"t2","dot");o.assert(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var a=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];return o.assert(a===s,"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+s+"."),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),n.outerProduct=a.op({outerProduct_:function(e,t){var n=i.convertToTensor(e,"v1","outerProduct"),r=i.convertToTensor(t,"v2","outerProduct");return o.assert(1===n.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./operation":154}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../tensor_util"),i=e("../tensor_util_env"),o=e("../util"),a=e("./binary_ops"),s=e("./operation"),u=e("./tensor_ops");n.movingAverage=s.op({movingAverage_:function(e,t,n,s,l){void 0===l&&(l=!0);var c=i.convertToTensor(e,"v","movingAverage"),p=i.convertToTensor(t,"x","movingAverage"),h=i.convertToTensor(n,"decay","movingAverage");r.assertTypesMatch(c,p),o.assert(o.arraysEqual(c.shape,p.shape),"Shape mismatch in v and x");var f=u.scalar(1),d=f.sub(h),m=p.sub(c).mul(d);if(l){o.assert(null!=s,"When using zeroDebias: true, step is required.");var y=i.convertToTensor(s,"step","movingAverage");m=m.div(f.sub(a.pow(h,y)))}return c.add(m)}})},{"../tensor_util":187,"../tensor_util_env":188,"../util":192,"./binary_ops":136,"./operation":154,"./tensor_ops":169}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../tensor_util_env"),i=e("./axis_util"),o=e("./operation"),a=e("./tensor_ops");function s(e,t,n){if(void 0===n&&(n=null),0===e.rank)return e.abs();if(1!==e.rank&&null===n)return s(e.reshape([-1]),t,n);if(1===e.rank||"number"==typeof n||n instanceof Array&&1===n.length){if(1===t)return e.abs().sum(n);if(t===1/0)return e.abs().max(n);if(t===-1/0)return e.abs().min(n);if("euclidean"===t||2===t)return e.abs().pow(a.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(n instanceof Array&&2===n.length){if(1===t)return e.abs().sum(n[0]).max(n[1]-1);if(t===1/0)return e.abs().sum(n[1]).max(n[0]);if(t===-1/0)return e.abs().sum(n[1]).min(n[0]);if("fro"===t||"euclidean"===t)return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+n)}n.norm=o.op({norm_:function(e,t,n,o){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===o&&(o=!1);var a=s(e=r.convertToTensor(e,"x","norm"),t,n),u=a.shape;if(o){var l=i.parseAxisParam(n,e.shape);u=i.expandShapeToKeepDim(a.shape,l)}return a.reshape(u)}})},{"../tensor_util_env":188,"./axis_util":134,"./operation":154,"./tensor_ops":169}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment");n.op=function(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENV.engine.startScope(n);try{var o=i.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r.ENV.engine.endScope(o),o}catch(e){throw r.ENV.engine.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}},{"../environment":62}],155:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./batchnorm")),r(e("./complex_ops")),r(e("./concat_split")),r(e("./conv")),r(e("./matmul")),r(e("./reverse")),r(e("./pool")),r(e("./slice")),r(e("./unary_ops")),r(e("./reduction_ops")),r(e("./compare")),r(e("./binary_ops")),r(e("./relu_ops")),r(e("./logical_ops")),r(e("./array_ops")),r(e("./tensor_ops")),r(e("./transpose")),r(e("./softmax")),r(e("./lrn")),r(e("./norm")),r(e("./segment_ops")),r(e("./lstm")),r(e("./moving_average")),r(e("./strided_slice")),r(e("./topk"));var i=e("./operation");n.op=i.op;var o=e("./loss_ops");n.losses=o;var a=e("./linalg_ops");n.linalg=a;var s=e("./image_ops");n.image=s},{"./array_ops":132,"./batchnorm":135,"./binary_ops":136,"./compare":138,"./complex_ops":139,"./concat_split":140,"./conv":142,"./image_ops":145,"./linalg_ops":146,"./logical_ops":147,"./loss_ops":148,"./lrn":149,"./lstm":150,"./matmul":151,"./moving_average":152,"./norm":153,"./operation":154,"./pool":156,"./reduction_ops":159,"./relu_ops":160,"./reverse":161,"./segment_ops":162,"./slice":165,"./softmax":167,"./strided_slice":168,"./tensor_ops":169,"./topk":170,"./transpose":171,"./unary_ops":172}],156:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./conv_util"),s=e("./operation");n.maxPool=s.op({maxPool_:function(e,t,n,s,u){var l=i.convertToTensor(e,"x","maxPool"),c=l,p=!1;3===l.rank&&(p=!0,c=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),o.assert(4===c.rank,"Error in maxPool: input must be rank 4 but got rank "+c.rank+"."),null!=u&&o.assert(o.isInt(s),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var h=a.computePool2DInfo(c.shape,t,n,s,u),f=r.ENV.engine.runKernel((function(e,t){return t(e.maxPool(c,h))}),{x:c},(function(e,u){var l=u[0];return{x:function(){return function(e,t,n,s,u,l,c){var p=i.convertToTensor(e,"dy","maxPoolBackprop"),h=i.convertToTensor(t,"input","maxPoolBackprop"),f=i.convertToTensor(n,"output","maxPoolBackprop");o.assert(h.rank===p.rank,"Rank of input ("+h.rank+") does not match rank of dy ("+p.rank+")"),o.assert(4===p.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+p.rank+"."),o.assert(4===h.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+"."),null!=c&&o.assert(o.isInt(l),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+l+".");var d=a.computePool2DInfo(h.shape,s,u,l,c),m=r.ENV.engine.runKernel((function(e){return e.maxPoolBackprop(p,h,f,d)}),{$dy:p,$input:h});return m}(e,c,l,t,n,s)}}}));return p?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),n.avgPool=s.op({avgPool_:function(e,t,n,s,u){var l=i.convertToTensor(e,"x","avgPool");o.assert("float32"===l.dtype,"The input dtype to avgPool must be float32");var c=l,p=!1;3===l.rank&&(p=!0,c=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),o.assert(4===c.rank,"Error in avgPool: x must be rank 4 but got rank "+c.rank+"."),null!=u&&o.assert(o.isInt(s),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+s+".");var h=a.computePool2DInfo(c.shape,t,n,s),f=r.ENV.engine.runKernel((function(e){return e.avgPool(c,h)}),{x:c},(function(e){return{x:function(){return function(e,t,n,s,u){var l=i.convertToTensor(e,"dy","avgPoolBackprop"),c=i.convertToTensor(t,"input","avgPoolBackprop");o.assert(c.rank===l.rank,"Rank of input ("+c.rank+") does not match rank of dy ("+l.rank+")");var p=c,h=l,f=!1;3===c.rank&&(f=!0,p=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));o.assert(4===h.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+h.rank+"."),o.assert(4===p.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+p.rank+".");var d=a.computePool2DInfo(p.shape,n,s,u),m=r.ENV.engine.runKernel((function(e){return e.avgPoolBackprop(h,p,d)}),{dy4D:h,input4D:p});if(f)return m.as3D(m.shape[1],m.shape[2],m.shape[3]);return m}(e,c,t,n,s)}}}));return f=f.cast(l.dtype),p?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./conv_util":143,"./operation":154}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("seedrandom"),i=function(){function e(e,t,n,i,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=r.alea(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}();n.MPRandGauss=i},{seedrandom:278}],158:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");n.PARALLELIZE_THRESHOLD=30,n.computeOptimalWindowSize=function(e){return e<=n.PARALLELIZE_THRESHOLD?e:r.nearestDivisor(e,Math.floor(Math.sqrt(e)))}},{"../util":192}],159:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../globals"),o=e("../tensor_util_env"),a=e("../util"),s=e("./axis_util"),u=e("./operation"),l=e("./tensor_ops");n.all=u.op({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var i=o.convertToTensor(e,"x","all","bool");a.assert("bool"===i.dtype,"Error Tensor must be of type bool. Got: "+i.dtype);var u=s.parseAxisParam(t,i.shape),l=u,c=s.getAxesPermutation(l,i.rank);null!=c&&(i=i.transpose(c),l=s.getInnerMostAxes(l.length,i.rank));var p=r.ENV.engine.runKernel((function(e){return e.all(i,l)}),{$x:i});if(n){var h=s.expandShapeToKeepDim(p.shape,u);return p.reshape(h)}return p}}),n.any=u.op({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var i=o.convertToTensor(e,"x","any","bool");a.assert("bool"===i.dtype,"Error Tensor must be of type bool. Got: "+i.dtype);var u=s.parseAxisParam(t,i.shape),l=u,c=s.getAxesPermutation(l,i.rank);null!=c&&(i=i.transpose(c),l=s.getInnerMostAxes(l.length,i.rank));var p=r.ENV.engine.runKernel((function(e){return e.any(i,l)}),{$x:i});if(n){var h=s.expandShapeToKeepDim(p.shape,u);return p.reshape(h)}return p}}),n.argMax=u.op({argMax_:function(e,t){void 0===t&&(t=0);var n=o.convertToTensor(e,"x","argMax");null==t&&(t=0);var i=s.parseAxisParam(t,n.shape),a=s.getAxesPermutation(i,n.rank);return null!=a&&(n=n.transpose(a),i=s.getInnerMostAxes(i.length,n.rank)),r.ENV.engine.runKernel((function(e){return e.argMax(n,i[0])}),{$x:n},(function(e){return{$x:function(){return l.zerosLike(n)}}}))}}),n.argMin=u.op({argMin_:function(e,t){void 0===t&&(t=0);var n=o.convertToTensor(e,"x","argMin");null==t&&(t=0);var i=s.parseAxisParam(t,n.shape),a=s.getAxesPermutation(i,n.rank);return null!=a&&(n=n.transpose(a),i=s.getInnerMostAxes(i.length,n.rank)),r.ENV.engine.runKernel((function(e){return e.argMin(n,i[0])}),{$x:n},(function(e){return{$x:function(){return l.zerosLike(n)}}}))}}),n.logSumExp=u.op({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=o.convertToTensor(e,"x","logSumExp"),i=s.parseAxisParam(t,r.shape),a=r.max(i,!0),u=r.sub(a).exp().sum(i).log(),l=a.reshape(u.shape).add(u);if(n){var c=s.expandShapeToKeepDim(l.shape,i);return l.reshape(c)}return l}}),n.max=u.op({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var i=o.convertToTensor(e,"x","max"),a=s.parseAxisParam(t,i.shape),u=a,l=s.getAxesPermutation(u,i.rank);null!=l&&(i=i.transpose(l),u=s.getInnerMostAxes(u.length,i.rank));var c=r.ENV.engine.runKernel((function(e){return e.max(i,u)}),{$x:i});if(n){var p=s.expandShapeToKeepDim(c.shape,a);return c.reshape(p)}return c}}),n.mean=u.op({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=o.convertToTensor(e,"x","mean"),u=s.parseAxisParam(t,r.shape),c=s.computeOutAndReduceShapes(r.shape,u)[1],p=a.sizeFromShape(c);return i.customGrad((function(e){var r=l.scalar(p);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return u.forEach((function(e){n[e]=1})),t.reshape(n).mul(l.ones(e.shape,"float32")).div(r)}}}))(r)}}),n.min=u.op({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var i=o.convertToTensor(e,"x","min"),a=s.parseAxisParam(t,i.shape),u=a,l=s.getAxesPermutation(u,i.rank);null!=l&&(i=i.transpose(l),u=s.getInnerMostAxes(u.length,i.rank));var c=r.ENV.engine.runKernel((function(e){return e.min(i,u)}),{$x:i});if(n){var p=s.expandShapeToKeepDim(c.shape,a);return c.reshape(p)}return c}}),n.moments=u.op({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1),e=o.convertToTensor(e,"x","moments");var r=s.parseAxisParam(t,e.shape),i=e.mean(r,n),a=i.shape;n||(a=s.expandShapeToKeepDim(i.shape,r));var u=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:u.mean(r,n)}}}),n.sum=u.op({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var a=o.convertToTensor(e,"x","sum");"bool"===a.dtype&&(a=a.toInt());var u=s.parseAxisParam(t,a.shape);return i.customGrad((function(e){var t=s.getAxesPermutation(u,e.rank),i=u,o=e;null!=t&&(o=e.transpose(t),i=s.getInnerMostAxes(i.length,e.rank));var a=r.ENV.engine.runKernel((function(e){return e.sum(o,i)}),{permutedX:o});if(n){var c=s.expandShapeToKeepDim(a.shape,u);a=a.reshape(c)}return{value:a,gradFunc:function(t){var n=e.shape.slice();return u.forEach((function(e){n[e]=1})),t.reshape(n).mul(l.ones(e.shape,"float32"))}}}))(a)}})},{"../environment":62,"../globals":64,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./operation":154,"./tensor_ops":169}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("./binary_ops"),a=e("./logical_ops"),s=e("./operation"),u=e("./selu_util"),l=e("./tensor_ops");n.elu=s.op({elu_:function(e){var t=i.convertToTensor(e,"x","elu");return r.ENV.engine.runKernel((function(e,n){return n(e.elu(t))}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return r.ENV.engine.runKernel((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),n.leakyRelu=s.op({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=i.convertToTensor(e,"x","leakyRelu");return o.maximum(l.scalar(t).mul(n),n)}}),n.prelu=s.op({prelu_:function(e,t){var n=i.convertToTensor(e,"x","prelu"),r=i.convertToTensor(t,"alpha","prelu"),a=l.scalar(0);return o.maximum(a,n).add(r.mul(o.minimum(a,n)))}}),n.relu=s.op({relu_:function(e){var t=i.convertToTensor(e,"x","relu");return"bool"===t.dtype?t.toInt():r.ENV.engine.runKernel((function(e){return e.relu(t)}),{$x:t},(function(e){var n=t.step();return{$x:function(){return e.mulStrict(n.toFloat())}}}))}}),n.selu=s.op({selu_:function(e){var t=i.convertToTensor(e,"x","selu");return r.ENV.engine.runKernel((function(e){return e.selu(t)}),{$x:t},(function(e){return{$x:function(){var n=t.greater(l.scalar(0)),r=l.scalar(u.SELU_SCALEALPHA),i=l.scalar(u.SELU_SCALE),o=e.mul(i),s=e.mul(r).mul(t.toFloat().exp());return a.where(n,o,s)}}}))}})},{"../environment":62,"../tensor_util_env":188,"./binary_ops":136,"./logical_ops":147,"./operation":154,"./selu_util":164,"./tensor_ops":169}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./axis_util"),s=e("./operation");n.reverse=s.op({reverse_:function(e,t){var n=i.convertToTensor(e,"x","reverse");if(0===n.rank)return n.clone();var o=a.parseAxisParam(t,n.shape);return r.ENV.engine.runKernel((function(e){return e.reverse(n,o)}),{$x:n},(function(e){return{$x:function(){return e.reverse(o)}}})).reshapeAs(n)}}),n.reverse1d=s.op({reverse1d_:function(e){var t=i.convertToTensor(e,"x","reverse");return o.assert(1===t.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+t.rank+"."),n.reverse(t,0)}}),n.reverse2d=s.op({reverse2d_:function(e,t){var r=i.convertToTensor(e,"x","reverse");return o.assert(2===r.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+r.rank+"."),n.reverse(r,t)}}),n.reverse3d=s.op({reverse3d_:function(e,t){var r=i.convertToTensor(e,"x","reverse");return o.assert(3===r.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+r.rank+"."),n.reverse(r,t)}}),n.reverse4d=s.op({reverse4d_:function(e,t){var r=i.convertToTensor(e,"x","reverse");return o.assert(4===r.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+r.rank+"."),n.reverse(r,t)}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./operation":154}],162:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./array_ops"),s=e("./axis_util"),u=e("./binary_ops"),l=e("./compare"),c=e("./logical_ops"),p=e("./operation"),h=e("./tensor_ops");function f(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function d(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}n.gather=p.op({gather_:function(e,t,a){void 0===a&&(a=0);var u=i.convertToTensor(e,"x","gather"),l=i.convertToTensor(t,"indices","gather","int32");return o.assert("int32"===l.dtype,"Indices must be of dtype `int32`"),a=s.parseAxisParam(a,u.shape)[0],r.ENV.engine.runKernel((function(e){return e.gather(u,l,a)}),{$x:u},(function(e){return{$x:function(){if(0===a)return n.unsortedSegmentSum(e,l,u.shape[a]);var t=u.shape,r=l.size,i=t.slice(0,a),o=i.length,c=t.slice(a,t.length).slice(1),p=c.length,h=f(0,o),m=f(o+1,o+1+p),y=d([i,[r],c]),g=e.reshape(y),v=l.reshape([r]),b=d([[o],h,m]),_=g.transpose(b),w=n.unsortedSegmentSum(_,v,u.shape[a]),S=s.getUndoAxesPermutation(b);return w=w.transpose(S)}}}))}}),n.unsortedSegmentSum=p.op({unsortedSegmentSum_:function(e,t,s){var p=i.convertToTensor(e,"x","unsortedSegmentSum"),f=i.convertToTensor(t,"segmentIds","unsortedSegmentSum","int32");return o.assert("int32"===f.dtype,"segmentIds must be of dtype `int32`"),o.assert(o.isInt(s),"numSegments must be of dtype int"),r.ENV.engine.runKernel((function(e){return e.unsortedSegmentSum(p,f,s)}),{$x:p},(function(e){return{$x:function(){return function(e,t){for(var r=u.maximum(t,h.zerosLike(t)),i=n.gather(e,r),o=l.greaterEqual(t,h.scalar(0,"int32")),s=i.rank-o.rank,p=0;p<s;++p)o=a.expandDims(o,p+1);o=c.logicalAnd(o,h.ones(i.shape,"bool"));var f=h.zerosLike(i);return c.where(o,i,f)}(e,f)}}}))}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./array_ops":132,"./axis_util":134,"./binary_ops":136,"./compare":138,"./logical_ops":147,"./operation":154,"./tensor_ops":169}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util"),i=e("./reduce_util");n.segOpComputeOptimalWindowSize=function(e,t){var n,o=!1;for(e<=i.PARALLELIZE_THRESHOLD?(n=e,o=!0):n=r.nearestDivisor(e,Math.floor(Math.sqrt(e)));!o;){if(n>t||n===e){o=!0;break}n=r.nearestDivisor(e,n+1)}return n},n.computeOutShape=function(e,t,n){for(var r=[],i=e.length,o=0;o<i;o++)o!==t?r.push(e[o]):r.push(n);return r}},{"../util":192,"./reduce_util":158}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELU_SCALEALPHA=1.7580993408473768,n.SELU_SCALE=1.0507009873554805},{}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./operation"),s=e("./slice_util");n.slice=a.op({slice_:function(e,t,n){var a,u,l=i.convertToTensor(e,"x","slice");if(0===l.rank)throw new Error("Slicing scalar is not possible");a="number"==typeof t?[t].concat(new Array(l.rank-1).fill(0)):t.length<l.rank?t.concat(new Array(l.rank-t.length).fill(0)):t.slice(),u=(u=null==n?new Array(l.rank).fill(-1):"number"==typeof n?[n].concat(new Array(l.rank-1).fill(-1)):n.length<l.rank?n.concat(new Array(l.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(o.assert(-1===e,"Bad value in size"),l.shape[t]-a[t])})),s.assertParamsValid(l,a,u);var c=l.shape;return r.ENV.engine.runKernel((function(e){return e.slice(l,a,u)}),{$x:l},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([a[n],c[n]-a[n]-u[n]]);return{$x:function(){return e.pad(t)}}}))}}),n.slice1d=a.op({slice1d_:function(e,t,r){var a=i.convertToTensor(e,"x","slice1d");return o.assert(1===a.rank,"slice1d expects a rank-1 tensor, but got a rank-"+a.rank+" tensor"),n.slice(a,[t],[r])}}),n.slice2d=a.op({slice2d_:function(e,t,r){var a=i.convertToTensor(e,"x","slice2d");return o.assert(2===a.rank,"slice1d expects a rank-2 tensor, but got a rank-"+a.rank+" tensor"),n.slice(a,t,r)}}),n.slice3d=a.op({slice3d_:function(e,t,r){var a=i.convertToTensor(e,"x","slice3d");return o.assert(3===a.rank,"slice1d expects a rank-3 tensor, but got a rank-"+a.rank+" tensor"),n.slice(a,t,r)}}),n.slice4d=a.op({slice4d_:function(e,t,r){var a=i.convertToTensor(e,"x","slice4d");return o.assert(4===a.rank,"slice1d expects a rank-4 tensor, but got a rank-"+a.rank+" tensor"),n.slice(a,t,r)}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./operation":154,"./slice_util":166}],166:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");function i(e,t,n,i,o){var a=t[o];e&1<<o&&(a=n[o]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=i[o];return a<0&&(a+=s),a=r.clamp(0,a,s-1)}function o(e,t,n,i,o){var a=t[o];e&1<<o&&(a=n[o]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=i[o];return a<0&&(a+=s),a=n[o]>0?r.clamp(0,a,s):r.clamp(-1,a,s-1)}n.assertParamsValid=function(e,t,n){r.assert(e.rank===t.length,"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."),r.assert(e.rank===n.length,"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+").");for(var i=0;i<e.rank;++i)r.assert(t[i]+n[i]<=e.shape[i],"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+n[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")")},n.getStridedSlicedInfo=function(e,t,n,r,a,s,u,l,c){if(void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0),0!==u)throw new Error("ellipsis mask is not yet supported");if(0!==l)throw new Error("new axis mask is not yet supported");for(var p=[],h=[],f=[],d=0;d<e.length;d++)p[d]=i(a,t,r,e,d),h[d]=o(s,n,r,e,d),c&1<<d&&(h[d]=p[d]+1,f.push(d));var m=new Array(e.length).fill(0);return m=m.map((function(e,t){for(var n=0,i=p[t];!(r[t]>0?i>=h[t]:i<=h[t]);i+=r[t])n+=1;return n})),[p,m,f]},n.startForAxis=i,n.stopForAxis=o},{"../util":192}],167:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../gradients"),i=e("../tensor_util_env"),o=e("./operation");n.softmax=o.op({softmax_:function(e,t){void 0===t&&(t=-1);var n=i.convertToTensor(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return r.customGrad((function(e){var n=e.logSumExp([t],!0),r=e.toFloat().sub(n).exp();return{value:r,gradFunc:function(e){var n=e.mul(r);return n.sub(n.sum([t],!0).mul(r))}}}))(n)}})},{"../gradients":65,"../tensor_util_env":188,"./operation":154}],168:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("./operation");n.stridedSlice=o.op({stridedSlice_:function(e,t,n,o,a,s,u,l,c){if(void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0),0!==u)throw new Error("ellipsis mask is not yet supported");if(0!==l)throw new Error("new axis mask is not yet supported");var p=i.convertToTensor(e,"x","stridedSlice");return r.ENV.engine.runKernel((function(e){return e.stridedSlice(p,t,n,o,a,s,u,l,c)}),{$x:p})}})},{"../environment":62,"../tensor_util_env":188,"./operation":154}],169:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor"),o=e("../tensor_util_env"),a=e("../util"),s=e("./complex_ops"),u=e("./operation");function l(e,t,n){if(void 0===n&&(n="float32"),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!a.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e)throw new Error("values passed to tensor(values) must be an array of numbers or booleans, or a TypedArray");var o=a.inferShape(e);return null!=t&&1!==o.length&&a.assertShapesMatch(t,o,"Error creating a new Tensor. Inferred shape ("+o+") does not match the provided shape ("+t+"). "),a.isTypedArray(e)||Array.isArray(e)||(e=[e]),t=t||o,i.Tensor.make(t,{values:a.toTypedArray(e,n,r.ENV.get("DEBUG"))},n)}function c(e,t){void 0===t&&(t="float32"),a.assertNonNull(e);var n=a.inferShape(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return l(e,n,t)}function p(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=p(e,"float32"),r=p(e,"float32");return s.complex(n,r)}var o=a.makeOnesTypedArray(a.sizeFromShape(e),t);return i.Tensor.make(e,{values:o},t)}function h(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=h(e,"float32"),r=h(e,"float32");return s.complex(n,r)}var o=a.makeZerosTypedArray(a.sizeFromShape(e),t);return i.Tensor.make(e,{values:o},t)}n.tensor=l,n.scalar=function(e,t){if(void 0===t&&(t="float32"),(a.isTypedArray(e)||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return l(e,[],t)},n.tensor1d=c,n.tensor2d=function(e,t,n){if(void 0===n&&(n="float32"),a.assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=a.inferShape(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return l(e,t=t||r,n)},n.tensor3d=function(e,t,n){if(void 0===n&&(n="float32"),a.assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=a.inferShape(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return l(e,t=t||r,n)},n.tensor4d=function(e,t,n){if(void 0===n&&(n="float32"),a.assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=a.inferShape(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return l(e,t=t||r,n)},n.tensor5d=function(e,t,n){if(void 0===n&&(n="float32"),a.assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=a.inferShape(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return l(e,t=t||r,n)},n.tensor6d=function(e,t,n){if(void 0===n&&(n="float32"),a.assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=a.inferShape(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return l(e,t=t||r,n)},n.ones=p,n.zeros=h,n.fill=function(e,t,n){void 0===n&&(n="float32");var r=a.getTypedArrayFromDType(n,a.sizeFromShape(e));return r.fill(t),i.Tensor.make(e,{values:r},n)},n.linspace=function(e,t,n){if(0===n)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),i=a.makeZerosTypedArray(n,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return c(i,"float32")},n.range=function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return h([0],r);var i=Math.abs(Math.ceil((t-e)/n)),o=a.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),o[0]=e;for(var s=1;s<o.length;s++)o[s]=o[s-1]+n;return c(o,r)},n.onesLike=u.op({onesLike_:function(e){var t=o.convertToTensor(e,"x","onesLike");return p(t.shape,t.dtype)}}),n.zerosLike=u.op({zerosLike_:function(e){var t=o.convertToTensor(e,"x","zerosLike");return h(t.shape,t.dtype)}})},{"../environment":62,"../tensor":185,"../tensor_util_env":188,"../util":192,"./complex_ops":139,"./operation":154}],170:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("./operation");n.topk=o.op({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var o=i.convertToTensor(e,"x","topk");if(0===o.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=o.shape[o.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var s=r.ENV.engine.runKernel((function(e){return e.topk(o,t,n)}),{$x:o});return{values:s[0],indices:s[1]}}})},{"../environment":62,"../tensor_util_env":188,"./operation":154}],171:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./axis_util"),s=e("./operation");n.transpose=s.op({transpose_:function(e,t){var n=i.convertToTensor(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),o.assert(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."),t.forEach((function(e){o.assert(e>=0&&e<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)})),n.rank<=1?n.clone():r.ENV.engine.runKernel((function(e){return e.transpose(n,t)}),{$x:n},(function(e){var n=a.getUndoAxesPermutation(t);return{$x:function(){return e.transpose(n)}}}))}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./axis_util":134,"./operation":154}],172:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./operation"),s=e("./tensor_ops");n.abs=a.op({abs_:function(e){var t=i.convertToTensor(e,"x","abs");return r.ENV.engine.runKernel((function(e){return e.abs(t)}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(t.toFloat().step(-1))}}}))}}),n.acos=a.op({acos_:function(e){var t=i.convertToTensor(e,"x","acos");return r.ENV.engine.runKernel((function(e){return e.acos(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()).sqrt()).neg()}}}))}}),n.acosh=a.op({acosh_:function(e){var t=i.convertToTensor(e,"x","acosh");return r.ENV.engine.runKernel((function(e){return e.acosh(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.toFloat().square().sub(s.scalar(1)).sqrt())}}}))}}),n.asin=a.op({asin_:function(e){var t=i.convertToTensor(e,"x","asin");return r.ENV.engine.runKernel((function(e){return e.asin(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()).sqrt())}}}))}}),n.asinh=a.op({asinh_:function(e){var t=i.convertToTensor(e,"x","asinh");return r.ENV.engine.runKernel((function(e){return e.asinh(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(s.scalar(1).add(t.toFloat().square()).sqrt())}}}))}}),n.atan=a.op({atan_:function(e){var t=i.convertToTensor(e,"x","atan");return r.ENV.engine.runKernel((function(e){return e.atan(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(s.scalar(1).add(t.toFloat().square()))}}}))}}),n.atanh=a.op({atanh_:function(e){var t=i.convertToTensor(e,"x","atanh");return r.ENV.engine.runKernel((function(e){return e.atanh(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()))}}}))}}),n.ceil=a.op({ceil_:function(e){var t=i.convertToTensor(e,"x","ceil");return r.ENV.engine.runKernel((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),n.clipByValue=a.op({clipByValue_:function(e,t,n){var a=i.convertToTensor(e,"x","clipByValue");return o.assert(t<=n,"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."),r.ENV.engine.runKernel((function(e){return e.clip(a,t,n)}),{$x:a},(function(e){return{$x:function(){return e.where(a.greaterEqual(s.scalar(t)).logicalAnd(a.lessEqual(s.scalar(n))),s.zerosLike(e))}}}))}}),n.cos=a.op({cos_:function(e){var t=i.convertToTensor(e,"x","cos");return r.ENV.engine.runKernel((function(e){return e.cos(t)}),{$x:t},(function(e){return{$x:function(){return t.toFloat().sin().neg().mulStrict(e)}}}))}}),n.cosh=a.op({cosh_:function(e){var t=i.convertToTensor(e,"x","cosh");return r.ENV.engine.runKernel((function(e){return e.cosh(t)}),{$x:t},(function(e){return{$x:function(){return t.toFloat().sinh().mulStrict(e)}}}))}}),n.erf=a.op({erf_:function(e){var t=i.convertToTensor(e,"x","erf");return o.assert("int32"===t.dtype||"float32"===t.dtype,"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=t.toFloat()),r.ENV.engine.runKernel((function(e){return e.erf(t)}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(s.scalar(2/Math.sqrt(Math.PI)).mul(t.square().neg().exp()))}}}))}}),n.exp=a.op({exp_:function(e){var t=i.convertToTensor(e,"x","exp");return r.ENV.engine.runKernel((function(e,n){return n(e.exp(t))}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n)}}}))}}),n.expm1=a.op({expm1_:function(e){var t=i.convertToTensor(e,"x","expm1");return r.ENV.engine.runKernel((function(e){return e.expm1(t)}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(t.exp())}}}))}}),n.floor=a.op({floor_:function(e){var t=i.convertToTensor(e,"x","floor");return r.ENV.engine.runKernel((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),n.log=a.op({log_:function(e){var t=i.convertToTensor(e,"x","log");return r.ENV.engine.runKernel((function(e){return e.log(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.toFloat())}}}))}}),n.log1p=a.op({log1p_:function(e){var t=i.convertToTensor(e,"x","log1p");return r.ENV.engine.runKernel((function(e){return e.log1p(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.add(s.scalar(1)))}}}))}}),n.logSigmoid=a.op({logSigmoid_:function(e){var t=i.convertToTensor(e,"x","logSigmoid");return r.ENV.engine.runKernel((function(e){return e.softplus(t.neg()).neg()}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(t.neg().sigmoid())}}}))}}),n.neg=a.op({neg_:function(e){var t=i.convertToTensor(e,"x","neg");return r.ENV.engine.runKernel((function(e){return e.neg(t)}),{$x:t},(function(e){return{$x:function(){return e.neg()}}}))}}),n.reciprocal=a.op({reciprocal_:function(e){var t=i.convertToTensor(e,"x","reciprocal");return r.ENV.engine.runKernel((function(e){return e.reciprocal(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.square().neg())}}}))}}),n.round=a.op({round_:function(e){var t=i.convertToTensor(e,"x","round");return r.ENV.engine.runKernel((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),n.rsqrt=a.op({rsqrt_:function(e){var t=i.convertToTensor(e,"x","rsqrt");return r.ENV.engine.runKernel((function(e){return e.rsqrt(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.pow(s.scalar(1.5)).mul(s.scalar(2))).neg()}}}))}}),n.sigmoid=a.op({sigmoid_:function(e){var t=i.convertToTensor(e,"x","sigmoid");return r.ENV.engine.runKernel((function(e,n){return n(e.sigmoid(t))}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.mul(s.scalar(1).sub(n)))}}}))}}),n.sign=a.op({sign_:function(e){var t=i.convertToTensor(e,"x","sign");return r.ENV.engine.runKernel((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),n.sin=a.op({sin_:function(e){var t=i.convertToTensor(e,"x","sin");return r.ENV.engine.runKernel((function(e){return e.sin(t)}),{$x:t},(function(e){return{$x:function(){return t.toFloat().cos().mulStrict(e)}}}))}}),n.sinh=a.op({sinh_:function(e){var t=i.convertToTensor(e,"x","sinh");return r.ENV.engine.runKernel((function(e){return e.sinh(t)}),{$x:t},(function(e){return{$x:function(){return t.toFloat().cosh().mulStrict(e)}}}))}}),n.softplus=a.op({softplus_:function(e){var t=i.convertToTensor(e,"x","softplus");return r.ENV.engine.runKernel((function(e){return e.softplus(t)}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(t.sigmoid())}}}))}}),n.sqrt=a.op({sqrt_:function(e){var t=i.convertToTensor(e,"x","sqrt");return r.ENV.engine.runKernel((function(e){return e.sqrt(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.toFloat().sqrt().mul(s.scalar(2)))}}}))}}),n.square=a.op({square_:function(e){var t=i.convertToTensor(e,"x","square");return r.ENV.engine.runKernel((function(e){return e.square(t)}),{$x:t},(function(e){return{$x:function(){return e.mulStrict(t.toFloat().mul(s.scalar(2)))}}}))}}),n.step=a.op({step_:function(e,t){void 0===t&&(t=0);var n=i.convertToTensor(e,"x","step");return r.ENV.engine.runKernel((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),n.tan=a.op({tan_:function(e){var t=i.convertToTensor(e,"x","tan");return r.ENV.engine.runKernel((function(e){return e.tan(t)}),{$x:t},(function(e){return{$x:function(){return e.divStrict(t.cos().square())}}}))}}),n.tanh=a.op({tanh_:function(e){var t=i.convertToTensor(e,"x","tanh");return r.ENV.engine.runKernel((function(e,n){return n(e.tanh(t))}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return s.scalar(1).sub(n.square()).mulStrict(e)}}}))}})},{"../environment":62,"../tensor_util_env":188,"../util":192,"./operation":154,"./tensor_ops":169}],173:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=a.keep(s.scalar(-t)),i.rhoScalar=a.keep(s.scalar(n)),i.oneMinusRho=a.keep(s.scalar(1-n)),null===r&&(r=o.ENV.get("EPSILON")),i.epsilonScalar=a.keep(s.scalar(r)),i}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){a.tidy((function(){t.accumulatedGrads[n]=s.zerosLike(i).variable(false)}))}if(null==r.accumulatedUpdates[n]){a.tidy((function(){t.accumulatedUpdates[n]=s.zerosLike(i).variable(false)}))}var u=e[n],l=r.accumulatedGrads[n],c=r.accumulatedUpdates[n];a.tidy((function(){var e=t.rhoScalar.mul(l).add(t.oneMinusRho.mul(u.square())),r=c.add(t.epsilonScalar).sqrt().div(l.add(t.epsilonScalar).sqrt()).mul(u),o=t.rhoScalar.mul(c).add(t.oneMinusRho.mul(r.square()));t.accumulatedGrads[n].assign(e),t.accumulatedUpdates[n].assign(o);var a=t.c.mul(r).add(i);i.assign(a)}))},r=this;for(var i in e)n(i)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach((function(t){return e.accumulatedUpdates[t].dispose()})),Object.keys(this.accumulatedGrads).forEach((function(t){return e.accumulatedGrads[t].dispose()})))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="AdadeltaOptimizer",t}(e("./optimizer").Optimizer);n.AdadeltaOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],174:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=a.keep(s.scalar(-t)),r.epsilon=a.keep(s.scalar(o.ENV.get("EPSILON"))),r}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){a.tidy((function(){t.accumulatedGrads[n]=s.fill(i.shape,t.initialAccumulatorValue).variable(false)}))}var u=e[n],l=r.accumulatedGrads[n];a.tidy((function(){var e=l.add(u.square());t.accumulatedGrads[n].assign(e);var r=t.c.mul(u.div(e.add(t.epsilon).sqrt())).add(i);i.assign(r)}))},r=this;for(var i in e)n(i)},t.prototype.dispose=function(){var e=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach((function(t){return e.accumulatedGrads[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(e("./optimizer").Optimizer);n.AdagradOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],175:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n,r,i){void 0===i&&(i=null);var u=e.call(this)||this;return u.learningRate=t,u.beta1=n,u.beta2=r,u.epsilon=i,u.accumulatedFirstMoment={},u.accumulatedSecondMoment={},u.c=a.keep(s.scalar(-t)),u.beta1Scalar=a.keep(s.scalar(n)),u.beta2Scalar=a.keep(s.scalar(r)),a.tidy((function(){u.accBeta1=s.scalar(n).variable(),u.accBeta2=s.scalar(r).variable()})),u.oneMinusBeta1=a.keep(s.scalar(1-n)),u.oneMinusBeta2=a.keep(s.scalar(1-r)),u.one=a.keep(s.scalar(1)),null===i&&(i=o.ENV.get("EPSILON")),u.epsScalar=a.keep(s.scalar(i)),u}return i(t,e),t.prototype.applyGradients=function(e){var t=this;a.tidy((function(){var n=t.one.sub(t.accBeta1),r=t.one.sub(t.accBeta2);for(var i in e){var a=o.ENV.engine.registeredVariables[i];if(null==t.accumulatedFirstMoment[i]){var u=!1;t.accumulatedFirstMoment[i]=s.zerosLike(a).variable(u)}if(null==t.accumulatedSecondMoment[i]){u=!1;t.accumulatedSecondMoment[i]=s.zerosLike(a).variable(u)}var l=e[i],c=t.accumulatedFirstMoment[i],p=t.accumulatedSecondMoment[i],h=t.beta1Scalar.mul(c).add(t.oneMinusBeta1.mul(l)),f=t.beta2Scalar.mul(p).add(t.oneMinusBeta2.mul(l.square())),d=h.div(n),m=f.div(r);t.accumulatedFirstMoment[i].assign(h),t.accumulatedSecondMoment[i].assign(f);var y=t.c.mul(d.div(t.epsScalar.add(m.sqrt()))).add(a);a.assign(y)}t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar)),t.accBeta2.assign(t.accBeta2.mul(t.beta2Scalar))}))},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach((function(t){return e.accumulatedFirstMoment[t].dispose()})),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach((function(t){return e.accumulatedSecondMoment[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="AdamOptimizer",t}(e("./optimizer").Optimizer);n.AdamOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],176:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n,r,i,u){void 0===i&&(i=null),void 0===u&&(u=0);var l=e.call(this)||this;return l.learningRate=t,l.beta1=n,l.beta2=r,l.epsilon=i,l.decay=u,l.accumulatedFirstMoment={},l.accumulatedWeightedInfNorm={},l.c=a.keep(s.scalar(-t)),l.beta1Scalar=a.keep(s.scalar(n)),l.beta2Scalar=a.keep(s.scalar(r)),l.decayScalar=a.keep(s.scalar(u)),a.tidy((function(){l.iteration=s.scalar(0).variable(),l.accBeta1=s.scalar(n).variable()})),l.oneMinusBeta1=a.keep(s.scalar(1-n)),l.one=a.keep(s.scalar(1)),null===i&&(i=o.ENV.get("EPSILON")),l.epsScalar=a.keep(s.scalar(i)),l}return i(t,e),t.prototype.applyGradients=function(e){var t=this;a.tidy((function(){var n=t.one.sub(t.accBeta1),r=t.c.div(t.one.add(t.decayScalar.mul(t.iteration)));for(var i in e){var a=o.ENV.engine.registeredVariables[i];if(null==t.accumulatedFirstMoment[i]){var u=!1;t.accumulatedFirstMoment[i]=s.zerosLike(a).variable(u)}if(null==t.accumulatedWeightedInfNorm[i]){u=!1;t.accumulatedWeightedInfNorm[i]=s.zerosLike(a).variable(u)}var l=e[i],c=t.accumulatedFirstMoment[i],p=t.accumulatedWeightedInfNorm[i],h=t.beta1Scalar.mul(c).add(t.oneMinusBeta1.mul(l)),f=t.beta2Scalar.mul(p),d=l.abs(),m=f.maximum(d);t.accumulatedFirstMoment[i].assign(h),t.accumulatedWeightedInfNorm[i].assign(m);var y=r.div(n).mul(h.div(t.epsScalar.add(m))).add(a);a.assign(y)}t.iteration.assign(t.iteration.add(t.one)),t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar))}))},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach((function(t){return e.accumulatedFirstMoment[t].dispose()})),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach((function(t){return e.accumulatedWeightedInfNorm[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="AdamaxOptimizer",t}(e("./optimizer").Optimizer);n.AdamaxOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],177:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.m=s.scalar(i.momentum),i.accumulations={},i}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulations[n]){a.tidy((function(){t.accumulations[n]=s.zerosLike(i).variable(false)}))}var u=r.accumulations[n],l=e[n];a.tidy((function(){var e,r=t.m.mul(u).add(l);e=t.useNesterov?t.c.mul(l.add(r.mul(t.m))).add(i):t.c.mul(r).add(i),t.accumulations[n].assign(r),i.assign(e)}))},r=this;for(var i in e)n(i)},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="MomentumOptimizer",t}(e("./sgd_optimizer").SGDOptimizer);n.MomentumOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./sgd_optimizer":181}],178:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../globals"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,o=r.grads;return this.applyGradients(o),Object.keys(o).forEach((function(e){return o[e].dispose()})),t?i:(i.dispose(),null)},t.prototype.computeGradients=function(e,t){return o.variableGrads(e,t)},t}(e("../serialization").Serializable);n.Optimizer=a},{"../globals":64,"../serialization":183}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./adadelta_optimizer"),i=e("./adagrad_optimizer"),o=e("./adam_optimizer"),a=e("./adamax_optimizer"),s=e("./momentum_optimizer"),u=e("./rmsprop_optimizer"),l=e("./sgd_optimizer"),c=function(){function e(){}return e.sgd=function(e){return new l.SGDOptimizer(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new s.MomentumOptimizer(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new u.RMSPropOptimizer(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new o.AdamOptimizer(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new r.AdadeltaOptimizer(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new a.AdamaxOptimizer(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new i.AdagradOptimizer(e,t)},e}();n.OptimizerConstructors=c},{"./adadelta_optimizer":173,"./adagrad_optimizer":174,"./adam_optimizer":175,"./adamax_optimizer":176,"./momentum_optimizer":177,"./rmsprop_optimizer":180,"./sgd_optimizer":181}],180:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t,n,r,i,u){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===u&&(u=!1);var l=e.call(this)||this;return l.learningRate=t,l.decay=n,l.momentum=r,l.epsilon=i,l.accumulatedMeanSquares={},l.accumulatedMeanGrads={},l.accumulatedMoments={},l.c=a.keep(s.scalar(t)),l.decayScalar=a.keep(s.scalar(n)),l.momentumScalar=a.keep(s.scalar(r)),l.oneMinusDecay=a.keep(s.scalar(1-n)),l.centered=u,null===i&&(i=o.ENV.get("EPSILON")),l.epsilonScalar=a.keep(s.scalar(i)),l}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedMeanSquares[n]){a.tidy((function(){t.accumulatedMeanSquares[n]=s.zerosLike(i).variable(false)}))}if(null==r.accumulatedMeanGrads[n]&&r.centered){a.tidy((function(){t.accumulatedMeanGrads[n]=s.zerosLike(i).variable(false)}))}if(null==r.accumulatedMoments[n]){a.tidy((function(){t.accumulatedMoments[n]=s.zerosLike(i).variable(false)}))}var u=r.accumulatedMeanSquares[n],l=r.accumulatedMeanGrads[n],c=r.accumulatedMoments[n],p=e[n];a.tidy((function(){var e=t.decayScalar.mul(u).add(t.oneMinusDecay.mul(p.square()));if(t.centered){var r=t.decayScalar.mul(l).add(t.oneMinusDecay.mul(p)),o=t.momentumScalar.mul(c).add(t.c.mul(p).div(e.sub(r.square().add(t.epsilonScalar)).sqrt()));t.accumulatedMeanSquares[n].assign(e),t.accumulatedMeanGrads[n].assign(r),t.accumulatedMoments[n].assign(o);var a=i.sub(o);i.assign(a)}else{var s=t.decayScalar.mul(u).add(t.oneMinusDecay.mul(p.square()));o=t.momentumScalar.mul(c).add(t.c.mul(p).div(s.add(t.epsilonScalar).sqrt()));t.accumulatedMeanSquares[n].assign(s),t.accumulatedMoments[n].assign(o);a=i.sub(o);i.assign(a)}}))},r=this;for(var i in e)n(i)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach((function(t){return e.accumulatedMeanSquares[t].dispose()})),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach((function(t){return e.accumulatedMeanGrads[t].dispose()})),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach((function(t){return e.accumulatedMoments[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSPropOptimizer",t}(e("./optimizer").Optimizer);n.RMSPropOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],181:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return i(t,e),t.prototype.applyGradients=function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],i=o.ENV.engine.registeredVariables[n];a.tidy((function(){var e=t.c.mul(r).add(i);i.assign(e)}))}))},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=a.keep(s.scalar(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGDOptimizer",t}(e("./optimizer").Optimizer);n.SGDOptimizer=l,u.registerClass(l)},{"../environment":62,"../globals":64,"../ops/ops":155,"../serialization":183,"./optimizer":178}],182:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util"),i=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new o)}return e.prototype.profileKernel=function(e,t){var n,i=this,o=this.backendTimer.time((function(){n=t()}));return(Array.isArray(n)?n:[n]).forEach((function(t){var n=t.dataSync();r.checkComputationForNaN(n,t.dtype,e),o.then((function(r){i.logger.logKernelProfile(e,t,n,r.kernelMs)}))})),n},e}();n.Profiler=i;var o=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,i){var o=r.rightPad(i+"ms",9),a=r.rightPad(e,25),s=t.rank,u=t.size,l=r.rightPad(t.shape.toString(),14);console.log("%c"+a+"\t%c"+o+"\t%c"+s+"D "+l+"\t%c"+u,"font-weight:bold","color:red","color:blue","color: orange")},e}();n.Logger=o},{"./util":192}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util"),i=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}();n.Serializable=i;var o=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();n.SerializationMap=o,n.registerClass=function(e){r.assert(null!=e.className,"Class being registered does not have the static className property defined."),r.assert("string"==typeof e.className,"className is required to be a string, but got type "+typeof e.className),r.assert(e.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),o.register(e)}},{"./util":192}],184:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./tensor"),i=e("./util");n.getFilteredNodesXToY=function(e,t,n){for(var r={},i={},o=0;o<t.length;o++)r[t[o].id]=!0;for(o=0;o<e.length;o++){var a=(d=e[o]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),l=!0,i[d.id]=!0;break}if(l)break}}var p={};p[n.id]=!0;var h={};for(o=e.length-1;o>=0;o--)for(a=(d=e[o]).inputs,c=0;c<d.outputs.length;c++)if(p[d.outputs[c].id]){for(var s in a)p[a[s].id]=!0,h[d.id]=!0;break}var f=[];for(o=0;o<e.length;o++){var d;if(i[(d=e[o]).id]&&h[d.id]){var m={};for(var s in d.inputs){var y=d.inputs[s];r[y.id]&&(m[s]=y)}var g=Object.assign({},d);g.inputs=m,g.outputs=d.outputs,f.push(g)}}return f},n.backpropagateGradients=function(e,t){for(var n=function(n){var o=t[n],a=[];if(o.outputs.forEach((function(t){var n=e[t.id];if(null!=n)a.push(n);else{var o=r.Tensor.make(t.shape,{values:i.makeZerosTypedArray(t.size,t.dtype)},t.dtype);a.push(o)}})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var s=o.gradient(1===o.outputs.length?a[0]:a);for(var u in o.inputs){if(!(u in s))throw new Error("Cannot backprop through input "+u+". Available gradients found: "+Object.keys(s)+".");var l=s[u](),c=o.inputs[u];if(!i.arraysEqual(l.shape,c.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+u+"' has shape '"+l.shape+"', which does not match the shape of the input '"+c.shape+"'");if(null==e[c.id])e[c.id]=l;else{var p=e[c.id];e[c.id]=p.add(l),p.dispose()}}},o=t.length-1;o>=0;o--)n(o)}},{"./tensor":185,"./util":192}],185:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./tensor_format"),u=e("./util"),l=e("./util"),c=function(){function e(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=u.sizeFromShape(e),null!=n){var r=n.length;u.assert(r===this.size,"Length of values '"+r+"' does not match the size inferred by the shape '"+this.size+"'.")}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||u.getTypedArrayFromDType(t,u.sizeFromShape(this.shape)),this.strides=l.computeStrides(e)}return e.prototype.set=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length&&(t=[0]),u.assert(t.length===this.rank,"The number of provided coordinates ("+t.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(t);this.values[r]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return f.make(this.shape,{values:this.values},this.dtype)},e}();n.TensorBuffer=c;var p=null,h=null;n.setTensorTracker=function(e){p=e},n.setOpHandler=function(e){h=e};var f=function(){function e(t,n,r,i){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=u.sizeFromShape(t),null!=r&&u.assert(this.size===r.length,"Based on the provided shape, ["+t+"], and dtype "+this.dtype+", the tensor should have "+this.size+" values but has "+r.length),this.strides=l.computeStrides(t),this.dataId=null!=i?i:{},this.id=e.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",p().registerTensor(this),null!=r&&p().write(this.dataId,r)}return e.make=function(t,n,r){return new e(t,r,n.values,n.dataId)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),u.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.asType=function(e){return this.throwIfDisposed(),h.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];u.assert(e.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),u.assert("complex64"!==this.dtype,"Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),0===e.length&&(e=[0]);for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.dataSync()[n]},e.prototype.buffer=function(){return h.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.data=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.throwIfDisposed(),[2,p().read(this.dataId)]}))}))},e.prototype.dataSync=function(){return this.throwIfDisposed(),p().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(p().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),h.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),h.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),h.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),h.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),h.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),h.clone(this)},e.prototype.toString=function(e){void 0===e&&(e=!1);var t=this.dataSync();return s.tensorToString(t,this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),h.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),h.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),h.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),h.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),h.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),h.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),h.reverse(this,e)},e.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),h.concat([this,e],t)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),h.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),h.stack([this,e],t)},e.prototype.unstack=function(e,t){return void 0===t&&(t=0),h.unstack(this,t)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),h.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),this.throwIfDisposed(),h.batchNormalization(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.sum(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),h.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),h.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),h.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),h.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),h.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),h.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),h.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),h.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),h.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),h.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),h.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),h.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),h.div(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),h.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),h.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),h.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),h.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),h.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),h.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),h.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),h.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),h.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),h.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),h.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),h.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),h.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),h.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),h.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),h.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),h.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),h.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),h.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),h.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),h.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),h.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),h.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),h.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),h.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),h.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),h.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),h.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),h.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),h.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),h.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),h.sign(this)},e.prototype.exp=function(){return this.throwIfDisposed(),h.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),h.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),h.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),h.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),h.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),h.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),h.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),h.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),h.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),h.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),h.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),h.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),h.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),h.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),h.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),h.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),h.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),h.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),h.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),h.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),h.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),h.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),h.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),h.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),h.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),h.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),h.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),h.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),h.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),h.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),h.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),h.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),h.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),h.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),h.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),h.softmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),h.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),h.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),h.conv1d(this,e,t,n,r,i,o)},e.prototype.conv2d=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),h.conv2d(this,e,t,n,r,i,o)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),h.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),h.depthwiseConv2d(this,e,t,n,r,i,o)},e.prototype.separableConv2d=function(e,t,n,r,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),h.separableConv2d(this,e,t,n,r,i,o)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),h.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),h.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),h.localResponseNormalization(this,e,t,n,r)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),d.variable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),h.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),h.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),h.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),h.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),this.throwIfDisposed(),h.stridedSlice(this,e,t,n,r,i)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),h.depthToSpace(this,e,t)},e.nextId=0,e}();n.Tensor=f,Object.defineProperty(f,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.shape&&null!=e.dtype}});var d=function(e){function t(n,r,i){void 0===r&&(r=!0);var o=e.call(this,n.shape,n.dtype,null,n.dataId)||this;o.trainable=r,o.name=i,null==o.name&&(o.name=t.nextVarId.toString(),t.nextVarId++);try{p().registerVariable(o)}catch(e){throw p().disposeTensor(o),e}return o}return i(t,e),t.variable=function(e,n,r,i){return void 0===n&&(n=!0),null!=i&&i!==e.dtype&&(e=e.asType(i)),new t(e,n,r)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!u.arraysEqual(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");p().disposeTensor(this),this.dataId=e.dataId,p().registerTensor(this)},t.nextVarId=0,t}(f);n.Variable=d,Object.defineProperty(d,Symbol.hasInstance,{value:function(e){return e instanceof f&&null!=e.assign&&e.assign instanceof Function}});var m=d.variable;n.variable=m},{"./tensor_format":186,"./util":192}],186:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./util"),i=20,o=3,a=7;function s(e,t){var n;return n=Array.isArray(e)?parseFloat(e[0].toFixed(a))+" + "+parseFloat(e[1].toFixed(a))+"j":parseFloat(e.toFixed(a)).toString(),r.rightPad(n,t)}function u(e,t,n,r,a,c){void 0===c&&(c=!0);var p="complex64"===n?2:1,h=t[0],f=t.length;if(0===f)return"complex64"===n?[s(l(e)[0],0)]:[e[0].toString()];if(1===f){if(h>i){var d=o*p,m=Array.from(e.subarray(0,d)),y=Array.from(e.subarray(h-o*p,h));return"complex64"===n&&(m=l(m),y=l(y)),["["+m.map((function(e,t){return s(e,a[t])})).join(", ")+", ..., "+y.map((function(e,t){return s(e,a[h-o+t])})).join(", ")+"]"]}return["["+("complex64"===n?l(e):Array.from(e)).map((function(e,t){return s(e,a[t])})).join(", ")+"]"]}var g=t.slice(1),v=r.slice(1),b=r[0]*p,_=[];if(h>i){for(var w=0;w<o;w++){var S=(x=w*b)+b;_.push.apply(_,u(e.subarray(x,S),g,n,v,a,!1))}_.push("...");for(w=h-o;w<h;w++){S=(x=w*b)+b;_.push.apply(_,u(e.subarray(x,S),g,n,v,a,w===h-1))}}else for(w=0;w<h;w++){var x;S=(x=w*b)+b;_.push.apply(_,u(e.subarray(x,S),g,n,v,a,w===h-1))}var T=2===f?",":"";_[0]="["+_[0]+T;for(w=1;w<_.length-1;w++)_[w]=" "+_[w]+T;var P=",\n";for(w=2;w<f;w++)P+="\n";return _[_.length-1]=" "+_[_.length-1]+"]"+(c?"":P),_}function l(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}n.tensorToString=function(e,t,n,i){var o=r.computeStrides(t),a=function(e,t,n,i){var o=r.sizeFromShape(t),a=i[i.length-1],u=new Array(a).fill(0),c=t.length,p="complex64"===n?l(e):e;if(c>1)for(var h=0;h<o/a;h++)for(var f=h*a,d=0;d<a;d++)u[d]=Math.max(u[d],s(p[f+d],0).length);return u}(e,t,n,o),c=t.length,p=u(e,t,n,o,a),h=["Tensor"];return i&&(h.push("  dtype: "+n),h.push("  rank: "+c),h.push("  shape: ["+t+"]"),h.push("  values:")),h.push(p.map((function(e){return"    "+e})).join("\n")),h.join("\n")}},{"./util":192}],187:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./tensor"),i=e("./util");function o(e,t,n){if(null!=e)if(e instanceof r.Tensor)t.push(e);else if(i=e,Array.isArray(i)||"object"==typeof i){var i,a=e;for(var s in a){var u=a[s];n.has(u)||(n.add(u),o(u,t,n))}}}n.assertTypesMatch=function(e,t){i.assert(e.dtype===t.dtype,"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match")},n.isTensorInList=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},n.flattenNameArrayMap=function(e,t){var n=[];if(e instanceof r.Tensor)n.push(e);else for(var i=e,o=0;o<t.length;o++)n.push(i[t[o]]);return n},n.unflattenToNameArrayMap=function(e,t){if(e.length!==t.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n},n.getTensorsInContainer=function(e){var t=[];return o(e,t,new Set),t}},{"./tensor":185,"./util":192}],188:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment"),i=e("./tensor"),o=e("./util");function a(e,t,n,a){if(void 0===a&&(a="float32"),a=a||"float32",e instanceof i.Tensor)return e;if(!o.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e)throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got "+e.constructor.name);var s=o.inferShape(e);return o.isTypedArray(e)||Array.isArray(e)||(e=[e]),i.Tensor.make(s,{values:o.toTypedArray(e,a,r.ENV.get("DEBUG"))},a)}n.convertToTensor=a,n.convertToTensorArray=function(e,t,n){if(!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return a(e,t+"["+r+"]",n)}))}},{"./environment":62,"./tensor":185,"./util":192}],189:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment"),i=e("./tensor"),o=e("./util");function a(e,t,n){if(null==n&&(n=r.ENV.get("TEST_EPSILON")),e instanceof i.Tensor||t instanceof i.Tensor){if(e instanceof i.Tensor&&t instanceof i.Tensor){if(e.dtype!==t.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+t.dtype+".");if(!o.arraysEqual(e.shape,t.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+t.shape+".")}}else{var a=e.constructor.name,u=t.constructor.name;if(a!==u)throw new Error("Arrays are of different type actual: "+a+" vs expected: "+u)}var l,c;if(l=e instanceof i.Tensor?e.dataSync():e,c=t instanceof i.Tensor?t.dataSync():t,l.length!==c.length)throw new Error("Arrays have different lengths actual: "+l.length+" vs expected: "+c.length+".\nActual:   "+l+".\nExpected: "+c+".");for(var p=0;p<c.length;++p){var h=l[p],f=c[p];if(!s(h,Number(f),n))throw new Error("Arrays differ: actual["+p+"] = "+h+", expected["+p+"] = "+f+".\nActual:   "+l+".\nExpected: "+c+".")}}function s(e,t,n){return!(!isNaN(e)||!isNaN(t))||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}n.WEBGL_ENVS={HAS_WEBGL:!0},n.NODE_ENVS={IS_NODE:!0},n.CHROME_ENVS={IS_CHROME:!0},n.BROWSER_ENVS={IS_BROWSER:!0},n.CPU_ENVS={HAS_WEBGL:!1},n.ALL_ENVS={},n.expectArraysClose=a,n.expectPromiseToFail=function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},n.expectArraysEqual=function(e,t){return a(e,t,0)},n.expectNumbersClose=function(e,t,n){if(null==n&&(n=r.ENV.get("TEST_EPSILON")),!s(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},n.expectValuesInRange=function(e,t,n){var r;r=e instanceof i.Tensor?e.dataSync():e;for(var o=0;o<r.length;o++)if(r[o]<t||r[o]>n)throw new Error("Value out of range:"+r[o]+" low: "+t+", high: "+n)},n.expectArrayBuffersEqual=function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}},{"./environment":62,"./tensor":185,"./util":192}],190:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./optimizers/adadelta_optimizer"),i=e("./optimizers/adagrad_optimizer"),o=e("./optimizers/adam_optimizer"),a=e("./optimizers/adamax_optimizer"),s=e("./optimizers/momentum_optimizer"),u=e("./optimizers/optimizer_constructors"),l=e("./optimizers/rmsprop_optimizer"),c=e("./optimizers/sgd_optimizer");s.MomentumOptimizer,c.SGDOptimizer,r.AdadeltaOptimizer,i.AdagradOptimizer,l.RMSPropOptimizer,a.AdamaxOptimizer,o.AdamOptimizer,n.train={sgd:u.OptimizerConstructors.sgd,momentum:u.OptimizerConstructors.momentum,adadelta:u.OptimizerConstructors.adadelta,adagrad:u.OptimizerConstructors.adagrad,rmsprop:u.OptimizerConstructors.rmsprop,adamax:u.OptimizerConstructors.adamax,adam:u.OptimizerConstructors.adam}},{"./optimizers/adadelta_optimizer":173,"./optimizers/adagrad_optimizer":174,"./optimizers/adam_optimizer":175,"./optimizers/adamax_optimizer":176,"./optimizers/momentum_optimizer":177,"./optimizers/optimizer_constructors":179,"./optimizers/rmsprop_optimizer":180,"./optimizers/sgd_optimizer":181}],191:[function(e,t,n){"use strict";var r,i,o,a;Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.float32="float32",e.int32="int32",e.bool="bool"}(n.DType||(n.DType={})),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(n.Rank||(n.Rank={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(o||(o={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(a||(a={}));var s={float32:o,int32:r,bool:i,complex64:a};function u(e,t){return s[e][t]}n.upcastType=u,n.sumOutType=function(e){return u(e,"int32")}},{}],192:[function(e,t,n){(function(e){"use strict";function t(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function r(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function i(e,t){if(void 0===t&&(t=[]),Array.isArray(e))for(var n=0;n<e.length;++n)i(e[n],t);else t.push(e);return t}function o(e,t,n){if(n=n||[],e instanceof Array){r(t.length>0,(function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"})),r(e.length===t[0],(function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"}));for(var i=t.slice(1),a=0;a<e.length;++a)o(e[a],i,n.concat(a))}else r(0===t.length,(function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array of "+t[0]+" elements"}))}function a(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function s(e,t){if("float32"!==t)for(var n=0;n<e.length;n++)if(isNaN(e[n]))throw Error("NaN is not a valid value for dtype: '"+t+"'.")}function u(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function l(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}Object.defineProperty(n,"__esModule",{value:!0}),n.shuffle=t,n.clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},n.randUniform=function(e,t){var n=Math.random();return t*n+(1-n)*e},n.distSquared=function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},n.assert=r,n.assertShapesMatch=function(e,t,n){void 0===n&&(n=""),r(a(e,t),n+" Shapes "+e+" and "+t+" must match")},n.assertNonNull=function(e){r(null!=e,"The input to the tensor constructor must be a non-null value.")},n.flatten=i,n.inferShape=function(e){var t=e;if(u(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];t instanceof Array;)n.push(t.length),t=t[0];return e instanceof Array&&o(e,n,[]),n},n.sizeFromShape=function(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t},n.isScalarShape=function(e){return 0===e.length},n.arraysEqual=a,n.isInt=function(e){return e%1==0},n.tanh=function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},n.sizeToSquarishShape=function(e){for(var t=Math.floor(Math.sqrt(e));t>1;--t)if(e%t==0)return[t,e/t];return[1,e]},n.createShuffledIndices=function(e){for(var n=new Uint32Array(e),r=0;r<e;++r)n[r]=r;return t(n),n},n.rightPad=function(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)},n.repeatedTry=function(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var o=0,a=function(){if(e())r();else{o++;var s=t(o);null!=n&&o>=n?i():setTimeout(a,s)}};a()}))},n.inferFromImplicitShape=function(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var o=e.slice();return o[r]=t/n,o},n.squeezeShape=function(e,t){for(var n=[],r=[],i=0,o=0;o<e.length;++o){if(null!=t){if(t[i]===o&&1!==e[o])throw new Error("Can't squeeze axis "+o+" since its dim '"+e[o]+"' is not 1");(null==t[i]||t[i]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),t[i]<=o&&i++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}},n.getTypedArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n},n.checkComputationForNaN=function(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++)if(isNaN(e[r]))throw Error("The result of the '"+n+"' has NaNs.")},n.checkConversionForNaN=s,n.hasEncodingLoss=function(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))},n.isTypedArray=u,n.bytesPerElement=function(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)},n.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},n.nearestDivisor=function(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e},n.computeStrides=function(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n},n.toTypedArray=function(e,t,n){return function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t)?e:(Array.isArray(e)&&(e=i(e)),function(e,t,n){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return n&&s(e,t),new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}(e,t,n))},n.makeOnesTypedArray=function(e,t){for(var n=l(e,t),r=0;r<n.length;r++)n[r]=1;return n},n.makeZerosTypedArray=l,n.now=function(){if("undefined"!=typeof performance)return performance.now();if(void 0!==e){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}}).call(this,e("_process"))},{_process:266}],193:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.12.17"},{}],194:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./kernels/webgl/gpgpu_util");n.gpgpu_util=r;var i=e("./kernels/webgl/webgl_util");n.webgl_util=i;var o=e("./kernels/backend_webgl");n.MathBackendWebGL=o.MathBackendWebGL;var a=e("./kernels/webgl/gpgpu_context");n.GPGPUContext=a.GPGPUContext},{"./kernels/backend_webgl":80,"./kernels/webgl/gpgpu_context":102,"./kernels/webgl/gpgpu_util":104,"./kernels/webgl/webgl_util":129}],195:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("./backend/tfjs_backend"),u=e("./backend/state"),l=e("./utils/generic_utils"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getConfig=function(){return{}},t}(a.serialization.Serializable);n.Activation=c;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),s.elu(e,t)},t.className="elu",t}(c);n.Elu=p,a.serialization.SerializationMap.register(p);var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.selu(e)},t.className="selu",t}(c);n.Selu=h,a.serialization.SerializationMap.register(h);var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.relu(e)},t.className="relu",t}(c);n.Relu=f,a.serialization.SerializationMap.register(f);var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return a.tidy((function(){return o.minimum(u.getScalar(6),o.relu(e))}))},t.className="relu6",t}(c);n.Relu6=d,a.serialization.SerializationMap.register(d);var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(c);n.Linear=m,a.serialization.SerializationMap.register(m);var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.sigmoid(e)},t.className="sigmoid",t}(c);n.Sigmoid=y,a.serialization.SerializationMap.register(y);var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return s.hardSigmoid(e)},t.className="hardSigmoid",t}(c);n.HardSigmoid=g,a.serialization.SerializationMap.register(g);var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.softplus(e)},t.className="softplus",t}(c);n.Softplus=v,a.serialization.SerializationMap.register(v);var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return s.softsign(e)},t.className="softsign",t}(c);n.Softsign=b,a.serialization.SerializationMap.register(b);var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.tanh(e)},t.className="tanh",t}(c);n.Tanh=_,a.serialization.SerializationMap.register(_);var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),o.softmax(e,t)},t.className="softmax",t}(c);function S(e,t){return void 0===t&&(t={}),l.deserializeKerasObject(e,a.serialization.SerializationMap.getMap().classNameMap,t,"activation")}n.Softmax=w,a.serialization.SerializationMap.register(w),n.serializeActivation=function(e){return e.getClassName()},n.deserializeActivation=S,n.getActivation=function(e){return null==e?S({className:"linear",config:{}}):"string"==typeof e?S({className:e,config:{}}):e instanceof c?e:S(e)}},{"./backend/state":197,"./backend/tfjs_backend":198,"./utils/generic_utils":236,"@tensorflow/tfjs-core":66}],196:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core").ENV.get("EPSILON");n.epsilon=function(){return r},n.setEpsilon=function(e){r=e},n.imageDataFormat=function(){return"channelsLast"}},{"@tensorflow/tfjs-core":66}],197:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=0;n.getNextUniqueTensorId=function(){return i++};var o={};n.getUid=function(e){return void 0===e&&(e=""),e in o||(o[e]=0),o[e]+=1,e+o[e].toString()};var a={float32:{},int32:{}};n.getScalar=function(e,t){return void 0===t&&(t="float32"),null==a[t][e]&&(a[t][e]=r.scalar(e,t),r.keep(a[t][e])),a[t][e]},n.disposeScalarCache=function(){for(var e in a)for(var t in a[e])a[e][t].dispose(),delete a[e][t]}},{"@tensorflow/tfjs-core":66}],198:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("../backend/state"),a=e("../common"),s=e("../errors"),u=e("../utils/math_utils"),l=e("./common"),c="webgl";function p(e,t){void 0===t&&(t=-1);var n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function h(e,t,n){return i.tidy((function(){switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:return r.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return r.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return r.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);default:throw new s.ValueError("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function f(e,t,n){return i.tidy((function(){switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:return r.slice2d(e,[0,t],[e.shape[0],n]);case 3:return r.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return r.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new s.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function d(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new s.ValueError("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return r.tile(e,t)}n.setBackend=function(e){r.setBackend(e),c=e,o.disposeScalarCache()},n.getBackend=function(){return c},n.isBackendSymbolic=function(){return!1},n.countParams=function(e){var t=e.shape;return t.length>0?t.reduce((function(e,t){return e*t})):1},n.cast=function(e,t){return e.asType(t)},n.expandDims=p,n.repeat=function(e,t){return i.tidy((function(){if(2!==e.shape.length)throw new s.ValueError("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return d(p(e,1),[1,t,1])}))},n.flatten=function(e){var t=[u.arrayProd(e.shape)];return e.reshape(t)},n.batchFlatten=function(e){if(e.rank<=1)throw new s.ValueError("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],u.arrayProd(e.shape,1)];return e.reshape(t)},n.sliceAlongFirstAxis=h,n.sliceAlongLastAxis=f,n.sliceAlongAxis=function(e,t,n,o){return i.tidy((function(){switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:switch(o){case 1:return h(e,t,n);case 2:return f(e,t,n);default:throw new s.ValueError("The axis is not within the rank of the tensor "+o)}case 3:switch(o){case 1:return h(e,t,n);case 2:return r.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return f(e,t,n);default:throw new s.ValueError("The axis is not within the rank of the tensor "+o)}case 4:switch(o){case 1:return h(e,t,n);case 2:return r.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return r.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return f(e,t,n);default:throw new s.ValueError("The axis is not within the rank of the tensor "+o)}default:throw new s.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))},n.concatenate=function(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),r.concat(e,t)},n.concatAlongFirstAxis=function(e,t){switch(e.rank){case 1:return r.concat1d([e,t]);case 2:return r.concat2d([e,t],0);case 3:return r.concat3d([e,t],0);case 4:return r.concat4d([e,t],0);default:throw new s.ValueError("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}},n.tile=d,n.randomNormal=function(e,t,n,i,o){return void 0===t&&(t=0),void 0===n&&(n=1),r.randomNormal(e,t,n,i,o)},n.dot=function(e,t){if(2!==t.rank)throw new s.NotImplementedError("dot support for y other than rank 2 is not yet implemented: y shape = "+t.shape);if(2===e.rank)return r.matMul(e,t);if(3===e.rank){var n=e.shape[0],i=e.shape[1],o=e.shape[2];return e=e.reshape([n*i,o]),r.matMul(e,t).reshape([n,i,t.shape[1]])}throw new s.NotImplementedError("dot support for x of rank "+e.rank+" is not yet implemented: x shape = "+e.shape)},n.sign=function(e){return i.tidy((function(){var t=i.zerosLike(e),n=i.onesLike(e);return i.where(r.equal(e,t),t,i.where(r.greater(e,i.zerosLike(e)),n,r.mul(o.getScalar(-1),n)))}))},n.oneHot=function(e,t){return i.tidy((function(){if(1!==e.rank)throw new Error("Only 1D one-hot tensors are supported in the deeplearn backend, at present.");return e=e.toInt(),r.oneHot(e,t).toFloat()}))},n.gather=function(e,t,n){return i.tidy((function(){return t=Array.isArray(t)?i.tensor1d(t,"int32"):t.toInt(),r.gather(e,t,n)}))},n.square=function(e){return r.mulStrict(e,e)},n.pow=function(e,t){return i.tidy((function(){if("number"==typeof t&&(t=i.scalar(Math.round(t),"int32")),"int32"!==t.dtype)throw new s.NotImplementedError("Non-int32 dtype ("+t.dtype+") is not supported by pow() yet");return r.pow(e,t)}))},n.biasAdd=function(e,t,n){return i.tidy((function(){if(null==n&&(n=l.imageDataFormat()),a.checkDataFormat(n),1!==t.rank&&t.rank!==e.rank)throw new s.ValueError("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e.rank);var r,i=t.shape;if(5===e.rank)"channelsFirst"===n?r=1===i.length?e.add(t.reshape([1,i[0],1,1,1])):e.add(t.reshape([1,i[3],i[0],i[1],i[2]])):"channelsLast"===n&&(r=1===i.length?e.add(t.reshape([1,1,1,1,i[0]])):e.add(t.reshape([1].concat(i))));else if(4===e.rank)"channelsFirst"===n?r=1===i.length?e.add(t.reshape([1,i[0],1,1])):e.add(t.reshape([1,i[2],i[0],i[1]])):"channelsLast"===n&&(r=1===i.length?e.add(t.reshape([1,1,1,i[0]])):e.add(t.reshape([1].concat(i))));else if(3===e.rank)"channelsFirst"===n?r=1===i.length?e.add(t.reshape([1,i[0],1])):e.add(t.reshape([1,i[1],i[0]])):"channelsLast"===n&&(r=1===i.length?e.add(t.reshape([1,1,i[0]])):e.add(t.reshape([1].concat(i))));else{if(!(e.rank<3))throw new s.ValueError("Unsupported input rank by biasAdd: "+e.rank);r=e.add(t)}return r}))},n.elu=function(e,t){if(void 0===t&&(t=1),1!==t)throw new s.NotImplementedError("Support for alpha values other than 1 ("+t+") is not implemented yet.");return r.elu(e)},n.softsign=function(e){return i.tidy((function(){return r.div(e,r.add(o.getScalar(1),r.abs(e)))}))},n.dropout=function(e,t,n,a){return i.tidy((function(){if(null!=n&&!i.util.arraysEqual(e.shape,n))throw new s.NotImplementedError("Non-default noise shape is not implemented yet: "+JSON.stringify(n));if(null!=a)throw new s.NotImplementedError("seed is not implemented for dropout yet.");var u=r.step(r.add(r.neg(t),r.randomUniform(e.shape,0,1,"float32")));return u=r.mul(r.div(o.getScalar(1),r.sub(o.getScalar(1),t)),u),r.mul(e,u)}))},n.hardSigmoid=function(e){return i.tidy((function(){var t=r.add(o.getScalar(.5),r.mul(o.getScalar(.2),e));return r.clipByValue(t,0,1)}))},n.inTrainPhase=function(e,t,n){return void 0===n&&(n=!1),n?e():t()}},{"../backend/state":197,"../common":201,"../errors":208,"../utils/math_utils":238,"./common":196,"@tensorflow/tfjs-core":66}],199:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("./backend/state"),l=e("./logs"),c=e("./utils/generic_utils"),p=function(){function e(){this.validationData=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.onEpochBegin=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.onBatchBegin=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.onBatchEnd=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.onTrainEnd=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},e.prototype.setModel=function(e){},e}();n.BaseCallback=p;var h=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setParams(e)}},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setModel(e)}},e.prototype.onEpochBegin=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchBegin=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchEnd=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainEnd=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e}();n.CallbackList=h;var f=function(){function e(e){this.yieldEvery=e,this.batchCount=0,this.batchDurationsMillis=[],this.autoYieldEveryBatches=null,this.batchStartMillis=s.util.now()}return e.prototype.resolveOneTensorInLogs=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o;return a(this,(function(a){switch(a.label){case 0:for(n in t=[],e)t.push(n);r=0,a.label=1;case 1:return r<t.length?(i=t[r],"number"==typeof(o=e[i])?[3,3]:[4,o.data()]):[3,4];case 2:return a.sent(),[3,4];case 3:return r++,[3,1];case 4:return[2]}}))}))},e.prototype.maybeYieldOnBatch=function(t){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return"auto"!==this.yieldEvery?[3,7]:(this.batchCount++,null!=this.autoYieldEveryBatches?[3,3]:[4,this.resolveOneTensorInLogs(t)]);case 1:return i.sent(),n=s.util.now(),[4,s.nextFrame()];case 2:return i.sent(),this.batchCount>e.SKIP_FIRST_BATCHES&&(this.batchDurationsMillis.push(n-this.batchStartMillis),this.batchDurationsMillis.length>=e.DECISION_BATCH_COUNT&&(r=this.batchDurationsMillis.reduce((function(e,t){return e+t}))/this.batchDurationsMillis.length,this.autoYieldEveryBatches=Math.round(e.THRESHOLD_MILLIS/r),this.autoYieldEveryBatches<1&&(this.autoYieldEveryBatches=1))),this.batchStartMillis=s.util.now(),this.lastYieldBatchCount=this.batchCount,[3,6];case 3:return this.batchCount-this.lastYieldBatchCount>=this.autoYieldEveryBatches?[4,s.nextFrame()]:[3,6];case 4:return i.sent(),[4,this.resolveOneTensorInLogs(t)];case 5:i.sent(),this.lastYieldBatchCount=this.batchCount,i.label=6;case 6:return[3,9];case 7:return"batch"!==this.yieldEvery?[3,9]:[4,s.nextFrame()];case 8:i.sent(),i.label=9;case 9:return[2]}}))}))},e.prototype.maybeYieldOnEpoch=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return"epoch"!==this.yieldEvery?[3,2]:[4,s.nextFrame()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.SKIP_FIRST_BATCHES=1,e.DECISION_BATCH_COUNT=2,e.THRESHOLD_MILLIS=16,e}();n.ModelTrainingYielder=f;var d=function(e){function t(t){var n=e.call(this)||this;return n.yieldEvery=t||"auto",n}return i(t,e),t.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.autoYielder=new f(this.yieldEvery),[2]}))}))},t.prototype.onEpochBegin=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.seen=0,this.totals={},[2]}))}))},t.prototype.onBatchEnd=function(e,t){return o(this,void 0,void 0,(function(){var e,n,r,i,o=this;return a(this,(function(a){switch(a.label){case 0:return[4,this.autoYielder.maybeYieldOnBatch(t)];case 1:for(i in a.sent(),null==t&&(t={}),e=null==t.size?0:t.size,this.seen+=e,n=function(n){var i=t[n];if("number"==typeof i)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+i*e;else{var a=void 0;n in r.totals?a=r.totals[n]:r.totals[n]=u.getScalar(0),r.totals[n]=s.tidy((function(){return s.add(o.totals[n],s.mul(i,u.getScalar(e)))})),null!=a&&a.dispose()}},r=this,t)n(i);return[2]}}))}))},t.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,(function(){var e,n,r,i,o,l=this;return a(this,(function(a){switch(a.label){case 0:return[4,this.autoYielder.maybeYieldOnEpoch()];case 1:if(a.sent(),null!=t)for(e=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?t[e]=n.totals[e]/n.seen:s.tidy((function(){t[e]=s.mul(s.div(u.getScalar(1),u.getScalar(l.seen)),l.totals[e]),l.totals[e].dispose(),s.keep(t[e])}))},n=this,r=0,i=this.params.metrics;r<i.length;r++)o=i[r],e(o);return[2]}}))}))},t}(p);n.BaseLogger=d;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.epoch=[],this.history={},[2]}))}))},t.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){for(n in null==t&&(t={}),this.epoch.push(e),t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n]);return[2]}))}))},t.prototype.syncData=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,u,l;return a(this,(function(a){switch(a.label){case 0:for(r in e=[],t=[],n=[],this.history)for(i=this.history[r],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],e.push(s.data()),t.push(r),n.push(o));return[4,Promise.all(e)];case 1:for(u=a.sent(),l=0;l<u.length;++l)this.history[t[l]][n[l]].dispose(),this.history[t[l]][n[l]]=u[l][0];return[2]}}))}))},t}(p);n.History=m;var y=function(e){function t(t){var n=e.call(this)||this;return n.trainBegin=t.onTrainBegin,n.trainEnd=t.onTrainEnd,n.epochBegin=t.onEpochBegin,n.epochEnd=t.onEpochEnd,n.batchBegin=t.onBatchBegin,n.batchEnd=t.onBatchEnd,n}return i(t,e),t.prototype.onEpochBegin=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null==this.epochBegin?[3,3]:[4,l.resolveScalarsInLogs(t)];case 1:return n.sent(),[4,this.epochBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null==this.epochEnd?[3,3]:[4,l.resolveScalarsInLogs(t)];case 1:return n.sent(),[4,this.epochEnd(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onBatchBegin=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,l.resolveScalarsInLogs(t)];case 1:return n.sent(),[4,this.batchBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onBatchEnd=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null==this.batchEnd?[3,3]:[4,l.resolveScalarsInLogs(t)];case 1:return n.sent(),[4,this.batchEnd(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return null==this.trainBegin?[3,3]:[4,l.resolveScalarsInLogs(e)];case 1:return t.sent(),[4,this.trainBegin(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.onTrainEnd=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return null==this.trainEnd?[3,3]:[4,l.resolveScalarsInLogs(e)];case 1:return t.sent(),[4,this.trainEnd(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t}(p);n.CustomCallback=y,n.standardizeCallbacks=function(e){return null==e?null:e instanceof p?[e]:Array.isArray(e)&&e[0]instanceof p?e:c.toList(e).map((function(e){return new y(e)}))}},{"./backend/state":197,"./logs":229,"./utils/generic_utils":236,"@tensorflow/tfjs-core":66}],200:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("./base_callbacks"),a=e("./engine/training"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.model=null,t}return i(t,e),t.prototype.setModel=function(e){if(!(e instanceof a.Model))throw new Error("model must be a Model, not some other Container");this.model=e},t}(o.BaseCallback);n.Callback=s},{"./base_callbacks":199,"./engine/training":207}],201:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./utils/generic_utils"),i=new Map;n.VALID_DATA_FORMAT_VALUES=["channelsFirst","channelsLast"],n.checkDataFormat=function(e){r.checkStringTypeUnionValue(n.VALID_DATA_FORMAT_VALUES,"DataFormat",e)},n.VALID_PADDING_MODE_VALUES=["valid","same","causal"],n.checkPaddingMode=function(e){r.checkStringTypeUnionValue(n.VALID_PADDING_MODE_VALUES,"PaddingMode",e)},n.VALID_POOL_MODE_VALUES=["max","avg"],n.checkPoolMode=function(e){r.checkStringTypeUnionValue(n.VALID_POOL_MODE_VALUES,"PoolMode",e)};var o=[],a="/";n.nameScope=function(e,t){o.push(e);try{var n=t();return o.pop(),n}catch(e){throw o.pop(),e}},n.getScopedTensorName=function(e){if(!u(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===o.length?"":o.join(a)+a)+e},n.getUniqueTensorName=function(e){if(!u(e))throw new Error("Not a valid tensor name: '"+e+"'");i.has(e)||i.set(e,0);var t=i.get(e);if(i.set(e,i.get(e)+1),t>0){var n=e+"_"+t;return i.set(n,1),n}return e};var s=new RegExp(/^[A-Za-z][A-Za-z0-9\._\/]*$/);function u(e){return!!e.match(s)}n.isValidTensorName=u},{"./utils/generic_utils":236}],202:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("./backend/common"),u=e("./backend/state"),l=e("./utils/generic_utils");function c(e,t){return a.tidy((function(){return o.sqrt(o.sum(o.mulStrict(e,e),t,!0))}))}var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getConfig=function(){return{}},t}(a.serialization.Serializable);n.Constraint=p;var h=function(e){function t(t){var n=e.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return i(t,e),t.prototype.apply=function(e){var t=this;return a.tidy((function(){var n=c(e,t.axis),r=o.clipByValue(n,0,t.maxValue);return o.mul(e,o.div(r,o.add(u.getScalar(s.epsilon()),n)))}))},t.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},t.className="MaxNorm",t}(p);n.MaxNorm=h,a.serialization.SerializationMap.register(h);var f=function(e){function t(t){var n=e.call(this)||this;return n.defaultAxis=0,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return i(t,e),t.prototype.apply=function(e){var t=this;return a.tidy((function(){return o.div(e,o.add(u.getScalar(s.epsilon()),c(e,t.axis)))}))},t.prototype.getConfig=function(){return{axis:this.axis}},t.className="UnitNorm",t}(p);n.UnitNorm=f,a.serialization.SerializationMap.register(f);var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.relu(e)},t.className="NonNeg",t}(p);n.NonNeg=d,a.serialization.SerializationMap.register(d);var m=function(e){function t(t){var n=e.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=t.minValue?t.minValue:n.defaultMinValue,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.rate=null!=t.rate?t.rate:n.defaultRate,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return i(t,e),t.prototype.apply=function(e){var t=this;return a.tidy((function(){var n=c(e,t.axis),r=o.add(o.mul(u.getScalar(t.rate),o.clipByValue(n,t.minValue,t.maxValue)),o.mul(u.getScalar(1-t.rate),n));return o.mul(e,o.div(r,o.add(u.getScalar(s.epsilon()),n)))}))},t.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},t.className="MinMaxNorm",t}(p);function y(e,t){return void 0===t&&(t={}),l.deserializeKerasObject(e,a.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}n.MinMaxNorm=m,a.serialization.SerializationMap.register(m),n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"},n.serializeConstraint=function(e){return l.serializeKerasObject(e)},n.deserializeConstraint=y,n.getConstraint=function(e){return null==e?null:"string"==typeof e?y({className:e in n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}}):e instanceof p?e:y(e)}},{"./backend/common":196,"./backend/state":197,"./utils/generic_utils":236,"@tensorflow/tfjs-core":66}],203:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/state"),s=e("../errors"),u=e("../layers/serialization"),l=e("../utils/generic_utils"),c=e("../utils/serialization_utils"),p=e("../utils/types_utils"),h=e("../variables"),f=e("../version"),d=e("./input_layer"),m=e("./topology");function y(e,t,n,r){if(!n.startsWith("2."))throw new s.ValueError("Unsupported Keras version in weights being loaded: "+n);return t}function g(e,t,n){void 0===n&&(n=!1);for(var r=e.keras_version,i=(e.backend,t.map((function(e){return e.name}))),a={},u=0,c=t;u<c.length;u++){null!=(A=c[u]).name&&(null==a[A.name]&&(a[A.name]=[]),a[A.name].push(A))}for(var p,f,d,m,g=e.weights,v=[],b=0;b<i.length;++b){var _=i[b],w=g[_];null==w&&(w=[]);for(var S=[],x=0;x<w.length;++x){var T=w[x];S.push(new h.LayerVariable((p=T.dtype,f=T.shape,d=T.value,m=void 0,m=l.stringToDType(p),o.Tensor.make(f,{values:0===f.length?d:o.util.flatten(d)},m))))}for(var P=0,N=a[_];P<N.length;P++){var A,k=(A=N[P]).weights;if((S=y(0,S,r)).length!==k.length){if(!n)throw new s.ValueError("Layer #"+b+' (named "'+A.name+'") expects '+k.length+" weight(s), but the saved weights have "+S.length+" element(s).");console.warn("Skipping loading of weights of layer "+A.name+" due to mismatch in number of weights: ("+S.length+" vs "+k.length+").")}for(var E=0;E<S.length;++E)!n||o.util.arraysEqual(k[E].shape,S[E].shape)?v.push([k[E],S[E].read()]):console.warn("Skipping loading of weights for layer "+A.name+" due to mismatch in shape ("+k[E].shape+" vs "+S[E].shape+")")}}h.batchSetValue(v)}function v(e,t,n){void 0===n&&(n=!0);for(var r={},i=0,o=0,a=t;o<a.length;o++)for(var u=0,l=a[o].weights;u<l.length;u++){var c=l[u];if(null!=r[c.originalName])throw new s.ValueError("Duplicate weight name: "+c.originalName);r[c.originalName]=c,i++}var p=[];for(var f in e){if(null!=r[f])p.push([r[f],e[f]]);else if(n)throw new s.ValueError("Provided weight data has no target variable: "+f);delete r[f]}if(n){var d=[];for(var m in r)d.push(m);if(d.length>0)throw new s.ValueError(d.length+" of "+i+" weights are not set: "+d)}h.batchSetValue(p)}n.loadWeightsFromJson=g,n.loadWeightsFromNamedTensorMap=v;var b=function(e){function t(n){var r=e.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=a.getUid(i)}if(r.supportsMasking=!1,r.trainable=!0,r.updatable=!0,Array.isArray(n.inputs)?r.inputs=n.inputs.slice():r.inputs=[n.inputs],Array.isArray(n.outputs)?r.outputs=n.outputs.slice():r.outputs=[n.outputs],l.unique(r.inputs).length!==r.inputs.length)throw new s.ValueError("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));l.unique(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[];for(var o=0,u=r.outputs;o<u.length;o++){var c=(I=u[o]).sourceLayer,p=I.nodeIndex,h=I.tensorIndex;r.outputLayers.push(c),r.outputLayersNodeIndices.push(p),r.outputLayersTensorIndices.push(h)}for(var f=0,y=r.inputs;f<y.length;f++){c=(I=y[f]).sourceLayer,p=I.nodeIndex,h=I.tensorIndex;l.assert(0===p,"input layer has >1 nodes"),l.assert(0===h,"input layer has >1 tensors"),r.inputLayers.push(c),r.inputLayersNodeIndices.push(p),r.inputLayersTensorIndices.push(h)}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){if(!((c=r.inputLayers[g])instanceof d.InputLayer))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+n.inputs+". Input "+g+" (0-based) originates from layer type "+c.getClassName()+".");r.inputNames.push(c.name),r.feedInputShapes.push(c.batchInputShape),r.feedInputNames.push(c.name)}for(var v=0,b=r.outputLayers;v<b.length;v++){c=b[v];r.outputNames.push(c.name)}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));for(var _={},w={},S={},x={},T={},P=[],N=function(e,n,i,o,a,u){null!=o&&null!=a&&null!=u||(o=e.sourceLayer,a=e.nodeIndex,u=e.tensorIndex);var l=o.inboundNodes[a];if(-1!==i.indexOf(l))throw new s.RuntimeError("The tensor "+e.name+' at layer "'+o.name+'" is part of a cycle.');if(-1===n.indexOf(l)){r.containerNodes.add(t.nodeKey(o,a)),o.id in T||(T[o.id]=Object.keys(T).length),-1===i.indexOf(l)&&i.push(l);for(var c=l.inboundLayers.length,p=0;p<c;p++){var h=l.inputTensors[p],f=l.inboundLayers[p],d=l.nodeIndices[p],m=l.tensorIndices[p];N(h,n,i,f,d,m)}for(n.push(l);i.indexOf(l)>=0;)i.splice(i.indexOf(l),1);P.push(l)}},A=[],k=[],E=0,O=r.outputs;E<O.length;E++){var I=O[E];N(I,A,k)}for(var M=0,C=P.slice().reverse();M<C.length;M++){w[(te=C[M]).id]=te,te.id in _||(_[te.id]=0);var R=_[te.id],z=null==S[te.outboundLayer.id]?0:S[te.outboundLayer.id];R=Math.max(R,z),S[te.outboundLayer.id]=R,x[te.outboundLayer.id]=te.outboundLayer,_[te.id]=R;for(g=0;g<te.inboundLayers.length;g++){var D=te.inboundLayers[g],L=(p=te.nodeIndices[g],D.inboundNodes[p]),F=null==_[L.id]?0:_[L.id];_[L.id]=Math.max(R+1,F),w[L.id]=L}}var V={};for(var q in _){(R=_[q])in V||(V[R]=[]),V[R].push(w[q])}var j={};for(var B in S){(R=S[B])in j||(j[R]=[]),j[R].push(x[B])}var U=Object.keys(j).map((function(e){return parseInt(e,10)})).sort(l.reverseNumberCompare);r.layers=[];for(var G=0,W=U;G<W.length;G++){var H=j[R=W[G]];H.sort((function(e,t){var n=T[e.id],r=T[t.id];return n<r?-1:n>r?1:0}));for(var Q=0,K=H;Q<K.length;Q++){c=K[Q];r.layers.push(c)}}r.layersByDepth=j,U=Object.keys(V).map((function(e){return parseInt(e,10)})).sort(l.reverseNumberCompare);for(var $=r.inputs.slice(),X=[],Y=0,J=U;Y<J.length;Y++)for(var Z=0,ee=V[R=J[Y]];Z<ee.length;Z++){var te;if(null!=(c=(te=ee[Z]).outboundLayer)){for(var ne=0,re=te.inputTensors;ne<re.length;ne++){I=re[ne];if(-1===$.indexOf(I))throw new s.RuntimeError("Graph disconnected: cannot obtain value for tensor "+I+' at layer "'+c.name+'". The following previous layers were accessed without issue: '+X)}for(var ie=0,oe=te.outputTensors;ie<oe.length;ie++){I=oe[ie];$.push(I)}X.push(c.name)}}r.nodesByDepth=V;for(var ae=r.layers.map((function(e){return e.name})),se=function(e){var t=ae.filter((function(t){return t===e})).length;if(1!==t)throw new s.RuntimeError('The name "'+e+'" is used '+t+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(ae))},ue=0,le=ae;ue<le.length;ue++){se(le[ue])}return r.outboundNodes=[],r.inboundNodes=[],new m.Node({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return i(t,e),t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount)for(var t=0,n=this.layers;t<n.length;t++){var r=n[t];e.numDisposedVariables+=r.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new s.ValueError("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e=e.concat(r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.layers;o<a.length;o++){r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.loadWeights=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),n?v(e,this.layers,r):g(e,this.layers,t)},t.prototype.updatedConfig=function(){var e=this.getConfig();return{className:this.getClassName(),config:e,kerasVersion:"tfjs-layers "+f.version,backend:"TensorFlow.js"}},t.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=c.convertTsToPythonic(this.updatedConfig());return t?JSON.stringify(n):n},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){var r;return e=l.toList(e),r="mask"in t?l.toList(t.mask):l.pyListRepeat(null,e.length),n.runInternalGraph(e,r)[0]}))},t.prototype.computeMask=function(e,t){var n=this;return o.tidy((function(){var r;return e=l.toList(e),r=null==t?l.pyListRepeat(null,e.length):l.toList(t),n.runInternalGraph(e,r)[1]}))},t.prototype.computeOutputShape=function(e){var t=p.normalizeShapeList(e);if(t.length!==this.inputLayers.length)throw new s.ValueError("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<t.length;r++){var i=this.inputLayers[r],o=t[r];n[A=i.name+"_0_0"]=o}var a=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(l.reverseNumberCompare);if(a.length>1)for(var u=0,c=a;u<c.length;u++)for(var h=c[u],f=0,d=this.nodesByDepth[h];f<d.length;f++){var m=d[f];i=m.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(i.id)){for(var y=[],g=0;g<m.inboundLayers.length;g++){var v=m.inboundLayers[g],b=m.nodeIndices[g],_=m.tensorIndices[g],w=n[A=v.name+"_"+b+"_"+_];y.push(w)}var S=i.computeOutputShape(l.singletonOrArray(y)),x=p.normalizeShapeList(S),T=i.inboundNodes.indexOf(m);for(g=0;g<x.length;g++){n[A=i.name+"_"+T+"_"+g]=x[g]}}}var P=[],N=[];for(r=0;r<this.outputLayers.length;r++){i=this.outputLayers[r],T=this.outputLayersNodeIndices[r],_=this.outputLayersTensorIndices[r];var A=i.name+"_"+T+"_"+_;N.push(A)}for(r=0;r<N.length;r++){var k=N[r];l.assert(k in n),P.push(n[k])}return l.singletonOrArray(P)},t.prototype.runInternalGraph=function(e,t){null==t&&(t=l.pyListRepeat(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],o=e[r],a=t[r];n[i.id]=[o,a]}for(var u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(l.reverseNumberCompare),c=0,p=u;c<p.length;c++)for(var h=p[c],f=0,d=this.nodesByDepth[h];f<d.length;f++){for(var m=d[f],y=m.outboundLayer,g=m.inputTensors,v=m.outputTensors,b=new Array,_=0,w=g;_<w.length;_++){(i=w[_]).id in n&&b.push(n[i.id])}if(b.length===g.length){var S={},x=void 0,T=void 0,P=void 0,N=void 0;if(null!=m.callArgs&&(S=m.callArgs),1===b.length){var A=b[0],k=A[0],E=A[1];null==S.mask&&(S.mask=E),P=l.toList(y.call(k,S)),N=l.toList(y.computeMask(k,E)),x=[k],T=[E]}else x=b.map((function(e){return e[0]})),T=b.map((function(e){return e[1]})),null==S.mask&&(S.mask=T),P=l.toList(y.call(x,S)),N=l.toList(y.computeMask(x,T));if(y.activityRegularizer)throw new s.NotImplementedError("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<v.length;++r){i=v[r],o=P[r],a=N[r];n[i.id]=[o,a]}}}for(var O=[],I=[],M=[],C=0,R=this.outputs;C<R.length;C++){i=R[C];l.assert(i.id in n,"Could not compute output "+i.name+" : "+i.id);var z=n[i.id],D=z[0];a=z[1];M.push(D.shape),O.push(D),I.push(a)}return[O,I,M]},t.prototype.buildNodeConversionMap=function(e){for(var n,r={},i=0,o=this.layers;i<o.length;i++){var a=o[i];n=a instanceof t?1:0;for(var s=0;s<a.inboundNodes.length;s++){var u=t.nodeKey(a,s);u in this.containerNodes&&(r[u]=n,n+=1)}}return r},t.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new s.ValueError("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new s.ValueError("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===e)return i}throw new s.ValueError("No such layer: "+e)},t.prototype.calculateLosses=function(){var e=this;return o.tidy((function(){for(var n=[],r=0,i=e.layers;r<i.length;r++)for(var o=i[r],a=0;a<o.inboundNodes.length;++a){var s=t.nodeKey(o,a);e.containerNodes.has(s)&&n.push.apply(n,o.calculateLosses())}return n}))},t.prototype.getConfig=function(){for(var e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,o=this.layers;i<o.length;i++){for(var a=(b=o[i]).getClassName(),s=b.getConfig(),u=[],l=0;l<b.inboundNodes.length;l++){var c=b.inboundNodes[l],p=t.nodeKey(b,l),h={};if(this.containerNodes.has(p)){if(c.callArgs)try{JSON.stringify(c.callArgs),h=c.callArgs}catch(e){console.warn("Layer "+b.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),h={}}if(c.inboundLayers.length>0){for(var f=[],d=0;d<c.inboundLayers.length;d++){var m=c.inboundLayers[d],y=c.nodeIndices[d],g=c.tensorIndices[d];null==(w=n[t.nodeKey(m,y)])&&(w=0),f.push([m.name,w,g,h])}u.push(f)}}}r.push({name:b.name,className:a,config:s,inboundNodes:u})}e.layers=r;var v=[];for(d=0;d<this.inputLayers.length;d++){var b=this.inputLayers[d];y=this.inputLayersNodeIndices[d],p=t.nodeKey(b,y);if(this.containerNodes.has(p)){null==(w=n[p])&&(w=0);g=this.inputLayersTensorIndices[d];v.push([b.name,w,g])}}e.inputLayers=v;var _=[];for(d=0;d<this.outputLayers.length;d++){b=this.outputLayers[d],y=this.outputLayersNodeIndices[d],p=t.nodeKey(b,y);if(this.containerNodes.has(p)){var w;null==(w=n[p])&&(w=0);g=this.outputLayersTensorIndices[d];_.push([b.name,w,g])}}return e.outputLayers=_,e},t.fromConfig=function(e,t){var n={},r={};function i(e,t){e.name in r?r[e.name].push(t):r[e.name]=[t]}function o(e,t){for(var r,o=[],a=0,u=t;a<u.length;a++){var c=u[a],p=c[0],h=c[1],f=c[2];if(3===c.length)r={};else{if(4!==c.length)throw new s.ValueError("Improperly formatted model config for layer "+JSON.stringify(e)+": "+JSON.stringify(c));r=c[3]}if(!(p in n))return void i(e,t);var d=n[p];if(d.inboundNodes.length<=h)return void i(e,t);var m=d.inboundNodes[h];o.push(m.outputTensors[f])}o.length>0&&e.apply(l.singletonOrArray(o),r)}function a(e){var r=e.name,o=u.deserialize(e,null!=t.customObjects?t.customObjects:{});n[r]=o;for(var a=0,l=e.inboundNodes;a<l.length;a++){var c=l[a];if(!(c instanceof Array))throw new s.ValueError("Corrupted configuration, expected array for nodeData: "+c);i(o,c)}}for(var c=t.name,p=t.layers,h=0,f=p;h<f.length;h++){a(y=f[h])}for(;!l.isObjectEmpty(r);)for(var d=0,m=p;d<m.length;d++){var y=m[d];if((E=n[y.name]).name in r){for(var g=0,v=r[E.name];g<v.length;g++){o(E,v[g])}delete r[E.name]}}for(var b=[],_=[],w=0,S=t.inputLayers;w<S.length;w++){var x=(y=S[w])[0],T=y[1],P=y[2];l.assert(x in n);var N=(E=n[x]).inboundNodes[T].outputTensors;b.push(N[P])}for(var A=0,k=t.outputLayers;A<k.length;A++){x=(y=k[A])[0],T=y[1],P=y[2];l.assert(x in n);var E;N=(E=n[x]).inboundNodes[T].outputTensors;_.push(N[P])}return new e({inputs:b,outputs:_,name:c})},Object.defineProperty(t.prototype,"stateful",{get:function(){if(this._stateful)throw new s.ValueError("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++){if(t[e].stateful)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){var e=this;o.tidy((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))},t}(m.Layer);n.Container=b},{"../backend/state":197,"../errors":208,"../layers/serialization":227,"../utils/generic_utils":236,"../utils/serialization_utils":239,"../utils/types_utils":240,"../variables":242,"../version":243,"./input_layer":205,"./topology":206,"@tensorflow/tfjs-core":66}],204:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("../errors"),o=e("./input_layer");var a=function(){function e(t){if(this.id2Value={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n];else{if(null==t)return;for(var r=0,i=t;r<i.length;r++){var o=i[r];this.add(o.key,o.value)}}}return e.prototype.add=function(e,t){if(null!=this.id2Value[e.id])throw new i.ValueError("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=function(e,t){if(null!=e.shape){if(e.shape.length!==t.shape.length)throw new i.ValueError("The rank of feed ("+t.shape.length+") does not match the rank of the key ("+e.shape.length+").");for(var n=0;n<e.shape.length;++n)if(null!=e.shape[n]&&e.shape[n]!==t.shape[n])throw new i.ValueError("The "+n+"-th dimension of the feed ("+t.shape[n]+") is incompatible with that of the key ("+e.shape[n]+").")}if(null==e.dtype||e.dtype===t.dtype)return t;try{return r.cast(t,e.dtype)}catch(n){throw new i.ValueError("The dtype of the feed ("+t.dtype+") can not be cast to the dtype of the key '"+e.name+"' ("+e.dtype+").")}}(e,t),this},e.prototype.addFeed=function(e){this.add(e.key,e.value)},e.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},e.prototype.getValue=function(e){if(null==this.id2Value[e.id])throw new i.ValueError("Nonexistent key: "+JSON.stringify(e));return this.id2Value[e.id]},e}();function s(e,t,n){if(t.hasKey(e))return t.getValue(e);if(e.sourceLayer instanceof o.InputLayer)throw new i.ValueError("Missing a feed value for SymbolicTensor from InputLayer '"+o.InputLayer.name+"'");for(var r=[],a=0,u=e.inputs;a<u.length;a++){var l=s(u[a],t,n);r.push(l)}var c=e.sourceLayer.apply(r,n);Array.isArray(c)||(c=[c]);for(var p=function(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r)for(var i=0,o=e.sourceLayer.inboundNodes[r].outputTensors;i<o.length;i++){if(o[i].id===e.id){n=r;break}}t=e.sourceLayer.getOutputAt(n)}return t}(e),h=Array.isArray(p)?p:[p],f=0;f<h.length;++f)t.add(h[f],c[f]);return 1===c.length?c[0]:c[e.outputTensorIndex]}n.FeedDict=a,n.execute=function(e,t,n){for(var r=Array.isArray(e),i=r?e:[e],o=[],u=new a(t),l=0,c=i;l<c.length;l++){var p=c[l];o.push(s(p,u,n))}return r?o:o[0]}},{"../errors":208,"./input_layer":205,"@tensorflow/tfjs-core":66}],205:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/state"),s=e("../errors"),u=e("./topology"),l=function(e){function t(t){var n=e.call(this,{dtype:t.dtype,name:null!=t.name?t.name:a.getUid("input").toString()})||this;if(null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new s.ValueError("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=t.batchInputShape;if(null==r){if(null==t.inputShape)throw new s.ValueError("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new s.ValueError("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var o=new u.SymbolicTensor(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new u.Node({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return i(t,e),t.prototype.apply=function(e,t){throw new s.ValueError("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(u.Layer);n.InputLayer=l,o.serialization.SerializationMap.register(l),n.Input=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new s.ValueError("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new l({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}},{"../backend/state":197,"../errors":208,"./topology":206,"@tensorflow/tfjs-core":66}],206:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/state"),s=e("../common"),u=e("../errors"),l=e("../utils/generic_utils"),c=e("../utils/types_utils"),p=e("../utils/variable_utils"),h=e("../variables"),f=function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}};n.InputSpec=f;var d=function(e,t,n,r,i,o,u){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=u,this.id=a.getNextUniqueTensorId(),null!=o&&(this.originalName=s.getScopedTensorName(o),this.name=s.getUniqueTensorName(this.originalName)),this.rank=t.length};n.SymbolicTensor=d;var m=0,y=function(){function e(e,t){this.callArgs=t,this.id=m++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,r=e.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var r=n[t];null!=r?e.push(r.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}();n.Node=y;var g=0,v=function(e){function t(t){var n=e.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=g++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=t.name;if(!r){var i=n.getClassName();r=l.toSnakeCase(i)+"_"+a.getUid(i)}if(n.name=r,n.trainable=null==t.trainable||t.trainable,n.updatable=null==t.updatable||t.updatable,null!=t.inputShape||null!=t.batchInputShape){var o=void 0;if(null!=t.batchInputShape)o=t.batchInputShape;else if(null!=t.inputShape){var s=null;null!=t.batchSize&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;null==u&&(u=t.inputDType),null==u&&(u="float32"),n.dtype=u}return null!=t.weights?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n}return i(t,e),t.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},t.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new u.RuntimeError("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new u.ValueError("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},t.prototype.getInputAt=function(e){return l.singletonOrArray(this.getNodeAtIndex(e,"input").inputTensors)},t.prototype.getOutputAt=function(e){return l.singletonOrArray(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(t.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new u.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new u.AttributeError("Layer "+this.name+" is not connected, no input to return.");return l.singletonOrArray(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new u.AttributeError("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new u.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return l.singletonOrArray(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),t.prototype.calculateLosses=function(){return this.losses.map((function(e){return e()}))},Object.defineProperty(t.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},t.prototype.assertInputCompatibility=function(e){if(e=l.toList(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=l.toList(this.inputSpec);if(e.length!==t.length)throw new u.ValueError("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(null!=i){var o=r.rank;if(null!=i.ndim&&o!==i.ndim)throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+o);if(null!=i.maxNDim&&o>i.maxNDim)throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+o);if(null!=i.minNDim&&o<i.minNDim)throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+o+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var a=r.shape;for(var s in i.axes){var c=Number(s),p=i.axes[s],h=c>=0?a[c]:a[a.length+c];if(null!=p&&-1===[p,null].indexOf(h))throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected axis "+c+" of input shape to have value "+p+" but got shape "+a+".")}}if(null!=i.shape)for(var f=0;f<i.shape.length;++f){var d=i.shape[f],m=r.shape[f];if(null!=d&&null!=m&&d!==m)throw new u.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape=${xShape}.")}}}}},t.prototype.call=function(e,t){return e},t.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},t.prototype.setCallHook=function(e){this._callHook=e},t.prototype.clearCallHook=function(){this._callHook=null},t.prototype.apply=function(e,t){var n=this;t=t||{},this.assertNotDisposed();for(var r=l.toList(e),i=!0,o=0,a=r;o<a.length;o++){if(!(a[o]instanceof d)){i=!1;break}}for(var c=!0,p=0,h=r;p<h.length;p++){if(h[p]instanceof d){c=!1;break}}if(i===c)throw new u.ValueError("Arguments to apply() must be all SymbolicTensors or all Tensors");return s.nameScope(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);for(var i=[],o=0,a=l.toList(e);o<a.length;o++){var s=a[o];i.push(s.shape)}n.build(l.singletonOrArray(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&c&&(n._refCount=1)}if(n.assertInputCompatibility(e),c){for(var p=n.call(e,t),h=[],f=0,m=l.toList(p);f<m.length;f++){var y=m[f];-1!==r.indexOf(y)&&(y=y.clone()),h.push(y)}if(p=l.singletonOrArray(h),null!=n.activityRegularizer)throw new u.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var g=function(e){e=l.toList(e);for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(i.shape)}return l.singletonOrArray(t)}(e),v=n.computeOutputShape(g),b=(p=void 0,"float32");if(n.warnOnIncompatibleInputShape(Array.isArray(e)?g[0]:g),p=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,i){return new d(b,r,n,l.toList(e),t,n.name,i)})):new d(b,v,n,l.toList(e),t,n.name),n.addInboundNode(e,p,null,null,g,v,t),n._refCount++,null!=n.activityRegularizer)throw new u.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))},t.prototype.warnOnIncompatibleInputShape=function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor ("+JSON.stringify(e)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(t.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new u.AttributeError("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],t=0,n=this.inboundNodes;t<n.length;t++){var r=n[t],i=JSON.stringify(r.outputShapes);-1===e.indexOf(i)&&e.push(i)}if(1===e.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new u.AttributeError("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),t.prototype.countParams=function(){if(!this.built)throw new u.RuntimeError("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return p.countParamsInWeights(this.weights)},t.prototype.build=function(e){this.built=!0},t.prototype.getWeights=function(e){return void 0===e&&(e=!1),h.batchGetValue(e?this.trainableWeights:this.weights)},t.prototype.setWeights=function(e){var t=this;o.tidy((function(){var n=t.weights;if(n.length!==e.length)throw new u.ValueError('You called setWeights(weights) on layer "'+t.name+'" with a weight list of length '+e.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+e+"...");if(0!==n.length){for(var r=[],i=h.batchGetValue(n),a=0;a<i.length;++a){var s=i[a],l=n[a],c=e[a];if(!o.util.arraysEqual(s.shape,c.shape))throw new u.ValueError("Layer weight shape "+s.shape+" not compatible with provided weight shape "+c.shape);r.push([l,c])}h.batchSetValue(r)}}))},t.prototype.addWeight=function(e,t,n,r,i,o,a){if(-1!==this._addedWeightNames.indexOf(e))throw new u.ValueError("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32");var s=new h.LayerVariable(r.apply(t,n),n,e,o,a);return null!=i&&this.addLoss((function(){return i.apply(s.read())})),null==o&&(o=!0),o?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},t.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=l.toList(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e))},t.prototype.computeOutputShape=function(e){return e},t.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")}))}return null}return t},t.prototype.addInboundNode=function(e,t,n,r,i,o,a){void 0===a&&(a=null);var s=l.toList(e);t=l.toList(t),n=l.toList(n),r=l.toList(r),i=c.normalizeShapeList(i),o=c.normalizeShapeList(o);for(var u=[],p=[],h=[],f=0,d=s;f<d.length;f++){var m=d[f];u.push(m.sourceLayer),p.push(m.nodeIndex),h.push(m.tensorIndex)}new y({outboundLayer:this,inboundLayers:u,nodeIndices:p,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:o},a);for(var g=0;g<t.length;g++)t[g].sourceLayer=this,t[g].nodeIndex=this.inboundNodes.length-1,t[g].tensorIndex=g},t.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},t.prototype.disposeWeights=function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length},t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},t}(o.serialization.Serializable);n.Layer=v,n.getSourceInputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var i=n.inboundNodes[r];if(0===i.inboundLayers.length)return i.inputTensors;for(var o=[],a=0;a<i.inboundLayers.length;a++)for(var s=0,u=e(i.inputTensors[a],i.inboundLayers[a],i.nodeIndices[a]);s<u.length;s++){var l=u[s];-1===o.indexOf(l)&&o.push(l)}return o}},{"../backend/state":197,"../common":201,"../errors":208,"../utils/generic_utils":236,"../utils/types_utils":240,"../utils/variable_utils":241,"../variables":242,"@tensorflow/tfjs-core":66}],207:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("@tensorflow/tfjs-core"),l=e("../backend/state"),c=e("../backend/tfjs_backend"),p=e("../base_callbacks"),h=e("../common"),f=e("../errors"),d=e("../logs"),m=e("../losses"),y=e("../metrics"),g=e("../optimizers"),v=e("../utils/generic_utils"),b=e("../utils/layer_utils"),_=e("../utils/math_utils"),w=e("./container"),S=e("./executor");function x(e){return e instanceof u.Tensor}function T(e){return Array.isArray(e)}function P(e){return!x(e)&&!T(e)}function N(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==t||0===t.length){if(null!=e){var o=!1;if(T(e)&&e.length>0)o=!0;else if(P(e)){for(var a in e)if(e.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new f.ValueError("Error when checking model "+i+" expected no data, but got "+e)}return[]}if(null==e)return t.map((function(e){return null}));var s;if(P(e)){s=[];for(var u=0,l=t;u<l.length;u++){var p=l[u];if(null==e[p])throw new f.ValueError('No data provided for "'+p+'". Need data for each key in: '+t);s.push(e[p])}}else if(T(e)){if(e.length!==t.length)throw new f.ValueError("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(t.length>1)throw new f.ValueError("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}for(var h=0;h<t.length;++h){1===(d=s[h]).shape.length&&(s[h]=c.expandDims(d,1))}if(null!=n)for(h=0;h<t.length;++h)if(null!=n[h]){var d;if((d=s[h]).shape.length!==n[h].length)throw new f.ValueError("Error when checking "+i+": expected "+t[h]+" to have "+n[h].length+" dimension(s). but got array with shape "+d.shape);for(var m=0;m<n[h].length;++m)if(0!==m||r){var y=d.shape[m],g=n[h][m];if(null!=g&&g>=0&&y!==g)throw new f.ValueError("Error when checking "+i+": expected "+t[h]+" to have shape ["+n[h]+"], but got array with shape ["+d.shape+"].")}}return s}function A(e,t,n){var r=v.unique(e.map((function(e){return e.shape[0]})));r.sort();var i=v.unique(t.map((function(e){return e.shape[0]})));if(i.sort(),r.length>1)throw new f.ValueError("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(i.length>1)throw new f.ValueError("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(r.length>0&&i.length>0&&!u.util.arraysEqual(r,i))throw new f.ValueError("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+i[0]+" target sample(s).")}function k(e,t){for(var n=[],r=0,i=null;r<e;)(i=r+t)>=e&&(i=e),n.push([r,i]),r=i;return n}function E(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return c.sliceAlongFirstAxis(e,t,n-t)})):c.sliceAlongFirstAxis(e,t,n-t)}function O(e,t){return s.tidy((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return O(e,t)})):c.gather(e,"int32"===t.dtype?t:t.toInt())}))}function I(e,t,n,r,i){var o;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(e)){if(e.length!==t.length)throw new f.ValueError("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");o=e}else{if(t.length>1)throw new f.ValueError("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");o=[e]}if(null!=n)for(var a=0;a<t.length;++a)if(null!=n[a]){var s=o[a];if(s.shape.length!==n[a].length)throw new f.ValueError("Error when checking "+i+": expected "+t[a]+" to have "+n[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=s.shape[u],c=n[a][u];if(null!=c&&c!==l)throw new f.ValueError("Error when checking "+i+": expected "+t[a]+" to have shape "+JSON.stringify(n[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}function M(e){s.util.assert(e>0&&Number.isInteger(e),"batchSize is required to be a positive integer, but got "+e)}n.isDataTensor=x,n.isDataArray=T,n.isDataDict=P,n.standardizeInputData=N,n.checkArrayLengths=A,n.makeBatches=k,n.sliceArraysByIndices=O,function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(n.ModelLoggingVerbosity||(n.ModelLoggingVerbosity={}));var C=function(e){function t(t){var n=e.call(this,t)||this;return n.isTraining=!1,n}return i(t,e),t.prototype.summary=function(e,t,n){if(void 0===n&&(n=console.log),!this.built)throw new f.ValueError("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");b.printSummary(this,e,t,n)},t.prototype.compile=function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer=g.getOptimizer(e.optimizer);else{if(!(e.optimizer instanceof u.Optimizer))throw new f.ValueError("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=e.optimizer}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new f.ValueError("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var r=e.loss;n=r.map((function(e){return m.get(e)}))}else{var i=m.get(e.loss);this.outputs.map((function(e){n.push(i)}))}else{for(var o in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(o))throw new f.ValueError('Unknown entry in loss dictionary: "'+o+'". Only expect the following keys: '+this.outputNames);for(var a in this.outputNames)null==e.loss[a]&&console.warn('Output "'+a+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+a+" during training"),n.push(m.get(e.loss[a]))}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var s=0;s<this.outputs.length;++s){var l=this.internalOutputShapes[s],c=this.outputNames[s];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[s])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],h.nameScope("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));if(Array.isArray(e))return t.map((function(t){return e}));if(null!=e){for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r],a=e.hasOwnProperty(o)?e[o]:[];Array.isArray(a)||(a=[a]),n.push(a)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+e)}(e.metrics,this.outputNames);h.nameScope("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){for(var r,i,o,a=function(n){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var a=t.internalOutputShapes[e];1===a[a.length-1]||t.lossFunctions[e]===m.binaryCrossentropy?-1!==["accuracy","acc"].indexOf(n)?i=y.binaryAccuracy:-1!==["crossentropy","ce"].indexOf(n)&&(i=y.binaryCrossentropy):t.lossFunctions[e]===m.sparseCategoricalCrossentropy?-1!==["accuracy","acc"].indexOf(n)?i=y.sparseCategoricalAccuracy:-1!==["crossentropy","ce"].indexOf(n)&&(i=y.sparseCategoricalCrossentropy):-1!==["accuracy","acc"].indexOf(n)?i=y.categoricalAccuracy:-1!==["crossentropy","ce"].indexOf(n)&&(i=y.categoricalCrossentropy);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),o=i,r=""+s}else{var u=y.get(n);o=u,r=""+n}var l;h.nameScope(r,(function(){l=o})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,l)},s=0,u=n;s<u.length;s++){a(u[s])}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights},t.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},t.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;M(r);var i=this.standardizeUserData(e,t,!0,r),o=i[0].concat(i[1]);this.makeTestFunction();var a=this.testFunction,s=this.testLoop(a,o,r,n.verbose,n.steps);return v.singletonOrArray(s)},t.prototype.checkNumSamples=function(e,t,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=t)throw new f.ValueError("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new f.ValueError("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i},t.prototype.execute=function(e,t){if(Array.isArray(t)&&0===t.length)throw new f.ValueError("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),o=new S.FeedDict;if(e instanceof u.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new f.ValueError("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var a=0;a<this.inputs.length;++a)o.add(this.inputs[a],e[a])}else for(var s=0,l=this.inputs;s<l.length;s++){var c=l[s],p=e[c.name];if(null==p)throw new f.ValueError("No value is provided for the model's input "+c.name);o.add(c,p)}var h=S.execute(i,o);return n?h:h[0]},t.prototype.retrieveSymbolicTensors=function(e){for(var t=v.pyListRepeat(null,e.length),n=e.length,r=0,i=this.layers;r<i.length;r++){for(var o=i[r],a=Array.isArray(o.output)?o.output:[o.output],s=a.map((function(e){return e.name})),u=0;u<e.length;++u){var l=s.indexOf(e[u]);if(-1!==l&&(t[u]=a[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw t.forEach((function(t,n){null==t&&c.push(e[n])})),new f.ValueError("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return t},t.prototype.predictLoop=function(e,t,n){var r=this;return void 0===t&&(t=32),void 0===n&&(n=!1),s.tidy((function(){var i=r.checkNumSamples(e);if(n)throw new f.NotImplementedError("Verbose predictLoop() is not implemented yet.");for(var o=k(i,t),a=[],u=function(t){var n=s.tidy((function(){var n=o[t][0],i=o[t][1],a=E(e,n,i),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:r.inputs[u],value:a[u]});else s.push({key:r.inputs[0],value:a});var l=new S.FeedDict(s);return S.execute(r.outputs,l)}));if(0===t)for(var i=0,u=n;i<u.length;i++){var l=u[i];a.push(l)}else for(var p=0;p<n.length;++p)a[p]=c.concatAlongFirstAxis(a[p],n[p])},l=0;l<o.length;++l)u(l);return v.singletonOrArray(a)}))},t.prototype.predict=function(e,t){void 0===t&&(t={}),I(e,this.inputNames,this.feedInputShapes,!1);var n=null==t.batchSize?32:t.batchSize;return M(n),this.predictLoop(e,n)},t.prototype.predictOnBatch=function(e){return I(e,this.inputNames,this.feedInputShapes,!0),this.predictLoop(e,e.shape[0])},t.prototype.standardizeUserData=function(e,t,n,r){if(void 0===n&&(n=!0),null==this.optimizer)throw new f.RuntimeError("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var i=[],o=0;o<this.feedOutputShapes.length;++o){var a=this.feedOutputShapes[o];this.feedLossFns[o]===m.sparseCategoricalCrossentropy?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(A(e=N(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=N(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){for(var r=[m.meanSquaredError,m.binaryCrossentropy,m.categoricalCrossentropy],i=0;i<e.length;++i){var o=e[i],a=t[i],s=n[i];if(null!=a){if(a===m.categoricalCrossentropy&&1===o.shape[o.shape.length-1])throw new f.ValueError("You are passing a target array of shape "+o.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(a))for(var u=o.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=u[c],h=l[c];if(null!=h&&p!==h)throw new f.ValueError("A target Tensor with shape "+o.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new f.ValueError("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+e[0].shape[0]+" sample(s).");return[e,t,null]},t.prototype.fitLoop=function(e,t,n,r,i,l,h,m,y,g,v,b,w,S,x){return o(this,void 0,void 0,(function(){var o,T,P,N,A,E,I,M,C=this;return a(this,(function(R){switch(R.label){case 0:if(null==r&&(r=32),null==i&&(i=1),null==g&&(g=!0),null==b&&(b=0),o=!1,null!=m&&null!=y&&(o=!0),null!=S&&(o=!0,null==w))throw new f.ValueError("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");if(null!=(T=this.checkNumSamples(t,r,w,"steps_per_epoch"))&&(P=_.range(0,T)),this.history=new p.History,N=new p.BaseLogger(x),h=(h=null==h?[N]:[N].concat(h)).concat([this.history]),l>0)throw new f.NotImplementedError("Verbose mode is not implemented yet.");return(A=new p.CallbackList(h)).setModel(this),A.setParams({epochs:i,initialEpoch:b,samples:T,steps:w,batchSize:r,verbose:l,doValidation:o,metrics:v}),[4,A.onTrainBegin()];case 1:R.sent(),this.stopTraining_=!1,E=function(i){var l,p,h,v,b;return a(this,(function(_){switch(_.label){case 0:return[4,A.onEpochBegin(i)];case 1:if(_.sent(),l={},null==w)return[3,2];throw new f.NotImplementedError("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===g)throw new f.NotImplementedError("batch shuffling is not implemneted yet");g&&u.util.shuffle(P),p=u.tensor1d(P),h=k(T,r),v=function(i){var u;return a(this,(function(a){switch(a.label){case 0:return u={},[4,A.onBatchBegin(i,u)];case 1:return a.sent(),s.tidy((function(){var a=h[i][0],f=h[i][1],d=c.sliceAlongFirstAxis(p,a,f-a);u.batch=i,u.size=f-a;for(var g=O(t,d),v=e(g),b=0;b<n.length;++b){var _=n[b],w=v[b];u[_]=w,s.keep(w)}if(i===h.length-1&&o){var S=C.testLoop(m,y,r);for(b=0;b<n.length;++b){_=n[b],w=S[b];s.keep(w),l["val_"+_]=w}}})),[4,A.onBatchEnd(i,u)];case 2:return a.sent(),d.disposeTensorsInLogs(u),I.stopTraining_?[2,"break"]:[2]}}))},b=0,_.label=3;case 3:return b<h.length?[5,v(b)]:[3,6];case 4:if("break"===_.sent())return[3,6];_.label=5;case 5:return++b,[3,3];case 6:p.dispose(),_.label=7;case 7:return[4,A.onEpochEnd(i,l)];case 8:return _.sent(),I.stopTraining_?[2,"break"]:[2]}}))},I=this,M=b,R.label=2;case 2:return M<i?[5,E(M)]:[3,5];case 3:if("break"===R.sent())return[3,5];R.label=4;case 4:return++M,[3,2];case 5:return[4,A.onTrainEnd()];case 6:return R.sent(),[4,this.history.syncData()];case 7:return R.sent(),[2,this.history]}}))}))},t.prototype.testLoop=function(e,t,n,r,i){var o=this;return void 0===r&&(r=0),s.tidy((function(){var a=o.checkNumSamples(t,n,i,"steps"),p=[];if(1===r)throw new f.NotImplementedError("Verbose mode is not implemented yet.");if(null!=i)throw new f.NotImplementedError("steps mode in testLoop() is not implemented yet");for(var h=k(a,n),d=u.tensor1d(_.range(0,a)),m=0;m<h.length;++m){var y=h[m][0],g=h[m][1],v=c.sliceAlongFirstAxis(d,y,g-y),b=O(t,v),w=e(b);if(0===m)for(var S=0;S<w.length;++S)p.push(l.getScalar(0));for(S=0;S<w.length;++S){var x=w[S];p[S]=s.add(p[S],s.mul(l.getScalar(g-y),x))}}for(S=0;S<p.length;++S)p[S]=s.div(p[S],l.getScalar(a));return p}))},t.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],i=r;if(v.count(e,r)>1)i+="_"+v.count(e.slice(0,n),r);t.push(i)}return t},t.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(t){return s.tidy((function(){for(var n,r=[],i=t.slice(0,e.inputs.length),o=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),a=[],u=0;u<e.inputs.length;++u)a.push({key:e.inputs[u],value:i[u]});var l=new S.FeedDict(a),c=S.execute(e.outputs,l);for(u=0;u<e.lossFunctions.length;++u){var p=e.lossFunctions[u],h=s.mean(p(o[u],c[u]));n=0===u?h:s.add(n,h),r.push(n)}for(u=0;u<e.metricsTensors.length;++u){var f=e.metricsTensors[u][0],d=e.metricsTensors[u][1],m=s.mean(f(o[d],c[d]));r.push(m)}return r}))}},t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){var r,i,o,u,l,c,h,d,m,y,g,v,b,_,w,x,T,P,N,A=this;return a(this,(function(a){switch(a.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,a.label=1;case 1:if(a.trys.push([1,,3,4]),M(r=null==n.batchSize?32:n.batchSize),i=this.standardizeUserData(e,t,!1,r),o=i[0],u=i[1],l=!1,c=void 0,h=void 0,d=void 0,m=!1,null!=n.validationData&&n.validationData.length>0){if(l=!0,2!==n.validationData.length)throw 3===n.validationData.length?new f.NotImplementedError("validationData including sample weights is not supported yet."):new f.ValueError("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+n.validationData+" is invalid.");c=n.validationData[0],h=n.validationData[1],y=this.standardizeUserData(c,h,!0,r),c=y[0],h=y[1],d=c.concat(h)}else null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1?(l=!0,g=Math.floor(o[0].shape[0]*(1-n.validationSplit)),v=o[0].shape[0],c=E(o,g,v),o=E(o,0,g),h=E(u,g,v),u=E(u,0,g),m=!0,d=c.concat(h)):null!=n.validationSteps&&(l=!0);return b=o.concat(u),this.checkTrainableWeightsConsistency(),_=function(e){var t=[],n=[],r=e.slice(0,A.inputs.length),i=e.slice(A.inputs.length,A.inputs.length+A.outputs.length),o=[],a=A.collectedTrainableWeights.map((function(e){return e.read()}));return[A.optimizer.minimize((function(){for(var e=[],a=0;a<A.inputs.length;++a)e.push({key:A.inputs[a],value:r[a]});var u,l=new S.FeedDict(e),c=S.execute(A.outputs,l,{training:!0});for(a=0;a<A.lossFunctions.length;++a){var p=(0,A.lossFunctions[a])(i[a],c[a]);t.push(p);var h=s.mean(p);n.push(h),u=0===a?p:s.add(u,p)}for(a=0;a<A.metricsTensors.length;++a){var f=A.metricsTensors[a][0],d=A.metricsTensors[a][1],m=s.mean(f(i[d],c[d]));s.keep(m),o.push(m)}return u=s.mean(u),A.calculateLosses().forEach((function(e){u=s.add(u,e)})),u}),!0,a)].concat(o)},w=this.getDedupedMetricsNames(),x=void 0,T=void 0,l?(this.makeTestFunction(),x=this.testFunction,T=w.slice().concat(w.map((function(e){return"val_"+e})))):(x=null,d=[],T=w.slice()),P=p.standardizeCallbacks(n.callbacks),[4,this.fitLoop(_,b,w,r,n.epochs,n.verbose,P,x,d,n.shuffle,T,n.initialEpoch,null,null,n.yieldEvery)];case 2:return N=a.sent(),m&&(d.forEach((function(e){return e.dispose()})),o.forEach((function(e){return e.dispose()})),u.forEach((function(e){return e.dispose()}))),this.isTraining=!1,[2,N];case 3:return this.isTraining=!1,[7];case 4:return[2]}}))}))},t.prototype.getNamedWeights=function(e){for(var t={},n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),o=0;o<r.length;++o)n&&!r[o].trainable||(t[r[o].originalName]=i[o]);return t},Object.defineProperty(t.prototype,"stopTraining",{set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),t.prototype.save=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:if("string"==typeof e){if(0===(n=u.io.getSaveHandlers(e)).length)throw new f.ValueError("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new f.ValueError("Found more than one ("+n.length+") save handlers for URL '"+e+"'");e=n[0]}if(null==e.save)throw new f.ValueError("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,u.io.encodeWeights(this.getNamedWeights(t))];case 1:return r=o.sent(),!1,null,i=this.toJSON(null,false),[2,e.save({modelTopology:i,weightData:r.data,weightSpecs:r.specs})]}}))}))},t.className="Model",t}(w.Container);n.Model=C,u.serialization.SerializationMap.register(C)},{"../backend/state":197,"../backend/tfjs_backend":198,"../base_callbacks":199,"../common":201,"../errors":208,"../logs":229,"../losses":230,"../metrics":231,"../optimizers":233,"../utils/generic_utils":236,"../utils/layer_utils":237,"../utils/math_utils":238,"./container":203,"./executor":204,"@tensorflow/tfjs-core":66}],208:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.AttributeError=o;var a=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.RuntimeError=a;var s=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.ValueError=s;var u=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.NotImplementedError=u;var l=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.AssertionError=l;var c=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error);n.IndexError=c},{}],209:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./engine/input_layer"),i=e("./engine/training"),o=e("./models");n.model=function(e){return new i.Model(e)},n.sequential=function(e){return new o.Sequential(e)},n.loadModel=function(e,t){return void 0===t&&(t=!0),o.loadModelInternal(e,t)},n.input=function(e){return r.Input(e)}},{"./engine/input_layer":205,"./engine/training":207,"./models":232}],210:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./constraints");n.maxNorm=function(e){return new r.MaxNorm(e)},n.unitNorm=function(e){return new r.UnitNorm(e)},n.nonNeg=function(){return new r.NonNeg},n.minMaxNorm=function(e){return new r.MinMaxNorm(e)}},{"./constraints":202}],211:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./initializers");n.zeros=function(){return new r.Zeros},n.ones=function(){return new r.Ones},n.constant=function(e){return new r.Constant(e)},n.randomUniform=function(e){return new r.RandomUniform(e)},n.randomNormal=function(e){return new r.RandomNormal(e)},n.truncatedNormal=function(e){return new r.TruncatedNormal(e)},n.identity=function(e){return new r.Identity(e)},n.varianceScaling=function(e){return new r.VarianceScaling(e)},n.glorotUniform=function(e){return new r.GlorotUniform(e)},n.glorotNormal=function(e){return new r.GlorotNormal(e)},n.heNormal=function(e){return new r.HeNormal(e)},n.leCunNormal=function(e){return new r.LeCunNormal(e)},n.orthogonal=function(e){return new r.Orthogonal(e)}},{"./initializers":216}],212:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./engine/input_layer"),i=e("./engine/topology");n.Layer=i.Layer;var o=e("./exports");n.input=o.input;var a=e("./layers/advanced_activations"),s=e("./layers/convolutional"),u=e("./layers/convolutional_depthwise"),l=e("./layers/core"),c=e("./layers/embeddings"),p=e("./layers/merge"),h=e("./layers/normalization"),f=e("./layers/padding"),d=e("./layers/pooling"),m=e("./layers/recurrent");n.RNN=m.RNN,n.RNNCell=m.RNNCell;var y=e("./layers/wrappers");function g(e){return new d.AveragePooling1D(e)}function v(e){return new d.AveragePooling2D(e)}function b(e){return new d.GlobalMaxPooling1D(e)}function _(e){return new d.GlobalMaxPooling2D(e)}function w(e){return new d.MaxPooling1D(e)}function S(e){return new d.MaxPooling2D(e)}n.inputLayer=function(e){return new r.InputLayer(e)},n.elu=function(e){return new a.ELU(e)},n.reLU=function(e){return new a.ReLU(e)},n.leakyReLU=function(e){return new a.LeakyReLU(e)},n.softmax=function(e){return new a.Softmax(e)},n.thresholdedReLU=function(e){return new a.ThresholdedReLU(e)},n.conv1d=function(e){return new s.Conv1D(e)},n.conv2d=function(e){return new s.Conv2D(e)},n.conv2dTranspose=function(e){return new s.Conv2DTranspose(e)},n.separableConv2d=function(e){return new s.SeparableConv2D(e)},n.cropping2D=function(e){return new s.Cropping2D(e)},n.upSampling2d=function(e){return new s.UpSampling2D(e)},n.depthwiseConv2d=function(e){return new u.DepthwiseConv2D(e)},n.activation=function(e){return new l.Activation(e)},n.dense=function(e){return new l.Dense(e)},n.dropout=function(e){return new l.Dropout(e)},n.flatten=function(e){return new l.Flatten(e)},n.repeatVector=function(e){return new l.RepeatVector(e)},n.reshape=function(e){return new l.Reshape(e)},n.permute=function(e){return new l.Permute(e)},n.embedding=function(e){return new c.Embedding(e)},n.add=function(e){return new p.Add(e)},n.average=function(e){return new p.Average(e)},n.concatenate=function(e){return new p.Concatenate(e)},n.maximum=function(e){return new p.Maximum(e)},n.minimum=function(e){return new p.Minimum(e)},n.multiply=function(e){return new p.Multiply(e)},n.batchNormalization=function(e){return new h.BatchNormalization(e)},n.zeroPadding2d=function(e){return new f.ZeroPadding2D(e)},n.averagePooling1d=g,n.avgPool1d=function(e){return g(e)},n.avgPooling1d=function(e){return g(e)},n.averagePooling2d=v,n.avgPool2d=function(e){return v(e)},n.avgPooling2d=function(e){return v(e)},n.globalAveragePooling1d=function(e){return new d.GlobalAveragePooling1D(e)},n.globalAveragePooling2d=function(e){return new d.GlobalAveragePooling2D(e)},n.globalMaxPooling1d=b,n.globalMaxPooling2d=_,n.maxPooling1d=w,n.maxPooling2d=S,n.gru=function(e){return new m.GRU(e)},n.gruCell=function(e){return new m.GRUCell(e)},n.lstm=function(e){return new m.LSTM(e)},n.lstmCell=function(e){return new m.LSTMCell(e)},n.simpleRNN=function(e){return new m.SimpleRNN(e)},n.simpleRNNCell=function(e){return new m.SimpleRNNCell(e)},n.rnn=function(e){return new m.RNN(e)},n.stackedRNNCells=function(e){return new m.StackedRNNCells(e)},n.bidirectional=function(e){return new y.Bidirectional(e)},n.timeDistributed=function(e){return new y.TimeDistributed(e)},n.globalMaxPool1d=b,n.globalMaxPool2d=_,n.maxPool1d=w,n.maxPool2d=S},{"./engine/input_layer":205,"./engine/topology":206,"./exports":209,"./layers/advanced_activations":217,"./layers/convolutional":218,"./layers/convolutional_depthwise":219,"./layers/core":220,"./layers/embeddings":221,"./layers/merge":222,"./layers/normalization":223,"./layers/padding":224,"./layers/pooling":225,"./layers/recurrent":226,"./layers/wrappers":228}],213:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./losses"),i=e("./metrics");n.binaryAccuracy=function(e,t){return i.binaryAccuracy(e,t)},n.binaryCrossentropy=function(e,t){return i.binaryCrossentropy(e,t)},n.categoricalAccuracy=function(e,t){return i.categoricalAccuracy(e,t)},n.categoricalCrossentropy=function(e,t){return i.categoricalCrossentropy(e,t)},n.cosineProximity=function(e,t){return r.cosineProximity(e,t)},n.meanAbsoluteError=function(e,t){return r.meanAbsoluteError(e,t)},n.meanAbsolutePercentageError=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.MAPE=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.mape=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.meanSquaredError=function(e,t){return r.meanSquaredError(e,t)},n.MSE=function(e,t){return r.meanSquaredError(e,t)},n.mse=function(e,t){return r.meanSquaredError(e,t)}},{"./losses":230,"./metrics":231}],214:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./regularizers"),i=e("./regularizers");n.l1l2=function(e){return new i.L1L2(e)},n.l1=function(e){return r.l1(e)},n.l2=function(e){return r.l2(e)}},{"./regularizers":234}],215:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./exports_constraints");n.constraints=r;var i=e("./exports_initializers");n.initializers=i;var o=e("./exports_layers");n.layers=o;var a=e("./exports_metrics");n.metrics=a;var s=e("./exports_regularizers");n.regularizers=s;var u=e("./base_callbacks");n.CallbackList=u.CallbackList,n.CustomCallback=u.CustomCallback,n.History=u.History;var l=e("./callbacks");n.Callback=l.Callback;var c=e("./engine/topology");n.SymbolicTensor=c.SymbolicTensor;var p=e("./engine/training");n.Model=p.Model;var h=e("./exports");n.input=h.input,n.loadModel=h.loadModel,n.model=h.model,n.sequential=h.sequential;var f=e("./layers/recurrent");n.RNN=f.RNN;var d=e("./models");n.Sequential=d.Sequential;var m=e("./variables");n.LayerVariable=m.LayerVariable;var y=e("./version");n.version_layers=y.version},{"./base_callbacks":199,"./callbacks":200,"./engine/topology":206,"./engine/training":207,"./exports":209,"./exports_constraints":210,"./exports_initializers":211,"./exports_layers":212,"./exports_metrics":213,"./exports_regularizers":214,"./layers/recurrent":226,"./models":232,"./variables":242,"./version":243}],216:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("./backend/state"),s=e("./backend/tfjs_backend"),u=e("./common"),l=e("./errors"),c=e("./utils/generic_utils"),p=e("./utils/math_utils");function h(e){c.checkStringTypeUnionValue(n.VALID_FAN_MODE_VALUES,"FanMode",e)}function f(e){c.checkStringTypeUnionValue(n.VALID_DISTRIBUTION_VALUES,"Distribution",e)}n.VALID_FAN_MODE_VALUES=["fanIn","fanOut","fanAvg"],n.checkFanMode=h,n.VALID_DISTRIBUTION_VALUES=["normal","uniform"],n.checkDistribution=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(o.serialization.Serializable);n.Initializer=d;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return o.zeros(e,t)},t.className="Zeros",t}(d);n.Zeros=m,o.serialization.SerializationMap.register(m);var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return o.ones(e,t)},t.className="Ones",t}(d);n.Ones=y,o.serialization.SerializationMap.register(y);var g=function(e){function t(t){var n=e.call(this)||this;if("object"!=typeof t)throw new l.ValueError("Expected argument of type ConstantConfig but got "+t);if(void 0===t.value)throw new l.ValueError("config must have value set but got "+t);return n.value=t.value,n}return i(t,e),t.prototype.apply=function(e,t){var n=this;return o.tidy((function(){return o.mul(o.scalar(n.value),o.ones(e,t))}))},t.prototype.getConfig=function(){return{value:this.value}},t.className="Constant",t}(d);n.Constant=g,o.serialization.SerializationMap.register(g);var v=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return i(t,e),t.prototype.apply=function(e,t){return o.randomUniform(e,this.minval,this.maxval,t)},t.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},t.className="RandomUniform",t}(d);n.RandomUniform=v,o.serialization.SerializationMap.register(v);var b=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return i(t,e),t.prototype.apply=function(e,t){if("bool"===t)throw new l.NotImplementedError("randomNormal does not support dType bool.");return s.randomNormal(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(d);n.RandomNormal=b,o.serialization.SerializationMap.register(b);var _=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return i(t,e),t.prototype.apply=function(e,t){if("bool"===t)throw new l.NotImplementedError("truncatedNormal does not support dType bool.");return o.truncatedNormal(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="TruncatedNormal",t}(d);n.TruncatedNormal=_,o.serialization.SerializationMap.register(_);var w=function(e){function t(t){var n=e.call(this)||this;return n.gain=null!=t.gain?o.scalar(t.gain):a.getScalar(1),n}return i(t,e),t.prototype.apply=function(e,t){var n=this;return o.tidy((function(){if(2!==e.length||e[0]!==e[1])throw new l.ValueError("Identity matrix initializer can only be used for 2D square matrices.");return o.mul(n.gain,o.eye(e[0]))}))},t.prototype.getConfig=function(){return{gain:this.gain.get()}},t.className="Identity",t}(d);n.Identity=w,o.serialization.SerializationMap.register(w);var S=function(e){function t(t){var n=e.call(this)||this;if(t.scale<0)throw new l.ValueError("scale must be a positive float. Got: "+t.scale);return n.scale=null==t.scale?1:t.scale,n.mode=t.mode,h(n.mode),n.distribution=t.distribution,f(n.distribution),n.seed=t.seed,n}return i(t,e),t.prototype.apply=function(e,t){var n=function(e,t){var n,r;if(void 0===t&&(t="channelsLast"),u.checkDataFormat(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var i=p.arrayProd(e,2);n=e[1]*i,r=e[0]*i}else"channelsLast"===t&&(i=p.arrayProd(e,0,e.length-2),n=e[e.length-2]*i,r=e[e.length-1]*i);else{var o=p.arrayProd(e);n=Math.sqrt(o),r=Math.sqrt(o)}return[n,r]}(e),r=n[0],i=n[1],a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,r):"fanOut"===this.mode?a/=Math.max(1,i):a/=Math.max(1,(r+i)/2),"normal"===this.distribution){var s=Math.sqrt(a);if("bool"===t)throw new l.NotImplementedError(this.getClassName()+" does not support dType bool.");return o.truncatedNormal(e,0,s,t,this.seed)}var c=Math.sqrt(3*a);return o.randomUniform(e,-c,c,t)},t.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},t.className="VarianceScaling",t}(d);n.VarianceScaling=S,o.serialization.SerializationMap.register(S);var x=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})||this}return i(t,e),t.prototype.getClassName=function(){return S.className},t}(S);n.GlorotUniform=x;var T=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})||this}return i(t,e),t.prototype.getClassName=function(){return S.className},t}(S);n.GlorotNormal=T;var P=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return i(t,e),t.prototype.getClassName=function(){return S.className},t}(S);n.HeNormal=P;var N=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return i(t,e),t.prototype.getClassName=function(){return S.className},t}(S);n.LeCunNormal=N;var A=function(e){function t(t){var n=e.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==t.gain?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,null!=n.seed)throw new l.NotImplementedError("Random seed is not implemented for Orthogonal Initializer yet.");return n}return i(t,e),t.prototype.apply=function(e,t){var n=this;return o.tidy((function(){if(2!==e.length)throw new l.NotImplementedError("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var t=e[0]>e[1]?[e[1],e[0]]:e,r=s.randomNormal(t,0,1,"float32"),i=o.linalg.gramSchmidt(r);return e[0]>e[1]&&(i=i.transpose()),o.mul(a.getScalar(n.gain),i)}))},t.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},t.className="Orthogonal",t}(d);function k(e,t){return void 0===t&&(t={}),c.deserializeKerasObject(e,o.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}n.Orthogonal=A,o.serialization.SerializationMap.register(A),n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"},n.serializeInitializer=function(e){return c.serializeKerasObject(e)},n.getInitializer=function(e){if("string"==typeof e){var t=e in n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e;return"GlorotUniform"===t?new x:"GlorotNormal"===t?new T:"HeNormal"===t?new P:"LeCunNormal"===t?new N:k({className:t,config:{}})}return e instanceof d?e:k(e)}},{"./backend/state":197,"./backend/tfjs_backend":198,"./common":201,"./errors":208,"./utils/generic_utils":236,"./utils/math_utils":238,"@tensorflow/tfjs-core":66}],217:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../activations"),s=e("../backend/tfjs_backend"),u=e("../engine/topology"),l=e("../backend/state"),c=e("../errors"),p=e("../utils/types_utils"),h=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,null!=t&&(n.maxValue=t.maxValue),n}return i(t,e),t.prototype.call=function(e,t){e=p.getExactlyOneTensor(e);var n=o.relu(e);return null!=this.maxValue&&(n=o.clipByValue(n,0,this.maxValue)),n},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ReLU",t}(u.Layer);n.ReLU=h,o.serialization.SerializationMap.register(h);var f=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_ALPHA=.3,null==t&&(t={}),n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return i(t,e),t.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return o.leakyRelu(n,this.alpha)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LeakyReLU",t}(u.Layer);n.LeakyReLU=f,o.serialization.SerializationMap.register(f);var d=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==n.DEFAULT_ALPHA)throw new c.NotImplementedError("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return i(t,e),t.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return o.elu(n)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ELU",t}(u.Layer);n.ELU=d,o.serialization.SerializationMap.register(d);var m=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_THETA=1,null==t&&(t={}),n.theta=null==t.theta?n.DEFAULT_THETA:t.theta,n.thetaTensor=l.getScalar(n.theta),n}return i(t,e),t.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return n.mul(s.cast(n.greater(this.thetaTensor),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={theta:this.theta},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ThresholdedReLU",t}(u.Layer);n.ThresholdedReLU=m,o.serialization.SerializationMap.register(m);var y=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_AXIS=1,null==t&&(t={}),n.softmax=(new a.Softmax).apply,n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n}return i(t,e),t.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return this.softmax(n,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Softmax",t}(u.Layer);n.Softmax=y,o.serialization.SerializationMap.register(y)},{"../activations":195,"../backend/state":197,"../backend/tfjs_backend":198,"../engine/topology":206,"../errors":208,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],218:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../activations"),u=e("../backend/common"),l=e("../backend/tfjs_backend"),c=e("../common"),p=e("../constraints"),h=e("../engine/topology"),f=e("../errors"),d=e("../initializers"),m=e("../regularizers"),y=e("../utils/conv_utils"),g=e("../utils/generic_utils"),v=e("../utils/types_utils");function b(e,t){return a.tidy((function(){return c.checkDataFormat(t),"channelsFirst"===t?o.transpose(e,[0,2,3,1]):e}))}function _(e,t,n,r,i,s,p){return void 0===r&&(r=1),void 0===i&&(i="valid"),void 0===p&&(p=1),a.tidy((function(){if(null==s&&(s=u.imageDataFormat()),c.checkDataFormat(s),3!==e.shape.length)throw new f.ValueError("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new f.ValueError("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new f.ValueError("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===s&&(e=o.transpose(e,[0,2,1])),"causal"===i)throw new f.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var a=o.conv1d(e,t,r,"same"===i?"same":"valid","NWC",p);return null!=n&&(a=l.biasAdd(a,n)),a}))}function w(e,t,n,r,i,s,p){return void 0===r&&(r=[1,1]),void 0===i&&(i="valid"),a.tidy((function(){if(null==s&&(s=u.imageDataFormat()),c.checkDataFormat(s),3!==e.rank&&4!==e.rank)throw new f.ValueError("conv2dWithBias expects input to be of rank 3 or 4, but received "+e.rank+".");if(3!==t.rank&&4!==t.rank)throw new f.ValueError("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+e.rank+".");var a=b(e,s);if("causal"===i)throw new f.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return a=o.conv2d(a,t,r,"same"===i?"same":"valid","NHWC",p),null!=n&&(a=l.biasAdd(a,n)),"channelsFirst"===s&&(a=o.transpose(a,[0,3,1,2])),a}))}n.preprocessConv2DInput=b,n.conv1dWithBias=_,n.conv1d=function(e,t,n,r,i,o){return void 0===n&&(n=1),void 0===r&&(r="valid"),void 0===o&&(o=1),a.tidy((function(){return c.checkDataFormat(i),_(e,t,null,n,r,i,o)}))},n.conv2d=function(e,t,n,r,i,o){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),a.tidy((function(){return c.checkDataFormat(i),w(e,t,null,n,r,i,o)}))},n.conv2dWithBias=w;var S=function(e){function t(n,r){var i=e.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyConfig(r),i.rank=n,1!==i.rank&&2!==i.rank)throw new f.NotImplementedError("Convolution layer for rank other than 1 or 2 ("+i.rank+") is not implemented yet.");if(i.kernelSize=y.normalizeArray(r.kernelSize,n,"kernelSize"),i.strides=y.normalizeArray(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,c.checkPaddingMode(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,c.checkDataFormat(i.dataFormat),i.activation=s.getActivation(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=d.getInitializer(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=p.getConstraint(r.biasConstraint),i.biasRegularizer=m.getRegularizer(r.biasRegularizer),i.activityRegularizer=m.getRegularizer(r.activityRegularizer),i.dilationRate=y.normalizeArray(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new f.ValueError("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new f.ValueError("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate));return i}return i(t,e),t.verifyConfig=function(e){if(g.assert("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!g.checkArrayTypeAndLength(e.kernelSize,"number",1,2))throw new f.ValueError("BaseConv expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:s.serializeActivation(this.activation),useBias:this.useBias,biasInitializer:d.serializeInitializer(this.biasInitializer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),biasConstraint:p.serializeConstraint(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(h.Layer);n.BaseConv=S;var x=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.kernel=null,t.verifyConfig(r),i.filters=r.filters,i.kernelInitializer=d.getInitializer(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=p.getConstraint(r.kernelConstraint),i.kernelRegularizer=m.getRegularizer(r.kernelRegularizer),i}return i(t,e),t.prototype.build=function(e){e=v.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new f.ValueError("The channel dimension of the input should be defined. Found "+e[t]);var n,r=e[t],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[t]=r,n)}],this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var t;e=v.getExactlyOneTensor(e);var r=null==n.bias?null:n.bias.read();if(1===n.rank)t=_(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=w(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else if(3===n.rank)throw new f.NotImplementedError("3D convolution is not implemented yet.");return null!=n.activation&&(t=n.activation.apply(t)),t}))},t.prototype.computeOutputShape=function(e){e=v.getExactlyOneShape(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var i=y.convOutputLength(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(i)}var o=[e[0]];return"channelsLast"===this.dataFormat?(o=o.concat(t)).push(this.filters):(o.push(this.filters),o=o.concat(t)),o},t.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:d.serializeInitializer(this.kernelInitializer),kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),kernelConstraint:p.serializeConstraint(this.kernelConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.verifyConfig=function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new f.ValueError("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},t}(S);n.Conv=x;var T=function(e){function t(n){var r=e.call(this,2,n)||this;return t.verifyConfig(n),r}return i(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyConfig=function(e){if("number"!=typeof e.kernelSize&&!g.checkArrayTypeAndLength(e.kernelSize,"number",1,2))throw new f.ValueError("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv2D",t}(x);n.Conv2D=T,a.serialization.SerializationMap.register(T);var P=function(e){function t(t){var n=e.call(this,t)||this;if(n.inputSpec=[new h.InputSpec({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new f.ValueError("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return i(t,e),t.prototype.build=function(e){if(4!==(e=v.getExactlyOneShape(e)).length)throw new f.ValueError("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new f.ValueError("The channel dimension of the inputs should be defined. Found `None`.");var n,r=e[t],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new h.InputSpec({ndim:4,axes:(n={},n[t]=r,n)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){var t=v.getExactlyOneTensor(e);if(4!==t.shape.length)throw new f.ValueError("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var r,i,a=t.shape,s=a[0];"channelsFirst"===n.dataFormat?(r=2,i=3):(r=1,i=2);var u=a[r],c=a[i],p=n.kernelSize[0],h=n.kernelSize[1],d=n.strides[0],m=n.strides[1],g=[s,y.deconvLength(u,d,p,n.padding),y.deconvLength(c,m,h,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=o.transpose(t,[0,2,3,1]));var b=o.conv2dTranspose(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(b=o.transpose(b,[0,3,1,2])),null!=n.bias&&(b=l.biasAdd(b,n.bias.read(),n.dataFormat)),null!=n.activation&&(b=n.activation.apply(b)),b}))},t.prototype.computeOutputShape=function(e){var t,n,r,i=(e=v.getExactlyOneShape(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var o=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[t]=this.filters,i[n]=y.deconvLength(i[n],s,o,this.padding),i[r]=y.deconvLength(i[r],u,a,this.padding),i},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.dilationRate,t},t.className="Conv2DTranspose",t}(T);n.Conv2DTranspose=P,a.serialization.SerializationMap.register(P);var N=function(e){function t(t,n){var r=e.call(this,t,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new f.ValueError("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new f.ValueError("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new f.ValueError("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=d.getInitializer(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=m.getRegularizer(n.depthwiseRegularizer),r.depthwiseConstraint=p.getConstraint(n.depthwiseConstraint),r.pointwiseInitializer=d.getInitializer(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=m.getRegularizer(n.pointwiseRegularizer),r.pointwiseConstraint=p.getConstraint(n.pointwiseConstraint),r}return i(t,e),t.prototype.build=function(e){if((e=v.getExactlyOneShape(e)).length<this.rank+2)throw new f.ValueError("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new f.ValueError("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);var a,s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new h.InputSpec({ndim:this.rank+2,axes:(a={},a[t]=n,a)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var t;if(e=v.getExactlyOneTensor(e),1===n.rank)throw new f.NotImplementedError("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=o.transpose(e,[0,2,3,1])),t=o.separableConv2d(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=l.biasAdd(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=o.transpose(t,[0,3,1,2])),t}))},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=d.serializeInitializer(this.depthwiseInitializer),t.pointwiseInitializer=d.serializeInitializer(this.pointwiseInitializer),t.depthwiseRegularizer=m.serializeRegularizer(this.depthwiseRegularizer),t.pointwiseRegularizer=m.serializeRegularizer(this.pointwiseRegularizer),t.depthwiseConstraint=p.serializeConstraint(this.depthwiseConstraint),t.pointwiseConstraint=p.serializeConstraint(this.pointwiseConstraint),t},t.className="SeparableConv",t}(x);n.SeparableConv=N;var A=function(e){function t(t){return e.call(this,2,t)||this}return i(t,e),t.className="SeparableConv2D",t}(N);n.SeparableConv2D=A,a.serialization.SerializationMap.register(A);var k=function(e){function t(n){var r=e.call(this,1,n)||this;return t.verifyConfig(n),r.inputSpec=[{ndim:3}],r}return i(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},t.verifyConfig=function(e){if("number"!=typeof e.kernelSize&&!g.checkArrayTypeAndLength(e.kernelSize,"number",1,1))throw new f.ValueError("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv1D",t}(x);n.Conv1D=k,a.serialization.SerializationMap.register(k);var E=function(e){function t(t){var n=e.call(this,t)||this;return"number"==typeof t.cropping?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return i(t,e),t.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){if(e=v.getExactlyOneTensor(e),"channelsLast"===n.dataFormat){var t=l.sliceAlongAxis(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return l.sliceAlongAxis(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}t=l.sliceAlongAxis(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return l.sliceAlongAxis(t,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))},t.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Cropping2D",t}(h.Layer);n.Cropping2D=E,a.serialization.SerializationMap.register(E);var O=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==t.size?n.DEFAULT_SIZE:t.size,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,n}return i(t,e),t.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){var t=v.getExactlyOneTensor(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=o.transpose(t,[0,2,3,1]);var i=n.size[0]*r[2],a=n.size[1]*r[3],s=t.resizeNearestNeighbor([i,a]);return o.transpose(s,[0,3,1,2])}i=n.size[0]*r[1],a=n.size[1]*r[2];return t.resizeNearestNeighbor([i,a])}))},t.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="UpSampling2D",t}(h.Layer);n.UpSampling2D=O,a.serialization.SerializationMap.register(O)},{"../activations":195,"../backend/common":196,"../backend/tfjs_backend":198,"../common":201,"../constraints":202,"../engine/topology":206,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/conv_utils":235,"../utils/generic_utils":236,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],219:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/common"),u=e("../backend/tfjs_backend"),l=e("../common"),c=e("../constraints"),p=e("../errors"),h=e("../initializers"),f=e("../regularizers"),d=e("../utils/conv_utils"),m=e("../utils/types_utils"),y=e("./convolutional");function g(e,t,n,r,i,u){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),a.tidy((function(){null==i&&(i=s.imageDataFormat()),l.checkDataFormat(i);var a=y.preprocessConv2DInput(e,i);if(4!==e.rank)throw new p.ValueError("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new p.ValueError("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return a=o.depthwiseConv2d(a,t,n,"same"===r?"same":"valid","NHWC",u),"channelsFirst"===i&&(a=o.transpose(a,[0,3,1,2])),a}))}n.depthwiseConv2d=g;var v=function(e){function t(t){var n=e.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=h.getInitializer(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=c.getConstraint(t.depthwiseConstraint),n.depthwiseRegularizer=f.getRegularizer(t.depthwiseRegularizer),n}return i(t,e),t.prototype.build=function(e){if((e=m.getExactlyOneShape(e)).length<4)throw new p.ValueError("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new p.ValueError("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var t=g(e=m.getExactlyOneTensor(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=u.biasAdd(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))},t.prototype.computeOutputShape=function(e){e=m.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=d.convOutputLength(t,this.kernelSize[0],this.padding,this.strides[0]),o=d.convOutputLength(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,o]:[e[0],i,o,r]},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=h.serializeInitializer(this.depthwiseInitializer),t.depthwiseRegularizer=f.serializeRegularizer(this.depthwiseRegularizer),t.depthwiseConstraint=c.serializeConstraint(this.depthwiseRegularizer),t},t.className="DepthwiseConv2D",t}(y.BaseConv);n.DepthwiseConv2D=v,a.serialization.SerializationMap.register(v)},{"../backend/common":196,"../backend/tfjs_backend":198,"../common":201,"../constraints":202,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/conv_utils":235,"../utils/types_utils":240,"./convolutional":218,"@tensorflow/tfjs-core":66}],220:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../activations"),s=e("../backend/state"),u=e("../backend/tfjs_backend"),l=e("../constraints"),c=e("../engine/topology"),p=e("../errors"),h=e("../initializers"),f=e("../regularizers"),d=e("../utils/math_utils"),m=e("../utils/types_utils"),y=function(e){function t(t){var n=e.call(this,t)||this;if(n.rate=Math.max(Math.min(t.rate,1),0),n.rateScalar=s.getScalar(n.rate),n.noiseShape=t.noiseShape,n.seed=t.seed,null!=n.seed)throw new p.NotImplementedError("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return i(t,e),t.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){n.invokeCallHook(e,t);var r=m.getExactlyOneTensor(e);if(null!=n.noiseShape&&!o.util.arraysEqual(r.shape,n.noiseShape))throw new p.NotImplementedError("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(n.noiseShape));if(0<n.rate&&n.rate<1){var i=null!=t.training&&t.training,a=n.getNoiseShape(r);return u.inTrainPhase((function(){return u.dropout(r,n.rateScalar,a,n.seed)}),(function(){return r}),i)}return e}))},t.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dropout",t}(c.Layer);n.Dropout=y,o.serialization.SerializationMap.register(y);var g=function(e){function t(t){var n=e.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){var r=null;null!=t.batchSize&&(r=t.batchSize),n.batchInputShape=[r,t.inputDim]}return n.units=t.units,n.activation=a.getActivation(t.activation),null!=t.useBias&&(n.useBias=t.useBias),n.kernelInitializer=h.getInitializer(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=h.getInitializer(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=l.getConstraint(t.kernelConstraint),n.biasConstraint=l.getConstraint(t.biasConstraint),n.kernelRegularizer=f.getRegularizer(t.kernelRegularizer),n.biasRegularizer=f.getRegularizer(t.biasRegularizer),n.activityRegularizer=f.getRegularizer(t.activityRegularizer),n.inputSpec=[{minNDim:2}],n}return i(t,e),t.prototype.build=function(e){var t,n=(e=m.getExactlyOneShape(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},t.prototype.computeOutputShape=function(e){var t=(e=m.getExactlyOneShape(e)).slice();return t[t.length-1]=this.units,t},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){n.invokeCallHook(e,t);var r=m.getExactlyOneTensor(e),i=u.dot(r,n.kernel.read());return null!=n.bias&&(i=u.biasAdd(i,n.bias.read())),null!=n.activation&&(i=n.activation.apply(i)),i}))},t.prototype.getConfig=function(){var t={units:this.units,activation:a.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:h.serializeInitializer(this.kernelInitializer),biasInitializer:h.serializeInitializer(this.biasInitializer),kernelRegularizer:f.serializeRegularizer(this.kernelRegularizer),biasRegularizer:f.serializeRegularizer(this.biasRegularizer),activityRegularizer:f.serializeRegularizer(this.activityRegularizer),kernelConstraint:l.serializeConstraint(this.kernelConstraint),biasConstraint:l.serializeConstraint(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dense",t}(c.Layer);n.Dense=g,o.serialization.SerializationMap.register(g);var v=function(e){function t(t){var n=e.call(this,t||{})||this;return n.inputSpec=[{minNDim:3}],n}return i(t,e),t.prototype.computeOutputShape=function(e){for(var t=0,n=(e=m.getExactlyOneShape(e)).slice(1);t<n.length;t++){if(null==n[t])throw new p.ValueError('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.')}return[e[0],d.arrayProd(e,1)]},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){return n.invokeCallHook(e,t),u.batchFlatten(m.getExactlyOneTensor(e))}))},t.className="Flatten",t}(c.Layer);n.Flatten=v,o.serialization.SerializationMap.register(v);var b=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.activation=a.getActivation(t.activation),n}return i(t,e),t.prototype.call=function(e,t){var n=this;return o.tidy((function(){n.invokeCallHook(e,t);var r=m.getExactlyOneTensor(e);return n.activation.apply(r)}))},t.prototype.getConfig=function(){var t={activation:a.serializeActivation(this.activation)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Activation",t}(c.Layer);n.Activation=b,o.serialization.SerializationMap.register(b);var _=function(e){function t(t){var n=e.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return i(t,e),t.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){return e=m.getExactlyOneTensor(e),u.repeat(e,n.n)}))},t.prototype.getConfig=function(){var t={n:this.n},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="RepeatVector",t}(c.Layer);n.RepeatVector=_,o.serialization.SerializationMap.register(_);var w=function(e){function t(t){var n=e.call(this,t)||this;n.targetShape=t.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return i(t,e),t.prototype.isUnknown=function(e){return e<0||null==e},t.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),i=1,o=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==o)throw new p.ValueError("Can only specifiy one unknown dimension.");o=a}else i*=s}var u=d.arrayProd(e);if(null!==o){if(0===i||u%i!=0)throw new p.ValueError(n);r[o]=u/i}else if(u!==i)throw new p.ValueError(n);return r},t.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){n.invokeCallHook(e,t);var r=m.getExactlyOneTensor(e),i=r.shape,o=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(o)}))},t.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Reshape",t}(c.Layer);n.Reshape=w,o.serialization.SerializationMap.register(w);var S=function(e){function t(t){var n=e.call(this,t)||this;if(null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");var r=d.range(1,t.dims.length+1);if(!o.util.arraysEqual(t.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new c.InputSpec({ndim:n.dims.length+1})],n}return i(t,e),t.prototype.computeOutputShape=function(e){var t=(e=m.getExactlyOneShape(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t},t.prototype.call=function(e,t){return o.transpose(m.getExactlyOneTensor(e),this.dimsIncludingBatch)},t.prototype.getConfig=function(){var t={dims:this.dims},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Permute",t}(c.Layer);n.Permute=S,o.serialization.SerializationMap.register(S)},{"../activations":195,"../backend/state":197,"../backend/tfjs_backend":198,"../constraints":202,"../engine/topology":206,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/math_utils":238,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],221:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/tfjs_backend"),s=e("../constraints"),u=e("../engine/topology"),l=e("../errors"),c=e("../initializers"),p=e("../regularizers"),h=e("../utils/generic_utils"),f=e("../utils/types_utils"),d=function(e){function t(t){var n=e.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){var r=null;null!=t.batchSize&&(r=t.batchSize),null==t.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(h.toList(t.inputLength))}return n.inputDim=t.inputDim,n.outputDim=t.outputDim,n.embeddingsInitializer=c.getInitializer(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=p.getRegularizer(t.embeddingsRegularizer),n.activityRegularizer=p.getRegularizer(t.activityRegularizer),n.embeddingsConstraint=s.getConstraint(t.embeddingsConstraint),n.maskZero=t.maskZero,n.inputLength=t.inputLength,n}return i(t,e),t.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},t.prototype.warnOnIncompatibleInputShape=function(e){},t.prototype.computeMask=function(e,t){throw new l.NotImplementedError("computeMask has not been implemented for Embedding yet")},t.prototype.computeOutputShape=function(e){if(e=f.getExactlyOneShape(e),null==this.inputLength)return e.concat([this.outputDim]);var t=h.toList(this.inputLength);if(t.length!==e.length-1)throw new l.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,r=0;r<t.length;++r){var i=t[r],o=e[r+1];if(null!=i&&null!=o&&i!==o)throw new l.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==i&&(t[n]=o),n++}return[e[0]].concat(t,[this.outputDim])},t.prototype.call=function(e,t){var n=this;return o.tidy((function(){n.invokeCallHook(e,t);var r=f.getExactlyOneTensor(e);return"int32"!==r.dtype&&(r=a.cast(r,"int32")),a.gather(n.embeddings.read(),r.as1D()).reshape(f.getExactlyOneShape(n.computeOutputShape(r.shape)))}))},t.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:c.serializeInitializer(this.embeddingsInitializer),embeddingsRegularizer:p.serializeRegularizer(this.embeddingsRegularizer),activityRegularizer:p.serializeRegularizer(this.activityRegularizer),embeddingsConstraint:s.serializeConstraint(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Embedding",t}(u.Layer);n.Embedding=d,o.serialization.SerializationMap.register(d)},{"../backend/tfjs_backend":198,"../constraints":202,"../engine/topology":206,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/generic_utils":236,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],222:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/state"),u=e("../backend/tfjs_backend"),l=e("../engine/topology"),c=e("../errors"),p=e("../utils/generic_utils"),h=e("../utils/math_utils"),f=e("../utils/types_utils"),d=function(e){function t(t){var n=e.call(this,t||{})||this;return n.supportsMasking=!0,n}return i(t,e),t.prototype.mergeFunction=function(e){throw new c.NotImplementedError},t.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var i=e[e.length-t.length+r],o=t[r];if(null==i||null==o||i<0||o<0)n.push(null);else if(1===i)n.push(o);else if(1===o)n.push(i);else{if(i!==o)throw new c.ValueError("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n},t.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[f.getExactlyOneShape(e)]),e.length<2)throw new c.ValueError("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,r=e;n<r.length;n++){null!=(a=r[n])&&null!==a[0]&&t.push(a[0])}if((t=p.unique(t)).length>1)throw new c.ValueError("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var a=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,a)}var s=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===p.unique(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){for(var i=h.max(r),a=0,s=e;a<s.length;a++){for(var l=(m=s[a]).rank,c=0;c<i-l;++c)m=u.expandDims(m,1);t.push(m)}return n.mergeFunction(t)}for(var p=!1,f=0,d=e;f<d.length;f++){var m;if(null==(l=(m=d[f]).rank)){var y=m.shape,g=y[0],v=y.slice(1).concat([g]),b=m.reshape([g].concat(h.arrayProd(y.slice(1))));b=(b=o.transpose(b,[1,0])).reshape(v),t.push(b),p=!0}else if(l>1){var _=h.range(1,l).concat([0]);t.push(o.transpose(m,_)),p=!0}else t.push(m)}var w=n.mergeFunction(t),S=w.rank;if(p)if(null==S){var x=w.shape;v=[g=x[x.length-1]].concat(x.slice(0,x.length-1));w=o.transpose(w.reshape([-1,g]),[1,0]).reshape(v)}else if(S>1){_=[S-1].concat(h.range(0,S-1));w=o.transpose(w,_)}return w}return n.mergeFunction(e)}))},t.prototype.computeOutputShape=function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}for(var i=[],o=0,a=e;o<a.length;o++){null!=(r=a[o])&&null!==r[0]&&i.push(r[0])}return t=1===(i=p.unique(i)).length?i.concat(t):[null].concat(t)},t}(l.Layer);n.Merge=d;var m=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.mergeFunction=function(e){return a.tidy((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=o.add(t,e[n]);return t}))},t.className="Add",t}(d);n.Add=m,a.serialization.SerializationMap.register(m),n.add=function(e){return Array.isArray(e)?new m({}).apply(e):new m(e)};var y=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.mergeFunction=function(e){return a.tidy((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=o.mul(t,e[n]);return t}))},t.className="Multiply",t}(d);n.Multiply=y,a.serialization.SerializationMap.register(y),n.multiply=function(e){return Array.isArray(e)?new y({}).apply(e):new y(e)};var g=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.mergeFunction=function(e){return a.tidy((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=o.add(t,e[n]);return o.mul(s.getScalar(1/e.length),t)}))},t.className="Average",t}(d);n.Average=g,a.serialization.SerializationMap.register(g),n.average=function(e){return Array.isArray(e)?new g({}).apply(e):new g(e)};var v=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.mergeFunction=function(e){return a.tidy((function(){for(var t=e[0],n=1;n<e.length;++n)t=o.maximum(t,e[n]);return t}))},t.className="Maximum",t}(d);n.Maximum=v,a.serialization.SerializationMap.register(v),n.maximum=function(e){return Array.isArray(e)?new v({}).apply(e):new v(e)};var b=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.mergeFunction=function(e){return a.tidy((function(){for(var t=e[0],n=1;n<e.length;++n)t=o.minimum(t,e[n]);return t}))},t.className="Minimum",t}(d);n.Minimum=b,a.serialization.SerializationMap.register(b),n.minimum=function(e){return Array.isArray(e)?new b({}).apply(e):new b(e)};var _=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_AXIS=-1,null==t&&(t={}),n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return i(t,e),t.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new c.ValueError("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,r=e;n<r.length;n++){if(null!=(h=r[n])){t=!1;break}}if(!t){for(var i=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);for(var u=!1,l=0,p=i;l<p.length;l++){var h=p[l];if(a.util.arraysEqual(h,s)){u=!0;break}}u||i.push(s)}if(i.length>1)throw new c.ValueError("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},t.prototype.mergeFunction=function(e){var t=this;return a.tidy((function(){return u.concatenate(e,t.axis)}))},t.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new c.ValueError("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,o=t.slice(1);i<o.length;i++){var a=o[i];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Concatenate",t}(d);n.Concatenate=_,a.serialization.SerializationMap.register(_),n.concatenate=function(e){return Array.isArray(e)?new _({}).apply(e):new _(e)}},{"../backend/state":197,"../backend/tfjs_backend":198,"../engine/topology":206,"../errors":208,"../utils/generic_utils":236,"../utils/math_utils":238,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],223:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../constraints"),u=e("../engine/topology"),l=e("../backend/state"),c=e("../errors"),p=e("../initializers"),h=e("../regularizers"),f=e("../utils/generic_utils"),d=e("../utils/math_utils"),m=e("../utils/types_utils");function y(e,t,n,r,i,a){var s;if(void 0===a&&(a=.001),2===e.rank)s=o.batchNormalization2d(e,t,n,a,i,r);else if(3===e.rank)s=o.batchNormalization3d(e,t,n,a,i,r);else{if(4!==e.rank)throw new c.NotImplementedError("batchNormalization is not implememnted for array of rank "+e.rank+" yet");s=o.batchNormalization4d(e,t,n,a,i,r)}return s}function g(e,t,n,r,i){return void 0===i&&(i=.001),a.util.arraysEqual(r.slice().sort(),d.range(0,e.rank-1))?function(e,t,n,r,i){return void 0===i&&(i=.001),a.tidy((function(){var a=o.moments(e,r),s=a.mean,u=a.variance;return[y(e,s,u,n,t,i),s,u]}))}(e,t,n,r,i):function(e,t,n,r,i){return void 0===i&&(i=.001),a.tidy((function(){for(var a=o.moments(e,r),s=a.mean,u=a.variance,l=[],c=0,p=d.range(0,e.rank);c<p.length;c++){var h=p[c];-1!==r.indexOf(h)?l.push(1):l.push(e.shape[h])}var f=s.reshape(l),m=u.reshape(l),g=null==t?null:t.reshape(l),v=null==n?null:n.reshape(l);return[y(e,f,m,v,g,i),s,u]}))}(e,t,n,r,i)}n.batchNormalization=y,n.normalizeBatchInTraining=g;var v=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.axis=null==t.axis?-1:t.axis,n.momentum=null==t.momentum?.99:t.momentum,n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=p.getInitializer(t.betaInitializer||"zeros"),n.gammaInitializer=p.getInitializer(t.gammaInitializer||"ones"),n.movingMeanInitializer=p.getInitializer(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=p.getInitializer(t.movingVarianceInitializer||"ones"),n.betaConstraint=s.getConstraint(t.betaConstraint),n.gammaConstraint=s.getConstraint(t.gammaConstraint),n.betaRegularizer=h.getRegularizer(t.betaRegularizer),n.gammaRegularizer=h.getRegularizer(t.gammaRegularizer),n.stepCount=0,n}return i(t,e),t.prototype.build=function(e){e=m.getExactlyOneShape(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new c.ValueError("Axis "+t+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new u.InputSpec({ndim:e.length,axes:(r={},r[t]=n,r)})];var r,i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var r=null!=t.training&&t.training,i=m.getExactlyOneTensor(e),s=i.shape,u=s.length,c=d.range(0,u),p=n.axis>=0?n.axis:n.axis+u;c.splice(p,1);var h=f.pyListRepeat(1,u);h[p]=s[p];var v=c.slice();v.sort();var b=!a.util.arraysEqual(v,d.range(0,u).slice(0,u-1));if(!r)return function(){if(b){var e=n.movingMean.read().reshape(h),t=n.movingVariance.read().reshape(h),r=n.center?n.beta.read().reshape(h):null,o=n.scale?n.gamma.read().reshape(h):null;return y(i,e,t,r,o,n.epsilon)}return y(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var _=g(i,n.gamma.read(),n.beta.read(),c,n.epsilon),w=_[0],S=_[1],x=_[2],T=d.arrayProd(c.map((function(e){return i.shape[e]}))),P=x.mul(l.getScalar(T/(T-(1+n.epsilon))));return function(){n.stepCount++;var e=o.movingAverage(n.movingMean.read(),S,n.momentum,n.stepCount);n.movingMean.write(e);var t=o.movingAverage(n.movingVariance.read(),P,n.momentum,n.stepCount);n.movingVariance.write(t)}(),w}))},t.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:p.serializeInitializer(this.betaInitializer),gammaInitializer:p.serializeInitializer(this.gammaInitializer),movingMeanInitializer:p.serializeInitializer(this.movingMeanInitializer),movingVarianceInitializer:p.serializeInitializer(this.movingVarianceInitializer),betaRegularizer:h.serializeRegularizer(this.betaRegularizer),gammaRegularizer:h.serializeRegularizer(this.gammaRegularizer),betaConstraint:s.serializeConstraint(this.betaConstraint),gammaConstraint:s.serializeConstraint(this.gammaConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="BatchNormalization",t}(u.Layer);n.BatchNormalization=v,a.serialization.SerializationMap.register(v)},{"../backend/state":197,"../constraints":202,"../engine/topology":206,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/generic_utils":236,"../utils/math_utils":238,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],224:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/common"),u=e("../engine/topology"),l=e("../errors"),c=e("../utils/types_utils");function p(e,t,n){return a.tidy((function(){if(4!==e.rank)throw new l.ValueError("temporalPadding expects input tensor to be 4-D, but received a "+e.rank+"-D tensor.");if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new l.ValueError("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n=s.imageDataFormat()),"channelsLast"!==n&&"channelsFirst"!==n)throw new l.ValueError("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],o.pad(e,r)}))}n.temporalPadding=function(e,t){return a.tidy((function(){if(3!==e.rank)throw new l.ValueError("temporalPadding expects input tensor to be 3-D, but received a "+e.rank+"-D tensor.");if(null==t&&(t=[1,1]),2!==t.length)throw new l.ValueError("temporalPadding expects input padding pattern to be a length-2 array, but received a length-"+t.length+" array.");var n=[[0,0],t,[0,0]];return o.pad(e,n)}))},n.spatial2dPadding=p;var h=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).dataFormat=null==t.dataFormat?s.imageDataFormat():t.dataFormat,null==t.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new l.ValueError("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof t.padding[0])r=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new l.ValueError("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(r=t.padding[0],2!==t.padding[1].length)throw new l.ValueError("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");i=t.padding[1]}n.padding=[r,i]}return n.inputSpec=[new u.InputSpec({ndim:4})],n}return i(t,e),t.prototype.computeOutputShape=function(e){var t,n;return e=c.getExactlyOneShape(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){return p(c.getExactlyOneTensor(e),n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ZeroPadding2D",t}(u.Layer);n.ZeroPadding2D=h,a.serialization.SerializationMap.register(h)},{"../backend/common":196,"../engine/topology":206,"../errors":208,"../utils/types_utils":240,"@tensorflow/tfjs-core":66}],225:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/common"),u=e("../backend/tfjs_backend"),l=e("../common"),c=e("../engine/topology"),p=e("../engine/topology"),h=e("../errors"),f=e("../utils/conv_utils"),d=e("../utils/types_utils"),m=e("./convolutional");function y(e,t,n,r,i,u){return a.tidy((function(){var a;l.checkDataFormat(i),l.checkPoolMode(u),l.checkPaddingMode(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i=s.imageDataFormat()),null==u&&(u="max"),e=m.preprocessConv2DInput(e,i);var c="same"===r?"same":"valid";return a="max"===u?o.maxPool(e,t,n,c):o.avgPool(e,t,n,c),"channelsFirst"===i&&(a=o.transpose(a,[0,3,1,2])),a}))}n.pool2d=y;var g=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=2),n=e.call(this,t)||this,"number"==typeof t.poolSize)n.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new h.ValueError("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));n.poolSize=t.poolSize}if(null==t.strides)n.strides=n.poolSize;else if("number"==typeof t.strides)n.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new h.ValueError("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));n.strides=t.strides}return n.padding=null==t.padding?"valid":t.padding,l.checkPaddingMode(n.padding),n.inputSpec=[new c.InputSpec({ndim:3})],n}return i(t,e),t.prototype.computeOutputShape=function(e){e=d.getExactlyOneShape(e);var t=f.convOutputLength(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){n.invokeCallHook(e,t),e=u.expandDims(d.getExactlyOneTensor(e),2);var r=n.poolingFunction(d.getExactlyOneTensor(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return o.squeeze(r,[2])}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(p.Layer);n.Pooling1D=g;var v=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return l.checkDataFormat(i),l.checkPaddingMode(r),y(e,t,n,r,i,"max")},t.className="MaxPooling1D",t}(g);n.MaxPooling1D=v,a.serialization.SerializationMap.register(v);var b=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return l.checkDataFormat(i),l.checkPaddingMode(r),y(e,t,n,r,i,"avg")},t.className="AveragePooling1D",t}(g);n.AveragePooling1D=b,a.serialization.SerializationMap.register(b);var _=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new h.ValueError("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides];return n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,l.checkDataFormat(n.dataFormat),l.checkPaddingMode(n.padding),n.inputSpec=[new c.InputSpec({ndim:4})],n}return i(t,e),t.prototype.computeOutputShape=function(e){e=d.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=f.convOutputLength(t,this.poolSize[0],this.padding,this.strides[0]),n=f.convOutputLength(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){return n.invokeCallHook(e,t),n.poolingFunction(d.getExactlyOneTensor(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(p.Layer);n.Pooling2D=_;var w=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return l.checkDataFormat(i),l.checkPaddingMode(r),y(e,t,n,r,i,"max")},t.className="MaxPooling2D",t}(_);n.MaxPooling2D=w,a.serialization.SerializationMap.register(w);var S=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return l.checkDataFormat(i),l.checkPaddingMode(r),y(e,t,n,r,i,"avg")},t.className="AveragePooling2D",t}(_);n.AveragePooling2D=S,a.serialization.SerializationMap.register(S);var x=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[new c.InputSpec({ndim:3})],n}return i(t,e),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,t){throw new h.NotImplementedError},t}(p.Layer);n.GlobalPooling1D=x;var T=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.call=function(e,t){return a.tidy((function(){var t=d.getExactlyOneTensor(e);return o.mean(t,1)}))},t.className="GlobalAveragePooling1D",t}(x);n.GlobalAveragePooling1D=T,a.serialization.SerializationMap.register(T);var P=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.call=function(e,t){return a.tidy((function(){var t=d.getExactlyOneTensor(e);return o.max(t,1)}))},t.className="GlobalMaxPooling1D",t}(x);n.GlobalMaxPooling1D=P,a.serialization.SerializationMap.register(P);var N=function(e){function t(t){var n=e.call(this,t)||this;return n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,l.checkDataFormat(n.dataFormat),n.inputSpec=[new c.InputSpec({ndim:4})],n}return i(t,e),t.prototype.computeOutputShape=function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,t){throw new h.NotImplementedError},t.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(p.Layer);n.GlobalPooling2D=N;var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var t=d.getExactlyOneTensor(e);return"channelsLast"===n.dataFormat?o.mean(t,[1,2]):o.mean(t,[2,3])}))},t.className="GlobalAveragePooling2D",t}(N);n.GlobalAveragePooling2D=A,a.serialization.SerializationMap.register(A);var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var t=d.getExactlyOneTensor(e);return"channelsLast"===n.dataFormat?o.max(t,[1,2]):o.max(t,[2,3])}))},t.className="GlobalMaxPooling2D",t}(N);n.GlobalMaxPooling2D=k,a.serialization.SerializationMap.register(k)},{"../backend/common":196,"../backend/tfjs_backend":198,"../common":201,"../engine/topology":206,"../errors":208,"../utils/conv_utils":235,"../utils/types_utils":240,"./convolutional":218,"@tensorflow/tfjs-core":66}],226:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../activations"),u=e("../backend/state"),l=e("../backend/tfjs_backend"),c=e("../constraints"),p=e("../engine/topology"),h=e("../engine/topology"),f=e("../errors"),d=e("../initializers"),m=e("../regularizers"),y=e("../utils/math_utils"),g=e("../utils/types_utils"),v=e("../variables"),b=e("./serialization");function _(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new f.ValueError("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function w(e,t,n,r,i,a,s,u){void 0===r&&(r=!1),void 0===s&&(s=!1);var c=t.shape.length;if(c<3)throw new f.ValueError("Input should be at least 3D, but is "+c+"D.");var p,h,d=[1,0].concat(y.range(2,c));if(t=o.transpose(t,d),null!=i)throw new f.NotImplementedError("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=a)throw new f.NotImplementedError("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r&&(t=o.reverse(t,0));for(var m=n,g=t.shape[0],v=0;v<g;++v){var b=l.sliceAlongFirstAxis(t,v,1),_=e(b=b.reshape(b.shape.slice(1)),m);h=_[0],p=0===v?h.reshape([1].concat(h.shape)):l.concatAlongFirstAxis(p,h.reshape([1].concat(h.shape))),m=_[1]}return[h,o.transpose(p,[1,0].concat(y.range(2,p.shape.length))),m]}n.standardizeArgs=_,n.rnn=w;var S=function(e){function t(t){var n,r=e.call(this,t)||this;if(null==t.cell)throw new f.ValueError("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(t.cell)?new O({cells:t.cell}):t.cell).stateSize)throw new f.ValueError("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=t.returnSequences&&t.returnSequences,r.returnState=null!=t.returnState&&t.returnState,r.goBackwards=null!=t.goBackwards&&t.goBackwards,r._stateful=null!=t.stateful&&t.stateful,r.unroll=null!=t.unroll&&t.unroll,r.supportsMasking=!0,r.inputSpec=[new p.InputSpec({ndim:3})],r.stateSpec=null,r.states=null,r.numConstants=null,r.keptStates=[],r}return i(t,e),t.prototype.getStates=function(){if(null==this.states){var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return y.range(0,e).map((function(e){return null}))}return this.states},t.prototype.setStates=function(e){this.states=e},t.prototype.computeOutputShape=function(e){g.isArrayOfShapes(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){for(var i=[],o=0,a=t;o<a.length;o++){var s=a[o];i.push([e[0],s])}return[n].concat(i)}return n},t.prototype.computeMask=function(e,t){throw new f.NotImplementedError("computeMask has not been implemented for RNN yet")},t.prototype.build=function(e){if(null!=this.numConstants)throw new f.NotImplementedError("Constants support is not implemented in RNN yet.");g.isArrayOfShapes(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e[e.length-1];this.inputSpec[0]=new p.InputSpec({shape:[t,null,n]});var r,i=[e[0]].concat(e.slice(2));if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!a.util.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new f.ValueError("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=r.map((function(e){return new p.InputSpec({shape:[null,e]})}));this.stateful&&this.resetStates()},t.prototype.resetStates=function(e){var t=this;a.tidy((function(){if(!t.stateful)throw new f.AttributeError("Cannot call resetStates() on an RNN Layer that is not stateful.");var n=t.inputSpec[0].shape[0];if(null==n)throw new f.ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states)Array.isArray(t.cell.stateSize)?t.states=t.cell.stateSize.map((function(e){return o.zeros([n,e])})):t.states=[o.zeros([n,t.cell.stateSize])];else if(null==e)o.dispose(t.states),null!=t.keptStates&&(o.dispose(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states=t.cell.stateSize.map((function(e){return o.zeros([n,e])})):t.states[0]=o.zeros([n,t.cell.stateSize]);else{if(t.keptStates.push(t.states.slice()),Array.isArray(e)||(e=[e]),e.length!==t.states.length)throw new f.ValueError("Layer "+t.name+" expects "+t.states.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);for(var r=0;r<t.states.length;++r){var i=e[r],s=Array.isArray(t.cell.stateSize)?t.cell.stateSize[r]:t.cell.stateSize,u=[n,s];if(!a.util.arraysEqual(i.shape,u))throw new f.ValueError("State "+r+" is incompatible with layer "+t.name+": expected shape="+u+", received shape="+i.shape);t.states[r]=i}}t.states.forEach((function(e){return o.keep(e)}))}))},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var o=_(t,r,i,this.numConstants);t=o.inputs,r=o.initialState,i=o.constants;var a=[],s=[];if(null!=r){n.initialState=r,a=a.concat(r),this.stateSpec=[];for(var u=0,l=r;u<l.length;u++){var c=l[u];this.stateSpec.push(new p.InputSpec({shape:c.shape}))}s=s.concat(this.stateSpec)}if(null!=i&&(n.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof p.SymbolicTensor){var h=[t].concat(a),f=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=f;var m=e.prototype.apply.call(this,h,n);return this.inputSpec=d,m}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var r=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;if(e=g.getExactlyOneTensor(e),null==o&&(o=n.stateful?n.states:n.getInitialState(e)),null!=r)throw new f.NotImplementedError("Masking is not implemented for RNN yet");var a=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(o.length!==a)throw new f.ValueError("RNN Layer has "+a+" state(s) but was passed "+o.length+" initial state(s).");e.shape[1];n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=w((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,o,n.goBackwards,null,null,n.unroll),l=u[0],c=u[1],p=u[2];n.stateful&&n.resetStates(p);var h=n.returnSequences?c:l;return n.returnState?[h].concat(p):h}))},t.prototype.getInitialState=function(e){var t=this;return a.tidy((function(){var n=o.zeros(e.shape);return n=o.sum(n,[1,2]),n=l.expandDims(n),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?l.tile(n,[1,e]):n})):t.cell.stateSize>1?[l.tile(n,[1,t.cell.stateSize])]:[n]}))},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var r=e.prototype.getConfig.call(this);return Object.assign(t,r),t},t.className="RNN",t}(h.Layer);n.RNN=S,a.serialization.SerializationMap.register(S);var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(h.Layer);n.RNNCell=x;var T=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=s.getActivation(null==t.activation?n.DEFAULT_ACTIVATION:t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=d.getInitializer(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=d.getInitializer(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=d.getInitializer(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=m.getRegularizer(t.kernelRegularizer),n.recurrentRegularizer=m.getRegularizer(t.recurrentRegularizer),n.biasRegularizer=m.getRegularizer(t.biasRegularizer),n.kernelConstraint=c.getConstraint(t.kernelConstraint),n.recurrentConstraint=c.getConstraint(t.recurrentConstraint),n.biasConstraint=c.getConstraint(t.biasConstraint),n.dropout=y.min([1,y.max([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=y.min([1,y.max([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return i(t,e),t.prototype.build=function(e){e=g.getExactlyOneShape(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){if(2!==e.length)throw new f.ValueError("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var r=e[1];e=e[0];var i,a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=I((function(){return o.onesLike(e)}),n.dropout,a)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=I((function(){return o.onesLike(r)}),n.recurrentDropout,a));var s=n.dropoutMask,u=n.recurrentDropoutMask;i=null!=s?l.dot(o.mul(e,s),n.kernel.read()):l.dot(e,n.kernel.read()),null!=n.bias&&(i=l.biasAdd(i,n.bias.read())),null!=u&&(r=o.mul(r,u));var c=o.add(i,l.dot(r,n.recurrentKernel.read()));return null!=n.activation&&(c=n.activation.apply(c)),[c,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="SimpleRNNCell",t}(x);n.SimpleRNNCell=T,a.serialization.SerializationMap.register(T);var P=function(e){function t(t){return t.cell=new T(t),e.call(this,t)||this}return i(t,e),t.prototype.call=function(t,n){var r=this;return a.tidy((function(){null!=r.cell.dropoutMask&&(o.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(o.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,a=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:i,training:a,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.className="SimpleRNN",t}(S);n.SimpleRNN=P,a.serialization.SerializationMap.register(P);var N=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=s.getActivation(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=s.getActivation(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=d.getInitializer(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=d.getInitializer(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=d.getInitializer(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=m.getRegularizer(t.kernelRegularizer),n.recurrentRegularizer=m.getRegularizer(t.recurrentRegularizer),n.biasRegularizer=m.getRegularizer(t.biasRegularizer),n.kernelConstraint=c.getConstraint(t.kernelConstraint),n.recurrentConstraint=c.getConstraint(t.recurrentConstraint),n.biasConstraint=c.getConstraint(t.biasConstraint),n.dropout=y.min([1,y.max([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=y.min([1,y.max([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return i(t,e),t.prototype.build=function(e){var t=(e=g.getExactlyOneShape(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){if(2!==e.length)throw new f.ValueError("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var r=null!=t.training&&t.training,i=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=I((function(){return o.onesLike(e)}),n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=I((function(){return o.onesLike(i)}),n.recurrentDropout,r,3));var a,s,c,p=n.dropoutMask,h=n.recurrentDropoutMask;if(1===n.implementation){var d=l.sliceAlongLastAxis(n.kernel.read(),0,n.units),m=l.sliceAlongLastAxis(n.kernel.read(),n.units,n.units),y=l.sliceAlongLastAxis(n.kernel.read(),2*n.units,n.units),g=l.sliceAlongLastAxis(n.recurrentKernel.read(),0,n.units),v=l.sliceAlongLastAxis(n.recurrentKernel.read(),n.units,n.units),b=l.sliceAlongLastAxis(n.recurrentKernel.read(),2*n.units,n.units),_=void 0,w=void 0,S=void 0;0<n.dropout&&n.dropout<1?(_=o.mul(e,p[0]),w=o.mul(e,p[1]),S=o.mul(e,p[2])):(_=e,w=e,S=e);var x=l.dot(_,d),T=l.dot(w,m),P=l.dot(S,y);if(n.useBias){var N=l.sliceAlongFirstAxis(n.bias.read(),0,n.units),A=l.sliceAlongFirstAxis(n.bias.read(),n.units,n.units),k=l.sliceAlongFirstAxis(n.bias.read(),2*n.units,n.units);x=l.biasAdd(x,N),T=l.biasAdd(T,A),P=l.biasAdd(P,k)}var E=void 0,O=void 0,M=void 0;0<n.recurrentDropout&&n.recurrentDropout<1?(E=o.mul(i,h[0]),O=o.mul(i,h[1]),M=o.mul(i,h[2])):(E=i,O=i,M=i),a=n.recurrentActivation.apply(o.add(x,l.dot(E,g))),s=n.recurrentActivation.apply(o.add(T,l.dot(O,v))),c=n.activation.apply(o.add(P,l.dot(o.mul(s,M),b)))}else{0<n.dropout&&n.dropout<1&&(e=o.mul(e,p[0]));var C=l.dot(e,n.kernel.read());n.useBias&&(C=l.biasAdd(C,n.bias.read())),0<n.dropout&&n.dropout<1&&(i=o.mul(i,h[0]));var R=l.dot(i,l.sliceAlongLastAxis(n.recurrentKernel.read(),0,2*n.units)),z=(x=l.sliceAlongLastAxis(C,0,n.units),T=l.sliceAlongLastAxis(C,n.units,n.units),l.sliceAlongLastAxis(R,0,n.units)),D=l.sliceAlongLastAxis(R,n.units,n.units);a=n.recurrentActivation.apply(o.add(x,z)),s=n.recurrentActivation.apply(o.add(T,D));P=l.sliceAlongLastAxis(C,2*n.units,n.units);var L=l.dot(o.mul(s,i),l.sliceAlongLastAxis(n.recurrentKernel.read(),2*n.units,n.units));c=n.activation.apply(o.add(P,L))}var F=o.add(o.mul(a,i),o.mul(o.add(u.getScalar(1),o.neg(a)),c));return[F,F]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),recurrentActivation:s.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="GRUCell",t}(x);n.GRUCell=N,a.serialization.SerializationMap.register(N);var A=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new N(t),e.call(this,t)||this}return i(t,e),t.prototype.call=function(t,n){var r=this;return a.tidy((function(){null!=r.cell.dropoutMask&&(o.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(o.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,a=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:i,training:a,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),recurrentActivation:s.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="GRU",t}(S);n.GRU=A,a.serialization.SerializationMap.register(A);var k=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=s.getActivation(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=s.getActivation(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=d.getInitializer(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=d.getInitializer(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=d.getInitializer(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=m.getRegularizer(t.kernelRegularizer),n.recurrentRegularizer=m.getRegularizer(t.recurrentRegularizer),n.biasRegularizer=m.getRegularizer(t.biasRegularizer),n.kernelConstraint=c.getConstraint(t.kernelConstraint),n.recurrentConstraint=c.getConstraint(t.recurrentConstraint),n.biasConstraint=c.getConstraint(t.biasConstraint),n.dropout=y.min([1,y.max([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=y.min([1,y.max([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return i(t,e),t.prototype.build=function(e){var t,n,r=(e=g.getExactlyOneShape(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,a=this.units;t=new(n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){var n=o.apply([a]),r=(new d.Ones).apply([a]),i=o.apply([2*a]);return l.concatAlongFirstAxis(l.concatAlongFirstAxis(n,r),i)},t}(d.Initializer),n.className="CustomInit",n)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,t,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new f.ValueError("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var i=e[1],a=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=I((function(){return o.onesLike(e)}),n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=I((function(){return o.onesLike(i)}),n.recurrentDropout,r,4));var s,u,c,p,h=n.dropoutMask,d=n.recurrentDropoutMask;if(1===n.implementation){var m=l.sliceAlongLastAxis(n.kernel.read(),0,n.units),y=l.sliceAlongLastAxis(n.kernel.read(),n.units,n.units),g=l.sliceAlongLastAxis(n.kernel.read(),2*n.units,n.units),v=l.sliceAlongLastAxis(n.kernel.read(),3*n.units,n.units),b=l.sliceAlongLastAxis(n.recurrentKernel.read(),0,n.units),_=l.sliceAlongLastAxis(n.recurrentKernel.read(),n.units,n.units),w=l.sliceAlongLastAxis(n.recurrentKernel.read(),2*n.units,n.units),S=l.sliceAlongLastAxis(n.recurrentKernel.read(),3*n.units,n.units),x=void 0,T=void 0,P=void 0,N=void 0;0<n.dropout&&n.dropout<1?(x=o.mul(e,h[0]),T=o.mul(e,h[1]),P=o.mul(e,h[2]),N=o.mul(e,h[3])):(x=e,T=e,P=e,N=e);var A=l.dot(x,m),k=l.dot(T,y),E=l.dot(P,g),O=l.dot(N,v);if(n.useBias){var M=l.sliceAlongFirstAxis(n.bias.read(),0,n.units),C=l.sliceAlongFirstAxis(n.bias.read(),n.units,n.units),R=l.sliceAlongFirstAxis(n.bias.read(),2*n.units,n.units),z=l.sliceAlongFirstAxis(n.bias.read(),3*n.units,n.units);A=l.biasAdd(A,M),k=l.biasAdd(k,C),E=l.biasAdd(E,R),O=l.biasAdd(O,z)}var D=void 0,L=void 0,F=void 0,V=void 0;0<n.recurrentDropout&&n.recurrentDropout<1?(D=o.mul(i,d[0]),L=o.mul(i,d[1]),F=o.mul(i,d[2]),V=o.mul(i,d[3])):(D=i,L=i,F=i,V=i),s=n.recurrentActivation.apply(o.add(A,l.dot(D,b))),u=n.recurrentActivation.apply(o.add(k,l.dot(L,_))),c=o.add(o.mul(u,a),o.mul(s,n.activation.apply(o.add(E,l.dot(F,w))))),p=n.recurrentActivation.apply(o.add(O,l.dot(V,S)))}else{0<n.dropout&&n.dropout<1&&(e=o.mul(e,h[0]));var q=l.dot(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(i=o.mul(i,d[0])),q=o.add(q,l.dot(i,n.recurrentKernel.read())),n.useBias&&(q=l.biasAdd(q,n.bias.read()));var j=l.sliceAlongLastAxis(q,0,n.units),B=l.sliceAlongLastAxis(q,n.units,n.units),U=l.sliceAlongLastAxis(q,2*n.units,n.units),G=l.sliceAlongLastAxis(q,3*n.units,n.units);s=n.recurrentActivation.apply(j),u=n.recurrentActivation.apply(B),c=o.add(o.mul(u,a),o.mul(s,n.activation.apply(U))),p=n.recurrentActivation.apply(G)}var W=o.mul(p,n.activation.apply(c));return[W,W,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),recurrentActivation:s.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LSTMCell",t}(x);n.LSTMCell=k,a.serialization.SerializationMap.register(k);var E=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new k(t),e.call(this,t)||this}return i(t,e),t.prototype.call=function(t,n){var r=this;return a.tidy((function(){null!=r.cell.dropoutMask&&(o.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(o.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,a=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:i,training:a,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:s.serializeActivation(this.activation),recurrentActivation:s.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:d.serializeInitializer(this.kernelInitializer),recurrentInitializer:d.serializeInitializer(this.recurrentInitializer),biasInitializer:d.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:m.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:m.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:m.serializeRegularizer(this.biasRegularizer),activityRegularizer:m.serializeRegularizer(this.activityRegularizer),kernelConstraint:c.serializeConstraint(this.kernelConstraint),recurrentConstraint:c.serializeConstraint(this.recurrentConstraint),biasConstraint:c.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="LSTM",t}(S);n.LSTM=E,a.serialization.SerializationMap.register(E);var O=function(e){function t(t){var n=e.call(this,t)||this;return n.cells=t.cells,n}return i(t,e),Object.defineProperty(t.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var r=n[t];Array.isArray(r.stateSize)?e.push.apply(e,r.stateSize):e.push(r.stateSize)}return e},enumerable:!0,configurable:!0}),t.prototype.call=function(e,t){var n=this;return a.tidy((function(){for(var r=e.slice(1),i=[],o=0,a=n.cells.slice().reverse();o<a.length;o++){var s=a[o];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,l=[],c=0;c<n.cells.length;++c){s=n.cells[c];r=i[c],u=0===c?[e[0]].concat(r):[u[0]].concat(r),u=s.call(u,t),l.push(u.slice(1))}r=[];for(var p=0,h=l.slice().reverse();p<h.length;p++){var f=h[p];r.push.apply(r,f)}return[u[0]].concat(r)}))},t.prototype.build=function(e){var t;g.isArrayOfShapes(e)&&(e=e[0]);for(var n=0,r=this.cells;n<r.length;n++){var i=r[n];i.build(e),t=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,e=[e[0],t]}this.built=!0},t.prototype.getConfig=function(){for(var t=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];t.push({className:this.getClassName(),config:i.getConfig()})}var o={cells:t},a=e.prototype.getConfig.call(this);return Object.assign(o,a),o},t.fromConfig=function(e,t,n){void 0===n&&(n={});for(var r=[],i=0,o=t.cells;i<o.length;i++){var a=o[i];r.push(b.deserialize(a,n))}return new e({cells:r})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.cells;o<a.length;o++){r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.weights)}return v.batchGetValue(e)},t.prototype.setWeights=function(e){for(var t=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],o=i.weights.length,a=e.splice(o),s=0;s<i.weights.length;++s)t.push([i.weights[s],a[s]]);v.batchSetValue(t)},t.className="StackedRNNCells",t}(x);function I(e,t,n,r){function i(){return l.dropout(e(),u.getScalar(t))}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var a=[],s=0;s<r;s++)a.push(l.inTrainPhase(i,e,n));return a.forEach((function(e){return o.keep(e)})),a}return o.keep(l.inTrainPhase(i,e,n))}n.StackedRNNCells=O,a.serialization.SerializationMap.register(O)},{"../activations":195,"../backend/state":197,"../backend/tfjs_backend":198,"../constraints":202,"../engine/topology":206,"../errors":208,"../initializers":216,"../regularizers":234,"../utils/math_utils":238,"../utils/types_utils":240,"../variables":242,"./serialization":227,"@tensorflow/tfjs-core":66}],227:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("../utils/generic_utils");n.deserialize=function(e,t){return void 0===t&&(t={}),i.deserializeKerasObject(e,r.serialization.SerializationMap.getMap().classNameMap,t,"layer")}},{"../utils/generic_utils":236,"@tensorflow/tfjs-core":66}],228:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/state"),u=e("../backend/tfjs_backend"),l=e("../common"),c=e("../engine/topology"),p=e("../errors"),h=e("../utils/generic_utils"),f=e("../utils/types_utils"),d=e("./recurrent"),m=e("./serialization"),y=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=t.layer,n}return i(t,e),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=t.layer,i=m.deserialize(r,n);delete t.layer;var o={layer:i};return Object.assign(o,t),new e(o)},t}(c.Layer);n.Wrapper=y;var g=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n}return i(t,e),t.prototype.build=function(t){if((t=f.getExactlyOneShape(t)).length<3)throw new p.ValueError("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),e.prototype.build.call(this,t)},t.prototype.computeOutputShape=function(e){var t=[(e=f.getExactlyOneShape(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){e=f.getExactlyOneTensor(e);return d.rnn((function(e,r){return[n.layer.call(e,t),[]]}),e,[],!1,null,null,!1,e.shape[1])[1]}))},t.className="TimeDistributed",t}(y);function v(e){h.checkStringTypeUnionValue(n.VALID_BIDIRECTIONAL_MERGE_MODES,"BidirectionalMergeMode",e)}n.TimeDistributed=g,a.serialization.SerializationMap.register(g),n.VALID_BIDIRECTIONAL_MERGE_MODES=["sum","mul","concat","ave"],n.checkBidirectionalMergeMode=v;var b=function(e){function t(t){var n=e.call(this,t)||this,r=t.layer.getConfig();if(n.forwardLayer=m.deserialize({className:t.layer.getClassName(),config:r}),r.goBackwards=!0!==r.goBackwards,n.backwardLayer=m.deserialize({className:t.layer.getClassName(),config:r}),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,v(t.mergeMode),n.mergeMode=t.mergeMode,t.weights)throw new p.NotImplementedError("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return i(t,e),Object.defineProperty(t.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},t.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},t.prototype.computeOutputShape=function(e){var t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(r=i.slice(1),t=i[0]):t=i[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):h.singletonOrArray(n)},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var o=d.standardizeArgs(t,r,i,this.numConstants);if(t=o.inputs,r=o.initialState,i=o.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(null==r||0===r.length)&&null==i)return e.prototype.apply.call(this,t,n);var a=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new p.ValueError("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,a.push.apply(a,r);var l=r.map((function(e){return new c.InputSpec({shape:e.shape})}));this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=i)throw new p.NotImplementedError("Support for constants in Bidirectional layers is not implemented yet.");for(var h=a[0]instanceof c.SymbolicTensor,f=0,m=a;f<m.length;f++){if(m[f]instanceof c.SymbolicTensor!==h)throw new p.ValueError("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(h){var y=[t].concat(a),g=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=g;var b=e.prototype.apply.call(this,y,n);return this.inputSpec=v,b}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return a.tidy((function(){if(null!=t.mask)throw new p.NotImplementedError("The support for masking is not implemented for Bidirectional layers yet.");var r,i,a,l,c=t.initialState;if(null==c)r=n.forwardLayer.call(e,t),i=n.backwardLayer.call(e,t);else{var h=c.slice(0,c.length/2),f=c.slice(c.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:h})),i=n.forwardLayer.call(e,Object.assign(t,{initialState:f}))}return n.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),n.returnSequences&&(i=o.reverse(i,1)),"concat"===n.mergeMode?l=u.concatenate([r,i]):"sum"===n.mergeMode?l=o.add(r,i):"ave"===n.mergeMode?l=o.mul(s.getScalar(.5),o.add(r,i)):"mul"===n.mergeMode?l=o.mul(r,i):null==n.mergeMode&&(l=[r,i]),n.returnState?null==n.mergeMode?l.concat(a):[l].concat(a):l}))},t.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},t.prototype.build=function(e){var t=this;l.nameScope(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),l.nameScope(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t){var n=m.deserialize(t.layer);if(delete t.layer,null!=t.numConstants)throw new p.NotImplementedError("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)},t.className="Bidirectional",t}(y);n.Bidirectional=b,a.serialization.SerializationMap.register(b)},{"../backend/state":197,"../backend/tfjs_backend":198,"../common":201,"../engine/topology":206,"../errors":208,"../utils/generic_utils":236,"../utils/types_utils":240,"./recurrent":226,"./serialization":227,"@tensorflow/tfjs-core":66}],229:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core");n.resolveScalarsInLogs=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,u,l,c;return i(this,(function(i){switch(i.label){case 0:if(null==e)return[2];for(a in t=[],n=[],r=[],e)"number"!=typeof(s=e[a])&&(u=s,t.push(u.data()),n.push(a),r.push(u));return[4,Promise.all(t)];case 1:for(l=i.sent(),c=0;c<l.length;++c)e[n[c]]=l[c][0];return o.dispose(r),[2]}}))}))},n.disposeTensorsInLogs=function(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}},{"@tensorflow/tfjs-core":66}],230:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("./backend/common"),a=e("./backend/tfjs_backend"),s=e("./backend/state"),u=e("./errors");function l(e,t){return i.tidy((function(){var n=r.sum(a.square(e),t,!0),s=r.mul(i.scalar(o.epsilon()),r.onesLike(e)),u=r.sqrt(r.maximum(n,s));return r.div(e,u)}))}function c(e,t){return i.tidy((function(){return r.mean(a.square(r.sub(t,e)),-1)}))}function p(e,t){return i.tidy((function(){return r.mean(r.abs(r.sub(t,e)),-1)}))}function h(e,t){return i.tidy((function(){var n=r.sub(e,t),i=r.clipByValue(r.abs(e),o.epsilon(),Number.MAX_VALUE),a=r.abs(r.div(n,i));return r.mul(s.getScalar(100),r.mean(a,-1))}))}function f(e,t){return i.tidy((function(){var n=s.getScalar(1),i=r.clipByValue(t,o.epsilon(),Number.MAX_VALUE),u=r.log(r.add(n,i)),l=r.clipByValue(e,o.epsilon(),Number.MAX_VALUE),c=r.log(r.add(n,l));return r.mean(a.square(r.sub(u,c)),-1)}))}function d(e,t){return i.tidy((function(){var n=s.getScalar(0),i=s.getScalar(1),o=r.maximum(n,r.sub(i,r.mul(e,t)));return r.mean(a.square(o),-1)}))}function m(e,t){return i.tidy((function(){var n=s.getScalar(0),i=s.getScalar(1),o=r.maximum(n,r.sub(i,r.mul(e,t)));return r.mean(o,-1)}))}function y(e,t){return i.tidy((function(){var n=s.getScalar(0),i=s.getScalar(1),o=r.sum(r.mul(e,t),-1),a=r.max(r.mul(r.sub(i,e),t),-1);return r.maximum(n,r.add(i,r.sub(a,o)))}))}function g(e,t){return i.tidy((function(){var n=s.getScalar(Math.log(2)),i=r.sub(t,e),o=r.sub(r.add(i,r.softplus(r.mul(s.getScalar(-2),i))),n);return r.mean(o,-1)}))}function v(e,t,n){return void 0===n&&(n=!1),i.tidy((function(){if(n)t=r.softmax(t);else{var i=r.sum(t,t.shape.length-1,!0);t=r.div(t,i)}return t=r.clipByValue(t,o.epsilon(),1-o.epsilon()),r.neg(r.sum(r.mul(e.toFloat(),r.log(t)),t.shape.length-1))}))}function b(e,t,n){return void 0===n&&(n=!1),i.tidy((function(){var i=r.floor(a.flatten(e)).toInt(),o=t.shape;return v(r.oneHot(i,o[o.length-1]).reshape(o),t,n)}))}function _(e,t){return i.tidy((function(){var n=r.maximum(t,r.zerosLike(t)),i=r.mul(t,e),o=r.log(r.add(s.getScalar(1),r.exp(r.neg(r.abs(t)))));return r.add(r.sub(n,i),o)}))}function w(e,t){return i.tidy((function(){var n;return n=r.clipByValue(t,o.epsilon(),1-o.epsilon()),n=r.log(r.div(n,r.sub(r.onesLike(n),n))),r.mean(_(e,n),-1)}))}function S(e,t){return i.tidy((function(){var n=r.clipByValue(e,o.epsilon(),1),i=r.clipByValue(t,o.epsilon(),1);return r.sum(r.mul(e,r.log(r.div(n,i))),-1)}))}function x(e,t){return i.tidy((function(){var n=r.log(r.add(s.getScalar(o.epsilon()),t));return r.mean(r.sub(t,r.mul(e,n)),-1)}))}function T(e,t){return i.tidy((function(){var n=l(e,-1),i=l(t,-1),o=r.mul(n,i);return r.neg(r.sum(o,-1))}))}n.l2Normalize=l,n.meanSquaredError=c,n.meanAbsoluteError=p,n.meanAbsolutePercentageError=h,n.meanSquaredLogarithmicError=f,n.squaredHinge=d,n.hinge=m,n.categoricalHinge=y,n.logcosh=g,n.categoricalCrossentropy=v,n.sparseCategoricalCrossentropy=b,n.sigmoidCrossEntropyWithLogits=_,n.binaryCrossentropy=w,n.kullbackLeiblerDivergence=S,n.poisson=x,n.cosineProximity=T,n.mse=c,n.MSE=c,n.mae=p,n.MAE=p,n.mape=h,n.MAPE=h,n.msle=f,n.MSLE=f,n.kld=S,n.KLD=S,n.cosine=T,n.get=function(e){var t={meanSquaredError:c,meanAbsoluteError:p,meanAbsolutePercentageError:h,meanSquaredLogarithmicError:f,squaredHinge:d,hinge:m,categoricalHinge:y,logcosh:g,categoricalCrossentropy:v,sparseCategoricalCrossentropy:b,binaryCrossentropy:w,kullbackLeiblerDivergence:S,poisson:x,cosineProximity:T};if("string"==typeof e){if(e in t)return t[e];throw new u.ValueError("Unknown loss "+e)}return e}},{"./backend/common":196,"./backend/state":197,"./backend/tfjs_backend":198,"./errors":208,"@tensorflow/tfjs-core":66}],231:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("./backend/tfjs_backend"),a=e("./backend/state"),s=e("./errors"),u=e("./losses"),l=e("./losses");function c(e,t){return i.tidy((function(){var n=r.mul(a.getScalar(.5),r.onesLike(t)),i=o.cast(r.greater(t,n),e.dtype);return r.mean(r.equal(e,i),-1)}))}function p(e,t){return i.tidy((function(){return o.cast(r.equal(r.argMax(e,-1),r.argMax(t,-1)),"float32")}))}n.binaryAccuracy=c,n.categoricalAccuracy=p,n.binaryCrossentropy=function(e,t){return l.binaryCrossentropy(e,t)},n.sparseCategoricalAccuracy=function(e,t){throw new s.NotImplementedError},n.topKCategoricalAccuracy=function(e,t){throw new s.NotImplementedError},n.sparseTopKCategoricalAccuracy=function(e,t){throw new s.NotImplementedError},n.mse=u.meanSquaredError,n.MSE=u.meanSquaredError,n.mae=u.meanAbsoluteError,n.MAE=u.meanAbsoluteError,n.mape=u.meanAbsolutePercentageError,n.MAPE=u.meanAbsolutePercentageError,n.categoricalCrossentropy=u.categoricalCrossentropy,n.cosine=u.cosineProximity,n.sparseCategoricalCrossentropy=u.sparseCategoricalCrossentropy,n.get=function(e){var t={binaryAccuracy:c,categoricalAccuracy:p,categoricalCrossentropy:n.categoricalCrossentropy,sparseCategoricalCrossentropy:n.sparseCategoricalCrossentropy,mse:n.mse,MSE:n.MSE,mae:n.mae,MAE:n.MAE,mape:n.mape,MAPE:n.MAPE,cosine:n.cosine};if("string"==typeof e&&e in t)return t[e];if("string"!=typeof e&&null!=e)return e;throw new s.ValueError("Unknown metric "+e)}},{"./backend/state":197,"./backend/tfjs_backend":198,"./errors":208,"./losses":230,"@tensorflow/tfjs-core":66}],232:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("./backend/state"),l=e("./engine/input_layer"),c=e("./engine/topology"),p=e("./engine/training"),h=e("./errors"),f=e("./layers/serialization"),d=e("./utils/generic_utils"),m=e("./utils/serialization_utils"),y=e("./utils/types_utils");function g(e,t,n){return void 0===n&&(n=!0),o(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(a){switch(a.label){case 0:if(null==e.load)throw new h.ValueError("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,e.load()];case 1:if(r=a.sent(),null!=(i=r.modelTopology).model_config&&(i=i.model_config),o=f.deserialize(m.convertPythonicToTs(i),t),null!=r.weightData){if(null==r.weightSpecs)throw new h.ValueError("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");!1,!0,o.loadWeights(s.io.decodeWeights(r.weightData,r.weightSpecs),false,true,n)}return[2,o]}}))}))}n.modelFromJSON=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o,u,l,c,p;return a(this,(function(a){switch(a.label){case 0:return null!=(n=e.modelTopology).model_config&&(n=n.model_config),r=m.convertPythonicToTs(n),i=f.deserialize(r,t),null==e.weightsManifest?[3,2]:[4,s.io.loadWeights(e.weightsManifest,e.pathPrefix,i.weights.map((function(e){return e.originalName})))];case 1:for(o=a.sent(),u={},l=0,c=i.weights;l<c.length;l++)p=c[l],u[p.originalName]=o[p.originalName];null,!0,i.loadWeights(u,null,true),a.label=2;case 2:return[2,i]}}))}))},n.loadModelInternal=function(e,t){return void 0===t&&(t=!0),o(this,void 0,void 0,(function(){var n;return a(this,(function(r){if("string"==typeof e){if(0===(n=s.io.getLoadHandlers(e)).length)n.push(s.io.browserHTTPRequest(e));else if(n.length>1)throw new h.ValueError("Found more than one ("+n.length+") load handlers for URL '"+e+"'");e=n[0]}return[2,g(e,void 0,t)]}))}))},n.loadModelFromIOHandler=g;var v=function(e){function t(t){var n=e.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n._updatable=!0,n.built=!1,n.name=null!=t.name?t.name:u.getUid("sequential_"),null!=t.layers)for(var r=0,i=t.layers;r<i.length;r++){var o=i[r];n.add(o)}return n}return i(t,e),t.prototype.add=function(e){var n,r=e instanceof t||e instanceof p.Model;if(r){if(1!==(n=e).outputs.length)throw new h.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new h.ValueError("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new h.ValueError("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=l.Input({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new h.ValueError("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new h.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=c.getSourceInputs(this.outputs[0])}this.inboundNodes=[],new c.Node({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:d.pyListRepeat(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},t.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},t.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},t.prototype.build=function(e){if(y.getExactlyOneShape(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new p.Model({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},t.prototype.countParams=function(){return this.built||this.build(),e.prototype.countParams.call(this)},t.prototype.summary=function(t,n,r){void 0===r&&(r=console.log),this.built||this.build(),e.prototype.summary.call(this,t,n,r)},t.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},Object.defineProperty(t.prototype,"updatable",{get:function(){return this._updatable},set:function(e){this.built&&(this.model.updatable=e),this._updatable=e},enumerable:!0,configurable:!0}),t.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new h.RuntimeError("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},t.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},t.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},t.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),o(this,void 0,void 0,(function(){return a(this,(function(r){if(!this.built)throw new h.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fit(e,t,n)]}))}))},t.fromConfig=function(e,n){var r=new e({});if(!(r instanceof t))throw new h.ValueError("Sequential.fromConfig called on non-Sequential input: "+r);if(!(n instanceof Array))throw new h.ValueError("Sequential.fromConfig called without an array of configs");if(null==n[0].className||"Merge"===n[0].className)throw new h.ValueError("Legacy serialization format not supported yet.");for(var i=0,o=n;i<o.length;i++){var a=o[i],s=f.deserialize(a);r.add(s)}return r},Object.defineProperty(t.prototype,"stopTraining",{set:function(e){this.model.stopTraining=e},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push({className:r.getClassName(),config:r.getConfig()})}return e},t.className="Sequential",t}(p.Model);n.Sequential=v,s.serialization.SerializationMap.register(v)},{"./backend/state":197,"./engine/input_layer":205,"./engine/topology":206,"./engine/training":207,"./errors":208,"./layers/serialization":227,"./utils/generic_utils":236,"./utils/serialization_utils":239,"./utils/types_utils":240,"@tensorflow/tfjs-core":66}],233:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./backend/common"),o=e("./errors");n.getOptimizer=function(e){var t={Adagrad:function(){return r.train.adagrad(.01)},Adadelta:function(){return r.train.adadelta(1,.95,i.epsilon())},Adam:function(){return r.train.adam(.001,.9,.999,i.epsilon())},Adamax:function(){return r.train.adamax(.002,.9,.999,i.epsilon(),0)},RMSProp:function(){return r.train.rmsprop(.001,.9,0,i.epsilon())},SGD:function(){return r.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new o.ValueError("Unknown Optimizer "+e)}},{"./backend/common":196,"./errors":208,"@tensorflow/tfjs-core":66}],234:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("./backend/state"),u=e("./backend/tfjs_backend"),l=e("./utils/generic_utils"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(a.serialization.Serializable);n.Regularizer=c;var p=function(e){function t(t){var n=e.call(this)||this,r=null==t||null==t.l1?.01:t.l1,i=null==t||null==t.l2?.01:t.l2;return n.hasL1=0!==r,n.hasL2=0!==i,n.l1=s.getScalar(r),n.l2=s.getScalar(i),n}return i(t,e),t.prototype.apply=function(e){var t=this;return a.tidy((function(){var n=a.zeros([1]);return t.hasL1&&(n=a.add(n,a.sum(o.mul(t.l1,a.abs(e))))),t.hasL2&&(n=a.add(n,a.sum(o.mul(t.l2,u.square(e))))),n.asScalar()}))},t.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},t.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},t.className="L1L2",t}(c);function h(e,t){return void 0===t&&(t={}),l.deserializeKerasObject(e,a.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}n.L1L2=p,a.serialization.SerializationMap.register(p),n.l1=function(e){return new p({l1:null!=e?e.l1:null,l2:0})},n.l2=function(e){return new p({l2:null!=e?e.l2:null,l1:0})},n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={l1l2:"L1L2"},n.serializeRegularizer=function(e){return l.serializeKerasObject(e)},n.deserializeRegularizer=h,n.getRegularizer=function(e){return null==e?null:"string"==typeof e?h({className:e in n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}}):e instanceof c?e:h(e)}},{"./backend/state":197,"./backend/tfjs_backend":198,"./utils/generic_utils":236,"@tensorflow/tfjs-core":66}],235:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors"),i=e("./generic_utils"),o=e("./math_utils");n.normalizeArray=function(e,t,n){if("number"==typeof e)return i.pyListRepeat(e,t);if(e.length!==t)throw new r.ValueError("The "+n+" argument must be a tuple of "+t+" integers. Received: "+e.length+" elements.");for(var a=0;a<t;++a){var s=e[a];if(!o.isInteger(s))throw new r.ValueError("The "+n+" argument must be a tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+s)}return e},n.convOutputLength=function(e,t,n,r,i){return void 0===i&&(i=1),null==e?e:(o="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((o+r-1)/r));var o},n.deconvLength=function(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+o.max([n-t,0]);else{if("same"!==i)throw new r.ValueError("Unsupport padding mode: "+i+".");e*=t}return e}},{"../errors":208,"./generic_utils":236,"./math_utils":238}],236:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../errors");function o(e,t){if(!e)throw new i.AssertionError(t)}function a(e){return Array.isArray(e)?e:[e]}n.pyListRepeat=function(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n},n.assert=o,n.count=function(e,t){for(var n=0,r=0,i=e;r<i.length;r++){i[r]===t&&n++}return n},n.singletonOrArray=function(e){return 1===e.length?e[0]:e},n.toList=a,n.objectListUid=function(e){for(var t="",n=0,r=a(e);n<r.length;n++){var o=r[n];if(null==o.id)throw new i.ValueError("Object "+o+" passed to objectListUid without an id");""!==t&&(t+=", "),t+=Math.abs(o.id)}return t},n.toSnakeCase=function(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t},n.toCamelCase=function(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))};var s={};function u(e,t){return e<t?-1:e>t?1:0}n.serializeKerasObject=function(e){return null==e?null:{className:e.getClassName(),config:e.getConfig()}},n.deserializeKerasObject=function(e,t,n,o){if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===o&&(o="object"),"string"==typeof e){var a=e,u=void 0;if(a in n)u=n[a];else if(a in s)u=s[a];else if(null==(u=t[a]))throw new i.ValueError("Unknown "+o+": "+e+". This may be due to one of the following reasons:\n1. The "+o+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+o+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return u}var l=e;if(null==l.className||null==l.config)throw new i.ValueError(o+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var c,p,h,f=l.className,d=void 0,m=void 0;if(f in n?(d=(c=n.get(f))[0],m=c[1]):f in s?(d=(p=s.className)[0],m=p[1]):f in t&&(d=(h=t[f])[0],m=h[1]),null==d)throw new i.ValueError("Unknown "+o+": "+f+". This may be due to one of the following reasons:\n1. The "+o+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+o+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=m){for(var y={},g=0,v=Object.keys(s);g<v.length;g++){y[T=v[g]]=s[T]}for(var b=0,_=Object.keys(n);b<_.length;b++){y[T=_[b]]=n[T]}l.config.customObjects=y;for(var w=r({},s),S=0,x=Object.keys(n);S<x.length;S++){var T=x[S];s[T]=n[T]}var P=m(d,l.config);return s=r({},w),P}w=r({},s);for(var N=0,A=Object.keys(n);N<A.length;N++){T=A[N];s[T]=n[T]}return P=new d(l.config),s=r({},w),P},n.numberCompare=u,n.reverseNumberCompare=function(e,t){return-1*u(e,t)},n.stringToDType=function(e){if("float32"===e)return"float32";throw new i.ValueError("Invalid dtype: "+e)},n.stringsEqual=function(e,t){if(null==e||null==t)return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0},n.unique=function(e){if(null==e)return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t},n.isObjectEmpty=function(e){if(null==e)throw new i.ValueError("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},n.checkStringTypeUnionValue=function(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new i.ValueError(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")},n.checkArrayTypeAndLength=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),o(n>=0),o(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}},{"../errors":208}],237:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./variable_utils");function i(e,t,n){void 0===n&&(n=console.log);for(var r="",i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[i]).slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function o(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}i([e.name+" ("+e.getClassName()+")",r,e.countParams().toString()],t,n)}function a(e,t,n,r){var o;try{o=JSON.stringify(e.outputShape)}catch(e){o="multiple"}for(var a=[],s=0,u=e.inboundNodes;s<u.length;s++){var l=u[s];if(!(null!=n&&n.length>0&&-1===n.indexOf(l)))for(var c=0;c<l.inboundLayers.length;++c){var p=l.inboundLayers[c].name,h=l.nodeIndices[c],f=l.tensorIndices[c];a.push(p+"["+h+"]["+f+"]")}}var d=e.name,m=e.getClassName(),y=0===a.length?"":a[0];i([d+" ("+m+")",o,e.countParams().toString(),y],t,r);for(c=1;c<a.length;++c)i(["","","",a[c]],t,r)}n.printSummary=function(e,t,n,s){void 0===s&&(s=console.log);var u,l=function(e){var t=!0,n=[],r=[];for(var i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(var o=0,a=n;o<a.length;o++){var s=a[o];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,s)}if(t)for(var u=0,l=e.layers;u<l.length;u++){for(var c=!1,p=0,h=l[u].inboundNodes;p<h.length;p++){var f=h[p];if(-1!==r.indexOf(f)){if(c){t=!1;break}c=!0}}if(!t)break}return t}(e),c=["Layer (type)","Output shape","Param #"];if(l?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!l)for(var p in c.push("Receives inputs"),u=[],e.nodesByDepth)u.push.apply(u,e.nodesByDepth[p]);s("_".repeat(t)),i(c,n,s),s("=".repeat(t));for(var h=e.layers,f=0;f<h.length;++f)l?o(h[f],n,s):a(h[f],n,u,s),s((f===h.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var d=function(e){var t;t=null!=e.collectedTrainableWeights?r.countParamsInWeights(e.collectedTrainableWeights):r.countParamsInWeights(e.trainableWeights);return t}(e),m=r.countParamsInWeights(e.nonTrainableWeights);s("Total params: "+(d+m)),s("Trainable params: "+d),s("Non-trainable params: "+m),s("_".repeat(t))}},{"./variable_utils":241}],238:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("../errors");function a(e){return e=Array.isArray(e)?new Float32Array(e):e,i.tensor1d(e)}function s(e){return r.sum(a(e)).dataSync()[0]}function u(e){return s(e)/e.length}n.isInteger=function(e){return e===parseInt(e.toString(),10)},n.arrayProd=function(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,i=t;i<n;++i)r*=e[i];return r},n.min=function(e){return r.min(a(e)).dataSync()[0]},n.max=function(e){return r.max(a(e)).dataSync()[0]},n.sum=s,n.mean=u,n.variance=function(e){var t=r.sub(a(e),i.scalar(u(e)));return r.sum(r.mulStrict(t,t)).dataSync()[0]/e.length},n.median=function(e){var t=e.slice().sort((function(e,t){return e-t})),n=Math.floor((t.length-1)/2),r=Math.ceil((t.length-1)/2);return n===r?t[n]:(t[n]+t[r])/2},n.range=function(e,t){if(t<e)throw new o.ValueError("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],r=e;r<t;++r)n.push(r);return n}},{"../errors":208,"@tensorflow/tfjs-core":66}],239:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../utils/generic_utils");function i(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}n.convertPythonicToTs=function e(t,n){if(null===t)return null;if("string"==typeof t)return r.toCamelCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var o=[],a=t.length,s=0;s<a;++s){var u=t[s];i(n,s,u)?o.push(u):o.push(e(u,n))}return o}for(var l={},c=0,p=Object.keys(t);c<p.length;c++){var h=p[c],f=t[h];if("name"===h&&"string"==typeof f)l[h]=f;else{var d=r.toCamelCase(h);l[d]=e(f,d)}}return l},n.convertTsToPythonic=function e(t,n){if(null==t)return null;if("string"==typeof t)return r.toSnakeCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var o=[],a=t.length,s=0;s<a;++s){var u=t[s];i(n,s,u)?o.push(u):o.push(e(u,n))}return o}for(var l={},c=0,p=Object.keys(t);c<p.length;c++){var h=p[c],f=t[h],d=r.toSnakeCase(h);l[d]="name"!==h&&"className"!==h||"string"!=typeof f?e(f,h):f}return l}},{"../utils/generic_utils":236}],240:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.isArrayOfShapes=function(e){return Array.isArray(e)&&Array.isArray(e[0])},n.normalizeShapeList=function(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]},n.getExactlyOneTensor=function(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new r.ValueError("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t},n.getExactlyOneShape=function(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new r.ValueError("Expected exactly 1 Shape; got "+e.length)}return e}},{"../errors":208}],241:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.countParamsInWeights=function(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];0===i.shape.length?t+=1:t+=i.shape.reduce((function(e,t){return e*t}))}return t}},{}],242:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("./backend/state"),a=e("./common"),s=e("./errors"),u="Variable",l=function(){function e(e,t,n,i,s){void 0===t&&(t="float32"),void 0===n&&(n=u),void 0===i&&(i=!0),void 0===s&&(s=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=o.getNextUniqueTensorId(),n=null==n?u:n,this.originalName=a.getScopedTensorName(n),this.name=a.getUniqueTensorName(this.originalName),this.trainable=i,this.constraint=s,this.val=r.variable(e,this.trainable,this.name,this.dtype)}return e.prototype.read=function(){return this.assertNotDisposed(),this.val},e.prototype.write=function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},e.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},e.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},e}();n.LayerVariable=l,n.variable=function(e,t,n,r){return new l(e,t,n,!0,r)},n.zerosVariable=function(e,t,n){return new l(r.zeros(e),t,n)},n.zerosLike=function(e,t,n){return new l(r.zerosLike(e),t,n)},n.onesVariable=function(e,t,n){var i=r.ones(e);return new l(i,t,n)},n.onesLike=function(e,t,n){var i=r.onesLike(e);return new l(i,t,n)},n.eyeVariable=function(e,t,n){return new l(r.eye(e),t,n)},n.randomUniformVariable=function(e,t,n,i,o,a){return void 0===a&&(a="randomUniform"),new l(r.randomUniform(e,t,n,i),i,a)},n.truncatedNormalVariable=function(e,t,n,i,o,a){if(void 0===t&&(t=0),void 0===n&&(n=1),void 0===a&&(a="truncatedNormal"),"bool"===i)throw new s.NotImplementedError("randomNormal does not support dType bool.");return new l(r.truncatedNormal(e,t,n,i,o),i,a)},n.randomNormalVariable=function(e,t,n,i,o,a){if(void 0===t&&(t=0),void 0===n&&(n=1),void 0===a&&(a="randomNormal"),"bool"===i)throw new s.NotImplementedError("randomNormalVariable does not support dType bool.");return new l(r.randomNormal(e,t,n,i,o),i,a)},n.update=function(e,t){return e.write(t)},n.updateAdd=function(e,t){return e.write(r.add(e.read(),t))},n.updateSub=function(e,t){return e.write(r.sub(e.read(),t))},n.batchGetValue=function(e){return e.map((function(e){return e.read()}))},n.batchSetValue=function(e){e.map((function(e){e[0].write(e[1])}))},n.gradients=function(e,t){var n=t.map((function(e){return e.read()})),r=i.variableGrads(e,n);return t.map((function(e){return r.grads[e.name]}))}},{"./backend/state":197,"./common":201,"./errors":208,"@tensorflow/tfjs-core":66}],243:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.7.5"},{}],244:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("@tensorflow/tfjs-core")),r(e("@tensorflow/tfjs-layers")),r(e("@tensorflow/tfjs-converter"));var i=e("@tensorflow/tfjs-core"),o=e("@tensorflow/tfjs-layers"),a=e("@tensorflow/tfjs-converter"),s=e("./version");n.version={"tfjs-core":i.version_core,"tfjs-layers":o.version_layers,"tfjs-converter":a.version_converter,tfjs:s.version}},{"./version":245,"@tensorflow/tfjs-converter":13,"@tensorflow/tfjs-core":66,"@tensorflow/tfjs-layers":215}],245:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.12.7"},{}],246:[function(e,t,n){"use strict";n.byteLength=function(e){return 3*e.length/4-u(e)},n.toByteArray=function(e){var t,n,r,a,s,l=e.length;a=u(e),s=new o(3*l/4-a),n=a>0?l-4:l;var c=0;for(t=0;t<n;t+=4)r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=r>>16&255,s[c++]=r>>8&255,s[c++]=255&r;2===a?(r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&r):1===a&&(r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=r>>8&255,s[c++]=255&r);return s},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o="",a=[],s=16383,u=0,c=n-i;u<c;u+=s)a.push(l(e,u,u+s>c?c:u+s));1===i?(t=e[n-1],o+=r[t>>2],o+=r[t<<4&63],o+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],o+=r[t>>10],o+=r[t>>4&63],o+=r[t<<2&63],o+="=");return a.push(o),a.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function l(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],247:[function(e,t,n){"use strict";function r(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}n.INT_BITS=32,n.INT_MAX=2147483647,n.INT_MIN=-1<<31,n.sign=function(e){return(e>0)-(e<0)},n.abs=function(e){var t=e>>31;return(e^t)-t},n.min=function(e,t){return t^(e^t)&-(e<t)},n.max=function(e,t){return e^(e^t)&-(e<t)},n.isPow2=function(e){return!(e&e-1||!e)},n.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},n.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},n.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},n.countTrailingZeros=r,n.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},n.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},n.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(i),n.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},n.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},n.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},n.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},n.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},n.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>r(e)+1}},{}],248:[function(e,t,n){},{}],249:[function(e,t,n){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var r=e("base64-js"),i=e("ieee754");n.Buffer=s,n.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function a(e){if(e>o)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=s.prototype,t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(e)}return u(e,t,n)}function u(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return j(e)||e&&j(e.buffer)?function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=s.prototype,r}(e,t,n):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=a(n),i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t):function(e){if(s.isBuffer(e)){var t=0|h(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||B(e.length)?a(0):p(e);if("Buffer"===e.type&&Array.isArray(e.data))return p(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e){return l(e),a(e<0?0:0|h(e))}function p(e){for(var t=e.length<0?0:0|h(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||j(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function d(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,n);case"utf8":case"utf-8":return P(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return k(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),B(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=n;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var p=!0,h=0;h<u;h++)if(l(e,o+h)!==l(t,h)){p=!1;break}if(p)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(B(s))return a;e[n+a]=s}return a}function b(e,t,n,r){return q(F(t,e.length-n),e,n,r)}function _(e,t,n,r){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return _(e,t,n,r)}function S(e,t,n,r){return q(V(t),e,n,r)}function x(e,t,n,r){return q(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function P(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,l=e[i],c=null,p=l>239?4:l>223?3:l>191?2:1;if(i+p<=n)switch(p){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&l)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,p=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=p}return function(e){var t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=N));return n}(r)}n.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{get:function(){if(this instanceof s)return this.buffer}}),Object.defineProperty(s.prototype,"offset",{get:function(){if(this instanceof s)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(e,t,n){return u(e,t,n)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},s.allocUnsafe=function(e){return c(e)},s.allocUnsafeSlow=function(e){return c(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(ArrayBuffer.isView(o)&&(o=s.from(o)),!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},s.byteLength=f,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?P(this,0,e):d.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,r,i){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),u=Math.min(o,a),l=this.slice(r,i),c=e.slice(t,n),p=0;p<u;++p)if(l[p]!==c[p]){o=l[p],a=c[p];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function E(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=L(e[o]);return i}function O(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,o){return t=+t,n>>>=0,o||C(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function z(e,t,n,r,o){return t=+t,n>>>=0,o||C(e,0,n,8),i.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=s.prototype,r},s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return z(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return z(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;o>=0;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=s.isBuffer(e)?e:new s(e,r),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%u]}return this};var D=/[^+/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function V(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function j(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function B(e){return e!=e}},{"base64-js":246,ieee754:256}],250:[function(e,t,n){"use strict";var r=e("./lib/thunk.js");function i(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function(e){var t=new i;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var o=0;o<n.length;++o){var a=n[o];if("array"===a||"object"==typeof a&&a.blockIndices){if(t.argTypes[o]="array",t.arrayArgs.push(o),t.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),t.shimArgs.push("array"+o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)t.scalarArgs.push(o),t.shimArgs.push("scalar"+o);else if("index"===a){if(t.indexArgs.push(o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(t.shapeArgs.push(o),o<t.pre.args.length&&t.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<t.post.args.length&&t.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+n[o]);t.argTypes[o]="offset",t.offsetArgs.push({array:a.array,offset:a.offset}),t.offsetArgIndex.push(o)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,r(t)}},{"./lib/thunk.js":252}],251:[function(e,t,n){"use strict";var r=e("uniq");function i(e,t,n){var r,i,o=e.length,a=t.arrayArgs.length,s=t.indexArgs.length>0,u=[],l=[],c=0,p=0;for(r=0;r<o;++r)l.push(["i",r,"=0"].join(""));for(i=0;i<a;++i)for(r=0;r<o;++r)p=c,c=e[r],0===r?l.push(["d",i,"s",r,"=t",i,"p",c].join("")):l.push(["d",i,"s",r,"=(t",i,"p",c,"-s",p,"*t",i,"p",p,")"].join(""));for(l.length>0&&u.push("var "+l.join(",")),r=o-1;r>=0;--r)c=e[r],u.push(["for(i",r,"=0;i",r,"<s",c,";++i",r,"){"].join(""));for(u.push(n),r=0;r<o;++r){for(p=c,c=e[r],i=0;i<a;++i)u.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&u.push(["index[",p,"]-=s",p].join("")),u.push(["++index[",c,"]"].join(""))),u.push("}")}return u.join("\n")}function o(e,t,n){for(var r=e.body,i=[],o=[],a=0;a<e.args.length;++a){var s=e.args[a];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),l="",c=t.arrayArgs.indexOf(a);switch(t.argTypes[a]){case"offset":var p=t.offsetArgIndex.indexOf(a);c=t.offsetArgs[p].array,l="+q"+p;case"array":l="p"+c+l;var h="l"+a,f="a"+c;if(0===t.arrayBlockIndices[c])1===s.count?"generic"===n[c]?s.lvalue?(i.push(["var ",h,"=",f,".get(",l,")"].join("")),r=r.replace(u,h),o.push([f,".set(",l,",",h,")"].join(""))):r=r.replace(u,[f,".get(",l,")"].join("")):r=r.replace(u,[f,"[",l,"]"].join("")):"generic"===n[c]?(i.push(["var ",h,"=",f,".get(",l,")"].join("")),r=r.replace(u,h),s.lvalue&&o.push([f,".set(",l,",",h,")"].join(""))):(i.push(["var ",h,"=",f,"[",l,"]"].join("")),r=r.replace(u,h),s.lvalue&&o.push([f,"[",l,"]=",h].join("")));else{for(var d=[s.name],m=[l],y=0;y<Math.abs(t.arrayBlockIndices[c]);y++)d.push("\\s*\\[([^\\]]+)\\]"),m.push("$"+(y+1)+"*t"+c+"b"+y);if(u=new RegExp(d.join(""),"g"),l=m.join("+"),"generic"===n[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[f,"[",l,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+t.scalarArgs.indexOf(a));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[i.join("\n"),r,o.join("\n")].join("\n").trim()}function a(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var i=e[r],o=i.match(/\d+/);o=o?o[0]:"",0===i.charAt(0)?t[r]="u"+i.charAt(1)+o:t[r]=i.charAt(0)+o,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}t.exports=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,s=new Array(e.arrayArgs.length),u=new Array(e.arrayArgs.length),l=0;l<e.arrayArgs.length;++l)u[l]=t[2*l],s[l]=t[2*l+1];var c=[],p=[],h=[],f=[],d=[];for(l=0;l<e.arrayArgs.length;++l){e.arrayBlockIndices[l]<0?(h.push(0),f.push(n),c.push(n),p.push(n+e.arrayBlockIndices[l])):(h.push(e.arrayBlockIndices[l]),f.push(e.arrayBlockIndices[l]+n),c.push(0),p.push(e.arrayBlockIndices[l]));for(var m=[],y=0;y<s[l].length;y++)h[l]<=s[l][y]&&s[l][y]<f[l]&&m.push(s[l][y]-h[l]);d.push(m)}var g=["SS"],v=["'use strict'"],b=[];for(y=0;y<n;++y)b.push(["s",y,"=SS[",y,"]"].join(""));for(l=0;l<e.arrayArgs.length;++l){g.push("a"+l),g.push("t"+l),g.push("p"+l);for(y=0;y<n;++y)b.push(["t",l,"p",y,"=t",l,"[",h[l]+y,"]"].join(""));for(y=0;y<Math.abs(e.arrayBlockIndices[l]);++y)b.push(["t",l,"b",y,"=t",l,"[",c[l]+y,"]"].join(""))}for(l=0;l<e.scalarArgs.length;++l)g.push("Y"+l);if(e.shapeArgs.length>0&&b.push("shape=SS.slice(0)"),e.indexArgs.length>0){var _=new Array(n);for(l=0;l<n;++l)_[l]="0";b.push(["index=[",_.join(","),"]"].join(""))}for(l=0;l<e.offsetArgs.length;++l){var w=e.offsetArgs[l],S=[];for(y=0;y<w.offset.length;++y)0!==w.offset[y]&&(1===w.offset[y]?S.push(["t",w.array,"p",y].join("")):S.push([w.offset[y],"*t",w.array,"p",y].join("")));0===S.length?b.push("q"+l+"=0"):b.push(["q",l,"=",S.join("+")].join(""))}var x=r([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((b=b.concat(x)).length>0&&v.push("var "+b.join(",")),l=0;l<e.arrayArgs.length;++l)v.push("p"+l+"|=0");e.pre.body.length>3&&v.push(o(e.pre,e,u));var T=o(e.body,e,u),P=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(d);P<n?v.push(function(e,t,n,r){for(var o=t.length,a=n.arrayArgs.length,s=n.blockSize,u=n.indexArgs.length>0,l=[],c=0;c<a;++c)l.push(["var offset",c,"=p",c].join(""));for(c=e;c<o;++c)l.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),l.push(["if(j",c,"<",s,"){"].join("")),l.push(["s",t[c],"=j",c].join("")),l.push(["j",c,"=0"].join("")),l.push(["}else{s",t[c],"=",s].join("")),l.push(["j",c,"-=",s,"}"].join("")),u&&l.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<a;++c){for(var p=["offset"+c],h=e;h<o;++h)p.push(["j",h,"*t",c,"p",t[h]].join(""));l.push(["p",c,"=(",p.join("+"),")"].join(""))}for(l.push(i(t,n,r)),c=e;c<o;++c)l.push("}");return l.join("\n")}(P,d[0],e,T)):v.push(i(d[0],e,T)),e.post.body.length>3&&v.push(o(e.post,e,u)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+v.join("\n")+"\n----------");var N=[e.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",P,a(u)].join("");return new Function(["function ",N,"(",g.join(","),"){",v.join("\n"),"} return ",N].join(""))()}},{uniq:297}],252:[function(e,t,n){"use strict";var r=e("./compile.js");t.exports=function(e){var t=["'use strict'","var CACHED={}"],n=[],i=e.funcName+"_cwise_thunk";t.push(["return function ",i,"(",e.shimArgs.join(","),"){"].join(""));for(var o=[],a=[],s=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],u=[],l=[],c=0;c<e.arrayArgs.length;++c){var p=e.arrayArgs[c];n.push(["t",p,"=array",p,".dtype,","r",p,"=array",p,".order"].join("")),o.push("t"+p),o.push("r"+p),a.push("t"+p),a.push("r"+p+".join()"),s.push("array"+p+".data"),s.push("array"+p+".stride"),s.push("array"+p+".offset|0"),c>0&&(u.push("array"+e.arrayArgs[0]+".shape.length===array"+p+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+p+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)s.push("scalar"+e.scalarArgs[c]);return n.push(["type=[",a.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",s.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(r.bind(void 0,e))}},{"./compile.js":251}],253:[function(e,t,n){t.exports=e("cwise-compiler")},{"cwise-compiler":250}],254:[function(e,t,n){"use strict";function r(e,t,n){var i=0|e[n];if(i<=0)return[];var o,a=new Array(i);if(n===e.length-1)for(o=0;o<i;++o)a[o]=t;else for(o=0;o<i;++o)a[o]=r(e,t,n+1);return a}t.exports=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,t);break;case"object":if("number"==typeof e.length)return r(e,t,0)}return[]}},{}],255:[function(e,t,n){"use strict";function r(e){if(this.size=0|e,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(2*this.size),n=0;n<t.length;n+=2){const e=Math.PI*n/this.size;t[n]=Math.cos(e),t[n+1]=-Math.sin(e)}this.table=t;for(var r=0,i=1;this.size>i;i<<=1)r++;this._width=r%2==0?r-1:r,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var a=0;a<this._width;a+=2){var s=this._width-a-2;this._bitrev[o]|=(o>>>a&3)<<s}}this._out=null,this._data=null,this._inv=0}t.exports=r,r.prototype.fromComplexArray=function(e,t){for(var n=t||new Array(e.length>>>1),r=0;r<e.length;r+=2)n[r>>>1]=e[r];return n},r.prototype.createComplexArray=function(){const e=new Array(this._csize);for(var t=0;t<e.length;t++)e[t]=0;return e},r.prototype.toComplexArray=function(e,t){for(var n=t||this.createComplexArray(),r=0;r<n.length;r+=2)n[r]=e[r>>>1],n[r+1]=0;return n},r.prototype.completeSpectrum=function(e){for(var t=this._csize,n=t>>>1,r=2;r<n;r+=2)e[t-r]=e[r],e[t-r+1]=-e[r+1]},r.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null},r.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null},r.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var n=0;n<e.length;n++)e[n]/=this.size;this._out=null,this._data=null},r.prototype._transform4=function(){var e,t,n=this._out,r=this._csize,i=1<<this._width,o=r/i<<1,a=this._bitrev;if(4===o)for(e=0,t=0;e<r;e+=o,t++){const n=a[t];this._singleTransform2(e,n,i)}else for(e=0,t=0;e<r;e+=o,t++){const n=a[t];this._singleTransform4(e,n,i)}var s=this._inv?-1:1,u=this.table;for(i>>=2;i>=2;i>>=2){var l=(o=r/i<<1)>>>2;for(e=0;e<r;e+=o)for(var c=e+l,p=e,h=0;p<c;p+=2,h+=i){const e=p,t=e+l,r=t+l,i=r+l,o=n[e],a=n[e+1],c=n[t],f=n[t+1],d=n[r],m=n[r+1],y=n[i],g=n[i+1],v=o,b=a,_=u[h],w=s*u[h+1],S=c*_-f*w,x=c*w+f*_,T=u[2*h],P=s*u[2*h+1],N=d*T-m*P,A=d*P+m*T,k=u[3*h],E=s*u[3*h+1],O=y*k-g*E,I=y*E+g*k,M=v+N,C=b+A,R=v-N,z=b-A,D=S+O,L=x+I,F=s*(S-O),V=s*(x-I),q=M+D,j=C+L,B=M-D,U=C-L,G=R+V,W=z-F,H=R-V,Q=z+F;n[e]=q,n[e+1]=j,n[t]=G,n[t+1]=W,n[r]=B,n[r+1]=U,n[i]=H,n[i+1]=Q}}},r.prototype._singleTransform2=function(e,t,n){const r=this._out,i=this._data,o=i[t],a=i[t+1],s=i[t+n],u=i[t+n+1],l=o+s,c=a+u,p=o-s,h=a-u;r[e]=l,r[e+1]=c,r[e+2]=p,r[e+3]=h},r.prototype._singleTransform4=function(e,t,n){const r=this._out,i=this._data,o=this._inv?-1:1,a=2*n,s=3*n,u=i[t],l=i[t+1],c=i[t+n],p=i[t+n+1],h=i[t+a],f=i[t+a+1],d=i[t+s],m=i[t+s+1],y=u+h,g=l+f,v=u-h,b=l-f,_=c+d,w=p+m,S=o*(c-d),x=o*(p-m),T=y+_,P=g+w,N=v+x,A=b-S,k=y-_,E=g-w,O=v-x,I=b+S;r[e]=T,r[e+1]=P,r[e+2]=N,r[e+3]=A,r[e+4]=k,r[e+5]=E,r[e+6]=O,r[e+7]=I},r.prototype._realTransform4=function(){var e,t,n=this._out,r=this._csize,i=1<<this._width,o=r/i<<1,a=this._bitrev;if(4===o)for(e=0,t=0;e<r;e+=o,t++){const n=a[t];this._singleRealTransform2(e,n>>>1,i>>>1)}else for(e=0,t=0;e<r;e+=o,t++){const n=a[t];this._singleRealTransform4(e,n>>>1,i>>>1)}var s=this._inv?-1:1,u=this.table;for(i>>=2;i>=2;i>>=2){var l=(o=r/i<<1)>>>1,c=l>>>1,p=c>>>1;for(e=0;e<r;e+=o)for(var h=0,f=0;h<=p;h+=2,f+=i){var d=e+h,m=d+c,y=m+c,g=y+c,v=n[d],b=n[d+1],_=n[m],w=n[m+1],S=n[y],x=n[y+1],T=n[g],P=n[g+1],N=v,A=b,k=u[f],E=s*u[f+1],O=_*k-w*E,I=_*E+w*k,M=u[2*f],C=s*u[2*f+1],R=S*M-x*C,z=S*C+x*M,D=u[3*f],L=s*u[3*f+1],F=T*D-P*L,V=T*L+P*D,q=N+R,j=A+z,B=N-R,U=A-z,G=O+F,W=I+V,H=s*(O-F),Q=s*(I-V),K=q+G,$=j+W,X=B+Q,Y=U-H;if(n[d]=K,n[d+1]=$,n[m]=X,n[m+1]=Y,0!==h){if(h!==p){var J=B+-s*Q,Z=-U+-s*H,ee=q+-s*G,te=-j- -s*W,ne=e+c-h,re=e+l-h;n[ne]=J,n[ne+1]=Z,n[re]=ee,n[re+1]=te}}else{var ie=q-G,oe=j-W;n[y]=ie,n[y+1]=oe}}}},r.prototype._singleRealTransform2=function(e,t,n){const r=this._out,i=this._data,o=i[t],a=i[t+n],s=o+a,u=o-a;r[e]=s,r[e+1]=0,r[e+2]=u,r[e+3]=0},r.prototype._singleRealTransform4=function(e,t,n){const r=this._out,i=this._data,o=this._inv?-1:1,a=2*n,s=3*n,u=i[t],l=i[t+n],c=i[t+a],p=i[t+s],h=u+c,f=u-c,d=l+p,m=o*(l-p),y=h+d,g=f,v=-m,b=h-d,_=f,w=m;r[e]=y,r[e+1]=0,r[e+2]=g,r[e+3]=v,r[e+4]=b,r[e+5]=0,r[e+6]=_,r[e+7]=w}},{}],256:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=e[t+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+e[t+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+p>=1?h/u:h*Math.pow(2,1-p))*u>=2&&(a++,u/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(t*u-1)*Math.pow(2,i),a+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+f]=255&a,f+=d,a/=256,l-=8);e[n+f-d]|=128*m}},{}],257:[function(e,t,n){"use strict";t.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},{}],258:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],259:[function(e,t,n){var r,i;r=this,i=function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}));var r=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],i=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"],o={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(e,t,n){"use strict";t.b=function(e){return e.replace(/\u0000/g,"")},t.a=function(e,t){return 60/t.bpm*(e/t.PPQ)},t.c=function(e){return"number"==typeof e},n.d(t,"d",(function(){return r})),t.e=function(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]+(Math.floor(e/12)-1)},n.d(t,"f",(function(){return i}));var r=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;return function(t){return function(e){return"string"==typeof e}(t)&&e.test(t)}}(),i=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],o=r[2];return t[i.toLowerCase()]+12*(parseInt(o)+1)}}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(11),i=(n.n(r),n(10)),o=(n.n(i),n(1)),a=n(9),s=n(5),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.header={bpm:120,timeSignature:[4,4],PPQ:480},this.tracks=[]}return u(e,null,[{key:"fromJSON",value:function(t){var n=new e;return n.header=t.header,t.tracks.forEach((function(e){var t=a.a.fromJSON(e);n.tracks.push(t)})),n}}]),u(e,[{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise((function(i,o){var a=new XMLHttpRequest;a.open(r,e),a.responseType="arraybuffer",a.addEventListener("load",(function(){4===a.readyState&&200===a.status?i(t.decode(a.response)):o(a.status)})),a.addEventListener("error",o),a.send(n)})).catch((function(e){console.log(e)}))}},{key:"decode",value:function(e){var t=this;if(e instanceof ArrayBuffer){var i=new Uint8Array(e);e=String.fromCharCode.apply(null,i)}var u=r(e);return this.header=n.i(s.a)(u),this.tracks=[],u.tracks.forEach((function(e,n){var r=new a.a;r.id=n,t.tracks.push(r);var i=0;e.forEach((function(e){i+=o.a(e.deltaTime,t.header),"meta"===e.type&&"trackName"===e.subtype?r.name=o.b(e.text):"noteOn"===e.subtype?(r.noteOn(e.noteNumber,i,e.velocity/127),-1===r.channelNumber&&(r.channelNumber=e.channel)):"noteOff"===e.subtype?r.noteOff(e.noteNumber,i):"controller"===e.subtype&&e.controllerType?r.cc(e.controllerType,i,e.value/127):"meta"===e.type&&"instrumentName"===e.subtype?r.instrument=e.text:"channel"===e.type&&"programChange"===e.subtype&&(r.patch(e.programNumber),r.channelNumber=e.channel)})),t.header.name||r.length||!r.name||(t.header.name=r.name)})),this}},{key:"encode",value:function(){var e=this,t=new i.File({ticks:this.header.PPQ}),n=this.tracks.filter((function(e){return!e.length}))[0];return!this.header.name||n&&n.name===this.header.name||t.addTrack().addEvent(new i.MetaEvent({time:0,type:i.MetaEvent.TRACK_NAME,data:this.header.name})),this.tracks.forEach((function(n){var r=t.addTrack();r.setTempo(e.bpm),n.name&&r.addEvent(new i.MetaEvent({time:0,type:i.MetaEvent.TRACK_NAME,data:n.name})),n.encode(r,e.header)})),t.toBytes()}},{key:"toArray",value:function(){for(var e=this.encode(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}},{key:"toJSON",value:function(){var e={header:this.header,startTime:this.startTime,duration:this.duration,tracks:(this.tracks||[]).map((function(e){return e.toJSON()}))};return e.header.name||(e.header.name=""),e}},{key:"track",value:function(e){var t=new a.a(e);return this.tracks.push(t),t}},{key:"get",value:function(e){return o.c(e)?this.tracks[e]:this.tracks.find((function(t){return t.name===e}))}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=new e;return r.header=this.header,r.tracks=this.tracks.map((function(e){return e.slice(t,n)})),r}},{key:"startTime",get:function(){var e=this.tracks.map((function(e){return e.startTime}));return e.length&&Math.min.apply(Math,e)||0}},{key:"bpm",get:function(){return this.header.bpm},set:function(e){var t=this.header.bpm;this.header.bpm=e;var n=t/e;this.tracks.forEach((function(e){return e.scale(n)}))}},{key:"timeSignature",get:function(){return this.header.timeSignature},set:function(e){this.header.timeSignature=e}},{key:"duration",get:function(){var e=this.tracks.map((function(e){return e.duration}));return e.length&&Math.max.apply(Math,e)||0}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(e.length){var n=function(e,t){var n=0,r=e.length,i=r;if(r>0&&e[r-1].time<=t)return r-1;for(;n<i;){var o=Math.floor(n+(i-n)/2),a=e[o],s=e[o+1];if(a.time===t){for(var u=o;u<e.length;u++)e[u].time===t&&(o=u);return o}if(a.time<t&&s.time>t)return o;a.time>t?i=o:a.time<t&&(n=o+1)}return-1}(e,t.time);e.splice(n+1,0,t)}else e.push(t)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"},o=function(){function e(t,n,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.number=t,this.time=n,this.value=r}return r(e,[{key:"name",get:function(){if(i.hasOwnProperty(this.number))return i[this.number]}}]),e}()},function(e,t,n){"use strict";function r(e){for(var t={PPQ:e.header.ticksPerBeat},n=0;n<e.tracks.length;n++)for(var r=e.tracks[n],i=0;i<r.length;i++){var o=r[i];"meta"===o.type&&("timeSignature"===o.subtype?t.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(t.bpm||(t.bpm=6e7/o.microsecondsPerBeat)))}return t.bpm=t.bpm||120,t}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.length>i)return!0}return!1}function i(e,t,n){for(var r=0,i=1/0,o=0;o<e.length;o++){var a=e[o],s=t[o];a[s]&&a[s].time<i&&(r=o,i=a[s].time)}n[r](e[r][t[r]]),t[r]+=1}function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o=t.filter((function(e,t){return t%2==0})),a=new Uint32Array(o.length),s=t.filter((function(e,t){return t%2==1}));r(o,a);)i(o,a,s)}n.d(t,"a",(function(){return o}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return(new r.a).decode(e)},t.load=function(e,t){var n=(new r.a).load(e);return t&&n.then(t),n},t.create=function(){return new r.a},t.fromJSON=function(e){return r.a.fromJSON(e)};var r=n(2),i=n(0);n.d(t,"instrumentByPatchID",(function(){return i.a})),n.d(t,"instrumentFamilyByID",(function(){return i.b})),n.d(t,"drumKitByPatchID",(function(){return i.c}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r.c(t))this.midi=t;else{if(!r.d(t))throw new Error("the midi value must either be in Pitch Notation (e.g. C#4) or a midi value");this.name=t}this.time=n,this.duration=i,this.velocity=o}return i(e,null,[{key:"fromJSON",value:function(t){return new e(t.midi,t.time,t.duration,t.velocity)}}]),i(e,[{key:"match",value:function(e){return r.c(e)?this.midi===e:r.d(e)?this.name.toLowerCase()===e.toLowerCase():void 0}},{key:"toJSON",value:function(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration}}},{key:"name",get:function(){return r.e(this.midi)},set:function(e){this.midi=r.f(e)}},{key:"noteOn",get:function(){return this.time},set:function(e){this.time=e}},{key:"noteOff",get:function(){return this.time+this.duration},set:function(e){this.duration=e-this.time}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),i=n(4),o=n(6),a=n(8),s=n(0),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name=t,this.channelNumber=r,this.notes=[],this.controlChanges={},this.instrumentNumber=n}return u(e,null,[{key:"fromJSON",value:function(t){var n=new e(t.name,t.instrumentNumber,t.channelNumber);return n.id=t.id,t.notes&&t.notes.forEach((function(e){var t=a.a.fromJSON(e);n.notes.push(t)})),t.controlChanges&&(n.controlChanges=t.controlChanges),n}}]),u(e,[{key:"note",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=new a.a(e,t,i,o);return n.i(r.a)(this.notes,s),this}},{key:"noteOn",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=new a.a(e,t,0,i);return n.i(r.a)(this.notes,o),this}},{key:"noteOff",value:function(e,t){for(var n=0;n<this.notes.length;n++){var r=this.notes[n];if(r.match(e)&&0===r.duration){r.noteOff=t;break}}return this}},{key:"cc",value:function(e,t,o){this.controlChanges.hasOwnProperty(e)||(this.controlChanges[e]=[]);var a=new i.a(e,t,o);return n.i(r.a)(this.controlChanges[e],a),this}},{key:"patch",value:function(e){return this.instrumentNumber=e,this}},{key:"channel",value:function(e){return this.channelNumber=e,this}},{key:"scale",value:function(e){return this.notes.forEach((function(t){t.time*=e,t.duration*=e})),this}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=Math.max(this.notes.findIndex((function(e){return e.time>=t})),0),i=this.notes.findIndex((function(e){return e.noteOff>=n}))+1,o=new e(this.name);return o.notes=this.notes.slice(r,i),o.notes.forEach((function(e){return e.time=e.time-t})),o}},{key:"encode",value:function(e,t){function r(e){var t=Math.floor(i*e),n=Math.max(t-a,0);return a=t,n}var i=t.PPQ/(60/t.bpm),a=0,s=Math.max(0,this.channelNumber);-1!==this.instrumentNumber&&e.instrument(s,this.instrumentNumber),n.i(o.a)(this.noteOns.sort((function(e,t){return e.time-t.time})),(function(t){e.addNoteOn(s,t.name,r(t.time),Math.floor(127*t.velocity))}),this.noteOffs.sort((function(e,t){return e.time-t.time})),(function(t){e.addNoteOff(s,t.name,r(t.time))}))}},{key:"toJSON",value:function(){var e={startTime:this.startTime,duration:this.duration,length:this.length,notes:[],controlChanges:{}};return void 0!==this.id&&(e.id=this.id),e.name=this.name,-1!==this.instrumentNumber&&(e.instrumentNumber=this.instrumentNumber,e.instrument=this.instrument,e.instrumentFamily=this.instrumentFamily),-1!==this.channelNumber&&(e.channelNumber=this.channelNumber,e.isPercussion=this.isPercussion),this.notes.length&&(e.notes=this.notes.map((function(e){return e.toJSON()}))),Object.keys(this.controlChanges).length&&(e.controlChanges=this.controlChanges),e}},{key:"noteOns",get:function(){var e=[];return this.notes.forEach((function(t){e.push({time:t.noteOn,midi:t.midi,name:t.name,velocity:t.velocity})})),e}},{key:"noteOffs",get:function(){var e=[];return this.notes.forEach((function(t){e.push({time:t.noteOff,midi:t.midi,name:t.name})})),e}},{key:"length",get:function(){return this.notes.length}},{key:"startTime",get:function(){return this.notes.length?this.notes[0].noteOn:0}},{key:"duration",get:function(){return this.notes.length?this.notes[this.notes.length-1].noteOff:0}},{key:"instrument",get:function(){return this.isPercussion?s.c[this.instrumentNumber]:s.a[this.instrumentNumber]},set:function(e){var t=s.a.indexOf(e);-1!==t&&(this.instrumentNumber=t)}},{key:"isPercussion",get:function(){return[9,10].includes(this.channelNumber)}},{key:"instrumentFamily",get:function(){return this.isPercussion?"drums":s.b[Math.floor(this.instrumentNumber/8)]}}]),e}()},function(e,t,n){(function(e){var n={};!function(e){var t=e.DEFAULT_VOLUME=90,n=(e.DEFAULT_DURATION=128,e.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(e){var t=/([a-g])(#+|b+)?([0-9]+)$/i.exec(e),r=t[1].toLowerCase(),i=t[2]||"";return 12*parseInt(t[3],10)+n.midi_letter_pitches[r]+("#"==i.substr(0,1)?1:-1)*i.length},ensureMidiPitch:function(e){return"number"!=typeof e&&/[^0-9]/.test(e)?n.midiPitchFromNote(e):parseInt(e,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(e,t){var r,i=0,o=e;return t=t||!1,e>23&&(o=e-12*(i=Math.floor(e/12)-1)),r=n.midi_pitches_letter[o],t&&r.indexOf("#")>0&&(r=n.midi_flattened_notes[r]),r+i},mpqnFromBpm:function(e){var t=Math.floor(6e7/e),n=[];do{n.unshift(255&t),t>>=8}while(t);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(e){if(void 0!==e[0])for(var t=0,n=e.length-1;n>=0;++t,--n)e[t];return Math.floor(6e7/e)},codes2Str:function(e){return String.fromCharCode.apply(null,e)},str2Bytes:function(e,t){if(t)for(;e.length/2<t;)e="0"+e;for(var n=[],r=e.length-1;r>=0;r-=2){var i=0===r?e[r]:e[r-1]+e[r];n.unshift(parseInt(i,16))}return n},translateTickTime:function(e){for(var t=127&e;e>>=7;)t<<=8,t|=127&e|128;for(var n=[];n.push(255&t),128&t;)t>>=8;return n}}),r=function(e){if(!this)return new r(e);!e||null===e.type&&void 0===e.type||null===e.channel&&void 0===e.channel||null===e.param1&&void 0===e.param1||(this.setTime(e.time),this.setType(e.type),this.setChannel(e.channel),this.setParam1(e.param1),this.setParam2(e.param2))};r.NOTE_OFF=128,r.NOTE_ON=144,r.AFTER_TOUCH=160,r.CONTROLLER=176,r.PROGRAM_CHANGE=192,r.CHANNEL_AFTERTOUCH=208,r.PITCH_BEND=224,r.prototype.setTime=function(e){this.time=n.translateTickTime(e||0)},r.prototype.setType=function(e){if(e<r.NOTE_OFF||e>r.PITCH_BEND)throw new Error("Trying to set an unknown event: "+e);this.type=e},r.prototype.setChannel=function(e){if(e<0||e>15)throw new Error("Channel is out of bounds.");this.channel=e},r.prototype.setParam1=function(e){this.param1=e},r.prototype.setParam2=function(e){this.param2=e},r.prototype.toBytes=function(){var e=[],t=this.type|15&this.channel;return e.push.apply(e,this.time),e.push(t),e.push(this.param1),void 0!==this.param2&&null!==this.param2&&e.push(this.param2),e};var i=function(e){if(!this)return new i(e);this.setTime(e.time),this.setType(e.type),this.setData(e.data)};i.SEQUENCE=0,i.TEXT=1,i.COPYRIGHT=2,i.TRACK_NAME=3,i.INSTRUMENT=4,i.LYRIC=5,i.MARKER=6,i.CUE_POINT=7,i.CHANNEL_PREFIX=32,i.END_OF_TRACK=47,i.TEMPO=81,i.SMPTE=84,i.TIME_SIG=88,i.KEY_SIG=89,i.SEQ_EVENT=127,i.prototype.setTime=function(e){this.time=n.translateTickTime(e||0)},i.prototype.setType=function(e){this.type=e},i.prototype.setData=function(e){this.data=e},i.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var e=[];if(e.push.apply(e,this.time),e.push(255,this.type),Array.isArray(this.data))e.push(this.data.length),e.push.apply(e,this.data);else if("number"==typeof this.data)e.push(1,this.data);else if(null!==this.data&&void 0!==this.data){e.push(this.data.length);var t=this.data.split("").map((function(e){return e.charCodeAt(0)}));e.push.apply(e,t)}else e.push(0);return e};var o=function(e){if(!this)return new o(e);var t=e||{};this.events=t.events||[]};o.START_BYTES=[77,84,114,107],o.END_BYTES=[0,255,47,0],o.prototype.addEvent=function(e){return this.events.push(e),this},o.prototype.addNoteOn=o.prototype.noteOn=function(e,i,o,a){return this.events.push(new r({type:r.NOTE_ON,channel:e,param1:n.ensureMidiPitch(i),param2:a||t,time:o||0})),this},o.prototype.addNoteOff=o.prototype.noteOff=function(e,i,o,a){return this.events.push(new r({type:r.NOTE_OFF,channel:e,param1:n.ensureMidiPitch(i),param2:a||t,time:o||0})),this},o.prototype.addNote=o.prototype.note=function(e,t,n,r,i){return this.noteOn(e,t,r,i),n&&this.noteOff(e,t,n,i),this},o.prototype.addChord=o.prototype.chord=function(e,t,n,r){if(!Array.isArray(t)&&!t.length)throw new Error("Chord must be an array of pitches");return t.forEach((function(t){this.noteOn(e,t,0,r)}),this),t.forEach((function(t,r){0===r?this.noteOff(e,t,n):this.noteOff(e,t)}),this),this},o.prototype.setInstrument=o.prototype.instrument=function(e,t,n){return this.events.push(new r({type:r.PROGRAM_CHANGE,channel:e,param1:t,time:n||0})),this},o.prototype.setTempo=o.prototype.tempo=function(e,t){return this.events.push(new i({type:i.TEMPO,data:n.mpqnFromBpm(e),time:t||0})),this},o.prototype.toBytes=function(){var e=0,t=[],r=o.START_BYTES,i=o.END_BYTES;this.events.forEach((function(n){var r=n.toBytes();e+=r.length,t.push.apply(t,r)})),e+=i.length;var a=n.str2Bytes(e.toString(16),4);return r.concat(a,t,i)};var a=function(e){if(!this)return new a(e);var t=e||{};if(t.ticks){if("number"!=typeof t.ticks)throw new Error("Ticks per beat must be a number!");if(t.ticks<=0||t.ticks>=32768||t.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=t.ticks||128,this.tracks=t.tracks||[]};a.HDR_CHUNKID="MThd",a.HDR_CHUNK_SIZE="\0\0\0",a.HDR_TYPE0="\0\0",a.HDR_TYPE1="\0",a.prototype.addTrack=function(e){return e?(this.tracks.push(e),this):(e=new o,this.tracks.push(e),e)},a.prototype.toBytes=function(){var e=this.tracks.length.toString(16),t=a.HDR_CHUNKID+a.HDR_CHUNK_SIZE;return parseInt(e,16)>1?t+=a.HDR_TYPE1:t+=a.HDR_TYPE0,t+=n.codes2Str(n.str2Bytes(e,2)),t+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach((function(e){t+=n.codes2Str(e.toBytes())})),t},e.Util=n,e.File=a,e.Track=o,e.Event=r,e.MetaEvent=i}(n),null!=e?e.exports=n:null!=t?t=n:this.Midi=n}).call(t,n(12)(e))},function(e,t){function n(e){function t(t){var r=e.charCodeAt(n);return t&&r>127&&(r-=256),n+=1,r}var n=0;return{eof:function(){return n>=e.length},read:function(t){var r=e.substr(n,t);return n+=t,r},readInt32:function(){var t=(e.charCodeAt(n)<<24)+(e.charCodeAt(n+1)<<16)+(e.charCodeAt(n+2)<<8)+e.charCodeAt(n+3);return n+=4,t},readInt16:function(){var t=(e.charCodeAt(n)<<8)+e.charCodeAt(n+1);return n+=2,t},readInt8:t,readVarInt:function(){for(var e=0;;){var n=t();if(!(128&n))return e+n;e+=127&n,e<<=7}}}}e.exports=function(e){return function(e){function t(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}var r;stream=n(e);var i=t(stream);if("MThd"!=i.id||6!=i.length)throw"Bad .mid file - header not found";var o=n(i.data),a=o.readInt16(),s=o.readInt16(),u=o.readInt16();if(32768&u)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=u;for(var l={formatType:a,trackCount:s,ticksPerBeat:ticksPerBeat},c=[],p=0;p<l.trackCount;p++){c[p]=[];var h=t(stream);if("MTrk"!=h.id)throw"Unexpected chunk - expected MTrk, got "+h.id;for(var f=n(h.data);!f.eof();){var d=function(e){var t={};t.deltaTime=e.readVarInt();var n,i=e.readInt8();if(240==(240&i)){if(255==i){t.type="meta";var o=e.readInt8(),a=e.readVarInt();switch(o){case 0:if(t.subtype="sequenceNumber",2!=a)throw"Expected length for sequenceNumber event is 2, got "+a;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(a),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(a),t;case 3:return t.subtype="trackName",t.text=e.read(a),t;case 4:return t.subtype="instrumentName",t.text=e.read(a),t;case 5:return t.subtype="lyrics",t.text=e.read(a),t;case 6:return t.subtype="marker",t.text=e.read(a),t;case 7:return t.subtype="cuePoint",t.text=e.read(a),t;case 32:if(t.subtype="midiChannelPrefix",1!=a)throw"Expected length for midiChannelPrefix event is 1, got "+a;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!=a)throw"Expected length for endOfTrack event is 0, got "+a;return t;case 81:if(t.subtype="setTempo",3!=a)throw"Expected length for setTempo event is 3, got "+a;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!=a)throw"Expected length for smpteOffset event is 5, got "+a;var s=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&s],t.hour=31&s,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!=a)throw"Expected length for timeSignature event is 4, got "+a;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!=a)throw"Expected length for keySignature event is 2, got "+a;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(a),t;default:return t.subtype="unknown",t.data=e.read(a),t}return t.data=e.read(a),t}if(240==i)return t.type="sysEx",a=e.readVarInt(),t.data=e.read(a),t;if(247==i)return t.type="dividedSysEx",a=e.readVarInt(),t.data=e.read(a),t;throw"Unrecognised MIDI event type byte: "+i}0==(128&i)?(n=i,i=r):(n=e.readInt8(),r=i);var u=i>>4;switch(t.channel=15&i,t.type="channel",u){case 8:return t.subtype="noteOff",t.noteNumber=n,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=n,t.velocity=e.readInt8(),0==t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=n,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=n,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=n,t;case 13:return t.subtype="channelAftertouch",t.amount=n,t;case 14:return t.subtype="pitchBend",t.value=n+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+u}}(f);c[p].push(d)}}return{header:l,tracks:c}}(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])},"object"==typeof n&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof n?n.MidiConvert=i():r.MidiConvert=i()},{}],260:[function(e,t,n){"use strict";var r=e("ndarray-ops"),i=e("ndarray"),o=e("typedarray-pool"),a=e("./lib/fft-matrix.js");t.exports=function(e,t,n){var s,u,l=t.shape,c=l.length,p=1,h=new Array(c),f=0;for(s=c-1;s>=0;--s)if(h[s]=p,p*=l[s],f=Math.max(f,a.scratchMemory(l[s])),t.shape[s]!==n.shape[s])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var d,m=4*p+f;d="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?o.mallocDouble(m):o.mallocFloat(m);var y,g,v,b,_=i(d,l.slice(0),h,0),w=i(d,l.slice(0),h.slice(0),p),S=i(d,l.slice(0),h.slice(0),2*p),x=i(d,l.slice(0),h.slice(0),3*p),T=4*p;for(r.assign(_,t),r.assign(w,n),s=c-1;s>=0&&(a(e,p/l[s],l[s],d,_.offset,w.offset,T),0!==s);--s){for(g=1,v=S.stride,b=x.stride,u=s-1;u<c;++u)b[u]=v[u]=g,g*=l[u];for(u=s-2;u>=0;--u)b[u]=v[u]=g,g*=l[u];r.assign(S,_),r.assign(x,w),y=_,_=S,S=y,y=w,w=x,x=y}r.assign(t,_),r.assign(n,w),o.free(d)}},{"./lib/fft-matrix.js":261,ndarray:265,"ndarray-ops":262,"typedarray-pool":296}],261:[function(e,t,n){var r=e("bit-twiddle");function i(e,t,n,i,o,a){var s,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,N,A,k,E,O;for(e|=0,t|=0,o|=0,a|=0,s=n|=0,u=r.log2(s),T=0;T<t;++T){for(f=s>>1,p=0,l=0;l<s-1;l++){for(l<p&&(b=i[o+l],i[o+l]=i[o+p],i[o+p]=b,b=i[a+l],i[a+l]=i[a+p],i[a+p]=b),h=f;h<=p;)p-=h,h>>=1;p+=h}for(g=-1,v=0,y=1,d=0;d<u;d++){for(m=y,y<<=1,S=1,x=0,p=0;p<m;p++){for(l=p;l<s;l+=y)P=i[o+(c=l+m)],N=i[a+c],A=i[o+l],k=i[a+l],_=(E=S*(P+N))-N*(S+x),w=E+(O=P*(x-S)),i[o+c]=A-_,i[a+c]=k-w,i[o+l]+=_,i[a+l]+=w;O=S*(v-g),S=(E=g*(S+x))-x*(g+v),x=E+O}v=Math.sqrt((1-g)/2),e<0&&(v=-v),g=Math.sqrt((1+g)/2)}if(e<0){var I=1/s;for(l=0;l<s;l++)i[o+l]*=I,i[a+l]*=I}o+=n,a+=n}}t.exports=function(e,t,n,o,a,s,u){e|=0,t|=0,n|=0,a|=0,s|=0,r.isPow2(n)?i(e,t,n,o,a,s):function(e,t,n,o,a,s,u){e|=0,t|=0,n|=0,a|=0,s|=0,u|=0;var l,c,p,h,f,d,m,y,g,v=r.nextPow2(2*n+1),b=u,_=b+n,w=_+n,S=w+v,x=S+v,T=x+v,P=-e*Math.PI/n;for(g=0;g<n;++g)c=P*(g*g%(2*n)),h=Math.cos(c),f=Math.sin(c),o[x+(v-g)]=o[x+g]=o[b+g]=h,o[T+(v-g)]=o[T+g]=o[_+g]=f;for(g=n;g<=v-n;++g)o[x+g]=0;for(g=n;g<=v-n;++g)o[T+g]=0;i(1,1,v,o,x,T),P=e<0?1/n:1;for(l=0;l<t;++l){for(g=0;g<n;++g)c=o[a+g],p=o[s+g],d=(h=o[b+g])*(c+p),m=c*((f=-o[_+g])-h),y=p*(h+f),o[w+g]=d-y,o[S+g]=d+m;for(g=n;g<v;++g)o[w+g]=0;for(g=n;g<v;++g)o[S+g]=0;for(i(1,1,v,o,w,S),g=0;g<v;++g)c=o[w+g],p=o[S+g],d=(h=o[x+g])*(c+p),m=c*((f=o[T+g])-h),y=p*(h+f),o[w+g]=d-y,o[S+g]=d+m;for(i(-1,1,v,o,w,S),g=0;g<n;++g)c=o[w+g],p=o[S+g],d=(h=o[b+g])*(c+p),m=c*((f=-o[_+g])-h),y=p*(h+f),o[a+g]=P*(d-y),o[s+g]=P*(d+m);a+=n,s+=n}}(e,t,n,o,a,s,u)},t.exports.scratchMemory=function(e){return r.isPow2(e)?0:2*e+4*r.nextPow2(2*e+1)}},{"bit-twiddle":247}],262:[function(e,t,n){"use strict";var r=e("cwise-compiler"),i={body:"",args:[],thisVars:[],localVars:[]};function o(e){if(!e)return i;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function a(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return r({args:e.args,pre:o(e.pre),body:o(e.body),post:o(e.proc),funcName:e.funcName})}(e))}var s={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in s){var t=s[e];n[e]=a({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e}),n[e+"eq"]=a({args:["array","array"],body:{args:["a","b"],body:"a"+t+"=b"},rvalue:!0,funcName:e+"eq"}),n[e+"s"]=a({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"}),n[e+"seq"]=a({args:["array","scalar"],body:{args:["a","s"],body:"a"+t+"=s"},rvalue:!0,funcName:e+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in u){var t=u[e];n[e]=a({args:["array","array"],body:{args:["a","b"],body:"a="+t+"b"},funcName:e}),n[e+"eq"]=a({args:["array"],body:{args:["a"],body:"a="+t+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in l){var t=l[e];n[e]=a({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e}),n[e+"s"]=a({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"}),n[e+"eq"]=a({args:["array","array"],body:{args:["a","b"],body:"a=a"+t+"b"},rvalue:!0,count:2,funcName:e+"eq"}),n[e+"seq"]=a({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+t+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<c.length;++e){var t=c[e];n[t]=a({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:t}),n[t+"eq"]=a({args:["array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"})}}();var p=["max","min","atan2","pow"];!function(){for(var e=0;e<p.length;++e){var t=p[e];n[t]=a({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t}),n[t+"s"]=a({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t+"s"}),n[t+"eq"]=a({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"}),n[t+"seq"]=a({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"seq"})}}();var h=["atan2","pow"];!function(){for(var e=0;e<h.length;++e){var t=h[e];n[t+"op"]=a({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"op"}),n[t+"ops"]=a({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"ops"}),n[t+"opeq"]=a({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opeq"}),n[t+"opseq"]=a({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opseq"})}}(),n.any=r({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),n.all=r({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),n.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),n.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),n.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),n.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),n.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),n.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),n.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),n.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),n.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),n.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),n.random=a({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),n.assign=a({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),n.assigns=a({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),n.equals=r({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":250}],263:[function(e,t,n){"use strict";var r=e("ndarray-fft"),i=e("ndarray-scratch"),o=e("ndarray-ops"),a=e("cwise/lib/wrapper")({args:["array","array","scalar","scalar","scalar"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{var _inline_1_f=_inline_1_arg1_*_inline_1_arg2_;_inline_1_f<_inline_1_arg3_&&(_inline_1_f=_inline_1_arg3_),_inline_1_f>_inline_1_arg4_&&(_inline_1_f=_inline_1_arg4_),_inline_1_arg0_=_inline_1_f}",args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg3_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg4_",lvalue:!1,rvalue:!0,count:2}],thisVars:[],localVars:["_inline_1_f"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},debug:!1,funcName:"clampScale",blockSize:64});t.exports=function(e,t,n,s){void 0===n&&(n=-1/0),void 0===s&&(s=1/0);var u=t.shape,l=e.shape;if(t.shape.length!==e.shape.length)throw new Error("ndarray-resample: input and output arrays should have the same dimensions");var c,p=u.map((function(){return 0}));if(1===e.size)return(c=o.sum(t)/t.size)<n&&(c=n),c>s&&(c=s),void e.set.apply(e,p.concat(c));if(1===t.size)return(c=t.get.apply(t,p))<n&&(c=n),c>s&&(c=s),void o.assigns(e,c);for(var h=u.length,f=new Array(h),d=!1,m=0;m<h;m++)f[m]=Math.min(l[m],u[m]),l[m]>u[m]&&(d=!0);var y=i.malloc(u),g=i.malloc(u);o.assign(y,t),o.assigns(g,0),r(1,y,g);var v=y.lo,b=y.hi,_=i.malloc(l),w=i.malloc(l);d&&(o.assigns(_,0),o.assigns(w,0));var S=new Array(h),x=new Array(h),T=new Array(h),P=new Array(h);for(m=0;m<1<<h;++m){for(var N=0;N<h;++N)if(m&1<<N){if(S[N]=f[N]-(f[N]+1>>>1),0===S[N])continue;x[N]=l[N]-S[N],T[N]=u[N]-S[N],P[N]=1&f[N]?0:1}else S[N]=f[N]+1>>>1,x[N]=0,T[N]=0,P[N]=0;o.assign(b.apply(v.apply(_,x),S),b.apply(v.apply(y,T),S)),o.assign(v.apply(b.apply(v.apply(w,x),S),P),v.apply(b.apply(v.apply(g,T),S),P)),o.assigns(b.apply(b.apply(v.apply(w,x),S),P),0)}r(-1,_,w),a(e,_,e.size/t.size,n,s),i.free(y),i.free(g),i.free(_),i.free(w)}},{"cwise/lib/wrapper":253,"ndarray-fft":260,"ndarray-ops":262,"ndarray-scratch":264}],264:[function(e,t,n){"use strict";var r=e("ndarray"),i=e("ndarray-ops"),o=e("typedarray-pool");n.clone=function(e){var t=e.dtype;"generic"!==t&&"array"!==t||(t="double");var n=o.malloc(e.size,t),a=r(n,e.shape);return i.assign(a,e),a},n.malloc=function(e,t){t||(t="double");for(var n=1,i=new Array(e.length),a=e.length-1;a>=0;--a)i[a]=n,n*=e[a];return r(o.malloc(n,t),e,i,0)},n.free=function(e){"generic"!==e.dtype&&"array"!==e.dtype&&o.free(e.data)},n.zeros=function(e,t){t||(t="double");for(var n=1,i=new Array(e.length),a=e.length-1;a>=0;--a)i[a]=n,n*=e[a];var s=o.malloc(n,t);for(a=0;a<n;++a)s[a]=0;return r(s,e,i,0)},n.ones=function(e,t){t||(t="double");for(var n=1,i=new Array(e.length),a=e.length-1;a>=0;--a)i[a]=n,n*=e[a];var s=o.malloc(n,t);for(a=0;a<n;++a)s[a]=1;return r(s,e,i,0)},n.eye=function(e,t){var n,i;t||(t="double");var a=1,s=new Array(e.length);for(n=e.length-1;n>=0;--n)s[n]=a,a*=e[n];var u=o.malloc(a,t);for(n=0;n<a;++n)u[n]=0;var l=1/0,c=0;for(n=e.length-1;n>=0;n--)c+=s[n],l=Math.min(l,e[n]);for(n=0,i=0;n<l;n++,i+=c)u[i]=1;return r(u,e,s,0)}},{ndarray:265,"ndarray-ops":262,"typedarray-pool":296}],265:[function(e,t,n){var r=e("iota-array"),i=e("is-buffer"),o="undefined"!=typeof Float64Array;function a(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(a);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function u(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var i="generic"===e;if(-1===t){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===t){o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",o)(l[e][0])}o=["'use strict'"];var a=r(t),u=a.map((function(e){return"i"+e})),c="this.offset+"+a.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),p=a.map((function(e){return"b"+e})).join(","),h=a.map((function(e){return"c"+e})).join(",");o.push("function "+n+"(a,"+p+","+h+",d){this.data=a","this.shape=["+p+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+a.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push("function "+n+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),i?o.push("return this.data.set("+c+",v)}"):o.push("return this.data["+c+"]=v}"),o.push("proto.get=function "+n+"_get("+u.join(",")+"){"),i?o.push("return this.data.get("+c+")}"):o.push("return this.data["+c+"]}"),o.push("proto.index=function "+n+"_index(",u.join(),"){return "+c+"}"),o.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+a.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+a.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var f=a.map((function(e){return"a"+e+"=this.shape["+e+"]"})),d=a.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+d.join(","));for(var m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");o.push("return new "+n+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+a.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+a.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");o.push("return new "+n+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"b"+e})).join(",")+",c)}");var y=new Array(t),g=new Array(t);for(m=0;m<t;++m)y[m]="a[i"+m+"]",g[m]="b[i"+m+"]";o.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+y.join(",")+","+g.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset");for(m=0;m<t;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+a.map((function(e){return"shape["+e+"]"})).join(",")+","+a.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(l[e],s)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};t.exports=function(e,t,n,r){if(void 0===e)return(0,l.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var a=t.length;if(void 0===n){n=new Array(a);for(var s=a-1,c=1;s>=0;--s)n[s]=c,c*=t[s]}if(void 0===r){r=0;for(s=0;s<a;++s)n[s]<0&&(r-=(t[s]-1)*n[s])}for(var p=function(e){if(i(e))return"buffer";if(o)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(e)?"array":"generic"}(e),h=l[p];h.length<=a+1;)h.push(u(p,h.length-1));return(0,h[a+1])(e,t,n,r)}},{"iota-array":257,"is-buffer":258}],266:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],p=!1,h=-1;function f(){p&&l&&(p=!1,l.length?c=l.concat(c):h=-1,c.length&&d())}function d(){if(!p){var e=u(f);p=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,p=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||p||u(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],267:[function(e,t,n){arguments[4][48][0].apply(n,arguments)},{"./src/index-minimal":268,dup:48}],268:[function(e,t,n){"use strict";var r=n;function i(){r.Reader._configure(r.BufferReader),r.util._configure()}r.build="minimal",r.Writer=e("./writer"),r.BufferWriter=e("./writer_buffer"),r.Reader=e("./reader"),r.BufferReader=e("./reader_buffer"),r.util=e("./util/minimal"),r.rpc=e("./rpc"),r.roots=e("./roots"),r.configure=i,r.Writer._configure(r.BufferWriter),i()},{"./reader":269,"./reader_buffer":270,"./roots":271,"./rpc":272,"./util/minimal":275,"./writer":276,"./writer_buffer":277}],269:[function(e,t,n){"use strict";t.exports=u;var r,i=e("./util/minimal"),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function p(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;;){if(4==(e=7&this.uint32()))break;this.skipType(e)}break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},{"./util/minimal":275}],270:[function(e,t,n){arguments[4][51][0].apply(n,arguments)},{"./reader":269,"./util/minimal":275,dup:51}],271:[function(e,t,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],272:[function(e,t,n){arguments[4][53][0].apply(n,arguments)},{"./rpc/service":273,dup:53}],273:[function(e,t,n){arguments[4][54][0].apply(n,arguments)},{"../util/minimal":275,dup:54}],274:[function(e,t,n){arguments[4][55][0].apply(n,arguments)},{"../util/minimal":275,dup:55}],275:[function(e,t,n){(function(t){"use strict";var r=n;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=e("@protobufjs/aspromise"),r.base64=e("@protobufjs/base64"),r.EventEmitter=e("@protobufjs/eventemitter"),r.float=e("@protobufjs/float"),r.inquire=e("@protobufjs/inquire"),r.utf8=e("@protobufjs/utf8"),r.pool=e("@protobufjs/pool"),r.LongBits=e("./longbits"),r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isNode=Boolean(t.process&&t.process.versions&&t.process.versions.node),r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=t.dcodeIO&&t.dcodeIO.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./longbits":274,"@protobufjs/aspromise":1,"@protobufjs/base64":2,"@protobufjs/eventemitter":3,"@protobufjs/float":4,"@protobufjs/inquire":5,"@protobufjs/pool":6,"@protobufjs/utf8":7}],276:[function(e,t,n){arguments[4][57][0].apply(n,arguments)},{"./util/minimal":275,dup:57}],277:[function(e,t,n){arguments[4][58][0].apply(n,arguments)},{"./util/minimal":275,"./writer":276,dup:58}],278:[function(e,t,n){var r=e("./lib/alea"),i=e("./lib/xor128"),o=e("./lib/xorwow"),a=e("./lib/xorshift7"),s=e("./lib/xor4096"),u=e("./lib/tychei"),l=e("./seedrandom");l.alea=r,l.xor128=i,l.xorwow=o,l.xorshift7=a,l.xor4096=s,l.tychei=u,t.exports=l},{"./lib/alea":279,"./lib/tychei":280,"./lib/xor128":281,"./lib/xor4096":282,"./lib/xorshift7":283,"./lib/xorwow":284,"./seedrandom":285}],279:[function(e,t,n){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],280:[function(e,t,n){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],281:[function(e,t,n){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],282:[function(e,t,n){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,a,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=a,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.X&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],283:[function(e,t,n){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.x&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],284:[function(e,t,n){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],285:[function(e,t,n){!function(n,r){var i,o=this,a=256,s="random",u=r.pow(a,6),l=r.pow(2,52),c=2*l,p=a-1;function h(e,t,p){var h=[],v=y(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,g(n)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(a):(e=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(e)),g(e)}catch(e){var t=o.navigator,r=t&&t.plugins;return[+new Date,o,r,o.screen,g(n)]}}():e,3),h),b=new f(h),_=function(){for(var e=b.g(6),t=u,n=0;e<l;)e=(e+n)*a,t*=a,n=b.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return _.int32=function(){return 0|b.g(4)},_.quick=function(){return b.g(4)/4294967296},_.double=_,y(g(b.S),n),(t.pass||p||function(e,t,n,i){return i&&(i.S&&d(i,b),e.state=function(){return d(b,{})}),n?(r[s]=e,t):e})(_,v,"global"in t?t.global:this==r,t.state)}function f(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<a;)s[i]=i++;for(i=0;i<a;i++)s[i]=s[o=p&o+e[i%n]+(t=s[i])],s[o]=t;(r.g=function(e){for(var t,n=0,i=r.i,o=r.j,s=r.S;e--;)t=s[i=p&i+1],n=n*a+s[p&(s[i]=s[o=p&o+t])+(s[o]=t)];return r.i=i,r.j=o,n})(a)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function y(e,t){for(var n,r=e+"",i=0;i<r.length;)t[p&i]=p&(n^=19*t[p&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=h,y(r.random(),n),"object"==typeof t&&t.exports){t.exports=h;try{i=e("crypto")}catch(e){}}else"function"==typeof define&&define.amd&&define((function(){return h}))}([],Math)},{crypto:248}],286:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-note");var i=function(e){return e.filter((function(e){return 0===e||e}))},o=function(e){var t=r.props(e).midi;return null!==t?t:r.props(e+"-100").midi};function a(e){return i(e.map(r.name)).sort((function(e,t){return o(e)>o(t)}))}var s=function(e){return 0===e.length?[[]]:s(e.slice(1)).reduce((function(t,n){return t.concat(e.map((function(t,r){var i=n.slice();return i.splice(r,0,e[0]),i})))}),[])};n.range=function(e,t){return null===e||null===t?[]:e<t?function(e,t){for(var n=[];t--;n[t]=t+e);return n}(e,t-e+1):function(e,t){for(var n=[];t--;n[t]=e-t);return n}(e,e-t+1)},n.rotate=function(e,t){var n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))},n.compact=i,n.sort=a,n.unique=function(e){return a(e).filter((function(e,t,n){return 0===t||e!==n[t-1]}))},n.shuffle=function(e,t){var n,r;void 0===t&&(t=Math.random);for(var i=e.length;i;)n=t()*i--|0,r=e[i],e[i]=e[n],e[n]=r;return e},n.permutations=s},{"tonal-note":291}],287:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o=e("tonal-note"),a=e("tonal-distance"),s=e("tonal-dictionary"),u=e("tonal-pcset"),l=s.chord.names,c=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),p=(r=function(e){var t=s.chord(e);if(!t)return c;var n={intervals:t,name:e};return n.chroma=u.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=s.chord.names(n.chroma),n},void 0===i&&(i={}),function(e){return i[e]||(i[e]=r(e))}),h=function(e){return p(d(e)[1]).intervals};var f=/^(6|64|7|9|11|13)$/;function d(e){var t=o.tokenize(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:f.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}n.names=l,n.props=p,n.intervals=h,n.notes=function(e,t){var n=d(e);return t=t||n[1],p(t).intervals.map(a.transpose(n[0]))},n.exists=function(e){return void 0!==s.chord(d(e)[1])},n.supersets=function(e){if(!h(e).length)return[];var t=u.isSupersetOf(h(e));return s.chord.names().filter((function(e){return t(s.chord(e))}))},n.subsets=function(e){var t=u.isSubsetOf(h(e));return s.chord.names().filter((function(e){return t(s.chord(e))}))},n.tokenize=d},{"tonal-dictionary":288,"tonal-distance":289,"tonal-note":291,"tonal-pcset":292}],288:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-pcset"),i={M:["1P 3M 5P",["Major",""]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],M6:["1P 3M 5P 13M",["6"]],M69:["1P 3M 5P 6M 9M",["69"]],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],Maddb9:["1P 3M 5P 9m"],m:["1P 3m 5P"],m11:["1P 3m 5P 7m 9M 11P",["_11"]],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"],4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m#5":["1P 3m 5A",["m+","mb6"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m7#5":["1P 3m 6m 7m"],"m9#5":["1P 3m 6m 7m 9M"],"+add#9":["1P 3M 5A 9A"]},o=function(e){var t=Object.keys(e).sort(),n=[],i=[],o=function(e,t,r){n[e]=t,i[r]=i[r]||[],i[r].push(e)};t.forEach((function(t){var n=e[t][0].split(" "),i=e[t][1],a=r.chroma(n);o(t,n,a),i&&i.forEach((function(e){return o(e,n,a)}))}));var a=Object.keys(n).sort(),s=function(e){return n[e]};return s.names=function(e){return"string"==typeof e?(i[e]||[]).slice():(!0===e?a:t).slice()},s},a=function(e,t){var n=function(n){return e(n)||t(n)};return n.names=function(n){return e.names(n).concat(t.names(n))},n},s=o({chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],diminished:["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],prometheus:["1P 2M 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],egyptian:["1P 2M 4P 5P 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}),u=o(i),l=a(s,u);n.dictionary=o,n.combine=a,n.scale=s,n.chord=u,n.pcset=l},{"tonal-pcset":292}],289:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-note"),i=e("tonal-interval"),o=[0,2,4,-1,1,3,5],a=o.map((function(e){return Math.floor(7*e/12)})),s=[3,0,4,1,5,2,6];var u=function(e,t,n){var r=s[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],i=Math.floor((e+1)/7);return void 0===t?{step:r,alt:i,dir:n}:{step:r,alt:i,oct:t+4*i+a[r],dir:n}},l=function(e){return t=function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,i=e.dir;void 0===i&&(i=1);var s=o[t]+7*n;return null===r?[i*s]:[i*s,i*(r-a[t]-4*n)]}(n)},void 0===n&&(n={}),function(e){return n[e]||(n[e]=t(e))};var t,n},c=l(r.props),p=l(i.props);function h(e,t){if(1===arguments.length)return function(t){return h(e,t)};var n=c(e),i=p(t);if(null===n||null===i)return null;var o=1===n.length?[n[0]+i[0]]:[n[0]+i[0],n[1]+i[1]];return r.build(u(o[0],o[1]))}var f=function(e){return 7*(t=e)[0]+12*t[1]<0?u(-e[0],-e[1],-1):u(e[0],e[1],1);var t};function d(e,t,n){var r=p(e),o=p(t);if(null===r||null===o)return null;var a=[r[0]+n*o[0],r[1]+n*o[1]];return i.build(f(a))}function m(e,t){return 1===arguments.length?function(t){return m(e,t)}:d(e,t,1)}n.transpose=h,n.trFifths=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var i=c(t);return null===i?null:r.build(u(i[0]+n))},n.fifths=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=c(t),i=c(n);return null===i||null===r?null:i[0]-r[0]},n.transposeBy=function(e,t){return 1===arguments.length?function(t){return h(t,e)}:h(t,e)},n.addIntervals=d,n.add=m,n.subtract=function(e,t){return 1===arguments.length?function(t){return m(e,t)}:d(e,t,-1)},n.interval=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=c(t),o=c(n);if(null===r||null===o||r.length!==o.length)return null;var a=1===r.length?[o[0]-r[0],-Math.floor(7*(o[0]-r[0])/12)]:[o[0]-r[0],o[1]-r[1]];return i.build(f(a))},n.semitones=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var i=r.props(t),o=r.props(n);return null!==i.midi&&null!==o.midi?o.midi-i.midi:null!==i.chroma&&null!==o.chroma?(o.chroma-i.chroma+12)%12:null}},{"tonal-interval":290,"tonal-note":291}],290:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),i=[0,2,4,5,7,9,11],o="PMMPPMM",a=[0,1,2,3,4,5,6,5,4,3,2,1],s="1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),u=function(e){var t=r.exec(e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]},l=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null}),c=function(e,t){return Array(Math.abs(t)+1).join(e)},p=function(e){return(Math.abs(e)-1)%7},h={};function f(e){return"string"!=typeof e?l:h[e]||(h[e]=function(e){var t=u(e);if(null===t)return l;var n,r,a={num:+t[0],q:t[1]};return a.step=p(a.num),a.type=o[a.step],"M"===a.type&&"P"===a.q?l:(a.name=""+a.num+a.q,a.dir=a.num<0?-1:1,a.simple=8===a.num||-8===a.num?a.num:a.dir*(a.step+1),a.alt=(n=a.type,"M"===(r=a.q)&&"M"===n||"P"===r&&"P"===n?0:"m"===r&&"M"===n?-1:/^A+$/.test(r)?r.length:/^d+$/.test(r)?"P"===n?-r.length:-r.length-1:null),a.oct=Math.floor((Math.abs(a.num)-1)/7),a.semitones=a.dir*(i[a.step]+a.alt+12*a.oct),a.chroma=(a.dir*(i[a.step]+a.alt)%12+12)%12,Object.freeze(a))}(e))}var d=function(e){void 0===e&&(e={});var t=e.num,n=e.step,r=e.alt,i=e.oct;void 0===i&&(i=1);var a=e.dir;return void 0!==n&&(t=n+1+7*i),void 0===t?null:(a<0?"-":"")+t+function(e,t){return 0===t?"M"===e?"M":"P":-1===t&&"M"===e?"m":t>0?c("A",t):t<0?c("d","P"===e?t:t+1):null}(o[p(t)],r)},m=[1,2,2,3,3,4,5,5,6,6,7,7],y="P m M m M P d P m M m M".split(" ");n.names=function(e){return"string"!=typeof e?s.slice():s.filter((function(t){return-1!==e.indexOf(t[1])}))},n.tokenize=u,n.props=f,n.num=function(e){return f(e).num},n.name=function(e){return f(e).name},n.semitones=function(e){return f(e).semitones},n.chroma=function(e){return f(e).chroma},n.ic=function(e){return"string"==typeof e&&(e=f(e).chroma),"number"==typeof e?a[e%12]:null},n.build=d,n.simplify=function(e){var t=f(e);return t===l?null:t.simple+t.q},n.invert=function(e){var t=f(e);if(t===l)return null;var n=(7-t.step)%7,r="P"===t.type?-t.alt:-(t.alt+1);return d({step:n,alt:r,oct:t.oct,dir:t.dir})},n.fromSemitones=function(e){var t=e<0?-1:1,n=Math.abs(e),r=n%12,i=Math.floor(n/12);return t*(m[r]+7*i)+y[r]}},{}],291:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),i=function(e){return"string"!=typeof e?r.slice():r.filter((function(t){var n=t[1]||" ";return-1!==e.indexOf(n)}))},o=i(" #"),a=i(" b"),s=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function u(e){"string"!=typeof e&&(e="");var t=s.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:null}var l,c,p=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),h=[0,2,4,5,7,9,11],f=(l=function(e){var t=u(e);if(""===t[0]||""!==t[3])return p;var n=t[0],r=t[1],i=t[2],o={letter:n,acc:r,octStr:i};return o.pc=o.letter+o.acc,o.name=o.pc+i,o.step=(o.letter.charCodeAt(0)+3)%7,o.alt="b"===o.acc[0]?-o.acc.length:o.acc.length,o.oct=i.length?+i:null,o.chroma=(h[o.step]+o.alt+120)%12,o.midi=null!==o.oct?h[o.step]+o.alt+12*(o.oct+1):null,o.freq=m(o.midi),Object.freeze(o)},void 0===c&&(c={}),function(e){return c[e]||(c[e]=l(e))}),d=function(e){return f(e).pc},m=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},y=Math.log(2),g=Math.log(440),v=function(e){return"CDEFGAB"[e]},b=function(e,t){return Array(t+1).join(e)},_=function(e){return n=function(e){return e<0?b("b",-e):b("#",e)},"number"!=typeof(t=e)?"":n(t);var t,n},w=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},f(t),e):e,r=n.step,i=n.alt,o=n.oct,a=v(r);if(!a)return null;var s=a+_(i);return o||0===o?s+o:s},S=w;function x(e,t){return e=Math.round(e),(!0===t?o:a)[e%12]+(Math.floor(e/12)-1)}var T=function(e,t){var n=f(e),r=n.alt,i=n.chroma,o=n.midi;if(null===i)return null;var a=!1===t?r<0:r>0;return null===o?d(x(i,a)):x(o,a)};n.names=i,n.tokenize=u,n.props=f,n.name=function(e){return f(e).name},n.pc=d,n.midi=function(e){if("number"!=typeof e&&"string"!=typeof e)return null;var t,n=f(e).midi,r=n||0===n?n:+e;return(t=r)>=0&&t<=127?r:null},n.midiToFreq=m,n.freq=function(e){return f(e).freq||m(e)},n.freqToMidi=function(e){var t=12*(Math.log(e)-g)/y+69;return Math.round(100*t)/100},n.chroma=function(e){return f(e).chroma},n.oct=function(e){return f(e).oct},n.stepToLetter=v,n.altToAcc=_,n.from=w,n.build=S,n.fromMidi=x,n.simplify=T,n.enharmonic=function(e){return T(e,!1)}},{}],292:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-note"),i=e("tonal-interval"),o=e("tonal-array"),a=function(e){return r.chroma(e)||i.chroma(e)||0},s=function(e){return parseInt(u(e),2)};function u(e){if(p(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(a).forEach((function(e){t[e]=1})),t.join("")}var l=null;var c=/^[01]{12}$/;function p(e){return c.test(e)}var h="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function f(e,t){return arguments.length>1?f(e)(t):(e=u(e),function(t){return"1"===e[a(t)]})}n.chroma=u,n.chromas=function(e){return l=l||o.range(2048,4095).map((function(e){return e.toString(2)})),"number"==typeof e?l.filter((function(t){return function(e){return e.replace(/0/g,"").length}(t)===e})):l.slice()},n.modes=function(e,t){t=!1!==t;var n=u(e).split("");return o.compact(n.map((function(e,r){var i=o.rotate(r,n);return t&&"0"===i[0]?null:i.join("")})))},n.isChroma=p,n.intervals=function(e){return p(e)?o.compact(e.split("").map((function(e,t){return"1"===e?h[t]:null}))):[]},n.isEqual=function e(t,n){return 1===arguments.length?function(n){return e(t,n)}:u(t)===u(n)},n.isSubsetOf=function e(t,n){return arguments.length>1?e(t)(n):(t=s(t),function(e){return(e=s(e))!==t&&(e&t)===e})},n.isSupersetOf=function e(t,n){return arguments.length>1?e(t)(n):(t=s(t),function(e){return(e=s(e))!==t&&(e|t)===e})},n.includes=f,n.filter=function e(t,n){return 1===arguments.length?function(n){return e(t,n)}:n.filter(f(t))}},{"tonal-array":286,"tonal-interval":290,"tonal-note":291}],293:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o=e("tonal-note"),a=e("tonal-pcset"),s=e("tonal-distance"),u=e("tonal-dictionary"),l=e("tonal-array"),c=Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),p=(r=function(e){var t=u.scale(e);if(!t)return c;var n={intervals:t,name:e};return n.chroma=a.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=u.scale.names(n.chroma),Object.freeze(n)},i={},function(e){return i[e]||(i[e]=r(e))}),h=u.scale.names,f=function(e){var t=m(e);return p(t[1]).intervals};function d(e,t){var n=m(e);return t=t||n[1],f(t).map(s.transpose(n[0]))}function m(e){if("string"!=typeof e)return["",""];var t=e.indexOf(" "),n=o.name(e.substring(0,t))||o.name(e)||"",r=""!==n?e.substring(n.length+1):e;return[n,r.length?r:""]}n.props=p,n.names=h,n.intervals=f,n.notes=d,n.exists=function(e){var t=m(e);return void 0!==u.scale(t[1])},n.tokenize=m,n.modeNames=function(e){var t=f(e),n=d(e);return a.modes(t).map((function(e,r){var i=u.scale.names(e)[0];if(i)return[n[r]||t[r],i]})).filter((function(e){return e}))},n.chords=function(e){var t=a.isSubsetOf(f(e));return u.chord.names().filter((function(e){return t(u.chord(e))}))},n.toScale=function(e){var t=l.compact(e.map(o.pc));if(!t.length)return t;var n=t[0],r=l.unique(t);return l.rotate(r.indexOf(n),r)},n.supersets=function(e){if(!f(e).length)return[];var t=a.isSupersetOf(f(e));return u.scale.names().filter((function(e){return t(u.scale(e))}))},n.subsets=function(e){var t=a.isSubsetOf(f(e));return u.scale.names().filter((function(e){return t(u.scale(e))}))}},{"tonal-array":286,"tonal-dictionary":288,"tonal-distance":289,"tonal-note":291,"tonal-pcset":292}],294:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-array"),i=e("tonal-note"),o=e("tonal-interval"),a=e("tonal-distance"),s=e("tonal-dictionary"),u=e("tonal-scale"),l=e("tonal-chord"),c=e("tonal-pcset"),p=a.transpose,h=a.interval,f=i.props,d=i.midi,m=i.freq,y=s.chord,g=s.scale;n.Array=r,n.Note=i,n.Interval=o,n.Distance=a,n.Scale=u,n.Chord=l,n.PcSet=c,n.Dictionary=s,n.transpose=p,n.interval=h,n.note=f,n.midi=d,n.freq=m,n.chord=y,n.scale=g},{"tonal-array":286,"tonal-chord":287,"tonal-dictionary":288,"tonal-distance":289,"tonal-interval":290,"tonal-note":291,"tonal-pcset":292,"tonal-scale":293}],295:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var e,t;function n(t){t(e)}
/**
	 *  Tone.js
	 *  @author Yotam Mann
	 *  @license http://opensource.org/licenses/MIT MIT License
	 *  @copyright 2014-2018 Yotam Mann
	 */return t=function(){var e=function(){if(!(this instanceof e))throw new Error("constructor needs to be called with the 'new' keyword")};e.prototype.toString=function(){for(var t in e){var n=t[0].match(/^[A-Z]$/),r=e[t]===this.constructor;if(e.isFunction(e[t])&&n&&r)return t}return"Tone"},e.prototype.dispose=function(){return this},e.prototype.set=function(t,n,r){if(e.isObject(t))r=n;else if(e.isString(t)){var i={};i[t]=n,t=i}e:for(var o in t){n=t[o];var a=this;if(-1!==o.indexOf(".")){for(var s=o.split("."),u=0;u<s.length-1;u++)if((a=a[s[u]])instanceof e){s.splice(0,u+1);var l=s.join(".");a.set(l,n);continue e}o=s[s.length-1]}var c=a[o];e.isUndef(c)||(e.Signal&&c instanceof e.Signal||e.Param&&c instanceof e.Param?c.value!==n&&(e.isUndef(r)?c.value=n:c.rampTo(n,r)):c instanceof AudioParam?c.value!==n&&(c.value=n):e.TimeBase&&c instanceof e.TimeBase?a[o]=n:c instanceof e?c.set(n):c!==n&&(a[o]=n))}return this},e.prototype.get=function(t){e.isUndef(t)?t=this._collectDefaults(this.constructor):e.isString(t)&&(t=[t]);for(var n={},r=0;r<t.length;r++){var i=t[r],o=this,a=n;if(-1!==i.indexOf(".")){for(var s=i.split("."),u=0;u<s.length-1;u++){var l=s[u];a[l]=a[l]||{},a=a[l],o=o[l]}i=s[s.length-1]}var c=o[i];e.isObject(t[i])?a[i]=c.get():e.Signal&&c instanceof e.Signal||e.Param&&c instanceof e.Param||c instanceof AudioParam?a[i]=c.value:c instanceof e?a[i]=c.get():!e.isFunction(c)&&e.isDefined(c)&&(a[i]=c)}return n},e.prototype._collectDefaults=function(t){var n=[];if(e.isDefined(t.defaults)&&(n=Object.keys(t.defaults)),e.isDefined(t._super))for(var r=this._collectDefaults(t._super),i=0;i<r.length;i++)-1===n.indexOf(r[i])&&n.push(r[i]);return n},e.defaults=function(t,n,r){var i={};if(1===t.length&&e.isObject(t[0]))i=t[0];else for(var o=0;o<n.length;o++)i[n[o]]=t[o];return e.isDefined(r.defaults)?e.defaultArg(i,r.defaults):e.isObject(r)?e.defaultArg(i,r):i},e.defaultArg=function(t,n){if(e.isObject(t)&&e.isObject(n)){var r={};for(var i in t)r[i]=e.defaultArg(n[i],t[i]);for(var o in n)r[o]=e.defaultArg(t[o],n[o]);return r}return e.isUndef(t)?n:t},e.connectSeries=function(){for(var t=arguments[0],n=1;n<arguments.length;n++){var r=arguments[n];t.connect(r),t=r}return e},e.isUndef=function(e){return void 0===e},e.isDefined=function(t){return!e.isUndef(t)},e.isFunction=function(e){return"function"==typeof e},e.isNumber=function(e){return"number"==typeof e},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object},e.isBoolean=function(e){return"boolean"==typeof e},e.isArray=function(e){return Array.isArray(e)},e.isString=function(e){return"string"==typeof e},e.isNote=function(t){return e.isString(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)},e.noOp=function(){},e.prototype._readOnly=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._readOnly(e[t]);else Object.defineProperty(this,e,{writable:!1,enumerable:!0})},e.prototype._writable=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._writable(e[t]);else Object.defineProperty(this,e,{writable:!0})},e.State={Started:"started",Stopped:"stopped",Paused:"paused"},e.equalPowerScale=function(e){var t=.5*Math.PI;return Math.sin(e*t)},e.dbToGain=function(e){return Math.pow(10,e/20)},e.gainToDb=function(e){return Math.log(e)/Math.LN10*20},e.intervalToFrequencyRatio=function(e){return Math.pow(2,e/12)},e.prototype.now=function(){return e.context.now()},e.now=function(){return e.context.now()},e.extend=function(t,n){function r(){}e.isUndef(n)&&(n=e),r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t,t._super=n};var t=null;return Object.defineProperty(e,"context",{get:function(){return t},set:function(n){t=e.Context&&n instanceof e.Context?n:new e.Context(n),e.Context.emit("init",t)}}),Object.defineProperty(e.prototype,"context",{get:function(){return e.context}}),e.setContext=function(t){e.context=t},Object.defineProperty(e.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(e.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(e,"supported",{get:function(){var e=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),t=window.hasOwnProperty("Promise"),n=window.hasOwnProperty("Worker");return e&&t&&n}}),Object.defineProperty(e,"initialized",{get:function(){return null!==t}}),e.getContext=function(t){if(e.initialized)t(e.context);else{var n=function(){t(e.context),e.Context.off("init",n)};e.Context.on("init",n)}return e},e.version="r12",e},e=t(),n((function(e){return e.Emitter=function(){e.call(this),this._events={}},e.extend(e.Emitter),e.Emitter.prototype.on=function(e,t){for(var n=e.split(/\W+/),r=0;r<n.length;r++){var i=n[r];this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}return this},e.Emitter.prototype.once=function(e,t){var n=function(){t.apply(this,arguments),this.off(e,n)}.bind(this);return this.on(e,n),this},e.Emitter.prototype.off=function(t,n){for(var r=t.split(/\W+/),i=0;i<r.length;i++)if(t=r[i],this._events.hasOwnProperty(t))if(e.isUndef(n))this._events[t]=[];else for(var o=this._events[t],a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);return this},e.Emitter.prototype.emit=function(e){if(this._events){var t=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(e))for(var n=this._events[e].slice(0),r=0,i=n.length;r<i;r++)n[r].apply(this,t)}return this},e.Emitter.mixin=function(t){var n=["on","once","off","emit"];t._events={};for(var r=0;r<n.length;r++){var i=n[r],o=e.Emitter.prototype[i];t[i]=o}return e.Emitter},e.Emitter.prototype.dispose=function(){return e.prototype.dispose.call(this),this._events=null,this},e.Emitter})),n((function(e){return e.Timeline=function(){var t=e.defaults(arguments,["memory"],e.Timeline);e.call(this),this._timeline=[],this.memory=t.memory},e.extend(e.Timeline),e.Timeline.defaults={memory:1/0},Object.defineProperty(e.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),e.Timeline.prototype.add=function(t){if(e.isUndef(t.time))throw new Error("Tone.Timeline: events must have a time attribute");t.time=t.time.valueOf();var n=this._search(t.time);if(this._timeline.splice(n+1,0,t),this.length>this.memory){var r=this.length-this.memory;this._timeline.splice(0,r)}return this},e.Timeline.prototype.remove=function(e){var t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this},e.Timeline.prototype.get=function(t,n){n=e.defaultArg(n,"time");var r=this._search(t,n);return-1!==r?this._timeline[r]:null},e.Timeline.prototype.peek=function(){return this._timeline[0]},e.Timeline.prototype.shift=function(){return this._timeline.shift()},e.Timeline.prototype.getAfter=function(t,n){n=e.defaultArg(n,"time");var r=this._search(t,n);return r+1<this._timeline.length?this._timeline[r+1]:null},e.Timeline.prototype.getBefore=function(t,n){n=e.defaultArg(n,"time");var r=this._timeline.length;if(r>0&&this._timeline[r-1][n]<t)return this._timeline[r-1];var i=this._search(t,n);return i-1>=0?this._timeline[i-1]:null},e.Timeline.prototype.cancel=function(e){if(this._timeline.length>1){var t=this._search(e);if(t>=0)if(this._timeline[t].time===e){for(var n=t;n>=0&&this._timeline[n].time===e;n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=e&&(this._timeline=[]);return this},e.Timeline.prototype.cancelBefore=function(e){var t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this},e.Timeline.prototype.previousEvent=function(e){var t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null},e.Timeline.prototype._search=function(t,n){if(0===this._timeline.length)return-1;n=e.defaultArg(n,"time");var r=0,i=this._timeline.length,o=i;if(i>0&&this._timeline[i-1][n]<=t)return i-1;for(;r<o;){var a=Math.floor(r+(o-r)/2),s=this._timeline[a],u=this._timeline[a+1];if(s[n]===t){for(var l=a;l<this._timeline.length;l++)this._timeline[l][n]===t&&(a=l);return a}if(s[n]<t&&u[n]>t)return a;s[n]>t?o=a:r=a+1}return-1},e.Timeline.prototype._iterate=function(t,n,r){n=e.defaultArg(n,0),r=e.defaultArg(r,this._timeline.length-1),this._timeline.slice(n,r+1).forEach(function(e){t.call(this,e)}.bind(this))},e.Timeline.prototype.forEach=function(e){return this._iterate(e),this},e.Timeline.prototype.forEachBefore=function(e,t){var n=this._search(e);return-1!==n&&this._iterate(t,0,n),this},e.Timeline.prototype.forEachAfter=function(e,t){var n=this._search(e);return this._iterate(t,n+1),this},e.Timeline.prototype.forEachBetween=function(e,t,n){var r=this._search(e),i=this._search(t);return-1!==r&&-1!==i?(this._timeline[r].time!==e&&(r+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,r,i)):-1===r&&this._iterate(n,0,i),this},e.Timeline.prototype.forEachFrom=function(e,t){for(var n=this._search(e);n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this},e.Timeline.prototype.forEachAtTime=function(e,t){var n=this._search(e);return-1!==n&&this._iterate((function(n){n.time===e&&t.call(this,n)}),0,n),this},e.Timeline.prototype.dispose=function(){return e.prototype.dispose.call(this),this._timeline=null,this},e.Timeline})),n((function(e){e.supported&&(!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),new OfflineAudioContext(1,1,44100).startRendering()instanceof Promise||(OfflineAudioContext.prototype._native_startRendering=OfflineAudioContext.prototype.startRendering,OfflineAudioContext.prototype.startRendering=function(){return new Promise(function(e){this.oncomplete=function(t){e(t.renderedBuffer)},this._native_startRendering()}.bind(this))}))})),n((function(e){if(e.supported){!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),AudioContext.prototype.close||(AudioContext.prototype.close=function(){return e.isFunction(this.suspend)&&this.suspend(),Promise.resolve()}),AudioContext.prototype.resume||(AudioContext.prototype.resume=function(){return Promise.resolve()}),!AudioContext.prototype.createGain&&AudioContext.prototype.createGainNode&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),!AudioContext.prototype.createDelay&&AudioContext.prototype.createDelayNode&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode);var t=!1,n=new OfflineAudioContext(1,1,44100),r=new Uint32Array([1179011410,48,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,8,0,0,0,0]).buffer;try{n.decodeAudioData(r)instanceof Promise&&(t=!0)}catch(e){t=!1}t||(AudioContext.prototype._native_decodeAudioData=AudioContext.prototype.decodeAudioData,AudioContext.prototype.decodeAudioData=function(e){return new Promise(function(t,n){this._native_decodeAudioData(e,t,n)}.bind(this))})}})),n((function(e){e.Context=function(){e.Emitter.call(this);var n=e.defaults(arguments,["context"],e.Context);if(!n.context&&(n.context=new window.AudioContext,!n.context))throw new Error("could not create AudioContext. Possibly too many AudioContexts running already.");for(var r in this._context=n.context,this._context)this._defineProperty(this._context,r);this._latencyHint=n.latencyHint,this._constants={},this.lookAhead=n.lookAhead,this._computedUpdateInterval=0,this._ticker=new t(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval),this._timeouts=new e.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this))},e.extend(e.Context,e.Emitter),e.Emitter.mixin(e.Context),e.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},e.Context.prototype._defineProperty=function(t,n){e.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof t[n]?t[n].bind(t):t[n]},set:function(e){t[n]=e}})},e.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},e.Context.prototype.ready=function(){return new Promise(function(e){"running"===this._context.state?e():this._context.resume().then((function(){e()}))}.bind(this))},e.Context.prototype.close=function(){return this._context.close().then(function(){e.Context.emit("close",this)}.bind(this))},e.Context.prototype.getConstant=function(e){if(this._constants[e])return this._constants[e];for(var t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=e;var i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants[e]=i,i},e.Context.prototype._timeoutLoop=function(){for(var e=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=e;)this._timeouts.shift().callback()},e.Context.prototype.setTimeout=function(e,t){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:e,time:n+t,id:this._timeoutIds}),this._timeoutIds},e.Context.prototype.clearTimeout=function(e){return this._timeouts.forEach((function(t){t.id===e&&this.remove(t)})),this},Object.defineProperty(e.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(e){this._ticker.updateInterval=e}}),Object.defineProperty(e.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(e){this._ticker.type=e}}),Object.defineProperty(e.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(t){var n=t;if(this._latencyHint=t,e.isString(t))switch(t){case"interactive":n=.1,this._context.latencyHint=t;break;case"playback":n=.8,this._context.latencyHint=t;break;case"balanced":n=.25,this._context.latencyHint=t;break;case"fastest":this._context.latencyHint="interactive",n=.01}this.lookAhead=n,this.updateInterval=n/3}}),e.Context.prototype.dispose=function(){return this.close().then(function(){for(var t in e.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null,this._constants)this._constants[t].disconnect();this._constants=null}.bind(this))};var t=function(t,n,r){this._type=n,this._updateInterval=r,this._callback=e.defaultArg(t,e.noOp),this._createClock()};return t.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},t.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var e=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n},t.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},t.prototype._createClock=function(){if(this._type===t.Type.Worker)try{this._createWorker()}catch(e){this._type=t.Type.Timeout,this._createClock()}else this._type===t.Type.Timeout&&this._createTimeout()},Object.defineProperty(t.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(e){this._updateInterval=Math.max(e,128/44100),this._type===t.Type.Worker&&this._worker.postMessage(Math.max(1e3*e,1))}}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(e){this._disposeClock(),this._type=e,this._createClock()}}),t.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},t.prototype.dispose=function(){this._disposeClock(),this._callback=null},e.getContext((function(){var t=AudioNode.prototype.connect,n=AudioNode.prototype.disconnect;function r(n,r,i){if(n.input)return i=e.defaultArg(i,0),e.isArray(n.input)?this.connect(n.input[i]):this.connect(n.input,r,i);try{return n instanceof AudioNode?(t.call(this,n,r,i),n):(t.call(this,n,r),n)}catch(e){throw new Error("error connecting to node: "+n+"\n"+e)}}AudioNode.prototype.connect!==r&&(AudioNode.prototype.connect=r,AudioNode.prototype.disconnect=function(t,r,i){if(t&&t.input&&e.isArray(t.input))i=e.defaultArg(i,0),this.disconnect(t.input[i],r,0);else if(t&&t.input)this.disconnect(t.input,r,i);else try{n.apply(this,arguments)}catch(e){throw new Error("error disconnecting node: "+t+"\n"+e)}})})),e.supported&&!e.initialized?(e.context=new e.Context,window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+e.version+" * ","background: #000; color: #fff")):e.supported||console.warn("This browser does not support Tone.js"),e.Context})),n((function(e){return e.AudioNode=function(){e.call(this);var t=e.defaults(arguments,["context"],{context:e.context});this._context=t.context},e.extend(e.AudioNode),Object.defineProperty(e.AudioNode.prototype,"context",{get:function(){return this._context}}),e.AudioNode.prototype.createInsOuts=function(e,t){1===e?this.input=this.context.createGain():e>1&&(this.input=new Array(e)),1===t?this.output=this.context.createGain():t>1&&(this.output=new Array(t))},Object.defineProperty(e.AudioNode.prototype,"channelCount",{get:function(){return this.output.channelCount},set:function(e){return this.output.channelCount=e}}),Object.defineProperty(e.AudioNode.prototype,"channelCountMode",{get:function(){return this.output.channelCountMode},set:function(e){return this.output.channelCountMode=e}}),Object.defineProperty(e.AudioNode.prototype,"channelInterpretation",{get:function(){return this.output.channelInterpretation},set:function(e){return this.output.channelInterpretation=e}}),Object.defineProperty(e.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?e.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(e.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?e.isArray(this.output)?this.output.length:1:0}}),e.AudioNode.prototype._onConnect=function(){},e.AudioNode.prototype.connect=function(t,n,r){return t._onConnect&&t._onConnect(this),e.isArray(this.output)?(n=e.defaultArg(n,0),this.output[n].connect(t,0,r)):this.output.connect(t,n,r),this},e.AudioNode.prototype.disconnect=function(t,n,r){e.isArray(this.output)?e.isNumber(t)?this.output[t].disconnect():(n=e.defaultArg(n,0),this.output[n].disconnect(t,0,r)):this.output.disconnect.apply(this.output,arguments)},e.AudioNode.prototype.chain=function(){for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}return this},e.AudioNode.prototype.fan=function(){for(var e=0;e<arguments.length;e++)this.connect(arguments[e]);return this},window.AudioNode&&(AudioNode.prototype.chain=e.AudioNode.prototype.chain,AudioNode.prototype.fan=e.AudioNode.prototype.fan),e.AudioNode.prototype.dispose=function(){return e.isDefined(this.input)&&(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),e.isDefined(this.output)&&(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this},e.AudioNode})),n((function(e){return e.SignalBase=function(){e.AudioNode.call(this)},e.extend(e.SignalBase,e.AudioNode),e.SignalBase.prototype.connect=function(t,n,r){return e.Signal&&e.Signal===t.constructor||e.Param&&e.Param===t.constructor?(t._param.cancelScheduledValues(0),t._param.value=0,t.overridden=!0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.value=0),e.AudioNode.prototype.connect.call(this,t,n,r),this},e.SignalBase})),n((function(e){if(e.supported){var t=navigator.userAgent.toLowerCase();if(t.includes("safari")&&!t.includes("chrome")){var n=function(e){for(var t in this._internalNode=this.input=this.output=e._native_createWaveShaper(),this._curve=null,this._internalNode)this._defineProperty(this._internalNode,t)};Object.defineProperty(n.prototype,"curve",{get:function(){return this._curve},set:function(e){this._curve=e;var t=new Float32Array(e.length+1);t.set(e,1),t[0]=e[0],this._internalNode.curve=t}}),n.prototype._defineProperty=function(t,n){e.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof t[n]?t[n].bind(t):t[n]},set:function(e){t[n]=e}})},AudioContext.prototype._native_createWaveShaper=AudioContext.prototype.createWaveShaper,AudioContext.prototype.createWaveShaper=function(){return new n(this)}}}})),n((function(e){return e.WaveShaper=function(t,n){e.SignalBase.call(this),this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(t)?this.curve=t:isFinite(t)||e.isUndef(t)?this._curve=new Float32Array(e.defaultArg(t,1024)):e.isFunction(t)&&(this._curve=new Float32Array(e.defaultArg(n,1024)),this.setMap(t))},e.extend(e.WaveShaper,e.SignalBase),e.WaveShaper.prototype.setMap=function(e){for(var t=new Array(this._curve.length),n=0,r=this._curve.length;n<r;n++){var i=n/(r-1)*2-1;t[n]=e(i,n)}return this.curve=t,this},Object.defineProperty(e.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(e){this._curve=new Float32Array(e),this._shaper.curve=this._curve}}),Object.defineProperty(e.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){if(!["none","2x","4x"].includes(e))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=e}}),e.WaveShaper.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},e.WaveShaper})),n((function(e){return e.TimeBase=function(t,n){if(!(this instanceof e.TimeBase))return new e.TimeBase(t,n);if(this._val=t,this._units=n,e.isUndef(this._units)&&e.isString(this._val)&&parseFloat(this._val)==this._val&&"+"!==this._val.charAt(0))this._val=parseFloat(this._val),this._units=this._defaultUnits;else if(t&&t.constructor===this.constructor)this._val=t._val,this._units=t._units;else if(t instanceof e.TimeBase)switch(this._defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break;default:throw new Error("Unrecognized default units "+this._defaultUnits)}},e.extend(e.TimeBase),e.TimeBase.prototype._expressions={n:{regexp:/^(\d+)n(\.?)$/i,method:function(e,t){var n="."===t?1.5:1;return 1===(e=parseInt(e))?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/e)*n}},t:{regexp:/^(\d+)t$/i,method:function(e){return e=parseInt(e),this._beatsToUnits(8/(3*parseInt(e)))}},m:{regexp:/^(\d+)m$/i,method:function(e){return this._beatsToUnits(parseInt(e)*this._getTimeSignature())}},i:{regexp:/^(\d+)i$/i,method:function(e){return this._ticksToUnits(parseInt(e))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz$/i,method:function(e){return this._frequencyToUnits(parseFloat(e))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/,method:function(e,t,n){var r=0;return e&&"0"!==e&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r}},s:{regexp:/^(\d+(?:\.\d+)?)s$/,method:function(e){return this._secondsToUnits(parseFloat(e))}},samples:{regexp:/^(\d+)samples$/,method:function(e){return parseInt(e)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)$/,method:function(e){return this._expressions[this._defaultUnits].method.call(this,e)}}},e.TimeBase.prototype._defaultUnits="s",e.TimeBase.prototype._getBpm=function(){return e.Transport?e.Transport.bpm.value:120},e.TimeBase.prototype._getTimeSignature=function(){return e.Transport?e.Transport.timeSignature:4},e.TimeBase.prototype._getPPQ=function(){return e.Transport?e.Transport.PPQ:192},e.TimeBase.prototype._now=function(){return this.now()},e.TimeBase.prototype._frequencyToUnits=function(e){return 1/e},e.TimeBase.prototype._beatsToUnits=function(e){return 60/this._getBpm()*e},e.TimeBase.prototype._secondsToUnits=function(e){return e},e.TimeBase.prototype._ticksToUnits=function(e){return e*(this._beatsToUnits(1)/this._getPPQ())},e.TimeBase.prototype._noArg=function(){return this._now()},e.TimeBase.prototype.valueOf=function(){if(e.isUndef(this._val))return this._noArg();if(e.isString(this._val)&&e.isUndef(this._units))for(var t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}if(e.isDefined(this._units)){var n=this._expressions[this._units],r=this._val.toString().trim().match(n.regexp);return r?n.method.apply(this,r.slice(1)):n.method.call(this,parseFloat(this._val))}return this._val},e.TimeBase.prototype.toSeconds=function(){return this.valueOf()},e.TimeBase.prototype.toFrequency=function(){return 1/this.toSeconds()},e.TimeBase.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},e.TimeBase.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},e.TimeBase.prototype.dispose=function(){this._val=null,this._units=null},e.TimeBase})),n((function(e){e.Frequency=function(t,n){if(!(this instanceof e.Frequency))return new e.Frequency(t,n);e.TimeBase.call(this,t,n)},e.extend(e.Frequency,e.TimeBase),e.Frequency.prototype._expressions=Object.assign({},e.TimeBase.prototype._expressions,{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(t){return"midi"===this._defaultUnits?t:e.Frequency.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(n,r){var i=t[n.toLowerCase()]+12*(parseInt(r)+1);return"midi"===this._defaultUnits?i:e.Frequency.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(e,t,n){var r=1;return e&&"0"!==e&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}}),e.Frequency.prototype.transpose=function(t){return new this.constructor(this.valueOf()*e.intervalToFrequencyRatio(t))},e.Frequency.prototype.harmonize=function(e){return e.map(function(e){return this.transpose(e)}.bind(this))},e.Frequency.prototype.toMidi=function(){return e.Frequency.ftom(this.valueOf())},e.Frequency.prototype.toNote=function(){var t=this.toFrequency(),r=Math.log2(t/e.Frequency.A4),i=Math.round(12*r)+57,o=Math.floor(i/12);return o<0&&(i+=-12*o),n[i%12]+o.toString()},e.Frequency.prototype.toSeconds=function(){return 1/e.TimeBase.prototype.toSeconds.call(this)},e.Frequency.prototype.toFrequency=function(){return e.TimeBase.prototype.toFrequency.call(this)},e.Frequency.prototype.toTicks=function(){var t=this._beatsToUnits(1),n=this.valueOf()/t;return Math.floor(n*e.Transport.PPQ)},e.Frequency.prototype._noArg=function(){return 0},e.Frequency.prototype._frequencyToUnits=function(e){return e},e.Frequency.prototype._ticksToUnits=function(t){return 1/(60*t/(e.Transport.bpm.value*e.Transport.PPQ))},e.Frequency.prototype._beatsToUnits=function(t){return 1/e.TimeBase.prototype._beatsToUnits.call(this,t)},e.Frequency.prototype._secondsToUnits=function(e){return 1/e},e.Frequency.prototype._defaultUnits="hz";var t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.Frequency.A4=440,e.Frequency.mtof=function(t){return e.Frequency.A4*Math.pow(2,(t-69)/12)},e.Frequency.ftom=function(t){return 69+Math.round(12*Math.log2(t/e.Frequency.A4))},e.Frequency})),n((function(e){return e.Time=function(t,n){if(!(this instanceof e.Time))return new e.Time(t,n);e.TimeBase.call(this,t,n)},e.extend(e.Time,e.TimeBase),e.Time.prototype._expressions=Object.assign({},e.TimeBase.prototype._expressions,{quantize:{regexp:/^@(.+)/,method:function(t){if(e.Transport){var n=new this.constructor(t);return e.Transport.nextSubdivision(n)}return 0}},now:{regexp:/^\+(.+)/,method:function(e){return this._now()+new this.constructor(e)}}}),e.Time.prototype.quantize=function(t,n){n=e.defaultArg(n,1);var r=new this.constructor(t),i=this.valueOf();return i+(Math.round(i/r)*r-i)*n},e.Time.prototype.toNotation=function(){for(var t=this.toSeconds(),n=["1m"],r=1;r<8;r++){var i=Math.pow(2,r);n.push(i+"n."),n.push(i+"n"),n.push(i+"t")}n.push("0");var o=n[0],a=e.Time(n[0]).toSeconds();return n.forEach((function(n){var r=e.Time(n).toSeconds();Math.abs(r-t)<Math.abs(a-t)&&(o=n,a=r)})),o},e.Time.prototype.toBarsBeatsSixteenths=function(){var e=this._beatsToUnits(1),t=this.valueOf()/e,n=Math.floor(t/this._getTimeSignature()),r=t%1*4;return t=Math.floor(t)%this._getTimeSignature(),(r=r.toString()).length>3&&(r=parseFloat(parseFloat(r).toFixed(3))),[n,t,r].join(":")},e.Time.prototype.toTicks=function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())},e.Time.prototype.toSeconds=function(){return this.valueOf()},e.Time.prototype.toMidi=function(){return e.Frequency.ftom(this.toFrequency())},e.Time})),n((function(e){return e.TransportTime=function(t,n){if(!(this instanceof e.TransportTime))return new e.TransportTime(t,n);e.Time.call(this,t,n)},e.extend(e.TransportTime,e.Time),e.TransportTime.prototype._now=function(){return e.Transport.seconds},e.TransportTime})),n((function(e){return e.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},e.prototype.toSeconds=function(t){return e.isNumber(t)?t:e.isUndef(t)?this.now():e.isString(t)?new e.Time(t).toSeconds():t instanceof e.TimeBase?t.toSeconds():void 0},e.prototype.toFrequency=function(t){return e.isNumber(t)?t:e.isString(t)||e.isUndef(t)?new e.Frequency(t).valueOf():t instanceof e.TimeBase?t.toFrequency():void 0},e.prototype.toTicks=function(t){return e.isNumber(t)||e.isString(t)?new e.TransportTime(t).toTicks():e.isUndef(t)?e.Transport.ticks:t instanceof e.TimeBase?t.toTicks():void 0},e})),n((function(e){return e.Param=function(){var t=e.defaults(arguments,["param","units","convert"],e.Param);e.AudioNode.call(this),this._param=this.input=t.param,this.units=t.units,this.convert=t.convert,this.overridden=!1,this._events=new e.Timeline(1e3),e.isDefined(t.value)&&this._param&&(this.value=t.value)},e.extend(e.Param,e.AudioNode),e.Param.defaults={units:e.Type.Default,convert:!0,param:void 0},Object.defineProperty(e.Param.prototype,"value",{get:function(){var e=this.now();return this._toUnits(this.getValueAtTime(e))},set:function(e){this._initialValue=this._fromUnits(e),this.cancelScheduledValues(this.context.currentTime),this.setValueAtTime(e,this.context.currentTime)}}),Object.defineProperty(e.Param.prototype,"minValue",{get:function(){return this.units===e.Type.Time||this.units===e.Type.Frequency||this.units===e.Type.NormalRange||this.units===e.Type.Positive||this.units===e.Type.BPM?0:this.units===e.Type.AudioRange?-1:this.units===e.Type.Decibels?-1/0:this._param.minValue}}),Object.defineProperty(e.Param.prototype,"maxValue",{get:function(){return this.units===e.Type.NormalRange||this.units===e.Type.AudioRange?1:this._param.maxValue}}),e.Param.prototype._fromUnits=function(t){if(!this.convert&&!e.isUndef(this.convert)||this.overridden)return t;switch(this.units){case e.Type.Time:return this.toSeconds(t);case e.Type.Frequency:return this.toFrequency(t);case e.Type.Decibels:return e.dbToGain(t);case e.Type.NormalRange:return Math.min(Math.max(t,0),1);case e.Type.AudioRange:return Math.min(Math.max(t,-1),1);case e.Type.Positive:return Math.max(t,0);default:return t}},e.Param.prototype._toUnits=function(t){return(this.convert||e.isUndef(this.convert))&&this.units===e.Type.Decibels?e.gainToDb(t):t},e.Param.prototype._minOutput=1e-5,e.Param.AutomationType={Linear:"linearRampToValueAtTime",Exponential:"exponentialRampToValueAtTime",Target:"setTargetAtTime",SetValue:"setValueAtTime"},e.Param.prototype.setValueAtTime=function(t,n){return n=this.toSeconds(n),t=this._fromUnits(t),this._events.add({type:e.Param.AutomationType.SetValue,value:t,time:n}),this._param.setValueAtTime(t,n),this},e.Param.prototype.getValueAtTime=function(t){t=this.toSeconds(t);var n=this._events.getAfter(t),r=this._events.get(t),i=e.defaultArg(this._initialValue,this._param.defaultValue),o=i;if(null===r)o=i;else if(r.type===e.Param.AutomationType.Target){var a,s=this._events.getBefore(r.time);a=null===s?i:s.value,o=this._exponentialApproach(r.time,a,r.value,r.constant,t)}else o=null===n?r.value:n.type===e.Param.AutomationType.Linear?this._linearInterpolate(r.time,r.value,n.time,n.value,t):n.type===e.Param.AutomationType.Exponential?this._exponentialInterpolate(r.time,r.value,n.time,n.value,t):r.value;return o},e.Param.prototype.setRampPoint=function(e){e=this.toSeconds(e);var t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===t&&(t=this._minOutput),this.setValueAtTime(this._toUnits(t),e),this},e.Param.prototype.linearRampToValueAtTime=function(t,n){return t=this._fromUnits(t),n=this.toSeconds(n),this._events.add({type:e.Param.AutomationType.Linear,value:t,time:n}),this._param.linearRampToValueAtTime(t,n),this},e.Param.prototype.exponentialRampToValueAtTime=function(t,n){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),n=this.toSeconds(n),this._events.add({type:e.Param.AutomationType.Exponential,time:n,value:t}),this._param.exponentialRampToValueAtTime(t,n),this},e.Param.prototype.exponentialRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this},e.Param.prototype.linearRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this},e.Param.prototype.targetRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this},e.Param.prototype.exponentialApproachValueAtTime=function(e,t,n){var r=Math.log(this.toSeconds(n)+1)/Math.log(200);return t=this.toSeconds(t),this.setTargetAtTime(e,t,r)},e.Param.prototype.setTargetAtTime=function(t,n,r){if(t=this._fromUnits(t),r<=0)throw new Error("timeConstant must be greater than 0");return n=this.toSeconds(n),this._events.add({type:e.Param.AutomationType.Target,value:t,time:n,constant:r}),this._param.setTargetAtTime(t,n,r),this},e.Param.prototype.setValueCurveAtTime=function(t,n,r,i){i=e.defaultArg(i,1),r=this.toSeconds(r),n=this.toSeconds(n),this.setValueAtTime(t[0]*i,n);for(var o=r/(t.length-1),a=1;a<t.length;a++)this.linearRampToValueAtTime(t[a]*i,n+a*o);return this},e.Param.prototype.cancelScheduledValues=function(e){return e=this.toSeconds(e),this._events.cancel(e),this._param.cancelScheduledValues(e),this},e.Param.prototype.cancelAndHoldAtTime=function(t){var n=this.getValueAtTime(t),r=this._events.get(t),i=this._events.getAfter(t);return r&&r.time===t?i?this._events.cancel(i.time):this._events.cancel(t+1e-6):i&&(this._events.cancel(i.time),this._param.cancelAndHoldAtTime||this._param.cancelScheduledValues(t),i.type===e.Param.AutomationType.Linear?this._param.cancelAndHoldAtTime?this._events.add({type:e.Param.AutomationType.Linear,value:n,time:t}):this.linearRampToValueAtTime(n,t):i.type===e.Param.AutomationType.Exponential&&(this._param.cancelAndHoldAtTime?this._events.add({type:e.Param.AutomationType.Exponential,value:n,time:t}):this.exponentialRampToValueAtTime(n,t))),this._events.add({type:e.Param.AutomationType.SetValue,value:n,time:t}),this._param.cancelAndHoldAtTime?this._param.cancelAndHoldAtTime(t):this._param.setValueAtTime(n,t),this},e.Param.prototype.rampTo=function(t,n,r){return n=e.defaultArg(n,.1),this.units===e.Type.Frequency||this.units===e.Type.BPM||this.units===e.Type.Decibels?this.exponentialRampTo(t,n,r):this.linearRampTo(t,n,r),this},e.Param.prototype._exponentialApproach=function(e,t,n,r,i){return n+(t-n)*Math.exp(-(i-e)/r)},e.Param.prototype._linearInterpolate=function(e,t,n,r,i){return t+(i-e)/(n-e)*(r-t)},e.Param.prototype._exponentialInterpolate=function(e,t,n,r,i){return t*Math.pow(r/t,(i-e)/(n-e))},e.Param.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._param=null,this._events=null,this},e.Param})),n((function(e){return e.OfflineContext=function(t,n,r){var i=new OfflineAudioContext(t,n*r,r);e.Context.call(this,{context:i,clockSource:"offline",lookAhead:0,updateInterval:128/r}),this._duration=n,this._currentTime=0},e.extend(e.OfflineContext,e.Context),e.OfflineContext.prototype.now=function(){return this._currentTime},e.OfflineContext.prototype.render=function(){for(;this._duration-this._currentTime>=0;)this.emit("tick"),this._currentTime+=this.blockTime;return this._context.startRendering()},e.OfflineContext.prototype.close=function(){return this._context=null,Promise.resolve()},e.OfflineContext})),n((function(e){if(e.supported){var t=navigator.userAgent.toLowerCase();t.includes("safari")&&!t.includes("chrome")&&t.includes("mobile")&&(e.OfflineContext.prototype.createBufferSource=function(){var e=this._context.createBufferSource(),t=e.start;return e.start=function(n){this.setTimeout(function(){t.call(e,n)}.bind(this),0)}.bind(this),e})}})),n((function(e){return e.Gain=function(){var t=e.defaults(arguments,["gain","units"],e.Gain);e.AudioNode.call(this),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new e.Param({param:this._gainNode.gain,units:t.units,value:t.gain,convert:t.convert}),this._readOnly("gain")},e.extend(e.Gain,e.AudioNode),e.Gain.defaults={gain:1,convert:!0},e.Gain.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},e.Gain})),n((function(e){if(e.supported&&!AudioContext.prototype.createConstantSource){var t=function(e){this.context=e;for(var t=e.createBuffer(1,128,e.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=1;this._bufferSource=e.createBufferSource(),this._bufferSource.channelCount=1,this._bufferSource.channelCountMode="explicit",this._bufferSource.buffer=t,this._bufferSource.loop=!0;var i=this._output=e.createGain();this.offset=i.gain,this._bufferSource.connect(i)};t.prototype.start=function(e){return this._bufferSource.start(e),this},t.prototype.stop=function(e){return this._bufferSource.stop(e),this},t.prototype.connect=function(){return this._output.connect.apply(this._output,arguments),this},t.prototype.disconnect=function(){return this._output.disconnect.apply(this._output,arguments),this},AudioContext.prototype.createConstantSource=function(){return new t(this)},e.Context.prototype.createConstantSource=function(){return new t(this)}}})),n((function(e){return e.Signal=function(){var t=e.defaults(arguments,["value","units"],e.Signal);e.Param.call(this,t),this._proxies=[],this._sourceStarted=!1,this._constantSource=this.context.createConstantSource(),this._param=this._constantSource.offset,this.value=t.value,this.output=this._constantSource,this.input=this._param=this.output.offset},e.extend(e.Signal,e.Param),e.Signal.defaults={value:0,units:e.Type.Default,convert:!0},e.Signal.prototype.connect=function(t){return this._isParam(t)&&!this._sourceStarted?(this._proxies.push(t),t.overridden=!0,this._applyAutomations(t)):(e.SignalBase.prototype.connect.apply(this,arguments),this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0))),this},e.Signal.prototype._isParam=function(t){return e.Param&&e.Param===t.constructor||t instanceof AudioParam},e.Signal.prototype._connectProxies=function(){this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0)),this._proxies.forEach(function(t){e.SignalBase.prototype.connect.call(this,t),t._proxies&&t._connectProxies()}.bind(this))},e.Signal.prototype._onConnect=function(e){this._isParam(e)||this._connectProxies()},e.Signal.prototype._applyAutomations=function(e){var t=this.context.currentTime;e.cancelScheduledValues(t);var n=this.getValueAtTime(t);e.setValueAtTime(n,t),this._events.forEachFrom(t,(function(t){e[t.type](t.value,t.time,t.constant)}))},e.Signal.prototype.disconnect=function(t){if(this._proxies.includes(t)){var n=this._proxies.indexOf(t);this._proxies.splice(n,1)}else t||(this._proxies=[]);return e.SignalBase.prototype.disconnect.apply(this,arguments)},e.Signal.prototype.getValueAtTime=function(t){return this._param.getValueAtTime?this._param.getValueAtTime(t):e.Param.prototype.getValueAtTime.call(this,t)},["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime","setTargetAtTime"].forEach((function(t){var n=e.Signal.prototype[t];e.Signal.prototype[t]=function(){var e=arguments;n.apply(this,arguments),e[0]=this._fromUnits(e[0]),e[1]=this.toSeconds(e[1]),this._proxies.forEach((function(n){n[t].apply(n,e)}))}})),["cancelScheduledValues","cancelAndHoldAtTime"].forEach((function(t){var n=e.Signal.prototype[t];e.Signal.prototype[t]=function(){var e=arguments;n.apply(this,arguments),e[0]=this.toSeconds(e[0]),this._proxies.forEach((function(n){n[t].apply(n,e)}))}})),e.Signal.prototype.dispose=function(){return e.Param.prototype.dispose.call(this),this._constantSource.disconnect(),this._constantSource=null,this._proxies=null,this},e.Signal})),n((function(e){return e.Pow=function(t){e.SignalBase.call(this),this._exp=e.defaultArg(t,1),this._expScaler=this.input=this.output=new e.WaveShaper(this._expFunc(this._exp),8192)},e.extend(e.Pow,e.SignalBase),Object.defineProperty(e.Pow.prototype,"value",{get:function(){return this._exp},set:function(e){this._exp=e,this._expScaler.setMap(this._expFunc(this._exp))}}),e.Pow.prototype._expFunc=function(e){return function(t){return Math.pow(Math.abs(t),e)}},e.Pow.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},e.Pow})),n((function(e){return e.Envelope=function(){var t=e.defaults(arguments,["attack","decay","sustain","release"],e.Envelope);e.AudioNode.call(this),this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new e.Signal(0),this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve},e.extend(e.Envelope,e.AudioNode),e.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(e.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(e.Envelope.prototype,"attackCurve",{get:function(){if(e.isString(this._attackCurve))return this._attackCurve;if(e.isArray(this._attackCurve)){for(var t in e.Envelope.Type)if(e.Envelope.Type[t].In===this._attackCurve)return t;return this._attackCurve}},set:function(t){if(e.Envelope.Type.hasOwnProperty(t)){var n=e.Envelope.Type[t];e.isObject(n)?this._attackCurve=n.In:this._attackCurve=n}else{if(!e.isArray(t))throw new Error("Tone.Envelope: invalid curve: "+t);this._attackCurve=t}}}),Object.defineProperty(e.Envelope.prototype,"releaseCurve",{get:function(){if(e.isString(this._releaseCurve))return this._releaseCurve;if(e.isArray(this._releaseCurve)){for(var t in e.Envelope.Type)if(e.Envelope.Type[t].Out===this._releaseCurve)return t;return this._releaseCurve}},set:function(t){if(e.Envelope.Type.hasOwnProperty(t)){var n=e.Envelope.Type[t];e.isObject(n)?this._releaseCurve=n.Out:this._releaseCurve=n}else{if(!e.isArray(t))throw new Error("Tone.Envelope: invalid curve: "+t);this._releaseCurve=t}}}),e.Envelope.prototype.triggerAttack=function(t,n){t=this.toSeconds(t);var r=this.toSeconds(this.attack),i=r,o=this.toSeconds(this.decay);n=e.defaultArg(n,1);var a=this.getValueAtTime(t);if(a>0&&(i=(1-a)/(1/i)),"linear"===this._attackCurve)this._sig.linearRampTo(n,i,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(n,i,t);else if(i>0){this._sig.cancelAndHoldAtTime(t);var s=this._attackCurve;if(i<r){var u=1-i/r,l=Math.floor(u*this._attackCurve.length);(s=this._attackCurve.slice(l))[0]=a}this._sig.setValueCurveAtTime(s,t,i,n)}return o&&this._sig.targetRampTo(n*this.sustain,o,i+t),this},e.Envelope.prototype.triggerRelease=function(t){t=this.toSeconds(t);var n=this.getValueAtTime(t);if(n>0){var r=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampTo(0,r,t);else if("exponential"===this._releaseCurve)this._sig.targetRampTo(0,r,t);else{var i=this._releaseCurve;e.isArray(i)&&(this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(i,t,r,n))}}return this},e.Envelope.prototype.getValueAtTime=function(e){return this._sig.getValueAtTime(e)},e.Envelope.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this},e.Envelope.prototype.cancel=function(e){return this._sig.cancelScheduledValues(e),this},e.Envelope.prototype.connect=e.SignalBase.prototype.connect,function(){var t,n,r=128,i=[];for(t=0;t<r;t++)i[t]=Math.sin(t/127*(Math.PI/2));var o=[];for(t=0;t<127;t++){n=t/127;var a=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;o[t]=a/10+.83*n}o[127]=1;var s=[];for(t=0;t<r;t++)s[t]=Math.ceil(t/127*5)/5;var u=[];for(t=0;t<r;t++)n=t/127,u[t]=.5*(1-Math.cos(Math.PI*n));var l,c=[];for(t=0;t<r;t++){n=t/127;var p=4*Math.pow(n,3)+.2,h=Math.cos(p*Math.PI*2*n);c[t]=Math.abs(h*(1-n))}function f(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=1-e[n];return t}e.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:f(c),Out:c},cosine:{In:i,Out:(l=i,l.slice(0).reverse())},step:{In:s,Out:f(s)},ripple:{In:o,Out:f(o)},sine:{In:u,Out:f(u)}}}(),e.Envelope.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},e.Envelope})),n((function(e){return e.AmplitudeEnvelope=function(){e.Envelope.apply(this,arguments),this.input=this.output=new e.Gain,this._sig.connect(this.output.gain)},e.extend(e.AmplitudeEnvelope,e.Envelope),e.AmplitudeEnvelope.prototype.dispose=function(){return e.Envelope.prototype.dispose.call(this),this},e.AmplitudeEnvelope})),n((function(e){e.supported&&(AnalyserNode.prototype.getFloatTimeDomainData||(AnalyserNode.prototype.getFloatTimeDomainData=function(e){var t=new Uint8Array(e.length);this.getByteTimeDomainData(t);for(var n=0;n<t.length;n++)e[n]=(t[n]-128)/128}))})),n((function(e){return e.Analyser=function(){var t=e.defaults(arguments,["type","size"],e.Analyser);e.AudioNode.call(this),this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=t.type,this._buffer=null,this.size=t.size,this.type=t.type},e.extend(e.Analyser,e.AudioNode),e.Analyser.defaults={size:1024,type:"fft",smoothing:.8},e.Analyser.Type={Waveform:"waveform",FFT:"fft"},e.Analyser.prototype.getValue=function(){return this._type===e.Analyser.Type.FFT?this._analyser.getFloatFrequencyData(this._buffer):this._type===e.Analyser.Type.Waveform&&this._analyser.getFloatTimeDomainData(this._buffer),this._buffer},Object.defineProperty(e.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(e){this._analyser.fftSize=2*e,this._buffer=new Float32Array(e)}}),Object.defineProperty(e.Analyser.prototype,"type",{get:function(){return this._type},set:function(t){if(t!==e.Analyser.Type.Waveform&&t!==e.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+t);this._type=t}}),Object.defineProperty(e.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(e){this._analyser.smoothingTimeConstant=e}}),e.Analyser.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},e.Analyser})),n((function(e){return e.Compressor=function(){var t=e.defaults(arguments,["threshold","ratio"],e.Compressor);e.AudioNode.call(this),this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new e.Param({param:this._compressor.threshold,units:e.Type.Decibels,convert:!1}),this.attack=new e.Param(this._compressor.attack,e.Type.Time),this.release=new e.Param(this._compressor.release,e.Type.Time),this.knee=new e.Param({param:this._compressor.knee,units:e.Type.Decibels,convert:!1}),this.ratio=new e.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(t)},e.extend(e.Compressor,e.AudioNode),e.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},e.Compressor.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},e.Compressor})),n((function(e){return e.Add=function(t){e.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new e.Gain,this._param=this.input[1]=new e.Signal(t),this._param.connect(this._sum)},e.extend(e.Add,e.Signal),e.Add.prototype.dispose=function(){return e.Signal.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this},e.Add})),n((function(e){return e.Multiply=function(t){e.Signal.call(this),this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new e.Gain,this._param=this.input[1]=this.output.gain,this.value=e.defaultArg(t,0)},e.extend(e.Multiply,e.Signal),e.Multiply.prototype.dispose=function(){return e.Signal.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},e.Multiply})),n((function(e){return e.Negate=function(){e.SignalBase.call(this),this._multiply=this.input=this.output=new e.Multiply(-1)},e.extend(e.Negate,e.SignalBase),e.Negate.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},e.Negate})),n((function(e){return e.Subtract=function(t){e.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new e.Gain,this._neg=new e.Negate,this._param=this.input[1]=new e.Signal(t),this._param.chain(this._neg,this._sum)},e.extend(e.Subtract,e.Signal),e.Subtract.prototype.dispose=function(){return e.Signal.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this},e.Subtract})),n((function(e){return e.EqualPowerGain=function(){e.SignalBase.call(this),this._eqPower=this.input=this.output=new e.WaveShaper(function(t){return Math.abs(t)<.001?0:e.equalPowerScale(t)}.bind(this),4096)},e.extend(e.EqualPowerGain,e.SignalBase),e.EqualPowerGain.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},e.EqualPowerGain})),n((function(e){return e.CrossFade=function(t){e.AudioNode.call(this),this.createInsOuts(2,1),this.a=this.input[0]=new e.Gain,this.b=this.input[1]=new e.Gain,this.fade=new e.Signal(e.defaultArg(t,.5),e.Type.NormalRange),this._equalPowerA=new e.EqualPowerGain,this._equalPowerB=new e.EqualPowerGain,this._one=this.context.getConstant(1),this._invert=new e.Subtract,this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this._one.connect(this._invert,0,0),this.fade.connect(this._invert,0,1),this._invert.chain(this._equalPowerA,this.a.gain),this._readOnly("fade")},e.extend(e.CrossFade,e.AudioNode),e.CrossFade.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this._one=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},e.CrossFade})),n((function(e){return e.Filter=function(){var t=e.defaults(arguments,["frequency","type","rolloff"],e.Filter);e.AudioNode.call(this),this.createInsOuts(1,1),this._filters=[],this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.detune=new e.Signal(0,e.Type.Cents),this.gain=new e.Signal({value:t.gain,convert:!1}),this.Q=new e.Signal(t.Q),this._type=t.type,this._rolloff=t.rolloff,this.rolloff=t.rolloff,this._readOnly(["detune","frequency","gain","Q"])},e.extend(e.Filter,e.AudioNode),e.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(e.Filter.prototype,"type",{get:function(){return this._type},set:function(e){if(-1===["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e))throw new TypeError("Tone.Filter: invalid type "+e);this._type=e;for(var t=0;t<this._filters.length;t++)this._filters[t].type=e}}),Object.defineProperty(e.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(t){t=parseInt(t,10);var n=[-12,-24,-48,-96].indexOf(t);if(-1===n)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");n+=1,this._rolloff=t,this.input.disconnect();for(var r=0;r<this._filters.length;r++)this._filters[r].disconnect(),this._filters[r]=null;this._filters=new Array(n);for(var i=0;i<n;i++){var o=this.context.createBiquadFilter();o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}var a=[this.input].concat(this._filters).concat([this.output]);e.connectSeries.apply(e,a)}}),e.Filter.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this);for(var t=0;t<this._filters.length;t++)this._filters[t].disconnect(),this._filters[t]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},e.Filter})),n((function(e){return e.MultibandSplit=function(){var t=e.defaults(arguments,["lowFrequency","highFrequency"],e.MultibandSplit);e.AudioNode.call(this),this.input=new e.Gain,this.output=new Array(3),this.low=this.output[0]=new e.Filter(0,"lowpass"),this._lowMidFilter=new e.Filter(0,"highpass"),this.mid=this.output[1]=new e.Filter(0,"lowpass"),this.high=this.output[2]=new e.Filter(0,"highpass"),this.lowFrequency=new e.Signal(t.lowFrequency,e.Type.Frequency),this.highFrequency=new e.Signal(t.highFrequency,e.Type.Frequency),this.Q=new e.Signal(t.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},e.extend(e.MultibandSplit,e.AudioNode),e.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},e.MultibandSplit.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},e.MultibandSplit})),n((function(e){return e.EQ3=function(){var t=e.defaults(arguments,["low","mid","high"],e.EQ3);e.AudioNode.call(this),this.output=new e.Gain,this._multibandSplit=this.input=new e.MultibandSplit({lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this._lowGain=new e.Gain(t.low,e.Type.Decibels),this._midGain=new e.Gain(t.mid,e.Type.Decibels),this._highGain=new e.Gain(t.high,e.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},e.extend(e.EQ3,e.AudioNode),e.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},e.EQ3.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},e.EQ3})),n((function(e){return e.Scale=function(t,n){e.SignalBase.call(this),this._outputMin=e.defaultArg(t,0),this._outputMax=e.defaultArg(n,1),this._scale=this.input=new e.Multiply(1),this._add=this.output=new e.Add(0),this._scale.connect(this._add),this._setRange()},e.extend(e.Scale,e.SignalBase),Object.defineProperty(e.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(e){this._outputMin=e,this._setRange()}}),Object.defineProperty(e.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(e){this._outputMax=e,this._setRange()}}),e.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},e.Scale.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},e.Scale})),n((function(e){return e.ScaleExp=function(t,n,r){e.SignalBase.call(this),this._scale=this.output=new e.Scale(t,n),this._exp=this.input=new e.Pow(e.defaultArg(r,2)),this._exp.connect(this._scale)},e.extend(e.ScaleExp,e.SignalBase),Object.defineProperty(e.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),Object.defineProperty(e.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(e.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),e.ScaleExp.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},e.ScaleExp})),n((function(e){return e.Delay=function(){var t=e.defaults(arguments,["delayTime","maxDelay"],e.Delay);e.AudioNode.call(this),this._maxDelay=Math.max(this.toSeconds(t.maxDelay),this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(this._maxDelay),this.delayTime=new e.Param({param:this._delayNode.delayTime,units:e.Type.Time,value:t.delayTime}),this._readOnly("delayTime")},e.extend(e.Delay,e.AudioNode),e.Delay.defaults={maxDelay:1,delayTime:0},Object.defineProperty(e.Delay.prototype,"maxDelay",{get:function(){return this._maxDelay}}),e.Delay.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},e.Delay})),n((function(e){return e.FeedbackCombFilter=function(){var t=e.defaults(arguments,["delayTime","resonance"],e.FeedbackCombFilter);e.AudioNode.call(this),this._delay=this.input=this.output=new e.Delay(t.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new e.Gain(t.resonance,e.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},e.extend(e.FeedbackCombFilter,e.AudioNode),e.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},e.FeedbackCombFilter.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},e.FeedbackCombFilter})),n((function(e){return e.FFT=function(){var t=e.defaults(arguments,["size"],e.FFT);t.type=e.Analyser.Type.FFT,e.AudioNode.call(this),this._analyser=this.input=this.output=new e.Analyser(t)},e.extend(e.FFT,e.AudioNode),e.FFT.defaults={size:1024},e.FFT.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(e.FFT.prototype,"size",{get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}),e.FFT.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},e.FFT})),n((function(e){return e.Abs=function(){e.SignalBase.call(this),this._abs=this.input=this.output=new e.WaveShaper((function(e){return Math.abs(e)<.001?0:Math.abs(e)}),1024)},e.extend(e.Abs,e.SignalBase),e.Abs.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},e.Abs})),n((function(e){return e.Follower=function(){var t=e.defaults(arguments,["attack","release"],e.Follower);e.AudioNode.call(this),this.createInsOuts(1,1),this._abs=new e.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new e.WaveShaper,this._sub=new e.Subtract,this._delay=new e.Delay(this.blockTime),this._mult=new e.Multiply(1e4),this._attack=t.attack,this._release=t.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},e.extend(e.Follower,e.AudioNode),e.Follower.defaults={attack:.05,release:.5},e.Follower.prototype._setAttackRelease=function(t,n){var r=this.blockTime;t=e.Time(t).toFrequency(),n=e.Time(n).toFrequency(),t=Math.max(t,r),n=Math.max(n,r),this._frequencyValues.setMap((function(e){return e<=0?t:n}))},Object.defineProperty(e.Follower.prototype,"attack",{get:function(){return this._attack},set:function(e){this._attack=e,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(e.Follower.prototype,"release",{get:function(){return this._release},set:function(e){this._release=e,this._setAttackRelease(this._attack,this._release)}}),e.Follower.prototype.connect=e.SignalBase.prototype.connect,e.Follower.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},e.Follower})),n((function(e){return e.ScaledEnvelope=function(){var t=e.defaults(arguments,["attack","decay","sustain","release"],e.Envelope);e.Envelope.call(this,t),t=e.defaultArg(t,e.ScaledEnvelope.defaults),this._exp=this.output=new e.Pow(t.exponent),this._scale=this.output=new e.Scale(t.min,t.max),this._sig.chain(this._exp,this._scale)},e.extend(e.ScaledEnvelope,e.Envelope),e.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(e.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(e.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),Object.defineProperty(e.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),e.ScaledEnvelope.prototype.dispose=function(){return e.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},e.ScaledEnvelope})),n((function(e){return e.FrequencyEnvelope=function(){var t=e.defaults(arguments,["attack","decay","sustain","release"],e.Envelope);e.ScaledEnvelope.call(this,t),t=e.defaultArg(t,e.FrequencyEnvelope.defaults),this._octaves=t.octaves,this.baseFrequency=t.baseFrequency,this.octaves=t.octaves},e.extend(e.FrequencyEnvelope,e.Envelope),e.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(e.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(e){this._scale.min=this.toFrequency(e),this.octaves=this._octaves}}),Object.defineProperty(e.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._scale.max=this.baseFrequency*Math.pow(2,e)}}),Object.defineProperty(e.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),e.FrequencyEnvelope.prototype.dispose=function(){return e.ScaledEnvelope.prototype.dispose.call(this),this},e.FrequencyEnvelope})),n((function(e){return e.GreaterThanZero=function(){e.SignalBase.call(this),this._thresh=this.output=new e.WaveShaper((function(e){return e<=0?0:1}),127),this._scale=this.input=new e.Multiply(1e4),this._scale.connect(this._thresh)},e.extend(e.GreaterThanZero,e.SignalBase),e.GreaterThanZero.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},e.GreaterThanZero})),n((function(e){return e.GreaterThan=function(t){e.Signal.call(this),this.createInsOuts(2,0),this._param=this.input[0]=new e.Subtract(t),this.input[1]=this._param.input[1],this._gtz=this.output=new e.GreaterThanZero,this._param.connect(this._gtz)},e.extend(e.GreaterThan,e.Signal),e.GreaterThan.prototype.dispose=function(){return e.Signal.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this},e.GreaterThan})),n((function(e){return e.Gate=function(){var t=e.defaults(arguments,["threshold","attack","release"],e.Gate);e.AudioNode.call(this),this.createInsOuts(1,1),this._follower=new e.Follower(t.attack,t.release),this._gt=new e.GreaterThan(e.dbToGain(t.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},e.extend(e.Gate,e.AudioNode),e.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(e.Gate.prototype,"threshold",{get:function(){return e.gainToDb(this._gt.value)},set:function(t){this._gt.value=e.dbToGain(t)}}),Object.defineProperty(e.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(e){this._follower.attack=e}}),Object.defineProperty(e.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(e){this._follower.release=e}}),e.Gate.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},e.Gate})),n((function(e){function t(e){return function(t,n){n=this.toSeconds(n),e.apply(this,arguments);var r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}}return e.TickSignal=function(t){t=e.defaultArg(t,1),e.Signal.call(this,{units:e.Type.Ticks,value:t}),this._events.memory=1/0,this.cancelScheduledValues(0),this._events.add({type:e.Param.AutomationType.SetValue,time:0,value:t})},e.extend(e.TickSignal,e.Signal),e.TickSignal.prototype.setValueAtTime=t(e.Signal.prototype.setValueAtTime),e.TickSignal.prototype.linearRampToValueAtTime=t(e.Signal.prototype.linearRampToValueAtTime),e.TickSignal.prototype.setTargetAtTime=function(e,t,n){t=this.toSeconds(t),this.setRampPoint(t),e=this._fromUnits(e);for(var r=this._events.get(t),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var a=n*o+t,s=this._exponentialApproach(r.time,r.value,e,n,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},e.TickSignal.prototype.exponentialRampToValueAtTime=function(e,t){t=this.toSeconds(t),e=this._fromUnits(e);var n=this._events.get(t);null===n&&(n={value:this._initialValue,time:0});for(var r=Math.round(Math.max(10*(t-n.time),1)),i=(t-n.time)/r,o=0;o<=r;o++){var a=i*o+n.time,s=this._exponentialInterpolate(n.time,n.value,t,e,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},e.TickSignal.prototype._getTicksUntilEvent=function(t,n){if(null===t)t={ticks:0,time:0};else if(e.isUndef(t.ticks)){var r=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(r,t.time)}var i=this.getValueAtTime(t.time),o=this.getValueAtTime(n);return this._events.get(n).time===n&&this._events.get(n).type===e.Param.AutomationType.SetValue&&(o=this.getValueAtTime(n-this.sampleTime)),.5*(n-t.time)*(i+o)+t.ticks},e.TickSignal.prototype.getTicksAtTime=function(e){e=this.toSeconds(e);var t=this._events.get(e);return Math.max(this._getTicksUntilEvent(t,e),0)},e.TickSignal.prototype.getDurationOfTicks=function(e,t){t=this.toSeconds(t);var n=this.getTicksAtTime(t);return this.getTimeOfTick(n+e)-t},e.TickSignal.prototype.getTimeOfTick=function(t){var n=this._events.get(t,"ticks"),r=this._events.getAfter(t,"ticks");if(n&&n.ticks===t)return n.time;if(n&&r&&r.type===e.Param.AutomationType.Linear&&n.value!==r.value){var i=this.getValueAtTime(n.time),o=(this.getValueAtTime(r.time)-i)/(r.time-n.time),a=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-t)),s=(-i+a)/o;return(s>0?s:(-i-a)/o)+n.time}return n?0===n.value?1/0:n.time+(t-n.ticks)/n.value:t/this._initialValue},e.TickSignal.prototype.ticksToTime=function(t,n){return n=this.toSeconds(n),new e.Time(this.getDurationOfTicks(t,n))},e.TickSignal.prototype.timeToTicks=function(t,n){n=this.toSeconds(n),t=this.toSeconds(t);var r=this.getTicksAtTime(n),i=this.getTicksAtTime(n+t);return new e.Ticks(i-r)},e.TickSignal})),n((function(e){return e.TimelineState=function(t){e.Timeline.call(this),this._initial=t},e.extend(e.TimelineState,e.Timeline),e.TimelineState.prototype.getValueAtTime=function(e){var t=this.get(e);return null!==t?t.state:this._initial},e.TimelineState.prototype.setStateAtTime=function(e,t){return this.add({state:e,time:t}),this},e.TimelineState.prototype.getLastState=function(e,t){t=this.toSeconds(t);for(var n=this._search(t);n>=0;n--){var r=this._timeline[n];if(r.state===e)return r}},e.TimelineState.prototype.getNextState=function(e,t){t=this.toSeconds(t);var n=this._search(t);if(-1!==n)for(var r=n;r<this._timeline.length;r++){var i=this._timeline[r];if(i.state===e)return i}},e.TimelineState})),n((function(e){return e.TickSource=function(){var t=e.defaults(arguments,["frequency"],e.TickSource);this.frequency=new e.TickSignal(t.frequency,e.Type.Frequency),this._readOnly("frequency"),this._state=new e.TimelineState(e.State.Stopped),this._state.setStateAtTime(e.State.Stopped,0),this._tickOffset=new e.Timeline,this.setTicksAtTime(0,0)},e.extend(e.TickSource),e.TickSource.defaults={frequency:1},Object.defineProperty(e.TickSource.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),e.TickSource.prototype.start=function(t,n){return t=this.toSeconds(t),this._state.getValueAtTime(t)!==e.State.Started&&(this._state.setStateAtTime(e.State.Started,t),e.isDefined(n)&&this.setTicksAtTime(n,t)),this},e.TickSource.prototype.stop=function(t){if(t=this.toSeconds(t),this._state.getValueAtTime(t)===e.State.Stopped){var n=this._state.get(t);n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime(e.State.Stopped,t),this.setTicksAtTime(0,t),this},e.TickSource.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===e.State.Started&&this._state.setStateAtTime(e.State.Paused,t),this},e.TickSource.prototype.cancel=function(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this},e.TickSource.prototype.getTicksAtTime=function(t){t=this.toSeconds(t);var n=this._state.getLastState(e.State.Stopped,t),r={state:e.State.Paused,time:t};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,t+this.sampleTime,function(t){var n=i.time,r=this._tickOffset.get(t.time);r.time>=i.time&&(o=r.ticks,n=r.time),i.state===e.State.Started&&t.state!==e.State.Started&&(o+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(n)),i=t}.bind(this)),this._state.remove(r),o},Object.defineProperty(e.TickSource.prototype,"ticks",{get:function(){return this.getTicksAtTime(this.now())},set:function(e){this.setTicksAtTime(e,this.now())}}),Object.defineProperty(e.TickSource.prototype,"seconds",{get:function(){return this.getSecondsAtTime(this.now())},set:function(e){var t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}}),e.TickSource.prototype.getSecondsAtTime=function(t){t=this.toSeconds(t);var n=this._state.getLastState(e.State.Stopped,t),r={state:e.State.Paused,time:t};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,t+this.sampleTime,function(t){var n=i.time,r=this._tickOffset.get(t.time);r.time>=i.time&&(o=r.seconds,n=r.time),i.state===e.State.Started&&t.state!==e.State.Started&&(o+=t.time-n),i=t}.bind(this)),this._state.remove(r),o},e.TickSource.prototype.setTicksAtTime=function(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({time:t,ticks:e,seconds:this.frequency.getDurationOfTicks(e,t)}),this},e.TickSource.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)},e.TickSource.prototype.getTimeOfTick=function(t,n){n=e.defaultArg(n,this.now());var r=this._tickOffset.get(n),i=this._state.get(n),o=Math.max(r.time,i.time),a=this.frequency.getTicksAtTime(o)+t-r.ticks;return this.frequency.getTimeOfTick(a)},e.TickSource.prototype.forEachTickBetween=function(t,n,r){var i=this._state.get(t);if(this._state.forEachBetween(t,n,function(n){i.state===e.State.Started&&n.state!==e.State.Started&&this.forEachTickBetween(Math.max(i.time,t),n.time-this.sampleTime,r),i=n}.bind(this)),t=Math.max(i.time,t),i.state===e.State.Started&&this._state){var o=this.frequency.getTicksAtTime(t),a=(o-this.frequency.getTicksAtTime(i.time))%1;0!==a&&(a=1-a);for(var s=this.frequency.getTimeOfTick(o+a),u=null;s<n&&this._state;){try{r(s,Math.round(this.getTicksAtTime(s)))}catch(e){u=e;break}this._state&&(s+=this.frequency.getDurationOfTicks(1,s))}}if(u)throw u;return this},e.TickSource.prototype.dispose=function(){return e.Param.prototype.dispose.call(this),this._state.dispose(),this._state=null,this._tickOffset.dispose(),this._tickOffset=null,this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this},e.TickSource})),n((function(e){return e.Clock=function(){var t=e.defaults(arguments,["callback","frequency"],e.Clock);e.Emitter.call(this),this.callback=t.callback,this._nextTick=0,this._tickSource=new e.TickSource(t.frequency),this._lastUpdate=0,this.frequency=this._tickSource.frequency,this._readOnly("frequency"),this._state=new e.TimelineState(e.State.Stopped),this._state.setStateAtTime(e.State.Stopped,0),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},e.extend(e.Clock,e.Emitter),e.Clock.defaults={callback:e.noOp,frequency:1},Object.defineProperty(e.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),e.Clock.prototype.start=function(t,n){return t=this.toSeconds(t),this._state.getValueAtTime(t)!==e.State.Started&&(this._state.setStateAtTime(e.State.Started,t),this._tickSource.start(t,n),t<this._lastUpdate&&this.emit("start",t,n)),this},e.Clock.prototype.stop=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._state.setStateAtTime(e.State.Stopped,t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this},e.Clock.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===e.State.Started&&(this._state.setStateAtTime(e.State.Paused,t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this},Object.defineProperty(e.Clock.prototype,"ticks",{get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(e){this._tickSource.ticks=e}}),Object.defineProperty(e.Clock.prototype,"seconds",{get:function(){return this._tickSource.seconds},set:function(e){this._tickSource.seconds=e}}),e.Clock.prototype.getSecondsAtTime=function(e){return this._tickSource.getSecondsAtTime(e)},e.Clock.prototype.setTicksAtTime=function(e,t){return this._tickSource.setTicksAtTime(e,t),this},e.Clock.prototype.getTicksAtTime=function(e){return this._tickSource.getTicksAtTime(e)},e.Clock.prototype.nextTickTime=function(e,t){t=this.toSeconds(t);var n=this.getTicksAtTime(t);return this._tickSource.getTimeOfTick(n+e,t)},e.Clock.prototype._loop=function(){var t=this._lastUpdate,n=this.now();this._lastUpdate=n,t!==n&&(this._state.forEachBetween(t,n,function(t){switch(t.state){case e.State.Started:var n=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,n);break;case e.State.Stopped:0!==t.time&&this.emit("stop",t.time);break;case e.State.Paused:this.emit("pause",t.time)}}.bind(this)),this._tickSource.forEachTickBetween(t,n,function(e,t){this.callback(e,t)}.bind(this)))},e.Clock.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)},e.Clock.prototype.dispose=function(){e.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this._tickSource.dispose(),this._tickSource=null,this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},e.Clock})),n((function(e){e.IntervalTimeline=function(){e.call(this),this._root=null,this._length=0},e.extend(e.IntervalTimeline),e.IntervalTimeline.prototype.add=function(n){if(e.isUndef(n.time)||e.isUndef(n.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");n.time=n.time.valueOf();var r=new t(n.time,n.time+n.duration,n);for(null===this._root?this._root=r:this._root.insert(r),this._length++;null!==r;)r.updateHeight(),r.updateMax(),this._rebalance(r),r=r.parent;return this},e.IntervalTimeline.prototype.remove=function(e){if(null!==this._root){var t=[];this._root.search(e.time,t);for(var n=0;n<t.length;n++){var r=t[n];if(r.event===e){this._removeNode(r),this._length--;break}}}return this},Object.defineProperty(e.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),e.IntervalTimeline.prototype.cancel=function(e){return this.forEachFrom(e,function(e){this.remove(e)}.bind(this)),this},e.IntervalTimeline.prototype._setRoot=function(e){this._root=e,null!==this._root&&(this._root.parent=null)},e.IntervalTimeline.prototype._replaceNodeInParent=function(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)},e.IntervalTimeline.prototype._removeNode=function(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{var t,n;if(e.getBalance()>0)if(null===e.left.right)(t=e.left).right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right}else if(null===e.right.left)(t=e.right).left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent=t.parent,t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),this._rebalance(n)}e.dispose()},e.IntervalTimeline.prototype._rotateLeft=function(e){var t=e.parent,n=e.isLeftChild(),r=e.right;e.right=r.left,r.left=e,null!==t?n?t.left=r:t.right=r:this._setRoot(r)},e.IntervalTimeline.prototype._rotateRight=function(e){var t=e.parent,n=e.isLeftChild(),r=e.left;e.left=r.right,r.right=e,null!==t?n?t.left=r:t.right=r:this._setRoot(r)},e.IntervalTimeline.prototype._rebalance=function(e){var t=e.getBalance();t>1?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))},e.IntervalTimeline.prototype.get=function(e){if(null!==this._root){var t=[];if(this._root.search(e,t),t.length>0){for(var n=t[0],r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null},e.IntervalTimeline.prototype.forEach=function(e){if(null!==this._root){var t=[];this._root.traverse((function(e){t.push(e)}));for(var n=0;n<t.length;n++){var r=t[n].event;r&&e(r)}}return this},e.IntervalTimeline.prototype.forEachAtTime=function(e,t){if(null!==this._root){var n=[];this._root.search(e,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;i&&t(i)}}return this},e.IntervalTimeline.prototype.forEachFrom=function(e,t){if(null!==this._root){var n=[];this._root.searchAfter(e,n);for(var r=n.length-1;r>=0;r--)t(n[r].event)}return this},e.IntervalTimeline.prototype.dispose=function(){var e=[];null!==this._root&&this._root.traverse((function(t){e.push(t)}));for(var t=0;t<e.length;t++)e[t].dispose();return e=null,this._root=null,this};var t=function(e,t,n){this.event=n,this.low=e,this.high=t,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return t.prototype.insert=function(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)},t.prototype.search=function(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))},t.prototype.searchAfter=function(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)},t.prototype.traverse=function(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)},t.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},t.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},t.prototype.getBalance=function(){var e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e},t.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(t.prototype,"left",{get:function(){return this._left},set:function(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(t.prototype,"right",{get:function(){return this._right},set:function(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}}),t.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},e.IntervalTimeline})),n((function(e){return e.Ticks=function(t,n){if(!(this instanceof e.Ticks))return new e.Ticks(t,n);e.TransportTime.call(this,t,n)},e.extend(e.Ticks,e.TransportTime),e.Ticks.prototype._defaultUnits="i",e.Ticks.prototype._now=function(){return e.Transport.ticks},e.Ticks.prototype._beatsToUnits=function(e){return this._getPPQ()*e},e.Ticks.prototype._secondsToUnits=function(e){return e/(60/this._getBpm())*this._getPPQ()},e.Ticks.prototype._ticksToUnits=function(e){return e},e.Ticks.prototype.toTicks=function(){return this.valueOf()},e.Ticks.prototype.toSeconds=function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())},e.Ticks})),n((function(e){return e.TransportEvent=function(t,n){n=e.defaultArg(n,e.TransportEvent.defaults),e.call(this),this.Transport=t,this.id=e.TransportEvent._eventId++,this.time=e.Ticks(n.time),this.callback=n.callback,this._once=n.once},e.extend(e.TransportEvent),e.TransportEvent.defaults={once:!1,callback:e.noOp},e.TransportEvent._eventId=0,e.TransportEvent.prototype.invoke=function(e){this.callback&&(this.callback(e),this._once&&this.Transport&&this.Transport.clear(this.id))},e.TransportEvent.prototype.dispose=function(){return e.prototype.dispose.call(this),this.Transport=null,this.callback=null,this.time=null,this},e.TransportEvent})),n((function(e){return e.TransportRepeatEvent=function(t,n){e.TransportEvent.call(this,t,n),n=e.defaultArg(n,e.TransportRepeatEvent.defaults),this.duration=e.Ticks(n.duration),this._interval=e.Ticks(n.interval),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},e.extend(e.TransportRepeatEvent,e.TransportEvent),e.TransportRepeatEvent.defaults={duration:1/0,interval:1},e.TransportRepeatEvent.prototype.invoke=function(t){this._createEvents(t),e.TransportEvent.prototype.invoke.call(this,t)},e.TransportRepeatEvent.prototype._createEvents=function(t){var n=this.Transport.getTicksAtTime(t);n>=this.time&&n>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),e.Ticks(this._nextTick)))},e.TransportRepeatEvent.prototype._restart=function(t){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this._nextTick=this.time;var n=this.Transport.getTicksAtTime(t);n>this.time&&(this._nextTick=this.time+Math.ceil((n-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),e.Ticks(this._nextTick)),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),e.Ticks(this._nextTick))},e.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,e.TransportEvent.prototype.dispose.call(this),this.duration=null,this._interval=null,this},e.TransportRepeatEvent})),n((function(e){e.Transport=function(){e.Emitter.call(this),e.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=t.defaults.PPQ,this._clock=new e.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=e.Type.BPM,this.bpm.value=t.defaults.bpm,this._readOnly("bpm"),this._timeSignature=t.defaults.timeSignature,this._scheduledEvents={},this._timeline=new e.Timeline,this._repeatedEvents=new e.IntervalTimeline,this._syncedSignals=[],this._swingTicks=t.defaults.PPQ/2,this._swingAmount=0}.bind(this))},e.extend(e.Transport,e.Emitter),e.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},e.Transport.prototype._processTick=function(t,n){if(this._swingAmount>0&&n%this._ppq!=0&&n%(2*this._swingTicks)!=0){var r=n%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(r*Math.PI)*this._swingAmount;t+=e.Ticks(2*this._swingTicks/3).toSeconds()*i}this.loop&&n>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),n=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._timeline.forEachAtTime(n,(function(e){e.invoke(t)}))},e.Transport.prototype.schedule=function(t,n){var r=new e.TransportEvent(this,{time:e.TransportTime(n),callback:t});return this._addEvent(r,this._timeline)},e.Transport.prototype.scheduleRepeat=function(t,n,r,i){var o=new e.TransportRepeatEvent(this,{callback:t,interval:e.Time(n),time:e.TransportTime(r),duration:e.Time(e.defaultArg(i,1/0))});return this._addEvent(o,this._repeatedEvents)},e.Transport.prototype.scheduleOnce=function(t,n){var r=new e.TransportEvent(this,{time:e.TransportTime(n),callback:t,once:!0});return this._addEvent(r,this._timeline)},e.Transport.prototype.clear=function(e){if(this._scheduledEvents.hasOwnProperty(e)){var t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this},e.Transport.prototype._addEvent=function(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id},e.Transport.prototype.cancel=function(t){return t=e.defaultArg(t,0),t=this.toTicks(t),this._timeline.forEachFrom(t,function(e){this.clear(e.id)}.bind(this)),this._repeatedEvents.forEachFrom(t,function(e){this.clear(e.id)}.bind(this)),this},e.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(t,n){n=e.Ticks(n).toSeconds(),this.emit("start",t,n)}.bind(this)),this._clock.on("stop",function(e){this.emit("stop",e)}.bind(this)),this._clock.on("pause",function(e){this.emit("pause",e)}.bind(this))},Object.defineProperty(e.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),e.Transport.prototype.start=function(t,n){return e.isDefined(n)&&(n=this.toTicks(n)),this._clock.start(t,n),this},e.Transport.prototype.stop=function(e){return this._clock.stop(e),this},e.Transport.prototype.pause=function(e){return this._clock.pause(e),this},e.Transport.prototype.toggle=function(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!==e.State.Started?this.start(t):this.stop(t),this},Object.defineProperty(e.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(t){e.isArray(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}}),Object.defineProperty(e.Transport.prototype,"loopStart",{get:function(){return e.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e)}}),Object.defineProperty(e.Transport.prototype,"loopEnd",{get:function(){return e.Ticks(this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e)}}),e.Transport.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(e.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(e){this._swingAmount=e}}),Object.defineProperty(e.Transport.prototype,"swingSubdivision",{get:function(){return e.Ticks(this._swingTicks).toNotation()},set:function(e){this._swingTicks=this.toTicks(e)}}),Object.defineProperty(e.Transport.prototype,"position",{get:function(){var t=this.now(),n=this._clock.getTicksAtTime(t);return e.Ticks(n).toBarsBeatsSixteenths()},set:function(e){var t=this.toTicks(e);this.ticks=t}}),Object.defineProperty(e.Transport.prototype,"seconds",{get:function(){return this._clock.seconds},set:function(e){var t=this.now(),n=this.bpm.timeToTicks(e,t);this.ticks=n}}),Object.defineProperty(e.Transport.prototype,"progress",{get:function(){if(this.loop){var e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}}),Object.defineProperty(e.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(t){if(this._clock.ticks!==t){var n=this.now();this.state===e.State.Started?(this.emit("stop",n),this._clock.setTicksAtTime(t,n),this.emit("start",n,this.seconds)):this._clock.setTicksAtTime(t,n)}}}),e.Transport.prototype.getTicksAtTime=function(e){return Math.round(this._clock.getTicksAtTime(e))},e.Transport.prototype.getSecondsAtTime=function(e){return this._clock.getSecondsAtTime(e)},Object.defineProperty(e.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(e){var t=this.bpm.value;this._ppq=e,this.bpm.value=t}}),e.Transport.prototype._fromUnits=function(e){return 1/(60/e/this.PPQ)},e.Transport.prototype._toUnits=function(e){return e/this.PPQ*60},e.Transport.prototype.nextSubdivision=function(t){if(t=this.toTicks(t),this.state!==e.State.Started)return 0;var n=this.now(),r=t-this.getTicksAtTime(n)%t;return this._clock.nextTickTime(r,n)},e.Transport.prototype.syncSignal=function(t,n){if(!n){var r=this.now();n=0!==t.getValueAtTime(r)?t.getValueAtTime(r)/this.bpm.getValueAtTime(r):0}var i=new e.Gain(n);return this.bpm.chain(i,t._param),this._syncedSignals.push({ratio:i,signal:t,initial:t.value}),t.value=0,this},e.Transport.prototype.unsyncSignal=function(e){for(var t=this._syncedSignals.length-1;t>=0;t--){var n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this},e.Transport.prototype.dispose=function(){return e.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var t=e.Transport;return e.Transport=new t,e.Context.on("init",(function(n){n.Transport instanceof t?e.Transport=n.Transport:e.Transport=new t,n.Transport=e.Transport})),e.Context.on("close",(function(e){e.Transport instanceof t&&e.Transport.dispose()})),e.Transport})),n((function(e){return e.Volume=function(){var t=e.defaults(arguments,["volume"],e.Volume);e.AudioNode.call(this),this.output=this.input=new e.Gain(t.volume,e.Type.Decibels),this._unmutedVolume=t.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=t.mute},e.extend(e.Volume,e.AudioNode),e.Volume.defaults={volume:0,mute:!1},Object.defineProperty(e.Volume.prototype,"mute",{get:function(){return this.volume.value===-1/0},set:function(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}}),e.Volume.prototype.dispose=function(){return this.input.dispose(),e.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},e.Volume})),n((function(e){e.Master=function(){e.AudioNode.call(this),e.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new e.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)}.bind(this))},e.extend(e.Master,e.AudioNode),e.Master.defaults={volume:0,mute:!1},Object.defineProperty(e.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),e.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},e.Master.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},e.AudioNode.prototype.toMaster=function(){return this.connect(e.Master),this},window.AudioNode&&(AudioNode.prototype.toMaster=function(){return this.connect(e.Master),this});var t=e.Master;return e.Master=new t,e.Context.on("init",(function(n){n.Master instanceof t?e.Master=n.Master:e.Master=new t,n.Master=e.Master})),e.Context.on("close",(function(e){e.Master instanceof t&&e.Master.dispose()})),e.Master})),n((function(e){return e.Source=function(t){t=e.defaultArg(t,e.Source.defaults),e.AudioNode.call(this),this._volume=this.output=new e.Volume(t.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new e.TimelineState(e.State.Stopped),this._state.memory=100,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=t.mute},e.extend(e.Source,e.AudioNode),e.Source.defaults={volume:0,mute:!1},Object.defineProperty(e.Source.prototype,"state",{get:function(){return this._synced?e.Transport.state===e.State.Started?this._state.getValueAtTime(e.Transport.seconds):e.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(e.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),e.Source.prototype._start=e.noOp,e.Source.prototype.restart=e.noOp,e.Source.prototype._stop=e.noOp,e.Source.prototype.start=function(t,n,r){if(t=e.isUndef(t)&&this._synced?e.Transport.seconds:this.toSeconds(t),this._state.getValueAtTime(t)===e.State.Started)this._state.cancel(t),this._state.setStateAtTime(e.State.Started,t),this.restart(t,n,r);else if(this._state.setStateAtTime(e.State.Started,t),this._synced){var i=this._state.get(t);i.offset=e.defaultArg(n,0),i.duration=r;var o=e.Transport.schedule(function(e){this._start(e,n,r)}.bind(this),t);this._scheduled.push(o),e.Transport.state===e.State.Started&&this._syncedStart(this.now(),e.Transport.seconds)}else this._start.apply(this,arguments);return this},e.Source.prototype.stop=function(t){if(t=e.isUndef(t)&&this._synced?e.Transport.seconds:this.toSeconds(t),this._synced){var n=e.Transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}else this._stop.apply(this,arguments);return this._state.cancel(t),this._state.setStateAtTime(e.State.Stopped,t),this},e.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(t,n){if(n>0){var r=this._state.get(n);if(r&&r.state===e.State.Started&&r.time!==n){var i,o=n-this.toSeconds(r.time);r.duration&&(i=this.toSeconds(r.duration)-o),this._start(t,this.toSeconds(r.offset)+o,i)}}}.bind(this),this._syncedStop=function(t){var n=e.Transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(n)===e.State.Started&&this._stop(t)}.bind(this),e.Transport.on("start loopStart",this._syncedStart),e.Transport.on("stop pause loopEnd",this._syncedStop),this},e.Source.prototype.unsync=function(){this._synced&&(e.Transport.off("stop pause loopEnd",this._syncedStop),e.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var t=0;t<this._scheduled.length;t++){var n=this._scheduled[t];e.Transport.clear(n)}return this._scheduled=[],this._state.cancel(0),this},e.Source.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},e.Source})),n((function(e){e.supported&&(AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(e,t,n){var r=this.getChannelData(t);n=n||0;for(var i=0;i<r.length;i++)r[i+n]=e[i]},AudioBuffer.prototype.copyFromChannel=function(e,t,n){var r=this.getChannelData(t);n=n||0;for(var i=0;i<e.length;i++)e[i]=r[i+n]}))})),n((function(e){return e.Buffer=function(){var t=e.defaults(arguments,["url","onload","onerror"],e.Buffer);e.call(this),this._buffer=null,this._reversed=t.reverse,this._xhr=null,this._onload=e.noOp,t.url instanceof AudioBuffer||t.url instanceof e.Buffer?(this.set(t.url),t.onload&&(this.loaded?t.onload(this):this._onload=t.onload)):e.isString(t.url)&&this.load(t.url).then(t.onload).catch(t.onerror)},e.extend(e.Buffer),e.Buffer.defaults={url:void 0,reverse:!1,onload:e.noOp,onerror:e.noOp},e.Buffer.prototype.set=function(t){return t instanceof e.Buffer?t.loaded?this._buffer=t.get():t._onload=function(){this.set(t),this._onload(this)}.bind(this):this._buffer=t,this},e.Buffer.prototype.get=function(){return this._buffer},e.Buffer.prototype.load=function(t,n,r){return new Promise(function(i,o){this._xhr=e.Buffer.load(t,function(e){this._xhr=null,this.set(e),i(this),this._onload(this),n&&n(this)}.bind(this),function(e){this._xhr=null,o(e),r&&r(e)}.bind(this))}.bind(this))},e.Buffer.prototype.dispose=function(){return e.prototype.dispose.call(this),this._buffer=null,this._xhr&&(e.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(e.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(e.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(e.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(e.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),e.Buffer.prototype.fromArray=function(e){var t=e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,i=this.context.createBuffer(n,r,this.context.sampleRate);t||1!==n||(e=[e]);for(var o=0;o<n;o++)i.copyToChannel(e[o],o);return this._buffer=i,this},e.Buffer.prototype.toMono=function(t){if(e.isNumber(t))this.fromArray(this.toArray(t));else{for(var n=new Float32Array(this.length),r=this.numberOfChannels,i=0;i<r;i++)for(var o=this.toArray(i),a=0;a<o.length;a++)n[a]+=o[a];n=n.map((function(e){return e/r})),this.fromArray(n)}return this},e.Buffer.prototype.toArray=function(t){if(e.isNumber(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);for(var n=[],r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n},e.Buffer.prototype.getChannelData=function(e){return this._buffer.getChannelData(e)},e.Buffer.prototype.slice=function(t,n){n=e.defaultArg(n,this.duration);for(var r=Math.floor(this.context.sampleRate*this.toSeconds(t)),i=Math.floor(this.context.sampleRate*this.toSeconds(n)),o=[],a=0;a<this.numberOfChannels;a++)o[a]=this.toArray(a).slice(r,i);return(new e.Buffer).fromArray(o)},e.Buffer.prototype._reverse=function(){if(this.loaded)for(var e=0;e<this.numberOfChannels;e++)Array.prototype.reverse.call(this.getChannelData(e));return this},Object.defineProperty(e.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(e){this._reversed!==e&&(this._reversed=e,this._reverse())}}),e.Emitter.mixin(e.Buffer),e.Buffer._downloadQueue=[],e.Buffer.baseUrl="",e.Buffer.fromArray=function(t){return(new e.Buffer).fromArray(t)},e.Buffer.fromUrl=function(t){var n=new e.Buffer;return n.load(t).then((function(){return n}))},e.Buffer._removeFromDownloadQueue=function(t){var n=e.Buffer._downloadQueue.indexOf(t);-1!==n&&e.Buffer._downloadQueue.splice(n,1)},e.Buffer.load=function(t,n,r){n=e.defaultArg(n,e.noOp);var i=t.match(/\[(.+\|?)+\]$/);if(i){for(var o=i[1].split("|"),a=o[0],s=0;s<o.length;s++)if(e.Buffer.supportsType(o[s])){a=o[s];break}t=t.replace(i[0],a)}function u(t){if(e.Buffer._removeFromDownloadQueue(c),e.Buffer.emit("error",t),!r)throw t;r(t)}function l(){for(var t=0,n=0;n<e.Buffer._downloadQueue.length;n++)t+=e.Buffer._downloadQueue[n].progress;e.Buffer.emit("progress",t/e.Buffer._downloadQueue.length)}var c=new XMLHttpRequest;return c.open("GET",e.Buffer.baseUrl+t,!0),c.responseType="arraybuffer",c.progress=0,e.Buffer._downloadQueue.push(c),c.addEventListener("load",(function(){200===c.status?e.context.decodeAudioData(c.response).then((function(t){c.progress=1,l(),n(t),e.Buffer._removeFromDownloadQueue(c),0===e.Buffer._downloadQueue.length&&e.Buffer.emit("load")})).catch((function(){e.Buffer._removeFromDownloadQueue(c),u("Tone.Buffer: could not decode audio data: "+t)})):u("Tone.Buffer: could not locate file: "+t)})),c.addEventListener("error",u),c.addEventListener("progress",(function(e){e.lengthComputable&&(c.progress=e.loaded/e.total*.95,l())})),c.send(),c},e.Buffer.cancelDownloads=function(){return e.Buffer._downloadQueue.slice().forEach((function(t){e.Buffer._removeFromDownloadQueue(t),t.abort()})),e.Buffer},e.Buffer.supportsType=function(e){var t=e.split(".");return t=t[t.length-1],""!==document.createElement("audio").canPlayType("audio/"+t)},e.loaded=function(){var t,n;function r(){e.Buffer.off("load",t),e.Buffer.off("error",n)}return new Promise((function(r,i){t=function(){r()},n=function(){i()},e.Buffer.on("load",t),e.Buffer.on("error",n)})).then(r).catch((function(e){throw r(),new Error(e)}))},e.Buffer})),n((function(e){return e.OscillatorNode=function(){var t=e.defaults(arguments,["frequency","type"],e.OscillatorNode);e.AudioNode.call(this,t),this.onended=t.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new e.Gain,this._gainNode.gain.setValueAtTime(0,this.context.currentTime),this._oscillator=this.context.createOscillator(),this._oscillator.connect(this._gainNode),this.type=t.type,this.frequency=new e.Param(this._oscillator.frequency,e.Type.Frequency),this.frequency.value=t.frequency,this.detune=new e.Param(this._oscillator.detune,e.Type.Cents),this.detune.value=t.detune,this._gain=1},e.extend(e.OscillatorNode,e.AudioNode),e.OscillatorNode.defaults={frequency:440,detune:0,type:"sine",onended:e.noOp},Object.defineProperty(e.OscillatorNode.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),e.OscillatorNode.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?e.State.Started:e.State.Stopped},e.OscillatorNode.prototype.start=function(e){if(-1!==this._startTime)throw new Error("cannot call OscillatorNode.start more than once");this._startTime=this.toSeconds(e),this._oscillator.start(this._startTime);var t=this.context.currentTime;return this._gainNode.gain.cancelScheduledValues(t),this._gainNode.gain.setValueAtTime(0,t),this._gainNode.gain.setValueAtTime(1,this._startTime),this},e.OscillatorNode.prototype.setPeriodicWave=function(e){return this._oscillator.setPeriodicWave(e),this},e.OscillatorNode.prototype.stop=function(e){return this.cancelStop(),this._stopTime=this.toSeconds(e),this._gainNode.gain.setValueAtTime(0,this._stopTime),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(function(){this._oscillator.stop(this.now()),this.onended()}.bind(this),this._stopTime-this.now()),this},e.OscillatorNode.prototype.cancelStop=function(){return-1!==this._startTime&&(this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime)),this.context.clearTimeout(this._timeout),this._stopTime=-1),this},Object.defineProperty(e.OscillatorNode.prototype,"type",{get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e}}),e.OscillatorNode.prototype.dispose=function(){return this.context.clearTimeout(this._timeout),e.AudioNode.prototype.dispose.call(this),this.onended=null,this._oscillator.disconnect(),this._oscillator=null,this._gainNode.dispose(),this._gainNode=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this},e.OscillatorNode})),n((function(e){return e.Oscillator=function(){var t=e.defaults(arguments,["frequency","type"],e.Oscillator);e.Source.call(this,t),this._oscillator=null,this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.detune=new e.Signal(t.detune,e.Type.Cents),this._wave=null,this._partials=e.defaultArg(t.partials,[1]),this._phase=t.phase,this._type=null,this.type=t.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},e.extend(e.Oscillator,e.Source),e.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},e.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},e.Oscillator.prototype._start=function(t){this._oscillator=new e.OscillatorNode,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),t=this.toSeconds(t),this._oscillator.start(t)},e.Oscillator.prototype._stop=function(e){return this._oscillator&&(e=this.toSeconds(e),this._oscillator.stop(e)),this},e.Oscillator.prototype.restart=function(e){return this._oscillator.cancelStop(),this._state.cancel(this.toSeconds(e)),this},e.Oscillator.prototype.syncFrequency=function(){return e.Transport.syncSignal(this.frequency),this},e.Oscillator.prototype.unsyncFrequency=function(){return e.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(e.Oscillator.prototype,"type",{get:function(){return this._type},set:function(t){var n=[e.Oscillator.Type.Sine,e.Oscillator.Type.Square,e.Oscillator.Type.Triangle,e.Oscillator.Type.Sawtooth].includes(t);if(0===this._phase&&n)this._wave=null,null!==this._oscillator&&this._oscillator.type;else{var r=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(r[0],r[1]);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}this._type=t}}),e.Oscillator.prototype._getRealImaginary=function(t,n){var r=2048,i=new Float32Array(r),o=new Float32Array(r),a=1;if(t===e.Oscillator.Type.Custom)r=a=this._partials.length+1;else{var s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);s&&(a=parseInt(s[2])+1,t=s[1],r=a=Math.max(a,2))}for(var u=1;u<r;++u){var l,c=2/(u*Math.PI);switch(t){case e.Oscillator.Type.Sine:l=u<=a?1:0;break;case e.Oscillator.Type.Square:l=1&u?2*c:0;break;case e.Oscillator.Type.Sawtooth:l=c*(1&u?1:-1);break;case e.Oscillator.Type.Triangle:l=1&u?c*c*2*(u-1>>1&1?-1:1):0;break;case e.Oscillator.Type.Custom:l=this._partials[u-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+t)}0!==l?(i[u]=-l*Math.sin(n*u),o[u]=l*Math.cos(n*u)):(i[u]=0,o[u]=0)}return[i,o]},e.Oscillator.prototype._inverseFFT=function(e,t,n){for(var r=0,i=e.length,o=0;o<i;o++)r+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return r},e.Oscillator.prototype._getInitialValue=function(){for(var e=this._getRealImaginary(this._type,0),t=e[0],n=e[1],r=0,i=2*Math.PI,o=0;o<8;o++)r=Math.max(this._inverseFFT(t,n,o/8*i),r);return-this._inverseFFT(t,n,this._phase)/r},Object.defineProperty(e.Oscillator.prototype,"partials",{get:function(){return this._type!==e.Oscillator.Type.Custom?[]:this._partials},set:function(t){this._partials=t,this.type=e.Oscillator.Type.Custom}}),Object.defineProperty(e.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(e){this._phase=e*Math.PI/180,this.type=this._type}}),e.Oscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.dispose(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},e.Oscillator})),n((function(e){return e.AudioToGain=function(){e.SignalBase.call(this),this._norm=this.input=this.output=new e.WaveShaper((function(e){return(e+1)/2}))},e.extend(e.AudioToGain,e.SignalBase),e.AudioToGain.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},e.AudioToGain})),n((function(e){return e.Zero=function(){e.SignalBase.call(this),this._gain=this.input=this.output=new e.Gain,this.context.getConstant(0).connect(this._gain)},e.extend(e.Zero,e.SignalBase),e.Zero.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},e.Zero})),n((function(e){return e.LFO=function(){var t=e.defaults(arguments,["frequency","min","max"],e.LFO);e.AudioNode.call(this),this._oscillator=new e.Oscillator({frequency:t.frequency,type:t.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=e.Type.NormalRange,this.amplitude.value=t.amplitude,this._stoppedSignal=new e.Signal(0,e.Type.AudioRange),this._zeros=new e.Zero,this._stoppedValue=0,this._a2g=new e.AudioToGain,this._scaler=this.output=new e.Scale(t.min,t.max),this._units=e.Type.Default,this.units=t.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=t.phase},e.extend(e.LFO,e.AudioNode),e.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:e.Type.Default},e.LFO.prototype.start=function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this},e.LFO.prototype.stop=function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this},e.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},e.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(e.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(e){e=this._fromUnits(e),this._scaler.min=e}}),Object.defineProperty(e.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(e){e=this._fromUnits(e),this._scaler.max=e}}),Object.defineProperty(e.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(e.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(e.LFO.prototype,"units",{get:function(){return this._units},set:function(e){var t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}}),Object.defineProperty(e.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(e){this._oscillator.mute=e}}),Object.defineProperty(e.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),e.LFO.prototype.connect=function(t){return t.constructor!==e.Signal&&t.constructor!==e.Param||(this.convert=t.convert,this.units=t.units),e.SignalBase.prototype.connect.apply(this,arguments),this},e.LFO.prototype._fromUnits=e.Param.prototype._fromUnits,e.LFO.prototype._toUnits=e.Param.prototype._toUnits,e.LFO.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},e.LFO})),n((function(e){return e.Limiter=function(){var t=e.defaults(arguments,["threshold"],e.Limiter);e.AudioNode.call(this),this._compressor=this.input=this.output=new e.Compressor({attack:.001,decay:.001,threshold:t.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},e.extend(e.Limiter,e.AudioNode),e.Limiter.defaults={threshold:-12},e.Limiter.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},e.Limiter})),n((function(e){return e.LowpassCombFilter=function(){var t=e.defaults(arguments,["delayTime","resonance","dampening"],e.LowpassCombFilter);e.AudioNode.call(this),this.createInsOuts(1,1),this._delay=this.input=new e.Delay(t.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new e.Param({param:this._lowpass.frequency,units:e.Type.Frequency,value:t.dampening}),this._feedback=new e.Gain(t.resonance,e.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},e.extend(e.LowpassCombFilter,e.AudioNode),e.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},e.LowpassCombFilter.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},e.LowpassCombFilter})),n((function(e){return e.Merge=function(){e.AudioNode.call(this),this.createInsOuts(2,0),this.left=this.input[0]=new e.Gain,this.right=this.input[1]=new e.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},e.extend(e.Merge,e.AudioNode),e.Merge.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},e.Merge})),n((function(e){return e.Meter=function(){var t=e.defaults(arguments,["smoothing"],e.Meter);e.AudioNode.call(this),this.input=this.output=this._analyser=new e.Analyser("waveform",1024),this.smoothing=t.smoothing},e.extend(e.Meter,e.AudioNode),e.Meter.defaults={smoothing:.8},e.Meter.prototype.getLevel=function(){this._analyser.type="fft";var e=this._analyser.getValue();return Math.max.apply(this,e)+28},e.Meter.prototype.getValue=function(){return this._analyser.type="waveform",this._analyser.getValue()[0]},Object.defineProperty(e.Meter.prototype,"smoothing",{get:function(){return this._analyser.smoothing},set:function(e){this._analyser.smoothing=e}}),e.Meter.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},e.Meter})),n((function(e){return e.Split=function(){e.AudioNode.call(this),this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this._splitter.channelCount=2,this._splitter.channelCountMode="explicit",this.left=this.output[0]=new e.Gain,this.right=this.output[1]=new e.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},e.extend(e.Split,e.AudioNode),e.Split.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},e.Split})),n((function(e){return e.MidSideSplit=function(){e.AudioNode.call(this),this.createInsOuts(0,2),this._split=this.input=new e.Split,this._midAdd=new e.Add,this.mid=this.output[0]=new e.Multiply(Math.SQRT1_2),this._sideSubtract=new e.Subtract,this.side=this.output[1]=new e.Multiply(Math.SQRT1_2),this._split.connect(this._midAdd,0,0),this._split.connect(this._midAdd,1,1),this._split.connect(this._sideSubtract,0,0),this._split.connect(this._sideSubtract,1,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)},e.extend(e.MidSideSplit,e.AudioNode),e.MidSideSplit.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midAdd.dispose(),this._midAdd=null,this._sideSubtract.dispose(),this._sideSubtract=null,this._split.dispose(),this._split=null,this},e.MidSideSplit})),n((function(e){return e.MidSideMerge=function(){e.AudioNode.call(this),this.createInsOuts(2,0),this.mid=this.input[0]=new e.Gain,this._left=new e.Add,this._timesTwoLeft=new e.Multiply(Math.SQRT1_2),this.side=this.input[1]=new e.Gain,this._right=new e.Subtract,this._timesTwoRight=new e.Multiply(Math.SQRT1_2),this._merge=this.output=new e.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._timesTwoLeft),this._right.connect(this._timesTwoRight),this._timesTwoLeft.connect(this._merge,0,0),this._timesTwoRight.connect(this._merge,0,1)},e.extend(e.MidSideMerge,e.AudioNode),e.MidSideMerge.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._timesTwoLeft.dispose(),this._timesTwoLeft=null,this._right.dispose(),this._right=null,this._timesTwoRight.dispose(),this._timesTwoRight=null,this._merge.dispose(),this._merge=null,this},e.MidSideMerge})),n((function(e){return e.MidSideCompressor=function(t){e.AudioNode.call(this),t=e.defaultArg(t,e.MidSideCompressor.defaults),this._midSideSplit=this.input=new e.MidSideSplit,this._midSideMerge=this.output=new e.MidSideMerge,this.mid=new e.Compressor(t.mid),this.side=new e.Compressor(t.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},e.extend(e.MidSideCompressor,e.AudioNode),e.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},e.MidSideCompressor.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},e.MidSideCompressor})),n((function(e){return e.Mono=function(){e.AudioNode.call(this),this.createInsOuts(1,0),this._merge=this.output=new e.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)},e.extend(e.Mono,e.AudioNode),e.Mono.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},e.Mono})),n((function(e){return e.MultibandCompressor=function(t){e.AudioNode.call(this),t=e.defaultArg(arguments,e.MultibandCompressor.defaults),this._splitter=this.input=new e.MultibandSplit({lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new e.Gain,this.low=new e.Compressor(t.low),this.mid=new e.Compressor(t.mid),this.high=new e.Compressor(t.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},e.extend(e.MultibandCompressor,e.AudioNode),e.MultibandCompressor.defaults={low:e.Compressor.defaults,mid:e.Compressor.defaults,high:e.Compressor.defaults,lowFrequency:250,highFrequency:2e3},e.MultibandCompressor.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},e.MultibandCompressor})),n((function(e){if(e.supported&&!window.StereoPannerNode){var t=function(t){this.context=t,this.pan=new e.Signal(0,e.Type.AudioRange);var n=new e.WaveShaper((function(t){return e.equalPowerScale((t+1)/2)}),4096),r=new e.WaveShaper((function(t){return e.equalPowerScale(1-(t+1)/2)}),4096),i=new e.Gain,o=new e.Gain,a=this.input=new e.Split;(new e.Zero).fan(n,r);var s=this.output=new e.Merge;a.left.chain(i,s.left),a.right.chain(o,s.right),this.pan.chain(r,i.gain),this.pan.chain(n,o.gain)};t.prototype.disconnect=function(){this.output.disconnect.apply(this.output,arguments)},t.prototype.connect=function(){this.output.connect.apply(this.output,arguments)},AudioContext.prototype.createStereoPanner=function(){return new t(this)},e.Context.prototype.createStereoPanner=function(){return new t(this)}}})),n((function(e){return e.Panner=function(t){e.AudioNode.call(this),this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan,this.pan.value=e.defaultArg(t,0),this._readOnly("pan")},e.extend(e.Panner,e.AudioNode),e.Panner.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable("pan"),this._panner.disconnect(),this._panner=null,this.pan=null,this},e.Panner})),n((function(e){return e.Panner3D=function(){var t=e.defaults(arguments,["positionX","positionY","positionZ"],e.Panner3D);e.AudioNode.call(this),this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=t.panningModel,this._panner.maxDistance=t.maxDistance,this._panner.distanceModel=t.distanceModel,this._panner.coneOuterGain=t.coneOuterGain,this._panner.coneOuterAngle=t.coneOuterAngle,this._panner.coneInnerAngle=t.coneInnerAngle,this._panner.refDistance=t.refDistance,this._panner.rolloffFactor=t.rolloffFactor,this._orientation=[t.orientationX,t.orientationY,t.orientationZ],this._position=[t.positionX,t.positionY,t.positionZ],this.orientationX=t.orientationX,this.orientationY=t.orientationY,this.orientationZ=t.orientationZ,this.positionX=t.positionX,this.positionY=t.positionY,this.positionZ=t.positionZ},e.extend(e.Panner3D,e.AudioNode),e.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},e.Panner3D.prototype._rampTimeConstant=.01,e.Panner3D.prototype.setPosition=function(e,t,n){if(this._panner.positionX){var r=this.now();this._panner.positionX.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setPosition(e,t,n);return this._position=Array.prototype.slice.call(arguments),this},e.Panner3D.prototype.setOrientation=function(e,t,n){if(this._panner.orientationX){var r=this.now();this._panner.orientationX.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setOrientation(e,t,n);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(e.Panner3D.prototype,"positionX",{set:function(e){this._position[0]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(e.Panner3D.prototype,"positionY",{set:function(e){this._position[1]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(e.Panner3D.prototype,"positionZ",{set:function(e){this._position[2]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(e.Panner3D.prototype,"orientationX",{set:function(e){this._orientation[0]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(e.Panner3D.prototype,"orientationY",{set:function(e){this._orientation[1]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(e.Panner3D.prototype,"orientationZ",{set:function(e){this._orientation[2]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),e.Panner3D._aliasProperty=function(t){Object.defineProperty(e.Panner3D.prototype,t,{set:function(e){this._panner[t]=e},get:function(){return this._panner[t]}})},e.Panner3D._aliasProperty("panningModel"),e.Panner3D._aliasProperty("refDistance"),e.Panner3D._aliasProperty("rolloffFactor"),e.Panner3D._aliasProperty("distanceModel"),e.Panner3D._aliasProperty("coneInnerAngle"),e.Panner3D._aliasProperty("coneOuterAngle"),e.Panner3D._aliasProperty("coneOuterGain"),e.Panner3D._aliasProperty("maxDistance"),e.Panner3D.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},e.Panner3D})),n((function(e){return e.PanVol=function(){var t=e.defaults(arguments,["pan","volume"],e.PanVol);e.AudioNode.call(this),this._panner=this.input=new e.Panner(t.pan),this.pan=this._panner.pan,this._volume=this.output=new e.Volume(t.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,this._readOnly(["pan","volume"])},e.extend(e.PanVol,e.AudioNode),e.PanVol.defaults={pan:0,volume:0,mute:!1},Object.defineProperty(e.PanVol.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),e.PanVol.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},e.PanVol})),n((function(e){return e.Solo=function(){var t=e.defaults(arguments,["solo"],e.Solo);e.AudioNode.call(this),this.input=this.output=new e.Gain,this._soloBind=this._soloed.bind(this),this.context.on("solo",this._soloBind),this.solo=t.solo},e.extend(e.Solo,e.AudioNode),e.Solo.defaults={solo:!1},Object.defineProperty(e.Solo.prototype,"solo",{get:function(){return this._isSoloed()},set:function(e){e?this._addSolo():this._removeSolo(),this.context.emit("solo",this)}}),Object.defineProperty(e.Solo.prototype,"muted",{get:function(){return 0===this.input.gain.value}}),e.Solo.prototype._addSolo=function(){e.isArray(this.context._currentSolo)||(this.context._currentSolo=[]),this._isSoloed()||this.context._currentSolo.push(this)},e.Solo.prototype._removeSolo=function(){if(this._isSoloed()){var e=this.context._currentSolo.indexOf(this);this.context._currentSolo.splice(e,1)}},e.Solo.prototype._isSoloed=function(){return!!e.isArray(this.context._currentSolo)&&0!==this.context._currentSolo.length&&-1!==this.context._currentSolo.indexOf(this)},e.Solo.prototype._noSolos=function(){return!e.isArray(this.context._currentSolo)||0===this.context._currentSolo.length},e.Solo.prototype._soloed=function(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0},e.Solo.prototype.dispose=function(){return this.context.off("solo",this._soloBind),this._removeSolo(),this._soloBind=null,e.AudioNode.prototype.dispose.call(this),this},e.Solo})),n((function(e){return e.Waveform=function(){var t=e.defaults(arguments,["size"],e.Waveform);t.type=e.Analyser.Type.Waveform,e.AudioNode.call(this),this._analyser=this.input=this.output=new e.Analyser(t)},e.extend(e.Waveform,e.AudioNode),e.Waveform.defaults={size:1024},e.Waveform.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(e.Waveform.prototype,"size",{get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}),e.Waveform.prototype.dispose=function(){e.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},e.Waveform})),n((function(e){return e.CtrlInterpolate=function(){var t=e.defaults(arguments,["values","index"],e.CtrlInterpolate);e.call(this),this.values=t.values,this.index=t.index},e.extend(e.CtrlInterpolate),e.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(e.CtrlInterpolate.prototype,"value",{get:function(){var e=this.index;e=Math.min(e,this.values.length-1);var t=Math.floor(e),n=this.values[t],r=this.values[Math.ceil(e)];return this._interpolate(e-t,n,r)}}),e.CtrlInterpolate.prototype._interpolate=function(t,n,r){if(e.isArray(n)){for(var i=[],o=0;o<n.length;o++)i[o]=this._interpolate(t,n[o],r[o]);return i}if(e.isObject(n)){var a={};for(var s in n)a[s]=this._interpolate(t,n[s],r[s]);return a}return(1-t)*(n=this._toNumber(n))+t*(r=this._toNumber(r))},e.CtrlInterpolate.prototype._toNumber=function(t){return e.isNumber(t)?t:this.toSeconds(t)},e.CtrlInterpolate.prototype.dispose=function(){this.values=null},e.CtrlInterpolate})),n((function(e){return e.CtrlMarkov=function(t,n){e.call(this),this.values=e.defaultArg(t,{}),this.value=e.defaultArg(n,Object.keys(this.values)[0])},e.extend(e.CtrlMarkov),e.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var t=this.values[this.value];if(e.isArray(t))for(var n=this._getProbDistribution(t),r=Math.random(),i=0,o=0;o<n.length;o++){var a=n[o];if(r>i&&r<i+a){var s=t[o];e.isObject(s)?this.value=s.value:this.value=s}i+=a}else this.value=t}return this.value},e.CtrlMarkov.prototype._getProbDistribution=function(t){for(var n=[],r=0,i=!1,o=0;o<t.length;o++){var a=t[o];e.isObject(a)?(i=!0,n[o]=a.probability):n[o]=1/t.length,r+=n[o]}if(i)for(var s=0;s<n.length;s++)n[s]=n[s]/r;return n},e.CtrlMarkov.prototype.dispose=function(){this.values=null},e.CtrlMarkov})),n((function(e){return e.CtrlPattern=function(){var t=e.defaults(arguments,["values","type"],e.CtrlPattern);e.call(this),this.values=t.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=t.type},e.extend(e.CtrlPattern),e.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},e.CtrlPattern.defaults={type:e.CtrlPattern.Type.Up,values:[]},Object.defineProperty(e.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var t=this.values[this.index];return this.type===e.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),t=this.values[this._shuffled[this.index]]),t}}}),Object.defineProperty(e.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._shuffled=null,this._type===e.CtrlPattern.Type.Up||this._type===e.CtrlPattern.Type.UpDown||this._type===e.CtrlPattern.Type.RandomOnce||this._type===e.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==e.CtrlPattern.Type.Down&&this._type!==e.CtrlPattern.Type.DownUp&&this._type!==e.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1),this._type===e.CtrlPattern.Type.UpDown||this._type===e.CtrlPattern.Type.AlternateUp?this._direction=e.CtrlPattern.Type.Up:this._type!==e.CtrlPattern.Type.DownUp&&this._type!==e.CtrlPattern.Type.AlternateDown||(this._direction=e.CtrlPattern.Type.Down),this._type===e.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===e.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),e.CtrlPattern.prototype.next=function(){var t=this.type;return t===e.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):t===e.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):t===e.CtrlPattern.Type.UpDown||t===e.CtrlPattern.Type.DownUp?(this._direction===e.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=e.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=e.CtrlPattern.Type.Down)):t===e.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):t===e.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):t===e.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):t===e.CtrlPattern.Type.AlternateUp?(this._direction===e.CtrlPattern.Type.Up?(this.index+=2,this._direction=e.CtrlPattern.Type.Down):(this.index-=1,this._direction=e.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=e.CtrlPattern.Type.Up)):t===e.CtrlPattern.Type.AlternateDown&&(this._direction===e.CtrlPattern.Type.Up?(this.index+=1,this._direction=e.CtrlPattern.Type.Down):(this.index-=2,this._direction=e.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=e.CtrlPattern.Type.Down)),this.value},e.CtrlPattern.prototype._shuffleValues=function(){var e=[];this._shuffled=[];for(var t=0;t<this.values.length;t++)e[t]=t;for(;e.length>0;){var n=e.splice(Math.floor(e.length*Math.random()),1);this._shuffled.push(n[0])}},e.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},e.CtrlPattern})),n((function(e){return e.CtrlRandom=function(){var t=e.defaults(arguments,["min","max"],e.CtrlRandom);e.call(this),this.min=t.min,this.max=t.max,this.integer=t.integer},e.extend(e.CtrlRandom),e.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(e.CtrlRandom.prototype,"value",{get:function(){var e=this.toSeconds(this.min),t=this.toSeconds(this.max),n=Math.random(),r=n*e+(1-n)*t;return this.integer&&(r=Math.floor(r)),r}}),e.CtrlRandom})),n((function(e){return e.Buffers=function(t){var n=Array.prototype.slice.call(arguments);n.shift();var r=e.defaults(n,["onload","baseUrl"],e.Buffers);for(var i in e.call(this),this._buffers={},this.baseUrl=r.baseUrl,this._loadingCount=0,t)this._loadingCount++,this.add(i,t[i],this._bufferLoaded.bind(this,r.onload))},e.extend(e.Buffers),e.Buffers.defaults={onload:e.noOp,baseUrl:""},e.Buffers.prototype.has=function(e){return this._buffers.hasOwnProperty(e)},e.Buffers.prototype.get=function(e){if(this.has(e))return this._buffers[e];throw new Error("Tone.Buffers: no buffer named "+e)},e.Buffers.prototype._bufferLoaded=function(e){this._loadingCount--,0===this._loadingCount&&e&&e(this)},Object.defineProperty(e.Buffers.prototype,"loaded",{get:function(){var e=!0;for(var t in this._buffers){var n=this.get(t);e=e&&n.loaded}return e}}),e.Buffers.prototype.add=function(t,n,r){return r=e.defaultArg(r,e.noOp),n instanceof e.Buffer?(this._buffers[t]=n,r(this)):n instanceof AudioBuffer?(this._buffers[t]=new e.Buffer(n),r(this)):e.isString(n)&&(this._buffers[t]=new e.Buffer(this.baseUrl+n,r)),this},e.Buffers.prototype.dispose=function(){for(var t in e.prototype.dispose.call(this),this._buffers)this._buffers[t].dispose();return this._buffers=null,this},e.Buffers})),n((function(e){var t={};return e.prototype.send=function(n,r){t.hasOwnProperty(n)||(t[n]=this.context.createGain()),r=e.defaultArg(r,0);var i=new e.Gain(r,e.Type.Decibels);return this.connect(i),i.connect(t[n]),i},e.prototype.receive=function(e,n){return t.hasOwnProperty(e)||(t[e]=this.context.createGain()),t[e].connect(this,0,n),this},e.Context.on("init",(function(e){e.Buses?t=e.Buses:(t={},e.Buses=t)})),e})),n((function(e){return e.Draw=function(){e.call(this),this._events=new e.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},e.extend(e.Draw),e.Draw.prototype.schedule=function(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},e.Draw.prototype.cancel=function(e){return this._events.cancel(this.toSeconds(e)),this},e.Draw.prototype._drawLoop=function(){for(var t=e.now();this._events.length&&this._events.peek().time-this.anticipation<=t;){var n=this._events.shift();t-n.time<=this.expiration&&n.callback()}this._events.length>0&&requestAnimationFrame(this._boundDrawLoop)},e.Draw=new e.Draw,e.Draw})),n((function(e){e.Listener=function(){e.call(this),this._orientation=[0,0,0,0,0,0],this._position=[0,0,0],e.getContext(function(){this.set(t.defaults)}.bind(this))},e.extend(e.Listener),e.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},e.Listener.prototype._rampTimeConstant=.01,e.Listener.prototype.setPosition=function(e,t,n){if(this.context.listener.positionX){var r=this.now();this.context.listener.positionX.setTargetAtTime(e,r,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(t,r,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this.context.listener.setPosition(e,t,n);return this._position=Array.prototype.slice.call(arguments),this},e.Listener.prototype.setOrientation=function(e,t,n,r,i,o){if(this.context.listener.forwardX){var a=this.now();this.context.listener.forwardX.setTargetAtTime(e,a,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(t,a,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(n,a,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(r,a,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(i,a,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(o,a,this._rampTimeConstant)}else this.context.listener.setOrientation(e,t,n,r,i,o);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(e.Listener.prototype,"positionX",{set:function(e){this._position[0]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(e.Listener.prototype,"positionY",{set:function(e){this._position[1]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(e.Listener.prototype,"positionZ",{set:function(e){this._position[2]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(e.Listener.prototype,"forwardX",{set:function(e){this._orientation[0]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(e.Listener.prototype,"forwardY",{set:function(e){this._orientation[1]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(e.Listener.prototype,"forwardZ",{set:function(e){this._orientation[2]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(e.Listener.prototype,"upX",{set:function(e){this._orientation[3]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(e.Listener.prototype,"upY",{set:function(e){this._orientation[4]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(e.Listener.prototype,"upZ",{set:function(e){this._orientation[5]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),e.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var t=e.Listener;return e.Listener=new t,e.Context.on("init",(function(n){n.Listener instanceof t?e.Listener=n.Listener:e.Listener=new t,n.Listener=e.Listener})),e.Listener})),n((function(e){function t(n,r,i,o){o=e.defaultArg(o,0);var a=new e.OfflineContext(2,r,i);e.context=a;var s=n(e.Transport);return a.currentTime>0&&o<1e3?t(n,r,i,++o):{response:s,context:a}}return e.Offline=function(n,r){var i,o=e.context.sampleRate,a=e.context,s=t(n,r,o),u=s.response,l=s.context;return i=u instanceof Promise?u.then((function(){return l.render()})):l.render(),e.context=a,i.then((function(t){return new e.Buffer(t)}))},e.Offline})),n((function(e){return e.Effect=function(){var t=e.defaults(arguments,["wet"],e.Effect);e.AudioNode.call(this),this.createInsOuts(1,1),this._dryWet=new e.CrossFade(t.wet),this.wet=this._dryWet.fade,this.effectSend=new e.Gain,this.effectReturn=new e.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},e.extend(e.Effect,e.AudioNode),e.Effect.defaults={wet:1},e.Effect.prototype.connectEffect=function(e){return this.effectSend.chain(e,this.effectReturn),this},e.Effect.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},e.Effect})),n((function(e){return e.AutoFilter=function(){var t=e.defaults(arguments,["frequency","baseFrequency","octaves"],e.AutoFilter);e.Effect.call(this,t),this._lfo=new e.LFO({frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new e.Filter(t.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=t.type,this._readOnly(["frequency","depth"]),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency},e.extend(e.AutoFilter,e.Effect),e.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},e.AutoFilter.prototype.start=function(e){return this._lfo.start(e),this},e.AutoFilter.prototype.stop=function(e){return this._lfo.stop(e),this},e.AutoFilter.prototype.sync=function(e){return this._lfo.sync(e),this},e.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(e.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),Object.defineProperty(e.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}}),Object.defineProperty(e.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._lfo.max=this.baseFrequency*Math.pow(2,e)}}),e.AutoFilter.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},e.AutoFilter})),n((function(e){return e.AutoPanner=function(){var t=e.defaults(arguments,["frequency"],e.AutoPanner);e.Effect.call(this,t),this._lfo=new e.LFO({frequency:t.frequency,amplitude:t.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new e.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=t.type,this._readOnly(["depth","frequency"])},e.extend(e.AutoPanner,e.Effect),e.AutoPanner.defaults={frequency:1,type:"sine",depth:1},e.AutoPanner.prototype.start=function(e){return this._lfo.start(e),this},e.AutoPanner.prototype.stop=function(e){return this._lfo.stop(e),this},e.AutoPanner.prototype.sync=function(e){return this._lfo.sync(e),this},e.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(e.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),e.AutoPanner.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},e.AutoPanner})),n((function(e){return e.AutoWah=function(){var t=e.defaults(arguments,["baseFrequency","octaves","sensitivity"],e.AutoWah);e.Effect.call(this,t),this.follower=new e.Follower(t.follower),this._sweepRange=new e.ScaleExp(0,1,.5),this._baseFrequency=t.baseFrequency,this._octaves=t.octaves,this._inputBoost=new e.Gain,this._bandpass=new e.Filter({rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new e.Filter(0,"peaking"),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,this._readOnly(["gain","Q"])},e.extend(e.AutoWah,e.Effect),e.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(e.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._setSweepRange()}}),Object.defineProperty(e.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._setSweepRange()}}),Object.defineProperty(e.AutoWah.prototype,"sensitivity",{get:function(){return e.gainToDb(1/this._inputBoost.gain.value)},set:function(t){this._inputBoost.gain.value=1/e.dbToGain(t)}}),e.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},e.AutoWah.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},e.AutoWah})),n((function(e){return e.Modulo=function(t){e.SignalBase.call(this),this.createInsOuts(1,0),this._shaper=new e.WaveShaper(Math.pow(2,16)),this._multiply=new e.Multiply,this._subtract=this.output=new e.Subtract,this._modSignal=new e.Signal(t),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(t)},e.extend(e.Modulo,e.SignalBase),e.Modulo.prototype._setWaveShaper=function(e){this._shaper.setMap((function(t){return Math.floor((t+1e-4)/e)}))},Object.defineProperty(e.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(e){this._modSignal.value=e,this._setWaveShaper(e)}}),e.Modulo.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},e.Modulo})),n((function(e){return e.BitCrusher=function(){var t=e.defaults(arguments,["bits"],e.BitCrusher);e.Effect.call(this,t);var n=1/Math.pow(2,t.bits-1);this._subtract=new e.Subtract,this._modulo=new e.Modulo(n),this._bits=t.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},e.extend(e.BitCrusher,e.Effect),e.BitCrusher.defaults={bits:4},Object.defineProperty(e.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(e){this._bits=e;var t=1/Math.pow(2,e-1);this._modulo.value=t}}),e.BitCrusher.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},e.BitCrusher})),n((function(e){return e.Chebyshev=function(){var t=e.defaults(arguments,["order"],e.Chebyshev);e.Effect.call(this,t),this._shaper=new e.WaveShaper(4096),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample},e.extend(e.Chebyshev,e.Effect),e.Chebyshev.defaults={order:1,oversample:"none"},e.Chebyshev.prototype._getCoefficient=function(e,t,n){return n.hasOwnProperty(t)||(n[t]=0===t?0:1===t?e:2*e*this._getCoefficient(e,t-1,n)-this._getCoefficient(e,t-2,n)),n[t]},Object.defineProperty(e.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(e){this._order=e;for(var t=new Array(4096),n=t.length,r=0;r<n;++r){var i=2*r/n-1;t[r]=0===i?0:this._getCoefficient(i,e,{})}this._shaper.curve=t}}),Object.defineProperty(e.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),e.Chebyshev.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},e.Chebyshev})),n((function(e){return e.StereoEffect=function(){e.AudioNode.call(this);var t=e.defaults(arguments,["wet"],e.Effect);this.createInsOuts(1,1),this._dryWet=new e.CrossFade(t.wet),this.wet=this._dryWet.fade,this._split=new e.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new e.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},e.extend(e.StereoEffect,e.Effect),e.StereoEffect.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},e.StereoEffect})),n((function(e){return e.Chorus=function(){var t=e.defaults(arguments,["frequency","delayTime","depth"],e.Chorus);e.StereoEffect.call(this,t),this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new e.LFO({frequency:t.frequency,min:0,max:1}),this._lfoR=new e.LFO({frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new e.Delay,this._delayNodeR=new e.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=t.frequency,this.type=t.type,this._readOnly(["frequency"]),this.spread=t.spread},e.extend(e.Chorus,e.StereoEffect),e.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180},Object.defineProperty(e.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(e){this._depth=e;var t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}}),Object.defineProperty(e.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(e){this._delayTime=e/1e3,this.depth=this._depth}}),Object.defineProperty(e.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}}),Object.defineProperty(e.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}),e.Chorus.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},e.Chorus})),n((function(e){return e.Convolver=function(){var t=e.defaults(arguments,["url","onload"],e.Convolver);e.Effect.call(this,t),this._convolver=this.context.createConvolver(),this._buffer=new e.Buffer(t.url,function(e){this._convolver.buffer=e.get(),t.onload()}.bind(this)),this.connectEffect(this._convolver)},e.extend(e.Convolver,e.Effect),e.Convolver.defaults={onload:e.noOp},Object.defineProperty(e.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(e){this._buffer.set(e),this._convolver.buffer=this._buffer.get()}}),e.Convolver.prototype.load=function(e,t){return this._buffer.load(e,function(e){this.buffer=e,t&&t()}.bind(this))},e.Convolver.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},e.Convolver})),n((function(e){return e.Distortion=function(){var t=e.defaults(arguments,["distortion"],e.Distortion);e.Effect.call(this,t),this._shaper=new e.WaveShaper(4096),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample},e.extend(e.Distortion,e.Effect),e.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(e.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(e){this._distortion=e;var t=100*e,n=Math.PI/180;this._shaper.setMap((function(e){return Math.abs(e)<.001?0:(3+t)*e*20*n/(Math.PI+t*Math.abs(e))}))}}),Object.defineProperty(e.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),e.Distortion.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},e.Distortion})),n((function(e){return e.FeedbackEffect=function(){var t=e.defaults(arguments,["feedback"],e.FeedbackEffect);e.Effect.call(this,t),this._feedbackGain=new e.Gain(t.feedback,e.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},e.extend(e.FeedbackEffect,e.Effect),e.FeedbackEffect.defaults={feedback:.125},e.FeedbackEffect.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},e.FeedbackEffect})),n((function(e){return e.FeedbackDelay=function(){var t=e.defaults(arguments,["delayTime","feedback"],e.FeedbackDelay);e.FeedbackEffect.call(this,t),this._delayNode=new e.Delay(t.delayTime,t.maxDelay),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},e.extend(e.FeedbackDelay,e.FeedbackEffect),e.FeedbackDelay.defaults={delayTime:.25,maxDelay:1},e.FeedbackDelay.prototype.dispose=function(){return e.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},e.FeedbackDelay})),n((function(e){var t=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],n=[225,556,441,341];return e.Freeverb=function(){var r=e.defaults(arguments,["roomSize","dampening"],e.Freeverb);e.StereoEffect.call(this,r),this.roomSize=new e.Signal(r.roomSize,e.Type.NormalRange),this.dampening=new e.Signal(r.dampening,e.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var i=0;i<n.length;i++){var o=this.context.createBiquadFilter();o.type="allpass",o.frequency.value=n[i],this._allpassFiltersL.push(o)}for(var a=0;a<n.length;a++){var s=this.context.createBiquadFilter();s.type="allpass",s.frequency.value=n[a],this._allpassFiltersR.push(s)}for(var u=0;u<t.length;u++){var l=new e.LowpassCombFilter(t[u]);u<t.length/2?this.effectSendL.chain(l,this._allpassFiltersL[0]):this.effectSendR.chain(l,this._allpassFiltersR[0]),this.roomSize.connect(l.resonance),this.dampening.connect(l.dampening),this._combFilters.push(l)}e.connectSeries.apply(e,this._allpassFiltersL),e.connectSeries.apply(e,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},e.extend(e.Freeverb,e.StereoEffect),e.Freeverb.defaults={roomSize:.7,dampening:3e3},e.Freeverb.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this);for(var t=0;t<this._allpassFiltersL.length;t++)this._allpassFiltersL[t].disconnect(),this._allpassFiltersL[t]=null;this._allpassFiltersL=null;for(var n=0;n<this._allpassFiltersR.length;n++)this._allpassFiltersR[n].disconnect(),this._allpassFiltersR[n]=null;this._allpassFiltersR=null;for(var r=0;r<this._combFilters.length;r++)this._combFilters[r].dispose(),this._combFilters[r]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},e.Freeverb})),n((function(e){var t=[.06748,.06404,.08212,.09004],n=[.773,.802,.753,.733],r=[347,113,37];return e.JCReverb=function(){var i=e.defaults(arguments,["roomSize"],e.JCReverb);e.StereoEffect.call(this,i),this.roomSize=new e.Signal(i.roomSize,e.Type.NormalRange),this._scaleRoomSize=new e.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var o=0;o<r.length;o++){var a=this.context.createBiquadFilter();a.type="allpass",a.frequency.value=r[o],this._allpassFilters.push(a)}for(var s=0;s<t.length;s++){var u=new e.FeedbackCombFilter(t[s],.1);this._scaleRoomSize.connect(u.resonance),u.resonance.value=n[s],this._allpassFilters[this._allpassFilters.length-1].connect(u),s<t.length/2?u.connect(this.effectReturnL):u.connect(this.effectReturnR),this._feedbackCombFilters.push(u)}this.roomSize.connect(this._scaleRoomSize),e.connectSeries.apply(e,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},e.extend(e.JCReverb,e.StereoEffect),e.JCReverb.defaults={roomSize:.5},e.JCReverb.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this);for(var t=0;t<this._allpassFilters.length;t++)this._allpassFilters[t].disconnect(),this._allpassFilters[t]=null;this._allpassFilters=null;for(var n=0;n<this._feedbackCombFilters.length;n++)this._feedbackCombFilters[n].dispose(),this._feedbackCombFilters[n]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},e.JCReverb})),n((function(e){return e.MidSideEffect=function(){e.Effect.apply(this,arguments),this._midSideSplit=new e.MidSideSplit,this._midSideMerge=new e.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},e.extend(e.MidSideEffect,e.Effect),e.MidSideEffect.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},e.MidSideEffect})),n((function(e){return e.Phaser=function(){var t=e.defaults(arguments,["frequency","octaves","baseFrequency"],e.Phaser);e.StereoEffect.call(this,t),this._lfoL=new e.LFO(t.frequency,0,1),this._lfoR=new e.LFO(t.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=t.baseFrequency,this._octaves=t.octaves,this.Q=new e.Signal(t.Q,e.Type.Positive),this._filtersL=this._makeFilters(t.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(t.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[t.stages-1].connect(this.effectReturnL),this._filtersR[t.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},e.extend(e.Phaser,e.StereoEffect),e.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},e.Phaser.prototype._makeFilters=function(t,n,r){for(var i=new Array(t),o=0;o<t;o++){var a=this.context.createBiquadFilter();a.type="allpass",r.connect(a.Q),n.connect(a.frequency),i[o]=a}return e.connectSeries.apply(e,i),i},Object.defineProperty(e.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e;var t=this._baseFrequency*Math.pow(2,e);this._lfoL.max=t,this._lfoR.max=t}}),Object.defineProperty(e.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._lfoL.min=e,this._lfoR.min=e,this.octaves=this._octaves}}),e.Phaser.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var t=0;t<this._filtersL.length;t++)this._filtersL[t].disconnect(),this._filtersL[t]=null;this._filtersL=null;for(var n=0;n<this._filtersR.length;n++)this._filtersR[n].disconnect(),this._filtersR[n]=null;return this._filtersR=null,this.frequency=null,this},e.Phaser})),n((function(e){return e.StereoXFeedbackEffect=function(){var t=e.defaults(arguments,["feedback"],e.FeedbackEffect);e.StereoEffect.call(this,t),this.feedback=new e.Signal(t.feedback,e.Type.NormalRange),this._feedbackLR=new e.Gain,this._feedbackRL=new e.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},e.extend(e.StereoXFeedbackEffect,e.StereoEffect),e.StereoXFeedbackEffect.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},e.StereoXFeedbackEffect})),n((function(e){return e.PingPongDelay=function(){var t=e.defaults(arguments,["delayTime","feedback"],e.PingPongDelay);e.StereoXFeedbackEffect.call(this,t),this._leftDelay=new e.Delay(0,t.maxDelayTime),this._rightDelay=new e.Delay(0,t.maxDelayTime),this._rightPreDelay=new e.Delay(0,t.maxDelayTime),this.delayTime=new e.Signal(t.delayTime,e.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},e.extend(e.PingPongDelay,e.StereoXFeedbackEffect),e.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},e.PingPongDelay.prototype.dispose=function(){return e.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},e.PingPongDelay})),n((function(e){return e.PitchShift=function(){var t=e.defaults(arguments,["pitch"],e.PitchShift);e.FeedbackEffect.call(this,t),this._frequency=new e.Signal(0),this._delayA=new e.Delay(0,1),this._lfoA=new e.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new e.Delay(0,1),this._lfoB=new e.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new e.CrossFade,this._crossFadeLFO=new e.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new e.Delay(t.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var n=this.now();this._lfoA.start(n),this._lfoB.start(n),this._crossFadeLFO.start(n),this.windowSize=this._windowSize},e.extend(e.PitchShift,e.FeedbackEffect),e.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(e.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=t;var n=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,n=e.intervalToFrequencyRatio(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,n=e.intervalToFrequencyRatio(t)-1),this._frequency.value=n*(1.2/this._windowSize)}}),Object.defineProperty(e.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}}),e.PitchShift.prototype.dispose=function(){return e.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},e.PitchShift})),n((function(e){return e.BufferSource=function(){var t=e.defaults(arguments,["buffer","onload"],e.BufferSource);e.AudioNode.call(this,t),this.onended=t.onended,this._startTime=-1,this._sourceStarted=!1,this._sourceStopped=!1,this._stopTime=-1,this._gainNode=this.output=new e.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this._source.onended=this._onended.bind(this),this._buffer=new e.Buffer(t.buffer,t.onload),this.playbackRate=new e.Param(this._source.playbackRate,e.Type.Positive),this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut,this.curve=t.curve,this._gain=1,this._onendedTimeout=-1,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate.value=t.playbackRate},e.extend(e.BufferSource,e.AudioNode),e.BufferSource.defaults={onended:e.noOp,onload:e.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(e.BufferSource.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),e.BufferSource.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),-1!==this._startTime&&t>=this._startTime&&!this._sourceStopped?e.State.Started:e.State.Stopped},e.BufferSource.prototype.start=function(t,n,r,i,o){if(-1!==this._startTime)throw new Error("Tone.BufferSource can only be started once.");if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");t=this.toSeconds(t),n=this.loop?e.defaultArg(n,this.loopStart):e.defaultArg(n,0),n=this.toSeconds(n),i=e.defaultArg(i,1),this._gain=i,o=this.toSeconds(e.defaultArg(o,this.fadeIn)),this.fadeIn=o,o>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(this._gain,t+o):this._gainNode.gain.exponentialApproachValueAtTime(this._gain,t,o)):this._gainNode.gain.setValueAtTime(i,t),this._startTime=t;var a=this.toSeconds(e.defaultArg(r,this.buffer.duration-n%this.buffer.duration));if(a=Math.max(a,0),e.isDefined(r)&&(this.loop||(a=Math.min(a,this.buffer.duration-n%this.buffer.duration)),this.stop(t+a,this.fadeOut)),this.loop){var s=this.loopEnd||this.buffer.duration,u=this.loopStart;n>=s&&(n=(n-u)%(s-u)+u)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,n<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(t,n)),this},e.BufferSource.prototype.stop=function(t,n){if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");if(!this._sourceStopped){if(t=this.toSeconds(t),-1!==this._stopTime&&this.cancelStop(),t<=this._startTime)return this._gainNode.gain.cancelScheduledValues(t),this._gainNode.gain.value=0,this;t=Math.max(this._startTime+this.fadeIn+this.sampleTime,t),this._gainNode.gain.cancelScheduledValues(t),this._stopTime=t,n=this.toSeconds(e.defaultArg(n,this.fadeOut));var r=t-this._startTime-this.fadeIn-this.sampleTime;this.loop||(r=Math.min(r,this.buffer.duration));var i=t-(n=Math.min(r,n));return n>this.sampleTime?(this._gainNode.gain.setValueAtTime(this._gain,i),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(0,t):this._gainNode.gain.exponentialApproachValueAtTime(0,i,n)):this._gainNode.gain.setValueAtTime(0,t),e.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=e.context.setTimeout(this._onended.bind(this),this._stopTime-this.now()),this}},e.BufferSource.prototype.cancelStop=function(){if(-1!==this._startTime&&!this._sourceStopped){var e=this.toSeconds(this.fadeIn);this._gainNode.gain.cancelScheduledValues(this._startTime+e+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime+e+this.sampleTime)),this.context.clearTimeout(this._onendedTimeout),this._stopTime=-1}return this},e.BufferSource.prototype._onended=function(){if(!this._sourceStopped){this._sourceStopped=!0;var e="exponential"===this.curve?2*this.fadeOut:0;this._sourceStarted&&-1!==this._stopTime&&this._source.stop(this._stopTime+e),this.onended(this)}},Object.defineProperty(e.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(e){this._source.loopStart=this.toSeconds(e)}}),Object.defineProperty(e.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(e){this._source.loopEnd=this.toSeconds(e)}}),Object.defineProperty(e.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer.set(e)}}),Object.defineProperty(e.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(e){this._source.loop=e,this.cancelStop()}}),e.BufferSource.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,e.context.clearTimeout(this._onendedTimeout),this},e.BufferSource})),n((function(e){e.Noise=function(){var t=e.defaults(arguments,["type"],e.Noise);e.Source.call(this,t),this._source=null,this._type=t.type,this._playbackRate=t.playbackRate},e.extend(e.Noise,e.Source),e.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(e.Noise.prototype,"type",{get:function(){return this._type},set:function(t){if(this._type!==t){if(!(t in r))throw new TypeError("Tone.Noise: invalid type: "+t);if(this._type=t,this.state===e.State.Started){var n=this.now();this._stop(n),this._start(n)}}}}),Object.defineProperty(e.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}}),e.Noise.prototype._start=function(t){var n=r[this._type];this._source=new e.BufferSource(n).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(t),Math.random()*(n.duration-.001))},e.Noise.prototype._stop=function(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)},e.Noise.prototype.restart=function(e){this._stop(e),this._start(e)},e.Noise.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var t=220500,n={pink:function(){for(var e=[],n=0;n<2;n++){var r,i,o,a,s,u,l,c=new Float32Array(t);e[n]=c,r=i=o=a=s=u=l=0;for(var p=0;p<t;p++){var h=2*Math.random()-1;r=.99886*r+.0555179*h,i=.99332*i+.0750759*h,o=.969*o+.153852*h,a=.8665*a+.3104856*h,s=.55*s+.5329522*h,u=-.7616*u-.016898*h,c[p]=r+i+o+a+s+u+l+.5362*h,c[p]*=.11,l=.115926*h}}return e}(),brown:function(){for(var e=[],n=0;n<2;n++){var r=new Float32Array(t);e[n]=r;for(var i=0,o=0;o<t;o++){var a=2*Math.random()-1;r[o]=(i+.02*a)/1.02,i=r[o],r[o]*=3.5}}return e}(),white:function(){for(var e=[],n=0;n<2;n++){var r=new Float32Array(t);e[n]=r;for(var i=0;i<t;i++)r[i]=2*Math.random()-1}return e}()},r={};function i(){for(var t in n)r[t]=(new e.Buffer).fromArray(n[t])}return e.getContext(i),e.Context.on("init",i),e.Noise})),n((function(e){return e.Reverb=function(){var t=e.defaults(arguments,["decay"],e.Reverb);e.Effect.call(this,t),this._convolver=this.context.createConvolver(),this.decay=t.decay,this.preDelay=t.preDelay,this.connectEffect(this._convolver)},e.extend(e.Reverb,e.Effect),e.Reverb.defaults={decay:1.5,preDelay:.01},e.Reverb.prototype.generate=function(){return e.Offline(function(){var t=new e.Noise,n=new e.Noise,r=new e.Merge;t.connect(r.left),n.connect(r.right);var i=(new e.Gain).toMaster();r.connect(i),t.start(0),n.start(0),i.gain.setValueAtTime(0,0),i.gain.linearRampToValueAtTime(1,this.preDelay),i.gain.exponentialApproachValueAtTime(0,this.preDelay,this.decay-this.preDelay)}.bind(this),this.decay).then(function(e){return this._convolver.buffer=e.get(),this}.bind(this))},e.Reverb.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this},e.Reverb})),n((function(e){return e.StereoFeedbackEffect=function(){var t=e.defaults(arguments,["feedback"],e.FeedbackEffect);e.StereoEffect.call(this,t),this.feedback=new e.Signal(t.feedback,e.Type.NormalRange),this._feedbackL=new e.Gain,this._feedbackR=new e.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},e.extend(e.StereoFeedbackEffect,e.StereoEffect),e.StereoFeedbackEffect.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},e.StereoFeedbackEffect})),n((function(e){return e.StereoWidener=function(){var t=e.defaults(arguments,["width"],e.StereoWidener);e.MidSideEffect.call(this,t),this.width=new e.Signal(t.width,e.Type.NormalRange),this._readOnly(["width"]),this._twoTimesWidthMid=new e.Multiply(2),this._twoTimesWidthSide=new e.Multiply(2),this._midMult=new e.Multiply,this._twoTimesWidthMid.connect(this._midMult,0,1),this.midSend.chain(this._midMult,this.midReturn),this._oneMinusWidth=new e.Subtract,this._oneMinusWidth.connect(this._twoTimesWidthMid),this.context.getConstant(1).connect(this._oneMinusWidth,0,0),this.width.connect(this._oneMinusWidth,0,1),this._sideMult=new e.Multiply,this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult,0,1),this.sideSend.chain(this._sideMult,this.sideReturn)},e.extend(e.StereoWidener,e.MidSideEffect),e.StereoWidener.defaults={width:.5},e.StereoWidener.prototype.dispose=function(){return e.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._twoTimesWidthMid.dispose(),this._twoTimesWidthMid=null,this._twoTimesWidthSide.dispose(),this._twoTimesWidthSide=null,this._oneMinusWidth.dispose(),this._oneMinusWidth=null,this},e.StereoWidener})),n((function(e){return e.Tremolo=function(){var t=e.defaults(arguments,["frequency","depth"],e.Tremolo);e.StereoEffect.call(this,t),this._lfoL=new e.LFO({phase:t.spread,min:1,max:0}),this._lfoR=new e.LFO({phase:t.spread,min:1,max:0}),this._amplitudeL=new e.Gain,this._amplitudeR=new e.Gain,this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.depth=new e.Signal(t.depth,e.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=t.type,this.spread=t.spread},e.extend(e.Tremolo,e.StereoEffect),e.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},e.Tremolo.prototype.start=function(e){return this._lfoL.start(e),this._lfoR.start(e),this},e.Tremolo.prototype.stop=function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this},e.Tremolo.prototype.sync=function(t){return this._lfoL.sync(t),this._lfoR.sync(t),e.Transport.syncSignal(this.frequency),this},e.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),e.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(e.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}}),Object.defineProperty(e.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}),e.Tremolo.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},e.Tremolo})),n((function(e){return e.Vibrato=function(){var t=e.defaults(arguments,["frequency","depth"],e.Vibrato);e.Effect.call(this,t),this._delayNode=new e.Delay(0,t.maxDelay),this._lfo=new e.LFO({type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},e.extend(e.Vibrato,e.Effect),e.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(e.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),e.Vibrato.prototype.dispose=function(){e.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},e.Vibrato})),n((function(e){return e.Event=function(){var t=e.defaults(arguments,["callback","value"],e.Event);e.call(this),this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._state=new e.TimelineState(e.State.Stopped),this._playbackRate=1,this._startOffset=0,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate},e.extend(e.Event),e.Event.defaults={callback:e.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},e.Event.prototype._rescheduleEvents=function(t){return t=e.defaultArg(t,-1),this._state.forEachFrom(t,function(t){var n;if(t.state===e.State.Started){e.isDefined(t.id)&&e.Transport.clear(t.id);var r=t.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){n=1/0,e.isNumber(this._loop)&&(n=this._loop*this._getLoopDuration());var i=this._state.getAfter(r);null!==i&&(n=Math.min(n,i.time-r)),n!==1/0&&(this._state.setStateAtTime(e.State.Stopped,r+n+1),n=e.Ticks(n));var o=e.Ticks(this._getLoopDuration());t.id=e.Transport.scheduleRepeat(this._tick.bind(this),o,e.Ticks(r),n)}else t.id=e.Transport.schedule(this._tick.bind(this),e.Ticks(r))}}.bind(this)),this},Object.defineProperty(e.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(e.Transport.ticks)}}),Object.defineProperty(e.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(e){this._startOffset=e}}),Object.defineProperty(e.Event.prototype,"probability",{get:function(){return this._probability},set:function(e){this._probability=e}}),Object.defineProperty(e.Event.prototype,"humanize",{get:function(){return this._humanize},set:function(e){this._humanize=e}}),e.Event.prototype.start=function(t){return t=this.toTicks(t),this._state.getValueAtTime(t)===e.State.Stopped&&(this._state.add({state:e.State.Started,time:t,id:void 0}),this._rescheduleEvents(t)),this},e.Event.prototype.stop=function(t){if(this.cancel(t),t=this.toTicks(t),this._state.getValueAtTime(t)===e.State.Started){this._state.setStateAtTime(e.State.Stopped,t);var n=this._state.getBefore(t),r=t;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this},e.Event.prototype.cancel=function(t){return t=e.defaultArg(t,-1/0),t=this.toTicks(t),this._state.forEachFrom(t,(function(t){e.Transport.clear(t.id)})),this._state.cancel(t),this},e.Event.prototype._tick=function(t){var n=e.Transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(n)===e.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var r=.02;e.isBoolean(this.humanize)||(r=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*r}this.callback(t,this.value)}},e.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(e.Event.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this._rescheduleEvents()}}),Object.defineProperty(e.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._rescheduleEvents()}}),Object.defineProperty(e.Event.prototype,"loopEnd",{get:function(){return e.Ticks(this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(e.Event.prototype,"loopStart",{get:function(){return e.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(e.Event.prototype,"progress",{get:function(){if(this._loop){var t=e.Transport.ticks,n=this._state.get(t);if(null!==n&&n.state===e.State.Started){var r=this._getLoopDuration();return(t-n.time)%r/r}return 0}return 0}}),e.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},e.Event})),n((function(e){return e.Loop=function(){var t=e.defaults(arguments,["callback","interval"],e.Loop);e.call(this),this._event=new e.Event({callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations},e.extend(e.Loop),e.Loop.defaults={interval:"4n",callback:e.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},e.Loop.prototype.start=function(e){return this._event.start(e),this},e.Loop.prototype.stop=function(e){return this._event.stop(e),this},e.Loop.prototype.cancel=function(e){return this._event.cancel(e),this},e.Loop.prototype._tick=function(e){this.callback(e)},Object.defineProperty(e.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(e.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(e.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(e){this._event.loopEnd=e}}),Object.defineProperty(e.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(e){this._event.playbackRate=e}}),Object.defineProperty(e.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(e){this._event.humanize=e}}),Object.defineProperty(e.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(e){this._event.probability=e}}),Object.defineProperty(e.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(e){this._event.mute=e}}),Object.defineProperty(e.Loop.prototype,"iterations",{get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(e){this._event.loop=e===1/0||e}}),e.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},e.Loop})),n((function(e){return e.Part=function(){var t=e.defaults(arguments,["callback","events"],e.Part);e.Event.call(this,t),this._events=[];for(var n=0;n<t.events.length;n++)Array.isArray(t.events[n])?this.add(t.events[n][0],t.events[n][1]):this.add(t.events[n])},e.extend(e.Part,e.Event),e.Part.defaults={callback:e.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1,events:[]},e.Part.prototype.start=function(t,n){var r=this.toTicks(t);return this._state.getValueAtTime(r)!==e.State.Started&&(n=this._loop?e.defaultArg(n,this._loopStart):e.defaultArg(n,0),n=this.toTicks(n),this._state.add({state:e.State.Started,time:r,offset:n}),this._forEach((function(e){this._startNote(e,r,n)}))),this},e.Part.prototype._startNote=function(t,n,r){n-=r,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<r&&(n+=this._getLoopDuration()),t.start(e.Ticks(n))):t.startOffset<this._loopStart&&t.startOffset>=r&&(t.loop=!1,t.start(e.Ticks(n))):t.startOffset>=r&&t.start(e.Ticks(n))},Object.defineProperty(e.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(e){this._startOffset=e,this._forEach((function(e){e.startOffset+=this._startOffset}))}}),e.Part.prototype.stop=function(t){var n=this.toTicks(t);return this._state.cancel(n),this._state.setStateAtTime(e.State.Stopped,n),this._forEach((function(e){e.stop(t)})),this},e.Part.prototype.at=function(t,n){t=e.TransportTime(t);for(var r=e.Ticks(1).toSeconds(),i=0;i<this._events.length;i++){var o=this._events[i];if(Math.abs(t.toTicks()-o.startOffset)<r)return e.isDefined(n)&&(o.value=n),o}return e.isDefined(n)?(this.add(t,n),this._events[this._events.length-1]):null},e.Part.prototype.add=function(t,n){var r;return t.hasOwnProperty("time")&&(t=(n=t).time),t=this.toTicks(t),n instanceof e.Event?(r=n).callback=this._tick.bind(this):r=new e.Event({callback:this._tick.bind(this),value:n}),r.startOffset=t,r.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(r),this._restartEvent(r),this},e.Part.prototype._restartEvent=function(t){this._state.forEach(function(n){n.state===e.State.Started?this._startNote(t,n.time,n.offset):t.stop(e.Ticks(n.time))}.bind(this))},e.Part.prototype.remove=function(t,n){t.hasOwnProperty("time")&&(t=(n=t).time),t=this.toTicks(t);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof e.Part?i.remove(t,n):i.startOffset===t&&(e.isUndef(n)||e.isDefined(n)&&i.value===n)&&(this._events.splice(r,1),i.dispose())}return this},e.Part.prototype.removeAll=function(){return this._forEach((function(e){e.dispose()})),this._events=[],this},e.Part.prototype.cancel=function(e){return this._forEach((function(t){t.cancel(e)})),this._state.cancel(this.toTicks(e)),this},e.Part.prototype._forEach=function(t,n){if(this._events){n=e.defaultArg(n,this);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof e.Part?i._forEach(t,n):t.call(n,i)}}return this},e.Part.prototype._setAll=function(e,t){this._forEach((function(n){n[e]=t}))},e.Part.prototype._tick=function(e,t){this.mute||this.callback(e,t)},e.Part.prototype._testLoopBoundries=function(t){t.startOffset<this._loopStart||t.startOffset>=this._loopEnd?t.cancel(0):t.state===e.State.Stopped&&this._restartEvent(t)},Object.defineProperty(e.Part.prototype,"probability",{get:function(){return this._probability},set:function(e){this._probability=e,this._setAll("probability",e)}}),Object.defineProperty(e.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(e){this._humanize=e,this._setAll("humanize",e)}}),Object.defineProperty(e.Part.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this._forEach((function(t){t._loopStart=this._loopStart,t._loopEnd=this._loopEnd,t.loop=e,this._testLoopBoundries(t)}))}}),Object.defineProperty(e.Part.prototype,"loopEnd",{get:function(){return e.Ticks(this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach((function(t){t.loopEnd=e,this._testLoopBoundries(t)}))}}),Object.defineProperty(e.Part.prototype,"loopStart",{get:function(){return e.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach((function(e){e.loopStart=this.loopStart,this._testLoopBoundries(e)}))}}),Object.defineProperty(e.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._setAll("playbackRate",e)}}),Object.defineProperty(e.Part.prototype,"length",{get:function(){return this._events.length}}),e.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},e.Part})),n((function(e){return e.Pattern=function(){var t=e.defaults(arguments,["callback","values","pattern"],e.Pattern);e.Loop.call(this,t),this._pattern=new e.CtrlPattern({values:t.values,type:t.pattern,index:t.index})},e.extend(e.Pattern,e.Loop),e.Pattern.defaults={pattern:e.CtrlPattern.Type.Up,callback:e.noOp,values:[]},e.Pattern.prototype._tick=function(e){this.callback(e,this._pattern.value),this._pattern.next()},Object.defineProperty(e.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(e){this._pattern.index=e}}),Object.defineProperty(e.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(e){this._pattern.values=e}}),Object.defineProperty(e.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(e.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(e){this._pattern.type=e}}),e.Pattern.prototype.dispose=function(){e.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},e.Pattern})),n((function(e){return e.Sequence=function(){var t=e.defaults(arguments,["callback","events","subdivision"],e.Sequence),n=t.events;if(delete t.events,e.Part.call(this,t),this._subdivision=this.toTicks(t.subdivision),e.isUndef(t.loopEnd)&&e.isDefined(n)&&(this._loopEnd=n.length*this._subdivision),this._loop=!0,e.isDefined(n))for(var r=0;r<n.length;r++)this.add(r,n[r])},e.extend(e.Sequence,e.Part),e.Sequence.defaults={subdivision:"4n"},Object.defineProperty(e.Sequence.prototype,"subdivision",{get:function(){return e.Ticks(this._subdivision).toSeconds()}}),e.Sequence.prototype.at=function(t,n){return e.isArray(n)&&this.remove(t),e.Part.prototype.at.call(this,this._indexTime(t),n)},e.Sequence.prototype.add=function(t,n){if(null===n)return this;if(e.isArray(n)){var r=Math.round(this._subdivision/n.length);n=new e.Sequence(this._tick.bind(this),n,e.Ticks(r))}return e.Part.prototype.add.call(this,this._indexTime(t),n),this},e.Sequence.prototype.remove=function(t,n){return e.Part.prototype.remove.call(this,this._indexTime(t),n),this},e.Sequence.prototype._indexTime=function(t){return t instanceof e.TransportTime?t:e.Ticks(t*this._subdivision+this.startOffset).toSeconds()},e.Sequence.prototype.dispose=function(){return e.Part.prototype.dispose.call(this),this},e.Sequence})),n((function(e){return e.PulseOscillator=function(){var t=e.defaults(arguments,["frequency","width"],e.Oscillator);e.Source.call(this,t),this.width=new e.Signal(t.width,e.Type.NormalRange),this._widthGate=new e.Gain,this._sawtooth=new e.Oscillator({frequency:t.frequency,detune:t.detune,type:"sawtooth",phase:t.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new e.WaveShaper((function(e){return e<0?-1:1})),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},e.extend(e.PulseOscillator,e.Source),e.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},e.PulseOscillator.prototype._start=function(e){e=this.toSeconds(e),this._sawtooth.start(e),this._widthGate.gain.setValueAtTime(1,e)},e.PulseOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._sawtooth.stop(e),this._widthGate.gain.setValueAtTime(0,e)},e.PulseOscillator.prototype.restart=function(e){this._sawtooth.restart(e)},Object.defineProperty(e.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(e){this._sawtooth.phase=e}}),Object.defineProperty(e.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(e.PulseOscillator.prototype,"partials",{get:function(){return[]}}),e.PulseOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},e.PulseOscillator})),n((function(e){return e.PWMOscillator=function(){var t=e.defaults(arguments,["frequency","modulationFrequency"],e.PWMOscillator);e.Source.call(this,t),this._pulse=new e.PulseOscillator(t.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new e.Oscillator({frequency:t.frequency,detune:t.detune,phase:t.phase}),this._scale=new e.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},e.extend(e.PWMOscillator,e.Source),e.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},e.PWMOscillator.prototype._start=function(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)},e.PWMOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)},e.PWMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._pulse.restart(e)},Object.defineProperty(e.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(e.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(e.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(e){this._modulator.phase=e}}),e.PWMOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},e.PWMOscillator})),n((function(e){return e.FMOscillator=function(){var t=e.defaults(arguments,["frequency","type","modulationType"],e.FMOscillator);e.Source.call(this,t),this._carrier=new e.Oscillator(t.frequency,t.type),this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=t.detune,this.modulationIndex=new e.Multiply(t.modulationIndex),this.modulationIndex.units=e.Type.Positive,this._modulator=new e.Oscillator(t.frequency,t.modulationType),this.harmonicity=new e.Multiply(t.harmonicity),this.harmonicity.units=e.Type.Positive,this._modulationNode=new e.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=t.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},e.extend(e.FMOscillator,e.Source),e.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},e.FMOscillator.prototype._start=function(e){this._modulator.start(e),this._carrier.start(e)},e.FMOscillator.prototype._stop=function(e){this._modulator.stop(e),this._carrier.stop(e)},e.FMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._carrier.restart(e)},Object.defineProperty(e.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}}),Object.defineProperty(e.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}}),Object.defineProperty(e.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}}),Object.defineProperty(e.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}),e.FMOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},e.FMOscillator})),n((function(e){return e.AMOscillator=function(){var t=e.defaults(arguments,["frequency","type","modulationType"],e.AMOscillator);e.Source.call(this,t),this._carrier=new e.Oscillator(t.frequency,t.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=t.detune,this._modulator=new e.Oscillator(t.frequency,t.modulationType),this._modulationScale=new e.AudioToGain,this.harmonicity=new e.Multiply(t.harmonicity),this.harmonicity.units=e.Type.Positive,this._modulationNode=new e.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=t.phase,this._readOnly(["frequency","detune","harmonicity"])},e.extend(e.AMOscillator,e.Oscillator),e.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},e.AMOscillator.prototype._start=function(e){this._modulator.start(e),this._carrier.start(e)},e.AMOscillator.prototype._stop=function(e){this._modulator.stop(e),this._carrier.stop(e)},e.AMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._carrier.restart(e)},Object.defineProperty(e.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}}),Object.defineProperty(e.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}}),Object.defineProperty(e.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}}),Object.defineProperty(e.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}),e.AMOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},e.AMOscillator})),n((function(e){return e.FatOscillator=function(){var t=e.defaults(arguments,["frequency","type","spread"],e.FatOscillator);e.Source.call(this,t),this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.detune=new e.Signal(t.detune,e.Type.Cents),this._oscillators=[],this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=e.defaultArg(t.partials,[]),this.count=t.count,this._readOnly(["frequency","detune"])},e.extend(e.FatOscillator,e.Source),e.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},e.FatOscillator.prototype._start=function(e){e=this.toSeconds(e),this._forEach((function(t){t.start(e)}))},e.FatOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._forEach((function(t){t.stop(e)}))},e.FatOscillator.prototype.restart=function(e){e=this.toSeconds(e),this._forEach((function(t){t.restart(e)}))},e.FatOscillator.prototype._forEach=function(e){for(var t=0;t<this._oscillators.length;t++)e.call(this,this._oscillators[t],t)},Object.defineProperty(e.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this._forEach((function(t){t.type=e}))}}),Object.defineProperty(e.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(e){if(this._spread=e,this._oscillators.length>1){var t=-e/2,n=e/(this._oscillators.length-1);this._forEach((function(e,r){e.detune.value=t+n*r}))}}}),Object.defineProperty(e.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(t){if(t=Math.max(t,1),this._oscillators.length!==t){this._forEach((function(e){e.dispose()})),this._oscillators=[];for(var n=0;n<t;n++){var r=new e.Oscillator;this.type===e.Oscillator.Type.Custom?r.partials=this._partials:r.type=this._type,r.phase=this._phase,r.volume.value=-6-1.1*t,this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state===e.State.Started&&this._forEach((function(e){e.start()}))}}}),Object.defineProperty(e.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(e){this._phase=e,this._forEach((function(t){t.phase=e}))}}),Object.defineProperty(e.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(t){this._partials=t,this._type=e.Oscillator.Type.Custom,this._forEach((function(e){e.partials=t}))}}),e.FatOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach((function(e){e.dispose()})),this._oscillators=null,this._partials=null,this},e.FatOscillator})),n((function(e){e.OmniOscillator=function(){var t=e.defaults(arguments,["frequency","type"],e.OmniOscillator);e.Source.call(this,t),this.frequency=new e.Signal(t.frequency,e.Type.Frequency),this.detune=new e.Signal(t.detune,e.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=t.type,this._readOnly(["frequency","detune"]),this.set(t)},e.extend(e.OmniOscillator,e.Source),e.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var t="PulseOscillator",n="PWMOscillator",r="Oscillator",i="FMOscillator",o="AMOscillator",a="FatOscillator";return e.OmniOscillator.prototype._start=function(e){this._oscillator.start(e)},e.OmniOscillator.prototype._stop=function(e){this._oscillator.stop(e)},e.OmniOscillator.prototype.restart=function(e){this._oscillator.restart(e)},Object.defineProperty(e.OmniOscillator.prototype,"type",{get:function(){var e="";return this._sourceType===i?e="fm":this._sourceType===o?e="am":this._sourceType===a&&(e="fat"),e+this._oscillator.type},set:function(e){"fm"===e.substr(0,2)?(this._createNewOscillator(i),this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator(o),this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator(a),this._oscillator.type=e.substr(3)):"pwm"===e?this._createNewOscillator(n):"pulse"===e?this._createNewOscillator(t):(this._createNewOscillator(r),this._oscillator.type=e)}}),Object.defineProperty(e.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(e){this._oscillator.partials=e}}),e.OmniOscillator.prototype.set=function(t,n){return"type"===t?this.type=n:e.isObject(t)&&t.hasOwnProperty("type")&&(this.type=t.type),e.prototype.set.apply(this,arguments),this},e.OmniOscillator.prototype._createNewOscillator=function(t){if(t!==this._sourceType){this._sourceType=t;var n=e[t],r=this.now();if(null!==this._oscillator){var i=this._oscillator;i.stop(r),this.context.setTimeout((function(){i.dispose(),i=null}),this.blockTime)}this._oscillator=new n,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===e.State.Started&&this._oscillator.start(r)}},Object.defineProperty(e.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e}}),Object.defineProperty(e.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===t)return this._oscillator.width}}),Object.defineProperty(e.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===a)return this._oscillator.count},set:function(e){this._sourceType===a&&(this._oscillator.count=e)}}),Object.defineProperty(e.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===a)return this._oscillator.spread},set:function(e){this._sourceType===a&&(this._oscillator.spread=e)}}),Object.defineProperty(e.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===i||this._sourceType===o)return this._oscillator.modulationType},set:function(e){this._sourceType!==i&&this._sourceType!==o||(this._oscillator.modulationType=e)}}),Object.defineProperty(e.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===i)return this._oscillator.modulationIndex}}),Object.defineProperty(e.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===i||this._sourceType===o)return this._oscillator.harmonicity}}),Object.defineProperty(e.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===n)return this._oscillator.modulationFrequency}}),e.OmniOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},e.OmniOscillator})),n((function(e){return e.Instrument=function(t){t=e.defaultArg(t,e.Instrument.defaults),e.AudioNode.call(this),this._volume=this.output=new e.Volume(t.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._scheduledEvents=[]},e.extend(e.Instrument,e.AudioNode),e.Instrument.defaults={volume:0},e.Instrument.prototype.triggerAttack=e.noOp,e.Instrument.prototype.triggerRelease=e.noOp,e.Instrument.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this},e.Instrument.prototype._syncMethod=function(t,n){var r=this["_original_"+t]=this[t];this[t]=function(){var t=Array.prototype.slice.call(arguments),i=t[n],o=e.Transport.schedule(function(e){t[n]=e,r.apply(this,t)}.bind(this),i);this._scheduledEvents.push(o)}.bind(this)},e.Instrument.prototype.unsync=function(){return this._scheduledEvents.forEach((function(t){e.Transport.clear(t)})),this._scheduledEvents=[],this._original_triggerAttack&&(this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this},e.Instrument.prototype.triggerAttackRelease=function(e,t,n,r){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,r),this.triggerRelease(n+t),this},e.Instrument.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this.unsync(),this._scheduledEvents=null,this},e.Instrument})),n((function(e){return e.Monophonic=function(t){t=e.defaultArg(t,e.Monophonic.defaults),e.Instrument.call(this,t),this.portamento=t.portamento},e.extend(e.Monophonic,e.Instrument),e.Monophonic.defaults={portamento:0},e.Monophonic.prototype.triggerAttack=function(e,t,n){return t=this.toSeconds(t),this._triggerEnvelopeAttack(t,n),this.setNote(e,t),this},e.Monophonic.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this._triggerEnvelopeRelease(e),this},e.Monophonic.prototype._triggerEnvelopeAttack=function(){},e.Monophonic.prototype._triggerEnvelopeRelease=function(){},e.Monophonic.prototype.getLevelAtTime=function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)},e.Monophonic.prototype.setNote=function(e,t){if(t=this.toSeconds(t),this.portamento>0&&this.getLevelAtTime(t)>.05){var n=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(e,n,t)}else this.frequency.setValueAtTime(e,t);return this},e.Monophonic})),n((function(e){return e.Synth=function(t){t=e.defaultArg(t,e.Synth.defaults),e.Monophonic.call(this,t),this.oscillator=new e.OmniOscillator(t.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new e.AmplitudeEnvelope(t.envelope),this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","frequency","detune","envelope"])},e.extend(e.Synth,e.Monophonic),e.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},e.Synth.prototype._triggerEnvelopeAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain&&this.oscillator.stop(e+this.envelope.attack+this.envelope.decay),this},e.Synth.prototype._triggerEnvelopeRelease=function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},e.Synth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},e.Synth})),n((function(e){return e.AMSynth=function(t){t=e.defaultArg(t,e.AMSynth.defaults),e.Monophonic.call(this,t),this._carrier=new e.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(t.envelope),this._modulator=new e.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(t.modulation),this.modulationEnvelope=this._modulator.envelope.set(t.modulationEnvelope),this.frequency=new e.Signal(440,e.Type.Frequency),this.detune=new e.Signal(t.detune,e.Type.Cents),this.harmonicity=new e.Multiply(t.harmonicity),this.harmonicity.units=e.Type.Positive,this._modulationScale=new e.AudioToGain,this._modulationNode=new e.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},e.extend(e.AMSynth,e.Monophonic),e.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},e.AMSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e),this},e.AMSynth.prototype._triggerEnvelopeRelease=function(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this},e.AMSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},e.AMSynth})),n((function(e){return e.MonoSynth=function(t){t=e.defaultArg(t,e.MonoSynth.defaults),e.Monophonic.call(this,t),this.oscillator=new e.OmniOscillator(t.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new e.Filter(t.filter),this.filterEnvelope=new e.FrequencyEnvelope(t.filterEnvelope),this.envelope=new e.AmplitudeEnvelope(t.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},e.extend(e.MonoSynth,e.Monophonic),e.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},e.MonoSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),0===this.envelope.sustain&&this.oscillator.stop(e+this.envelope.attack+this.envelope.decay),this},e.MonoSynth.prototype._triggerEnvelopeRelease=function(e){return this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},e.MonoSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},e.MonoSynth})),n((function(e){return e.DuoSynth=function(t){t=e.defaultArg(t,e.DuoSynth.defaults),e.Monophonic.call(this,t),this.voice0=new e.MonoSynth(t.voice0),this.voice0.volume.value=-10,this.voice1=new e.MonoSynth(t.voice1),this.voice1.volume.value=-10,this._vibrato=new e.LFO(t.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new e.Gain(t.vibratoAmount,e.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new e.Signal(440,e.Type.Frequency),this.harmonicity=new e.Multiply(t.harmonicity),this.harmonicity.units=e.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},e.extend(e.DuoSynth,e.Monophonic),e.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},e.DuoSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.voice0._triggerEnvelopeAttack(e,t),this.voice1._triggerEnvelopeAttack(e,t),this},e.DuoSynth.prototype._triggerEnvelopeRelease=function(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this},e.DuoSynth.prototype.getLevelAtTime=function(e){return(this.voice0.getLevelAtTime(e)+this.voice1.getLevelAtTime(e))/2},e.DuoSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},e.DuoSynth})),n((function(e){return e.FMSynth=function(t){t=e.defaultArg(t,e.FMSynth.defaults),e.Monophonic.call(this,t),this._carrier=new e.Synth(t.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(t.envelope),this._modulator=new e.Synth(t.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(t.modulation),this.modulationEnvelope=this._modulator.envelope.set(t.modulationEnvelope),this.frequency=new e.Signal(440,e.Type.Frequency),this.detune=new e.Signal(t.detune,e.Type.Cents),this.harmonicity=new e.Multiply(t.harmonicity),this.harmonicity.units=e.Type.Positive,this.modulationIndex=new e.Multiply(t.modulationIndex),this.modulationIndex.units=e.Type.Positive,this._modulationNode=new e.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},e.extend(e.FMSynth,e.Monophonic),e.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},e.FMSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e),this},e.FMSynth.prototype._triggerEnvelopeRelease=function(e){return e=this.toSeconds(e),this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this},e.FMSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},e.FMSynth})),n((function(e){return e.MembraneSynth=function(t){t=e.defaultArg(t,e.MembraneSynth.defaults),e.Instrument.call(this,t),this.oscillator=new e.OmniOscillator(t.oscillator),this.envelope=new e.AmplitudeEnvelope(t.envelope),this.octaves=t.octaves,this.pitchDecay=t.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},e.extend(e.MembraneSynth,e.Instrument),e.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},e.MembraneSynth.prototype.triggerAttack=function(e,t,n){t=this.toSeconds(t);var r=(e=this.toFrequency(e))*this.octaves;return this.oscillator.frequency.setValueAtTime(r,t),this.oscillator.frequency.exponentialRampToValueAtTime(e,t+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(t,n),this.oscillator.start(t),this},e.MembraneSynth.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},e.MembraneSynth.prototype.dispose=function(){return e.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},e.MembraneSynth})),n((function(e){var t=[1,1.483,1.932,2.546,2.63,3.897];return e.MetalSynth=function(n){n=e.defaultArg(n,e.MetalSynth.defaults),e.Instrument.call(this,n),this.frequency=new e.Signal(n.frequency,e.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new e.Gain(0).connect(this.output),this._highpass=new e.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=n.octaves,this._filterFreqScaler=new e.Scale(n.resonance,7e3),this.envelope=new e.Envelope({attack:n.envelope.attack,attackCurve:"linear",decay:n.envelope.decay,sustain:0,release:n.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var r=0;r<t.length;r++){var i=new e.FMOscillator({type:"square",modulationType:"square",harmonicity:n.harmonicity,modulationIndex:n.modulationIndex});i.connect(this._highpass),this._oscillators[r]=i;var o=new e.Multiply(t[r]);this._freqMultipliers[r]=o,this.frequency.chain(o,i.frequency)}this.octaves=n.octaves},e.extend(e.MetalSynth,e.Instrument),e.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},e.MetalSynth.prototype.triggerAttack=function(t,n){return t=this.toSeconds(t),n=e.defaultArg(n,1),this.envelope.triggerAttack(t,n),this._oscillators.forEach((function(e){e.start(t)})),0===this.envelope.sustain&&this._oscillators.forEach(function(e){e.stop(t+this.envelope.attack+this.envelope.decay)}.bind(this)),this},e.MetalSynth.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this._oscillators.forEach(function(t){t.stop(e+this.envelope.release)}.bind(this)),this},e.MetalSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},e.MetalSynth.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this},Object.defineProperty(e.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(e){for(var t=0;t<this._oscillators.length;t++)this._oscillators[t].modulationIndex.value=e}}),Object.defineProperty(e.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(e){for(var t=0;t<this._oscillators.length;t++)this._oscillators[t].harmonicity.value=e}}),Object.defineProperty(e.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(e){this._filterFreqScaler.min=e,this.octaves=this._octaves}}),Object.defineProperty(e.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}}),e.MetalSynth.prototype.dispose=function(){e.Instrument.prototype.dispose.call(this);for(var t=0;t<this._oscillators.length;t++)this._oscillators[t].dispose(),this._freqMultipliers[t].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},e.MetalSynth})),n((function(e){return e.NoiseSynth=function(t){t=e.defaultArg(t,e.NoiseSynth.defaults),e.Instrument.call(this,t),this.noise=new e.Noise,this.envelope=new e.AmplitudeEnvelope(t.envelope),this.noise.chain(this.envelope,this.output),this._readOnly(["noise","envelope"])},e.extend(e.NoiseSynth,e.Instrument),e.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},e.NoiseSynth.prototype.triggerAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.noise.start(e),0===this.envelope.sustain&&this.noise.stop(e=this.envelope.attack+this.envelope.decay),this},e.NoiseSynth.prototype.triggerRelease=function(e){return this.envelope.triggerRelease(e),this.noise.stop(e+this.envelope.release),this},e.NoiseSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},e.NoiseSynth.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this},e.NoiseSynth.prototype.dispose=function(){return e.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},e.NoiseSynth})),n((function(e){return e.PluckSynth=function(t){t=e.defaultArg(t,e.PluckSynth.defaults),e.Instrument.call(this,t),this._noise=new e.Noise("pink"),this.attackNoise=t.attackNoise,this._lfcf=new e.LowpassCombFilter({resonance:t.resonance,dampening:t.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},e.extend(e.PluckSynth,e.Instrument),e.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.7},e.PluckSynth.prototype.triggerAttack=function(e,t){e=this.toFrequency(e),t=this.toSeconds(t);var n=1/e;return this._lfcf.delayTime.setValueAtTime(n,t),this._noise.start(t),this._noise.stop(t+n*this.attackNoise),this},e.PluckSynth.prototype.dispose=function(){return e.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},e.PluckSynth})),n((function(e){return e.PolySynth=function(){var t=e.defaults(arguments,["polyphony","voice"],e.PolySynth);e.Instrument.call(this,t),(t=e.defaultArg(t,e.Instrument.defaults)).polyphony=Math.min(e.PolySynth.MAX_POLYPHONY,t.polyphony),this.voices=new Array(t.polyphony),this._triggers=new Array(t.polyphony),this.detune=new e.Signal(t.detune,e.Type.Cents),this._readOnly("detune");for(var n=0;n<t.polyphony;n++){var r=new t.voice(arguments[2],arguments[3]);if(!(r instanceof e.Monophonic))throw new Error("Synth constructor must be instance of Tone.Monophonic");this.voices[n]=r,r.connect(this.output),r.hasOwnProperty("detune")&&this.detune.connect(r.detune),this._triggers[n]={release:-1,note:null,voice:r}}},e.extend(e.PolySynth,e.Instrument),e.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:e.Synth},e.PolySynth.prototype.triggerAttack=function(e,t,n){Array.isArray(e)||(e=[e]),t=this.toSeconds(t);for(var r=0;r<e.length;r++){for(var i=e[r],o=this._triggers[0],a=1;a<this._triggers.length;a++)this._triggers[a].release<o.release&&(o=this._triggers[a]);o.release=1/0,o.note=JSON.stringify(i),o.voice.triggerAttack(i,t,n)}return this},e.PolySynth.prototype.triggerAttackRelease=function(t,n,r,i){if(r=this.toSeconds(r),this.triggerAttack(t,r,i),e.isArray(n)&&e.isArray(t))for(var o=0;o<t.length;o++){var a=n[Math.min(o,n.length-1)];this.triggerRelease(t[o],r+this.toSeconds(a))}else this.triggerRelease(t,r+this.toSeconds(n));return this},e.PolySynth.prototype.triggerRelease=function(e,t){Array.isArray(e)||(e=[e]),t=this.toSeconds(t);for(var n=0;n<e.length;n++)for(var r=JSON.stringify(e[n]),i=0;i<this._triggers.length;i++){var o=this._triggers[i];o.note===r&&o.release>t&&(o.voice.triggerRelease(t),o.release=t)}return this},e.PolySynth.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},e.PolySynth.prototype.set=function(e,t,n){for(var r=0;r<this.voices.length;r++)this.voices[r].set(e,t,n);return this},e.PolySynth.prototype.get=function(e){return this.voices[0].get(e)},e.PolySynth.prototype.releaseAll=function(e){e=this.toSeconds(e);for(var t=0;t<this._triggers.length;t++){var n=this._triggers[t];n.release>e&&(n.release=e,n.voice.triggerRelease(e))}return this},e.PolySynth.prototype.dispose=function(){e.Instrument.prototype.dispose.call(this);for(var t=0;t<this.voices.length;t++)this.voices[t].dispose(),this.voices[t]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},e.PolySynth.MAX_POLYPHONY=20,e.PolySynth})),n((function(e){return e.Sampler=function(t){var n=Array.prototype.slice.call(arguments);n.shift();var r=e.defaults(n,["onload","baseUrl"],e.Sampler);e.Instrument.call(this,r);var i={};for(var o in t)if(e.isNote(o))i[e.Frequency(o).toMidi()]=t[o];else{if(isNaN(parseFloat(o)))throw new Error("Tone.Sampler: url keys must be the note's pitch");i[o]=t[o]}this._buffers=new e.Buffers(i,r.onload,r.baseUrl),this._activeSources={},this.attack=r.attack,this.release=r.release},e.extend(e.Sampler,e.Instrument),e.Sampler.defaults={attack:0,release:.1,onload:e.noOp,baseUrl:""},e.Sampler.prototype._findClosest=function(e){for(var t=0;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}return null},e.Sampler.prototype.triggerAttack=function(t,n,r){var i=e.Frequency(t).toMidi(),o=this._findClosest(i);if(null!==o){var a=i-o,s=this._buffers.get(a),u=new e.BufferSource({buffer:s,playbackRate:e.intervalToFrequencyRatio(o),fadeIn:this.attack,fadeOut:this.release,curve:"exponential"}).connect(this.output);u.start(n,0,s.duration,r),e.isArray(this._activeSources[i])||(this._activeSources[i]=[]),this._activeSources[i].push({note:i,source:u})}return this},e.Sampler.prototype.triggerRelease=function(t,n){var r=e.Frequency(t).toMidi();if(this._activeSources[r]&&this._activeSources[r].length){var i=this._activeSources[r].shift().source;n=this.toSeconds(n),i.stop(n+this.release,this.release)}return this},e.Sampler.prototype.releaseAll=function(e){for(var t in e=this.toSeconds(e),this._activeSources)for(var n=this._activeSources[t];n.length;)n.shift().source.stop(e+this.release,this.release);return this},e.Sampler.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},e.Sampler.prototype.triggerAttackRelease=function(e,t,n,r){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,r),this.triggerRelease(e,n+t),this},e.Sampler.prototype.add=function(t,n,r){if(e.isNote(t)){var i=e.Frequency(t).toMidi();this._buffers.add(i,n,r)}else{if(isNaN(parseFloat(t)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+t);this._buffers.add(t,n,r)}},Object.defineProperty(e.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),e.Sampler.prototype.dispose=function(){for(var t in e.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null,this._activeSources)this._activeSources[t].forEach((function(e){e.source.dispose()}));return this._activeSources=null,this},e.Sampler})),n((function(e){e.supported&&(OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable))})),n((function(e){return e.GainToAudio=function(){e.SignalBase.call(this),this._norm=this.input=this.output=new e.WaveShaper((function(e){return 2*Math.abs(e)-1}))},e.extend(e.GainToAudio,e.SignalBase),e.GainToAudio.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},e.GainToAudio})),n((function(e){return e.Normalize=function(t,n){e.SignalBase.call(this),this._inputMin=e.defaultArg(t,0),this._inputMax=e.defaultArg(n,1),this._sub=this.input=new e.Add(0),this._div=this.output=new e.Multiply(1),this._sub.connect(this._div),this._setRange()},e.extend(e.Normalize,e.SignalBase),Object.defineProperty(e.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(e){this._inputMin=e,this._setRange()}}),Object.defineProperty(e.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(e){this._inputMax=e,this._setRange()}}),e.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},e.Normalize.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},e.Normalize})),n((function(e){return e.TransportTimelineSignal=function(){e.Signal.apply(this,arguments),this.output=this._outputSig=new e.Signal(this._initialValue),this._lastVal=this.value,this._synced=e.Transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._bindAnchorValue=this._anchorValue.bind(this),e.Transport.on("start stop pause",this._bindAnchorValue),this._events.memory=1/0},e.extend(e.TransportTimelineSignal,e.Signal),e.TransportTimelineSignal.prototype._onTick=function(t){var n=this.getValueAtTime(e.Transport.seconds);this._lastVal!==n&&(this._lastVal=n,this._outputSig.linearRampToValueAtTime(n,t))},e.TransportTimelineSignal.prototype._anchorValue=function(t){var n=this.getValueAtTime(e.Transport.seconds);return this._lastVal=n,this._outputSig.cancelScheduledValues(t),this._outputSig.setValueAtTime(n,t),this},e.TransportTimelineSignal.prototype.getValueAtTime=function(t){return t=e.TransportTime(t),e.Signal.prototype.getValueAtTime.call(this,t)},e.TransportTimelineSignal.prototype.setValueAtTime=function(t,n){return n=e.TransportTime(n),e.Signal.prototype.setValueAtTime.call(this,t,n),this},e.TransportTimelineSignal.prototype.linearRampToValueAtTime=function(t,n){return n=e.TransportTime(n),e.Signal.prototype.linearRampToValueAtTime.call(this,t,n),this},e.TransportTimelineSignal.prototype.exponentialRampToValueAtTime=function(t,n){return n=e.TransportTime(n),e.Signal.prototype.exponentialRampToValueAtTime.call(this,t,n),this},e.TransportTimelineSignal.prototype.setTargetAtTime=function(t,n,r){return n=e.TransportTime(n),e.Signal.prototype.setTargetAtTime.call(this,t,n,r),this},e.TransportTimelineSignal.prototype.cancelScheduledValues=function(t){return t=e.TransportTime(t),e.Signal.prototype.cancelScheduledValues.call(this,t),this},e.TransportTimelineSignal.prototype.setValueCurveAtTime=function(t,n,r,i){return n=e.TransportTime(n),r=e.TransportTime(r),e.Signal.prototype.setValueCurveAtTime.call(this,t,n,r,i),this},e.TransportTimelineSignal.prototype.cancelAndHoldAtTime=function(t){return e.Signal.prototype.cancelAndHoldAtTime.call(this,e.TransportTime(t))},e.TransportTimelineSignal.prototype.dispose=function(){e.Transport.clear(this._synced),e.Transport.off("start stop pause",this._syncedCallback),this._events.cancel(0),e.Signal.prototype.dispose.call(this),this._outputSig.dispose(),this._outputSig=null},e.TransportTimelineSignal})),n((function(e){return e.GrainPlayer=function(){var t=e.defaults(arguments,["url","onload"],e.GrainPlayer);e.Source.call(this,t),this.buffer=new e.Buffer(t.url,t.onload),this._clock=new e.Clock(this._tick.bind(this),t.grainSize),this._loopStart=0,this._loopEnd=0,this._activeSources=[],this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))},e.extend(e.GrainPlayer,e.Source),e.GrainPlayer.defaults={onload:e.noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},e.GrainPlayer.prototype._start=function(t,n,r){n=e.defaultArg(n,0),n=this.toSeconds(n),t=this.toSeconds(t),this._offset=n,this._clock.start(t),r&&this.stop(t+this.toSeconds(r))},e.GrainPlayer.prototype._stop=function(e){this._clock.stop(e)},e.GrainPlayer.prototype._onstop=function(e){this._activeSources.forEach((function(t){t.stop(e,0)}))},e.GrainPlayer.prototype._tick=function(t){var n=this._offset<this._overlap?0:this._overlap,r=new e.BufferSource({buffer:this.buffer,fadeIn:n,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:e.intervalToFrequencyRatio(this.detune/100)}).connect(this.output);r.start(t,this._offset),this._offset+=this.grainSize,r.stop(t+this.grainSize),this._activeSources.push(r),r.onended=function(){var e=this._activeSources.indexOf(r);-1!==e&&this._activeSources.splice(e,1)}.bind(this)},e.GrainPlayer.prototype.seek=function(e,t){return this._offset=this.toSeconds(e),this._tick(this.toSeconds(t)),this},Object.defineProperty(e.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this.grainSize=this._grainSize}}),Object.defineProperty(e.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(e){this._loopStart=this.toSeconds(e)}}),Object.defineProperty(e.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(e){this._loopEnd=this.toSeconds(e)}}),Object.defineProperty(e.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(e){this.buffer.reverse=e}}),Object.defineProperty(e.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(e){this._grainSize=this.toSeconds(e),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(e.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(e){this._overlap=this.toSeconds(e)}}),e.GrainPlayer.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._clock.dispose(),this._clock=null,this._activeSources.forEach((function(e){e.dispose()})),this._activeSources=null,this},e.GrainPlayer})),n((function(e){return e.Player=function(t){var n;t instanceof e.Buffer&&t.loaded?(t=t.get(),n=e.Player.defaults):n=e.defaults(arguments,["url","onload"],e.Player),e.Source.call(this,n),this.autostart=n.autostart,this._buffer=new e.Buffer({url:n.url,onload:this._onload.bind(this,n.onload),reverse:n.reverse}),t instanceof AudioBuffer&&this._buffer.set(t),this._loop=n.loop,this._loopStart=n.loopStart,this._loopEnd=n.loopEnd,this._playbackRate=n.playbackRate,this._activeSources=[],this._elapsedTime=new e.TickSource(n.playbackRate),this.fadeIn=n.fadeIn,this.fadeOut=n.fadeOut},e.extend(e.Player,e.Source),e.Player.defaults={onload:e.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1,fadeIn:0,fadeOut:0},e.Player.prototype.load=function(e,t){return this._buffer.load(e,this._onload.bind(this,t))},e.Player.prototype._onload=function(t){(t=e.defaultArg(t,e.noOp))(this),this.autostart&&this.start()},e.Player.prototype._onSourceEnd=function(e){var t=this._activeSources.indexOf(e);this._activeSources.splice(t,1)},e.Player.prototype._start=function(t,n,r){n=this._loop?e.defaultArg(n,this._loopStart):e.defaultArg(n,0),n=this.toSeconds(n);var i=e.defaultArg(r,Math.max(this._buffer.duration-n,0));i=this.toSeconds(i),t=this.toSeconds(t),this._elapsedTime.start(t,n);var o=new e.BufferSource({buffer:this._buffer,loop:this._loop,loopStart:this._loopStart,loopEnd:this._loopEnd,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate,fadeIn:this.fadeIn,fadeOut:this.fadeOut}).connect(this.output);return this._loop||this._synced||this._state.setStateAtTime(e.State.Stopped,t+i/this._playbackRate),this._activeSources.push(o),this._loop&&e.isUndef(r)?o.start(t,n):o.start(t,n,i),this},e.Player.prototype._stop=function(e){return e=this.toSeconds(e),this._elapsedTime.stop(e),this._activeSources.forEach((function(t){t.stop(e)})),this},e.Player.prototype.restart=function(e,t,n){return this._stop(e),this._start(e,t,n),this},e.Player.prototype.seek=function(t,n){return n=this.toSeconds(n),this._state.getValueAtTime(n)===e.State.Started&&(t=this.toSeconds(t),this._stop(n),this._start(n,t)),this},e.Player.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(e.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(e){this._loopStart=e,this._activeSources.forEach((function(t){t.loopStart=e}))}}),Object.defineProperty(e.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this._activeSources.forEach((function(t){t.loopEnd=e}))}}),Object.defineProperty(e.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer.set(e)}}),Object.defineProperty(e.Player.prototype,"loop",{get:function(){return this._loop},set:function(t){if(this._loop!==t){this._loop=t;var n=this.now();if(t){var r=this._state.getNextState(e.State.Stopped,n);r&&(this._activeSources.forEach((function(e){e.loop=t})),this._state.cancel(r.time),this._elapsedTime.cancel(r.time))}else this._stopAtNextIteration(n)}}}),e.Player.prototype._stopAtNextIteration=function(t){if(this._state.getValueAtTime(t)===e.State.Started){var n=this._state.getNextState(e.State.Stopped,t),r=this._elapsedTime.getTicksAtTime(t),i=Math.max(Math.ceil(r/this.buffer.duration),1),o=this._elapsedTime.getTimeOfTick(i*this.buffer.duration,n?n.time-this.sampleTime:1/0);this.stop(o)}},Object.defineProperty(e.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e;var t=this.now();this._elapsedTime.frequency.setValueAtTime(e,t),this._loop||this._stopAtNextIteration(t),this._activeSources.forEach((function(n){n.playbackRate.setValueAtTime(e,t)}))}}),Object.defineProperty(e.Player.prototype,"position",{get:function(){var t=this.now();if(this._state.getValueAtTime(t)===e.State.Started&&this.loaded){var n=this.buffer.duration;return this._elapsedTime.getTicksAtTime(t)%n}return 0}}),Object.defineProperty(e.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(e){this._buffer.reverse=e}}),Object.defineProperty(e.Player.prototype,"loaded",{get:function(){return this._buffer.loaded}}),e.Player.prototype.dispose=function(){return this._activeSources.forEach((function(e){e.dispose()})),this._activeSources=null,e.Source.prototype.dispose.call(this),this._buffer.dispose(),this._buffer=null,this._elapsedTime.dispose(),this._elapsedTime=null,this},e.Player})),n((function(e){return e.Players=function(t){var n=Array.prototype.slice.call(arguments);n.shift();var r=e.defaults(n,["onload"],e.Players);for(var i in e.call(this),this._volume=this.output=new e.Volume(r.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=r.mute,this._players={},this._loadingCount=0,this._fadeIn=r.fadeIn,this._fadeOut=r.fadeOut,t)this._loadingCount++,this.add(i,t[i],this._bufferLoaded.bind(this,r.onload))},e.extend(e.Players,e.AudioNode),e.Players.defaults={volume:0,mute:!1,onload:e.noOp,fadeIn:0,fadeOut:0},e.Players.prototype._bufferLoaded=function(e){this._loadingCount--,0===this._loadingCount&&e&&e(this)},Object.defineProperty(e.Players.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),Object.defineProperty(e.Players.prototype,"fadeIn",{get:function(){return this._fadeIn},set:function(e){this._fadeIn=e,this._forEach((function(t){t.fadeIn=e}))}}),Object.defineProperty(e.Players.prototype,"fadeOut",{get:function(){return this._fadeOut},set:function(e){this._fadeOut=e,this._forEach((function(t){t.fadeOut=e}))}}),Object.defineProperty(e.Players.prototype,"state",{get:function(){var t=!1;return this._forEach((function(n){t=t||n.state===e.State.Started})),t?e.State.Started:e.State.Stopped}}),e.Players.prototype.has=function(e){return this._players.hasOwnProperty(e)},e.Players.prototype.get=function(e){if(this.has(e))return this._players[e];throw new Error("Tone.Players: no player named "+e)},e.Players.prototype._forEach=function(e){for(var t in this._players)e(this._players[t],t);return this},Object.defineProperty(e.Players.prototype,"loaded",{get:function(){var e=!0;return this._forEach((function(t){e=e&&t.loaded})),e}}),e.Players.prototype.add=function(t,n,r){return this._players[t]=new e.Player(n,r).connect(this.output),this._players[t].fadeIn=this._fadeIn,this._players[t].fadeOut=this._fadeOut,this},e.Players.prototype.stopAll=function(e){this._forEach((function(t){t.stop(e)}))},e.Players.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null,this.output=null,this._forEach((function(e){e.dispose()})),this._players=null,this},e.Players})),n((function(e){return e.UserMedia=function(){var t=e.defaults(arguments,["volume"],e.UserMedia);e.AudioNode.call(this),this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new e.Volume(t.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=t.mute},e.extend(e.UserMedia,e.AudioNode),e.UserMedia.defaults={volume:0,mute:!1},e.UserMedia.prototype.open=function(t){return e.UserMedia.enumerateDevices().then(function(n){var r;if(e.isNumber(t))r=n[t];else if(!(r=n.find((function(e){return e.label===t||e.deviceId===t})))&&n.length>0)r=n[0];else if(!r&&e.isDefined(t))throw new Error("Tone.UserMedia: no matching device: "+t);this._device=r;var i={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate}};return r&&(i.audio.deviceId=r.deviceId),navigator.mediaDevices.getUserMedia(i).then(function(e){return this._stream||(this._stream=e,this._mediaStream=this.context.createMediaStreamSource(e),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},e.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach((function(e){e.stop()})),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},e.UserMedia.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"audioinput"===e.kind}))}))},Object.defineProperty(e.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?e.State.Started:e.State.Stopped}}),Object.defineProperty(e.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(e.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(e.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(e.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),e.UserMedia.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(e.UserMedia,"supported",{get:function(){return e.isDefined(navigator.mediaDevices)&&e.isFunction(navigator.mediaDevices.getUserMedia)}}),e.UserMedia})),n((function(e){return e.Midi=function(t,n){if(!(this instanceof e.Midi))return new e.Midi(t,n);e.Frequency.call(this,t,n)},e.extend(e.Midi,e.Frequency),e.Midi.prototype._defaultUnits="midi",e.Midi.prototype._frequencyToUnits=function(t){return e.Frequency.ftom(e.Frequency.prototype._frequencyToUnits.call(this,t))},e.Midi.prototype._ticksToUnits=function(t){return e.Frequency.ftom(e.Frequency.prototype._ticksToUnits.call(this,t))},e.Midi.prototype._beatsToUnits=function(t){return e.Frequency.ftom(e.Frequency.prototype._beatsToUnits.call(this,t))},e.Midi.prototype._secondsToUnits=function(t){return e.Frequency.ftom(e.Frequency.prototype._secondsToUnits.call(this,t))},e.Midi.prototype.toMidi=function(){return this.valueOf()},e.Midi.prototype.toFrequency=function(){return e.Frequency.mtof(this.toMidi())},e.Midi.prototype.transpose=function(e){return new this.constructor(this.toMidi()+e)},e.Midi})),e},"function"==typeof define&&define.amd?define((function(){return i()})):"object"==typeof t?t.exports=i():r.Tone=i()},{}],296:[function(e,t,n){(function(t,r){"use strict";var i=e("bit-twiddle"),o=e("dup");t.__TYPEDARRAY_POOL||(t.__TYPEDARRAY_POOL={UINT8:o([32,0]),UINT16:o([32,0]),UINT32:o([32,0]),INT8:o([32,0]),INT16:o([32,0]),INT32:o([32,0]),FLOAT:o([32,0]),DOUBLE:o([32,0]),DATA:o([32,0]),UINT8C:o([32,0]),BUFFER:o([32,0])});var a="undefined"!=typeof Uint8ClampedArray,s=t.__TYPEDARRAY_POOL;s.UINT8C||(s.UINT8C=o([32,0])),s.BUFFER||(s.BUFFER=o([32,0]));var u=s.DATA,l=s.BUFFER;function c(e){if(e){var t=e.length||e.byteLength,n=i.log2(t);u[n].push(e)}}function p(e){e=i.nextPow2(e);var t=i.log2(e),n=u[t];return n.length>0?n.pop():new ArrayBuffer(e)}function h(e){return new Uint8Array(p(e),0,e)}function f(e){return new Uint16Array(p(2*e),0,e)}function d(e){return new Uint32Array(p(4*e),0,e)}function m(e){return new Int8Array(p(e),0,e)}function y(e){return new Int16Array(p(2*e),0,e)}function g(e){return new Int32Array(p(4*e),0,e)}function v(e){return new Float32Array(p(4*e),0,e)}function b(e){return new Float64Array(p(8*e),0,e)}function _(e){return a?new Uint8ClampedArray(p(e),0,e):h(e)}function w(e){return new DataView(p(e),0,e)}function S(e){e=i.nextPow2(e);var t=i.log2(e),n=l[t];return n.length>0?n.pop():new r(e)}n.free=function(e){if(r.isBuffer(e))l[i.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|i.log2(t);u[n].push(e)}},n.freeUint8=n.freeUint16=n.freeUint32=n.freeInt8=n.freeInt16=n.freeInt32=n.freeFloat32=n.freeFloat=n.freeFloat64=n.freeDouble=n.freeUint8Clamped=n.freeDataView=function(e){c(e.buffer)},n.freeArrayBuffer=c,n.freeBuffer=function(e){l[i.log2(e.length)].push(e)},n.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return p(e);switch(t){case"uint8":return h(e);case"uint16":return f(e);case"uint32":return d(e);case"int8":return m(e);case"int16":return y(e);case"int32":return g(e);case"float":case"float32":return v(e);case"double":case"float64":return b(e);case"uint8_clamped":return _(e);case"buffer":return S(e);case"data":case"dataview":return w(e);default:return null}return null},n.mallocArrayBuffer=p,n.mallocUint8=h,n.mallocUint16=f,n.mallocUint32=d,n.mallocInt8=m,n.mallocInt16=y,n.mallocInt32=g,n.mallocFloat32=n.mallocFloat=v,n.mallocFloat64=n.mallocDouble=b,n.mallocUint8Clamped=_,n.mallocDataView=w,n.mallocBuffer=S,n.clearCache=function(){for(var e=0;e<32;++e)s.UINT8[e].length=0,s.UINT16[e].length=0,s.UINT32[e].length=0,s.INT8[e].length=0,s.INT16[e].length=0,s.INT32[e].length=0,s.FLOAT[e].length=0,s.DOUBLE[e].length=0,s.UINT8C[e].length=0,u[e].length=0,l[e].length=0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"bit-twiddle":247,buffer:249,dup:254}],297:[function(e,t,n){"use strict";t.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],o=e[0],a=1;a<r;++a)if(o=i,t(i=e[a],o)){if(a===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],o=1;o<n;++o,i=r)if(i=r,(r=e[o])!==i){if(o===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},{}],298:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core");n.auxiliaryInputFromSpec=function(e){if("BinaryCounter"===e.type)return new s(e.args);throw new Error("Unknown auxiliary input: "+e)};var a=function(e){this.depth=e};n.AuxiliaryInput=a;var s=function(e){function t(t){return e.call(this,t.numBits)||this}return i(t,e),t.prototype.getTensors=function(e){for(var t=o.buffer([e,this.depth]),n=0;n<e;++n)for(var r=0;r<this.depth;++r)t.set(Math.floor((n+1)/Math.pow(2,r))%2?1:-1,n,r);return t.toTensor().as2D(e,this.depth)},t}(a);n.BinaryCounter=s},{"@tensorflow/tfjs-core":66}],299:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a=e("@tensorflow/tfjs-core"),s=e("tonal"),u=e("./constants"),l=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(o=n.ChordQuality||(n.ChordQuality={}));var c=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.ChordSymbolException=c;var p=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.ChordEncodingException=p;var h=function(){function e(){}return e.pitches=function(e){if(!s.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);return s.Chord.notes(e).map(s.Note.chroma)},e.root=function(e){var t=s.Chord.tokenize(e)[0];if(!t)throw new c("Chord symbol has unknown root: "+e);return s.Note.chroma(t)},e.quality=function(e){if(!s.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);var t=s.Chord.intervals(e),n=l.map((function(e){return e.every((function(e){return t.includes(e)}))})),r=n.indexOf(!0),i=n.lastIndexOf(!0);return r>=0&&r===i?r:o.Other},e}();n.ChordSymbols=h;var f=function(){function e(){}return e.prototype.encodeProgression=function(e,t){var n=this,r=e.map((function(e){return n.encode(e)})),i=Array.from(Array(t).keys()).map((function(e){return Math.floor(e*r.length/t)}));return a.stack(i.map((function(e){return r[e]})))},e}();n.ChordEncoder=f,n.chordEncoderFromType=function(e){switch(e){case"MajorMinorChordEncoder":return new d;case"TriadChordEncoder":return new m;case"PitchChordEncoder":return new y;default:throw new Error("Unknown chord encoder type: "+e)}};var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depth=1+2*u.NUM_PITCH_CLASSES,t}return i(t,e),t.prototype.index=function(e){if(e===u.NO_CHORD)return 0;var t=h.root(e),n=1+h.quality(e)*u.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new p("Chord is neither major nor minor: "+e);return n},t.prototype.encode=function(e){var t=this;return a.tidy((function(){return a.oneHot(a.tensor1d([t.index(e)],"int32"),t.depth).as1D()}))},t}(f);n.MajorMinorChordEncoder=d;var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depth=1+4*u.NUM_PITCH_CLASSES,t}return i(t,e),t.prototype.index=function(e){if(e===u.NO_CHORD)return 0;var t=h.root(e),n=1+h.quality(e)*u.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new p("Chord is not a standard triad: "+e);return n},t.prototype.encode=function(e){var t=this;return a.tidy((function(){return a.oneHot(a.tensor1d([t.index(e)],"int32"),t.depth).as1D()}))},t}(f);n.TriadChordEncoder=m;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depth=1+3*u.NUM_PITCH_CLASSES,t}return i(t,e),t.prototype.encode=function(e){var t=this;return a.tidy((function(){if(e===u.NO_CHORD)return a.oneHot(a.tensor1d([0],"int32"),t.depth).as1D();var n=h.root(e),r=a.oneHot(a.tensor1d([n],"int32"),u.NUM_PITCH_CLASSES).as1D(),i=a.buffer([u.NUM_PITCH_CLASSES]);h.pitches(e).forEach((function(e){return i.set(1,e)}));var o=i.toTensor().as1D(),s=r;return a.concat1d([a.tensor1d([0]),r,o,s])}))},t}(f);n.PitchChordEncoder=y},{"./constants":300,"@tensorflow/tfjs-core":66,tonal:294}],300:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_QUARTERS_PER_MINUTE=120,n.DEFAULT_STEPS_PER_BAR=16,n.DEFAULT_STEPS_PER_QUARTER=4,n.DEFAULT_STEPS_PER_SECOND=100,n.DEFAULT_VELOCITY=80,n.DEFAULT_PROGRAM=0,n.DEFAULT_TICKS_PER_QUARTER=220,n.DEFAULT_CHANNEL=0,n.DRUM_CHANNEL=9,n.MIN_MIDI_VELOCITY=0,n.MAX_MIDI_VELOCITY=127,n.MIDI_VELOCITIES=n.MAX_MIDI_VELOCITY-n.MIN_MIDI_VELOCITY+1,n.NO_CHORD="N.C.",n.NUM_PITCH_CLASSES=12,n.MIN_MIDI_PITCH=0,n.MAX_MIDI_PITCH=127,n.MIDI_PITCHES=n.MAX_MIDI_PITCH-n.MIN_MIDI_PITCH+1,n.MIN_MIDI_PROGRAM=0,n.MAX_MIDI_PROGRAM=127,n.LO_CLICK_PITCH=89,n.HI_CLICK_PITCH=90,n.LO_CLICK_CLASS=9,n.HI_CLICK_CLASS=10},{}],301:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("../protobuf/index"),l=e("./constants"),c=e("./performance"),p=e("./sequences");n.DEFAULT_DRUM_PITCH_CLASSES=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],n.converterFromSpec=function(e){switch(e.type){case"MelodyConverter":return new y(e.args);case"DrumsConverter":return new f(e.args);case"DrumRollConverter":return new d(e.args);case"TrioConverter":return new g(e.args);case"DrumsOneHotConverter":return new m(e.args);case"MultitrackConverter":return new v(e.args);default:throw new Error("Unknown DataConverter type: "+e)}};var h=function(){function e(e){this.numSteps=e.numSteps,this.numSegments=e.numSegments}return e.prototype.tensorSteps=function(e){return s.scalar(e.shape[0],"int32")},e}();n.DataConverter=h;var f=function(e){function t(t){var r=e.call(this,t)||this;r.NUM_SPLITS=0,r.SEGMENTED_BY_TRACK=!1,r.pitchClasses=t.pitchClasses||n.DEFAULT_DRUM_PITCH_CLASSES,r.pitchToClass=new Map;for(var i=function(e){o.pitchClasses[e].forEach((function(t){r.pitchToClass.set(t,e)}))},o=this,a=0;a<r.pitchClasses.length;++a)i(a);return r.depth=r.pitchClasses.length,r}return i(t,e),t.prototype.toTensor=function(e){var t=this;p.assertIsQuantizedSequence(e);for(var n=this.numSteps||e.totalQuantizedSteps,r=s.buffer([n,this.pitchClasses.length+1]),i=0;i<n;++i)r.set(1,i,-1);return e.notes.forEach((function(e){r.set(1,e.quantizedStartStep,t.pitchToClass.get(e.pitch)),r.set(0,e.quantizedStartStep,-1)})),r.toTensor()},t.prototype.toNoteSequence=function(e,t){return void 0===t&&(t=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return(n=u.NoteSequence.create()).quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),[4,(r=e.argMax(1)).data()];case 1:for(i=a.sent(),r.dispose(),o=0;o<i.length;++o)for(s=0;s<this.pitchClasses.length;s++)i[o]>>s&1&&n.notes.push(u.NoteSequence.Note.create({pitch:this.pitchClasses[s][0],quantizedStartStep:o,quantizedEndStep:o+1,isDrum:!0}));return n.totalQuantizedSteps=i.length,[2,n]}}))}))},t}(h);n.DrumsConverter=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.toNoteSequence=function(e,t){return void 0===t&&(t=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return(n=u.NoteSequence.create()).quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),[4,e.data()];case 1:for(r=a.sent(),i=0;i<e.shape[0];++i)for(o=r.slice(i*this.depth,(i+1)*this.depth),s=0;s<o.length;++s)o[s]&&n.notes.push(u.NoteSequence.Note.create({pitch:this.pitchClasses[s][0],quantizedStartStep:i,quantizedEndStep:i+1,isDrum:!0}));return n.totalQuantizedSteps=e.shape[0],[2,n]}}))}))},t}(f);n.DrumRollConverter=d;var m=function(e){function t(t){var n=e.call(this,t)||this;return n.depth=Math.pow(2,n.pitchClasses.length),n}return i(t,e),t.prototype.toTensor=function(e){var t=this;p.assertIsRelativeQuantizedSequence(e);for(var n=this.numSteps||e.totalQuantizedSteps,r=Array(n).fill(0),i=0,o=e.notes;i<o.length;i++){var a=o[i],u=a.pitch,l=a.quantizedStartStep;r[l]+=Math.pow(2,this.pitchToClass.get(u))}return s.tidy((function(){return s.oneHot(s.tensor1d(r,"int32"),t.depth)}))},t}(f);n.DrumsOneHotConverter=m;var y=function(e){function t(t){var n=e.call(this,t)||this;return n.NUM_SPLITS=0,n.SEGMENTED_BY_TRACK=!1,n.NOTE_OFF=1,n.FIRST_PITCH=2,n.minPitch=t.minPitch,n.maxPitch=t.maxPitch,n.ignorePolyphony=void 0===t.ignorePolyphony||t.ignorePolyphony,n.depth=t.maxPitch-t.minPitch+1+n.FIRST_PITCH,n}return i(t,e),t.prototype.toTensor=function(e){var t=this;p.assertIsQuantizedSequence(e);var n=this.numSteps||e.totalQuantizedSteps,r=e.notes.sort((function(e,t){return e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep})),i=s.buffer([n],"int32"),o=-1;return r.forEach((function(e){if(e.quantizedStartStep===o){if(t.ignorePolyphony)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<t.minPitch||e.pitch>t.maxPitch)throw Error("`NoteSequence` has a pitch outside of the valid range: "+e.pitch);i.set(e.pitch-t.minPitch+t.FIRST_PITCH,e.quantizedStartStep),i.set(t.NOTE_OFF,e.quantizedEndStep),o=e.quantizedStartStep})),s.tidy((function(){return s.oneHot(i.toTensor(),t.depth)}))},t.prototype.toNoteSequence=function(e,t){return void 0===t&&(t=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,(function(){var n,r,i,o,s,l;return a(this,(function(a){switch(a.label){case 0:return(n=u.NoteSequence.create()).quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),[4,(r=e.argMax(1)).data()];case 1:for(i=a.sent(),r.dispose(),o=null,s=0;s<i.length;++s)switch(l=i[s]){case 0:break;case 1:o&&(o.quantizedEndStep=s,n.notes.push(o),o=null);break;default:o&&(o.quantizedEndStep=s,n.notes.push(o)),o=u.NoteSequence.Note.create({pitch:l-this.FIRST_PITCH+this.minPitch,quantizedStartStep:s})}return o&&(o.quantizedEndStep=i.length,n.notes.push(o)),n.totalQuantizedSteps=i.length,[2,n]}}))}))},t}(h);n.MelodyConverter=y;var g=function(e){function t(t){var n=e.call(this,t)||this;return n.NUM_SPLITS=3,n.SEGMENTED_BY_TRACK=!1,n.MEL_PROG_RANGE=[0,31],n.BASS_PROG_RANGE=[32,39],t.melArgs.numSteps=t.numSteps,t.bassArgs.numSteps=t.numSteps,t.drumsArgs.numSteps=t.numSteps,n.melConverter=new y(t.melArgs),n.bassConverter=new y(t.bassArgs),n.drumsConverter=new m(t.drumsArgs),n.depth=n.melConverter.depth+n.bassConverter.depth+n.drumsConverter.depth,n}return i(t,e),t.prototype.toTensor=function(e){var t=this;p.assertIsQuantizedSequence(e);var n=p.clone(e),r=p.clone(e),i=p.clone(e);return n.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.MEL_PROG_RANGE[0]&&e.program<=t.MEL_PROG_RANGE[1]})),r.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.BASS_PROG_RANGE[0]&&e.program<=t.BASS_PROG_RANGE[1]})),i.notes=e.notes.filter((function(e){return e.isDrum})),s.tidy((function(){return s.concat([t.melConverter.toTensor(n),t.bassConverter.toTensor(r),t.drumsConverter.toTensor(i)],-1)}))},t.prototype.toNoteSequence=function(e,t){return void 0===t&&(t=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,(function(){var n,r,i,o,u,l,c=this;return a(this,(function(a){switch(a.label){case 0:return i=s.split(e,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),[4,this.melConverter.toNoteSequence(i[0],t)];case 1:return(o=a.sent()).notes.forEach((function(e){e.instrument=0,e.program=0})),[4,this.bassConverter.toNoteSequence(i[1])];case 2:return u=a.sent(),(n=o.notes).push.apply(n,u.notes.map((function(e){return e.instrument=1,e.program=c.BASS_PROG_RANGE[0],e}))),[4,this.drumsConverter.toNoteSequence(i[2])];case 3:return l=a.sent(),(r=o.notes).push.apply(r,l.notes.map((function(e){return e.instrument=2,e}))),i.forEach((function(e){return e.dispose()})),[2,o]}}))}))},t}(h);n.TrioConverter=g;var v=function(e){function t(t){var n=e.call(this,t)||this;return n.NUM_SPLITS=0,n.SEGMENTED_BY_TRACK=!0,n.stepsPerQuarter=t.stepsPerQuarter,n.totalSteps=t.totalSteps,n.numVelocityBins=t.numVelocityBins,n.minPitch=t.minPitch?t.minPitch:l.MIN_MIDI_PITCH,n.maxPitch=t.maxPitch?t.maxPitch:l.MAX_MIDI_PITCH,n.numPitches=n.maxPitch-n.minPitch+1,n.performanceEventDepth=2*n.numPitches+n.totalSteps+n.numVelocityBins,n.numPrograms=l.MAX_MIDI_PROGRAM-l.MIN_MIDI_PROGRAM+2,n.endToken=n.performanceEventDepth+n.numPrograms,n.depth=n.endToken+1,n.endTensor=s.tidy((function(){return s.oneHot(s.tensor1d([n.endToken],"int32"),n.depth).as1D()})),n}return i(t,e),t.prototype.trackToTensor=function(e){var t=this,n=this.numSteps/this.numSegments,r=void 0;if(e){for(;e.events.length>n-2;)e.events.pop();(r=s.buffer([e.events.length+2],"int32")).set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((function(e,n){switch(e.type){case"note-on":r.set(e.pitch-t.minPitch,n+1);break;case"note-off":r.set(t.numPitches+e.pitch-t.minPitch,n+1);break;case"time-shift":r.set(2*t.numPitches+e.steps-1,n+1);break;case"velocity-change":r.set(2*t.numPitches+t.totalSteps+e.velocityBin-1,n+1);break;default:throw new Error("Unrecognized performance event: "+e)}})),r.set(this.endToken,e.events.length+1)}else r=s.buffer([1],"int32",new Int32Array([this.endToken]));return s.tidy((function(){var e=s.oneHot(r.toTensor(),t.depth);return e.pad([[0,n-e.shape[0]],[0,0]])}))},t.prototype.toTensor=function(e){var t=this;if(p.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: "+e.quantizationInfo.stepsPerQuarter+" != "+this.stepsPerQuarter);var n=p.clone(e);n.notes=e.notes.filter((function(e){return e.pitch>=t.minPitch&&e.pitch<=t.maxPitch}));for(var r=new Set(n.notes.map((function(e){return e.instrument}))),i=Array.from(r).map((function(e){return c.Performance.fromNoteSequence(n,t.totalSteps,t.numVelocityBins,e)})).sort((function(e,t){return t.isDrum?-1:e.isDrum?1:e.program-t.program}));i.length>this.numSegments;)i.pop();for(i.forEach((function(e){return e.setNumSteps(t.totalSteps)}));i.length<this.numSegments;)i.push(void 0);return s.tidy((function(){return s.concat(i.map((function(e){return t.trackToTensor(e)})),0)}))},t.prototype.tokensToTrack=function(e){var t=this,n=e.indexOf(this.endToken),r=n>=0?n:e.length,i=e.slice(0,r),o=i.filter((function(e){return e<t.performanceEventDepth})),a=i.filter((function(e){return e>=t.performanceEventDepth})),s=a.length?a[0]-this.performanceEventDepth<this.numPrograms-1?[a[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=s[0],l=s[1],p=Array.from(o).map((function(e){if(e<t.numPitches)return{type:"note-on",pitch:t.minPitch+e};if(e<2*t.numPitches)return{type:"note-off",pitch:t.minPitch+e-t.numPitches};if(e<2*t.numPitches+t.totalSteps)return{type:"time-shift",steps:e-2*t.numPitches+1};if(e<2*t.numPitches+t.totalSteps+t.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*t.numPitches-t.totalSteps+1};throw new Error("Invalid performance event token: "+e)}));return new c.Performance(p,this.totalSteps,this.numVelocityBins,u,l)},t.prototype.toNoteSequence=function(e,t){return void 0===t&&(t=this.stepsPerQuarter),o(this,void 0,void 0,(function(){var n,r,i=this;return a(this,(function(l){switch(l.label){case 0:return(n=u.NoteSequence.create()).quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),n.totalQuantizedSteps=this.totalSteps,r=s.tidy((function(){return s.split(e.argMax(1),i.numSegments)})),[4,Promise.all(r.map((function(e){return o(i,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return[4,e.data()];case 1:return t=r.sent(),n=this.tokensToTrack(t),e.dispose(),[2,n]}}))}))})))];case 1:return l.sent().forEach((function(e,t){var r;e.setNumSteps(i.totalSteps),(r=n.notes).push.apply(r,e.toNoteSequence(t).notes)})),[2,n]}}))}))},t}(h);n.MultitrackConverter=v},{"../protobuf/index":317,"./constants":300,"./performance":305,"./sequences":308,"@tensorflow/tfjs-core":66}],302:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./aux_inputs");n.aux_inputs=i;var o=e("./chords");n.chords=o;var a=e("./constants");n.constants=a;var s=e("./data");n.data=s;var u=e("./logging");n.logging=u;var l=e("./performance");n.performance=l;var c=e("./sequences");n.sequences=c,r(e("./midi_io")),r(e("./player")),r(e("./recorder")),r(e("./visualizer"))},{"./aux_inputs":298,"./chords":299,"./constants":300,"./data":301,"./logging":303,"./midi_io":304,"./performance":305,"./player":306,"./recorder":307,"./sequences":308,"./visualizer":310}],303:[function(e,t,n){"use strict";function r(e,t,r){if(void 0===t&&(t="Magenta.js"),void 0===r&&(r=10),0===r)throw Error("Logging level cannot be NONE.");n.verbosity>=r&&(5===r?console.warn:console.log)("%c "+t+" ","background:magenta; color:white",e)}Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(n.Level||(n.Level={})),n.verbosity=10,n.log=r,n.logWithDuration=function(e,t,n,i){void 0===n&&(n="Magenta.js"),void 0===i&&(i=10),r(e+" in "+((performance.now()-t)/1e3).toPrecision(3)+"s",n,i)}},{}],304:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("midiconvert"),a=e("../protobuf"),s=e("./constants"),u=e("./sequences"),l=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.MidiConversionError=l,n.midiToSequenceProto=function(e){var t=o.parse(e),n=a.NoteSequence.create();n.ticksPerQuarter=t.header.PPQ,n.sourceInfo=a.NoteSequence.SourceInfo.create({parser:a.NoteSequence.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:a.NoteSequence.SourceInfo.EncodingType.MIDI}),t.header.timeSignature?n.timeSignatures.push(a.NoteSequence.TimeSignature.create({time:0,numerator:t.header.timeSignature[0],denominator:t.header.timeSignature[1]})):n.timeSignatures.push(a.NoteSequence.TimeSignature.create({time:0,numerator:4,denominator:4})),n.tempos.push(a.NoteSequence.Tempo.create({time:0,qpm:t.header.bpm}));for(var r=-1,i=0,u=t.tracks;i<u.length;i++){var l=u[i];l.notes.length>0&&(r+=1);for(var c=0,p=l.notes;c<p.length;c++){var h=p[c],f=h.time,d=f+h.duration;n.notes.push(a.NoteSequence.Note.create({instrument:r,program:l.instrumentNumber,startTime:f,endTime:d,pitch:h.midi,velocity:Math.floor(h.velocity*s.MIDI_VELOCITIES),isDrum:l.isPercussion})),d>n.totalTime&&(n.totalTime=d)}}return n},n.sequenceProtoToMidi=function(e){if(u.isQuantizedSequence(e)&&(e=u.unquantizeSequence(e)),e.tempos&&0!==e.tempos.length||(e.tempos=[{time:0,qpm:s.DEFAULT_QUARTERS_PER_MINUTE}]),e.timeSignatures&&0!==e.timeSignatures.length||(e.timeSignatures=[{time:0,numerator:4,denominator:4}]),1!==e.tempos.length||0!==e.tempos[0].time)throw new l("NoteSequence must have exactly 1 tempo at time 0");if(1!==e.timeSignatures.length||0!==e.timeSignatures[0].time)throw new l("NoteSequence must have exactly 1 time signature at time 0");for(var t={header:{bpm:e.tempos[0].qpm,PPQ:e.ticksPerQuarter?e.ticksPerQuarter:s.DEFAULT_TICKS_PER_QUARTER,timeSignature:[e.timeSignatures[0].numerator,e.timeSignatures[0].denominator]},tracks:[]},n=new Map,r=0,i=e.notes;r<i.length;r++){var a=i[r],c=a.instrument?a.instrument:0;n.has(c)||n.set(c,[]),n.get(c).push(a)}for(var p=Array.from(n.keys()).sort((function(e,t){return e-t})),h=0;h<p.length;h++){if(h!==p[h])throw new l("Instrument list must be continuous and start at 0");var f=n.get(h),d={id:h,notes:[],isPercussion:void 0!==f[0].isDrum&&f[0].isDrum,channelNumber:f[0].isDrum?s.DRUM_CHANNEL:s.DEFAULT_CHANNEL,instrumentNumber:void 0===f[0].program?s.DEFAULT_PROGRAM:f[0].program};d.notes=f.map((function(e){var t=void 0===e.velocity?s.DEFAULT_VELOCITY:e.velocity;return{midi:e.pitch,time:e.startTime,duration:e.endTime-e.startTime,velocity:(t+1)/s.MIDI_VELOCITIES}})),t.tracks.push(d)}return new Uint8Array(o.fromJSON(t).toArray())}},{"../protobuf":317,"./constants":300,"./sequences":308,midiconvert:259}],305:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../protobuf/index"),i=e("./constants"),o=e("./sequences"),a=function(){function e(e,t,n,r,i){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=r,this.isDrum=i}return e.fromNoteSequence=function(t,n,r,a){o.assertIsQuantizedSequence(t);for(var s=t.notes.filter((function(e,t){return void 0===a||e.instrument===a})),u=s.sort((function(e,t){return e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime})),l=u.map((function(e,t){return{step:e.quantizedStartStep,index:t,isOffset:0}})),c=u.map((function(e,t){return{step:e.quantizedEndStep,index:t,isOffset:1}})),p=l.concat(c).sort((function(e,t){return e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step})),h=r?Math.ceil((i.MIDI_VELOCITIES-1)/r):void 0,f=[],d=0,m=r,y=0,g=p;y<g.length;y++){var v=g[y];if(v.step>d){for(;v.step>d+n;)f.push({type:"time-shift",steps:n}),d+=n;f.push({type:"time-shift",steps:v.step-d}),d=v.step}if(v.isOffset)f.push({type:"note-off",pitch:u[v.index].pitch});else{if(h){var b=Math.floor((u[v.index].velocity-i.MIN_MIDI_VELOCITY-1)/h)+1;b!==m&&(f.push({type:"velocity-change",velocityBin:b}),m=b)}f.push({type:"note-on",pitch:u[v.index].pitch})}}var _=!!s.some((function(e){return e.isDrum}))&&(!s.some((function(e){return!e.isDrum}))||void 0),w=Array.from(new Set(s.map((function(e){return e.program})))),S=new e(f,n,r,_||1!==w.length?void 0:w[0],_);return S.setNumSteps(t.totalQuantizedSteps),S},e.prototype.getNumSteps=function(){return this.events.filter((function(e){return"time-shift"===e.type})).map((function(e){return e.steps})).reduce((function(e,t){return e+t}),0)},e.prototype.setNumSteps=function(e){var t=this.getNumSteps();if(t<e){if(this.events.length){var n=this.events[this.events.length-1];if("time-shift"===n.type){var r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){var i=this.events[this.events.length-1];"time-shift"===i.type?t-i.steps<e?(i.steps-=t-e,t=e):(this.events.pop(),t-=i.steps):this.events.pop()}},e.prototype.toNoteSequence=function(e){for(var t=this,n=this.numVelocityBins?Math.ceil((i.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,o=r.NoteSequence.create(),a=0,s=void 0,u=new Map,l=i.MIN_MIDI_PITCH;l<=i.MAX_MIDI_PITCH;++l)u.set(l,[]);for(var c=0,p=this.events;c<p.length;c++){var h=p[c];switch(h.type){case"note-on":u.get(h.pitch).push([a,s]);break;case"note-off":var f=u.get(h.pitch);if(f.length){var d=f.shift(),m=d[0],y=d[1];a>m?o.notes.push(r.NoteSequence.Note.create({pitch:h.pitch,velocity:y,instrument:e,quantizedStartStep:m,quantizedEndStep:a,program:this.program,isDrum:this.isDrum})):console.log("Ignoring zero-length note: (pitch = "+h.pitch+", step = "+a+")")}else console.log("Ignoring note-off with no previous note-on:(pitch = "+h.pitch+", step = "+a+")");break;case"time-shift":a+=h.steps;break;case"velocity-change":if(!n)throw new Error("Unexpected velocity change event: "+h);s=i.MIN_MIDI_VELOCITY+(h.velocityBin-1)*n+1;break;default:throw new Error("Unrecognized performance event: "+h)}}return u.forEach((function(n,i){for(var s=0,u=n;s<u.length;s++){var l=u[s],c=l[0],p=l[1];a>c?o.notes.push(r.NoteSequence.Note.create({pitch:i,velocity:p,instrument:e,quantizedStartStep:c,quantizedEndStep:a,program:t.program,isDrum:t.isDrum})):console.log("Ignoring zero-length note: (pitch = "+i+", step = "+a+")")}})),o.totalQuantizedSteps=a,o},e}();n.Performance=a},{"../protobuf/index":317,"./constants":300,"./sequences":308}],306:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("tone"),u=e("."),l=e("./constants"),c=e("./data"),p=e("./soundfont");function h(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}var f=function(){};n.BasePlayerCallback=f;var d=function(){function e(e,t){void 0===e&&(e=!1),this.playClick=e,this.callbackObject=t,this.desiredQPM=void 0}return e.prototype.setTempo=function(e){this.desiredQPM=e,"started"===s.Transport.state&&(s.Transport.bpm.value=e)},e.prototype.makeClickSequence=function(e){for(var t=u.sequences.clone(e),n=t.notes.map((function(e){return e.quantizedEndStep})),r=Math.max.apply(Math,n),i=0;i<r;i+=4){var o={pitch:i%16==0?l.LO_CLICK_PITCH:l.HI_CLICK_PITCH,quantizedStartStep:i,isDrum:!0,quantizedEndStep:i+1};t.notes.push(o)}return t.notes.sort(h),t},e.prototype.resumeContext=function(){s.context.resume()},e.prototype.start=function(e,t){var n=this;this.resumeContext();var r=u.sequences.isQuantizedSequence(e);if(this.playClick&&r&&(e=this.makeClickSequence(e)),t?s.Transport.bpm.value=t:e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?s.Transport.bpm.value=e.tempos[0].qpm:s.Transport.bpm.value=l.DEFAULT_QUARTERS_PER_MINUTE,r)e=u.sequences.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");return this.currentPart=new s.Part((function(e,t){(n.playClick||t.pitch!==l.LO_CLICK_PITCH&&t.pitch!==l.HI_CLICK_PITCH)&&n.playNote(e,t),n.callbackObject&&s.Draw.schedule((function(){n.callbackObject.run(t,e)}),e)}),e.notes.map((function(e){return[e.startTime,e]}))),this.desiredQPM&&(s.Transport.bpm.value=this.desiredQPM),this.currentPart.start(),"started"!==s.Transport.state&&s.Transport.start(),new Promise((function(t){n.scheduledStop=s.Transport.schedule((function(){n.stop(),t(),n.callbackObject&&n.callbackObject.stop()}),"+"+e.totalTime)}))},e.prototype.stop=function(){this.currentPart&&(this.currentPart.stop(),this.currentPart=null),s.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0},e.prototype.isPlaying=function(){return!!this.currentPart},e}();n.BasePlayer=d;var m=function(){function e(){var e=this;this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new s.MembraneSynth).toMaster(),this.tomLow=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomMid=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomHigh=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.closedHihat=new s.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.openHihat=new s.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.ride=(new s.MetalSynth).toMaster(),this.crash=new s.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toMaster(),this.snare=new s.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toMaster(),this.loClick=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.pitchPlayers=[function(t,n){return void 0===n&&(n=1),e.kick.triggerAttackRelease("C2","8n",t,n)},function(t,n){return void 0===n&&(n=1),e.snare.triggerAttackRelease("16n",t,n)},function(t,n){return void 0===n&&(n=1),e.closedHihat.triggerAttack(t,.3,n)},function(t,n){return void 0===n&&(n=1),e.openHihat.triggerAttack(t,.3,n)},function(t,n){return void 0===n&&(n=.5),e.tomLow.triggerAttack("G3",t,n)},function(t,n){return void 0===n&&(n=.5),e.tomMid.triggerAttack("C4",t,n)},function(t,n){return void 0===n&&(n=.5),e.tomHigh.triggerAttack("F4",t,n)},function(t,n){return void 0===n&&(n=1),e.crash.triggerAttack(t,1,n)},function(t,n){return void 0===n&&(n=1),e.ride.triggerAttack(t,.5,n)},function(t,n){return void 0===n&&(n=.5),e.loClick.triggerAttack("G5",t,n)},function(t,n){return void 0===n&&(n=.5),e.hiClick.triggerAttack("C6",t,n)}];for(var t=function(t){c.DEFAULT_DRUM_PITCH_CLASSES[t].forEach((function(n){e.DRUM_PITCH_TO_CLASS.set(n,t)}))},n=0;n<c.DEFAULT_DRUM_PITCH_CLASSES.length;++n)t(n);this.DRUM_PITCH_TO_CLASS.set(l.LO_CLICK_PITCH,l.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(l.HI_CLICK_PITCH,l.HI_CLICK_CLASS)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.playNote=function(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)},e}(),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.synths=new Map,t.drumKit=m.getInstance(),t}return i(t,e),t.prototype.playNote=function(e,t){var n=t.hasOwnProperty("velocity")?t.velocity/l.MAX_MIDI_VELOCITY:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{var r=new s.Frequency(t.pitch,"midi"),i=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(r,i,e,n)}},t.prototype.getSynth=function(e,t){if(this.synths.has(e))return this.synths.get(e);if(void 0!==t&&t>=32&&t<=39){var n=new s.Synth({oscillator:{type:"triangle"}}).toMaster();n.volume.value=5,this.synths.set(e,n)}else this.synths.set(e,new s.PolySynth(10).toMaster());return this.synths.get(e)},t.tone=s,t}(d);n.Player=y;var g=function(e){function t(t,n,r,i,o){void 0===n&&(n=s.Master);var a=e.call(this,!1,o)||this;return a.soundFont=new p.SoundFont(t),a.output=n,a.programOutputs=r,a.drumOutputs=i,a}return i(t,e),t.prototype.loadSamples=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.soundFont.loadSamples(e.notes.map((function(e){return{pitch:e.pitch,velocity:e.velocity,program:e.program||0,isDrum:e.isDrum||!1}})))];case 1:return t.sent(),[2]}}))}))},t.prototype.resumeContext=function(){s.context.resume()},t.prototype.start=function(t,n){var r=this;return this.resumeContext(),this.loadSamples(t).then((function(){return e.prototype.start.call(r,t,n)}))},t.prototype.playNote=function(e,t){var n=this.output;this.programOutputs&&!t.isDrum?this.programOutputs.has(t.program)&&(n=this.programOutputs.get(t.program)):this.drumOutputs&&t.isDrum&&this.drumOutputs.has(t.pitch)&&(n=this.drumOutputs.get(t.pitch)),this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,n)},t}(d);n.SoundFontPlayer=g;var v=function(e){function t(t){return e.call(this,!0,t)||this}return i(t,e),t}(y);n.PlayerWithClick=v},{".":302,"./constants":300,"./data":301,"./soundfont":309,tone:295}],307:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../protobuf"),a=e("tone"),s=e("./constants"),u=function(){};n.BaseRecorderCallback=u;var l=function(){function e(e,t){void 0===e&&(e={}),this.notes=[],this.midiInputs=[],this.loClick=new a.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new a.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.config={playClick:e.playClick,qpm:e.qpm||s.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:e.playCountIn},this.callbackObject=t,this.recording=!1,this.onNotes=new Map}return e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return[4,navigator.requestMIDIAccess().then((function(t){return e.midiReady(t)}),(function(e){return console.log("Something went wrong",e)}))];case 1:return t.sent(),[2]}}))}))},e.prototype.midiReady=function(e){console.log("Initialized Recorder");for(var t=e.inputs.values(),n=t.next();n&&!n.done;n=t.next())this.midiInputs.push(n.value)},e.prototype.isRecording=function(){return this.recording},e.prototype.setTempo=function(e){this.config.qpm=e,"started"===a.Transport.state&&(a.Transport.bpm.value=e)},e.prototype.enablePlayClick=function(e){this.config.playClick=e},e.prototype.enablePlayCountIn=function(e){this.config.playCountIn=e},e.prototype.initClickLoop=function(){var e=this,t=0;this.clickLoop=new a.Loop((function(n){t%4==0?e.loClick.triggerAttack("G5"):e.hiClick.triggerAttack("C6"),t++,e.config.playCountIn&&4===t&&(a.Transport.stop(),e.clickLoop.stop())}),"4n")},e.prototype.getMIDIInputs=function(){return this.midiInputs},e.prototype.start=function(e){for(var t=this,n=0,r=e||this.midiInputs;n<r.length;n++){r[n].onmidimessage=function(e){t.midiMessageReceived(e)}}this.config.playClick||this.config.playCountIn?(this.initClickLoop(),a.Transport.bpm.value=this.config.qpm,a.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map},e.prototype.stop=function(){var e=this;this.recording=!1;var t=Date.now();this.onNotes.forEach((function(n,r){e.noteOff(r,t)}));for(var n=0,r=this.midiInputs;n<r.length;n++){r[n].onmidimessage=null}return this.clickLoop&&(a.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()},e.prototype.getNoteSequence=function(){return 0===this.notes.length?null:o.NoteSequence.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})},e.prototype.midiMessageReceived=function(e){if(this.recording){var t=Date.now();void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=t);var n=e.data[0]>>4,r=e.data[1],i=e.data.length>2?e.data[2]:1;8===n||9===n&&0===i?(this.noteOff(r,t),this.callbackObject&&this.callbackObject.run(this.getNoteSequence())):9===n&&this.noteOn(r,i,t)}},e.prototype.noteOn=function(e,t,n){var r=new o.NoteSequence.Note;r.pitch=e,r.startTime=(n-this.firstNoteTimestamp)/1e3,r.velocity=t,this.onNotes.set(e,r)},e.prototype.noteOff=function(e,t){var n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)},e}();n.Recorder=l},{"../protobuf":317,"./constants":300,tone:295}],308:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../protobuf/index"),a=e("./constants"),s=.5,u=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.MultipleTimeSignatureException=u;var l=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.BadTimeSignatureException=l;var c=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.NegativeTimeException=c;var p=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);n.MultipleTempoException=p;var h=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(t,e),t}(Error);function f(e){return o.NoteSequence.decode(o.NoteSequence.encode(e).finish())}function d(e,t){return e*t/60}function m(e,t,n){void 0===n&&(n=s);var r=e*t;return Math.floor(r+(1-n))}function y(e){return e.controlChanges.concat(e.textAnnotations)}function g(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((function(e,t){return e.time-t.time})),0!==e.tempos[0].time&&e.tempos[0].qpm!==a.DEFAULT_QUARTERS_PER_MINUTE)throw new p("NoteSequence has an implicit tempo change from initial "+a.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+e.tempos[0].qpm+" qpm at "+e.tempos[0].time+" seconds.");for(var t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new p("NoteSequence has at least one tempo change from "+e.tempos[0].qpm+" qpm to "+e.tempos[t].qpm+"qpm at "+e.tempos[t].time+" seconds.")}}function v(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function b(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function _(e){if(!b(e))throw new h("NoteSequence "+e.id+" is not quantized or is quantized based on absolute timing")}function w(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerSecond>0}n.QuantizationStatusException=h,n.clone=f,n.stepsPerQuarterToStepsPerSecond=d,n.quantizeToStep=m,n.quantizeNoteSequence=function(e,t){var n=f(e);if(n.quantizationInfo=o.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((function(e,t){return e.time-t.time})),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new u("NoteSequence has an implicit change from initial 4/4 time signature to "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(var r=1;r<n.timeSignatures.length;r++){if((i=n.timeSignatures[r]).numerator!==n.timeSignatures[0].numerator||i.denominator!==n.timeSignatures[0].denominator)throw new u("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+i.numerator+"/"+i.denominator+" at "+i.time+" seconds")}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{var i=o.NoteSequence.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(i)}var s,p=n.timeSignatures[0];if(!(s=p.denominator)||0!=(s&s-1))throw new l("Denominator is not a power of 2. Time signature: "+p.numerator+"/"+p.denominator);if(0===p.numerator)throw new l("Numerator is 0. Time signature: "+p.numerator+"/"+p.denominator);if(n.tempos.length>0)g(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{var h=o.NoteSequence.Tempo.create({qpm:a.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(h)}var v=d(t,n.tempos[0].qpm);return n.totalQuantizedSteps=m(e.totalTime,v),function(e,t){for(var n=0,r=e.notes;n<r.length;n++){var i=r[n];if(i.quantizedStartStep=m(i.startTime,t),i.quantizedEndStep=m(i.endTime,t),i.quantizedEndStep===i.quantizedStartStep&&(i.quantizedEndStep+=1),i.quantizedStartStep<0||i.quantizedEndStep<0)throw new c("Got negative note time: start_step = "+i.quantizedStartStep+", end_step = "+i.quantizedEndStep);i.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=i.quantizedEndStep)}y(e).forEach((function(e){if(e.quantizedStep=m(e.time,t),e.quantizedStep<0)throw new c("Got negative event time: step = "+e.quantizedStep)}))}(n,v),n},n.isQuantizedSequence=v,n.assertIsQuantizedSequence=function(e){if(!v(e))throw new h("NoteSequence "+e.id+" is not quantized (missing quantizationInfo)")},n.isRelativeQuantizedSequence=b,n.assertIsRelativeQuantizedSequence=_,n.isAbsoluteQuantizedSequence=w,n.assertIsAbsoluteQuantizedSequence=function(e){if(!w(e))throw new h("NoteSequence "+e.id+" is not quantized or is quantized based on relative timing")},n.unquantizeSequence=function(e,t){_(e),g(e);var n=f(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(o.NoteSequence.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:a.DEFAULT_QUARTERS_PER_MINUTE;var r=function(e){return e/n.quantizationInfo.stepsPerQuarter*(60/t)};return n.totalTime=r(n.totalQuantizedSteps),n.notes.forEach((function(e){e.startTime=r(e.quantizedStartStep),e.endTime=r(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime)})),y(n).forEach((function(e){e.time=r(e.time)})),n},n.mergeInstruments=function(e){var t=f(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),r=Array.from(new Set(n.filter((function(e){return!e.isDrum})).map((function(e){return e.program}))));return n.forEach((function(e){e.isDrum?(e.program=0,e.instrument=r.length):e.instrument=r.indexOf(e.program)})),t}},{"../protobuf/index":317,"./constants":300}],309:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("tone"),a=e("./constants"),s=function(){function e(e){this.FADE_SECONDS=.1,this.baseURL=e,this.buffers=new o.Buffers([]),this.initialized=!1}return e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return[4,fetch(this.baseURL+"/instrument.json").then((function(e){return e.json()})).then((function(t){e.name=t.name,e.minPitch=t.minPitch,e.maxPitch=t.maxPitch,e.durationSeconds=t.durationSeconds,e.releaseSeconds=t.releaseSeconds,e.percussive=t.percussive,e.velocities=t.velocities,e.initialized=!0}))];case 1:return t.sent(),[2]}}))}))},e.prototype.sampleInfoToName=function(e){return this.velocities?"p"+e.pitch+"_v"+e.velocity:"p"+e.pitch},e.prototype.sampleNameToURL=function(e){return this.baseURL+"/"+e+".mp3"},e.prototype.nearestVelocity=function(e){if(!this.velocities)return e;e||(e=a.DEFAULT_VELOCITY);var t=void 0,n=a.MIDI_VELOCITIES;return this.velocities.forEach((function(r){var i=Math.abs(r-e);i<n&&(t=r,n=i)})),t},e.prototype.loadSamples=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a=this;return i(this,(function(i){switch(i.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:i.sent(),i.label=2;case 2:return t=e.filter((function(e){return!(e.pitch<a.minPitch||e.pitch>a.maxPitch)||(console.log("Pitch "+e.pitch+" is outside the valid range for "+a.name+", ignoring."),!1)})).map((function(e){return a.sampleInfoToName({pitch:e.pitch,velocity:a.nearestVelocity(e.velocity)})})),n=Array.from(new Set(t)).filter((function(e){return!a.buffers.has(e)})),(r=n.map((function(e){return{name:e,url:a.sampleNameToURL(e)}}))).length>0?(r.forEach((function(e){return a.buffers.add(e.name,e.url)})),[4,new Promise((function(e){return o.Buffer.on("load",e)}))]):[3,4];case 3:i.sent(),console.log("Loaded samples for "+this.name+"."),i.label=4;case 4:return[2]}}))}))},e.prototype.playNote=function(e,t,n,r,i){if(!this.initialized)throw new Error("Instrument is not initialized.");if(e<this.minPitch||e>this.maxPitch)console.log("Pitch "+e+" is outside the valid range for "+this.name+" ("+this.minPitch+"-"+this.maxPitch+")");else{var a=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(a))throw new Error("Buffer not found for "+this.name+": "+a);var s=this.buffers.get(a);if(!s.loaded)throw new Error("Buffer not loaded for "+this.name+": "+a);r>this.durationSeconds&&console.log("Requested note duration longer than sample duration: "+r+" > "+this.durationSeconds);var u=new o.BufferSource(s).connect(i);if(u.start(n,0,void 0,1,0),!this.percussive&&r<this.durationSeconds){var l=new o.BufferSource(s).connect(i);u.stop(n+r+this.FADE_SECONDS,this.FADE_SECONDS),l.start(n+r,this.durationSeconds,void 0,1,this.FADE_SECONDS)}}},e}();n.Instrument=s;var u=function(){function e(e){this.baseURL=e,this.instruments=new Map,this.initialized=!1}return e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return[4,fetch(this.baseURL+"/soundfont.json").then((function(e){return e.json()})).then((function(t){for(var n in e.name=t.name,t.instruments){var r=e.baseURL+"/"+t.instruments[n];e.instruments.set("drums"===n?"drums":+n,new s(r))}e.initialized=!0}))];case 1:return t.sent(),[2]}}))}))},e.prototype.loadSamples=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(r){switch(r.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:r.sent(),r.label=2;case 2:return t=new Map,e.forEach((function(e){e.isDrum=e.isDrum||!1,e.program=e.program||0;var r=e.isDrum?"drums":e.program,i={pitch:e.pitch,velocity:e.velocity};t.has(r)?t.get(r).push(i):n.instruments.has(r)?t.set(r,[i]):console.log("No instrument in "+n.name+" for: program="+e.program+", isDrum="+e.isDrum)})),[4,Promise.all(Array.from(t.keys()).map((function(e){return n.instruments.get(e).loadSamples(t.get(e))})))];case 3:return r.sent(),[2]}}))}))},e.prototype.playNote=function(e,t,n,r,i,o,a){void 0===i&&(i=0),void 0===o&&(o=!1);var s=o?"drums":i;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(s)?this.instruments.get(s).playNote(e,t,n,r,a):console.log("No instrument in "+this.name+" for: program="+i+", isDrum="+o)},e}();n.SoundFont=u},{"./constants":300,tone:295}],310:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("."),i=e("./constants"),o=function(){function e(e,t,n){void 0===n&&(n={}),this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119",minPitch:n.minPitch,maxPitch:n.maxPitch},this.noteSequence=e,this.sequenceIsQuantized=r.sequences.isQuantizedSequence(this.noteSequence),this.ctx=t.getContext("2d");var i=this.getCanvasSize();this.height=i.height;var o=window.devicePixelRatio||1;this.ctx.canvas.width=o*i.width,this.ctx.canvas.height=o*i.height,t.style.width=i.width+"px",t.style.height=i.height+"px",this.ctx.scale(o,o),this.redraw()}return e.prototype.redraw=function(e){var t;this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var n=0;n<this.noteSequence.notes.length;n++){var r=this.noteSequence.notes[n],i=this.config.noteSpacing*(n+1),o=this.getNoteStartTime(r)*this.config.pixelsPerTimeStep+i,a=(this.getNoteEndTime(r)-this.getNoteStartTime(r))*this.config.pixelsPerTimeStep,s=this.height-(r.pitch-this.config.minPitch)*this.config.noteHeight,u=r.velocity?r.velocity/100+.2:1,l=e&&this.isPaintingActiveNote(r,e);this.ctx.fillStyle="rgba("+(l?this.config.activeNoteRGB:this.config.noteRGB)+",\n          "+u+")",this.ctx.fillRect(o,s,a,this.config.noteHeight),l&&(t=o)}return t},e.prototype.getCanvasSize=function(){if(void 0===this.config.minPitch||void 0===this.config.maxPitch){this.config.minPitch=i.MAX_MIDI_PITCH,this.config.maxPitch=i.MIN_MIDI_PITCH;for(var e=0,t=this.noteSequence.notes;e<t.length;e++){var n=t[e];this.config.minPitch=Math.min(n.pitch,this.config.minPitch),this.config.maxPitch=Math.max(n.pitch,this.config.maxPitch)}this.config.minPitch-=2,this.config.maxPitch+=2}var r=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,o=this.noteSequence.notes.length,a=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime;return{width:o*this.config.noteSpacing+a*this.config.pixelsPerTimeStep,height:r}},e.prototype.getNoteStartTime=function(e){return this.sequenceIsQuantized?e.quantizedStartStep:e.startTime},e.prototype.getNoteEndTime=function(e){return this.sequenceIsQuantized?e.quantizedEndStep:e.endTime},e.prototype.isPaintingActiveNote=function(e,t){var n=this.getNoteStartTime(e)===this.getNoteStartTime(t),r=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||r},e}();n.Visualizer=o},{".":302,"./constants":300}],311:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@tensorflow/tfjs");n.tf=i,r(e("./core")),r(e("./music_rnn")),r(e("./music_vae")),r(e("./protobuf")),r(e("./transcription"))},{"./core":302,"./music_rnn":313,"./music_vae":315,"./protobuf":317,"./transcription":321,"@tensorflow/tfjs":244}],312:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core");n.ATTENTION_PREFIX="attention_cell_wrapper/";var i=function(){function e(e,t,n){this.cells=e,this.attnLength=t,this.attnSize=n}return e.isWrapped=function(e){return"rnn/"+n.ATTENTION_PREFIX+"kernel"in e},e.prototype.initialize=function(e){var t="rnn/"+n.ATTENTION_PREFIX;this.attnInputMatrix=e[t+"kernel"],this.attnInputBias=e[t+"bias"],this.attnW=e[t+"attention/attn_w"],this.attnV=e[t+"attention/attn_v"],this.attnMatrix=e[t+"attention/kernel"],this.attnBias=e[t+"attention/bias"],this.attnOutputMatrix=e[t+"attention_output_projection/kernel"],this.attnOutputBias=e[t+"attention_output_projection/bias"]},e.prototype.initState=function(){return{attention:r.zeros([this.attnSize]),attentionState:r.zeros([1,this.attnSize*this.attnLength])}},e.prototype.call=function(e,t,n,i){var o,a=r.concat([e,i.attention.as2D(1,-1)],1),s=r.add(r.matMul(a,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));t=(o=r.multiRNNCell(this.cells,s,t,n))[0],n=o[1];for(var u=r.reshape(i.attentionState,[-1,this.attnLength,1,this.attnSize]),l=r.conv2d(u,this.attnW,[1,1],"same"),c=[],p=0;p<t.length;p++)c.push(t[p]),c.push(n[p]);var h=r.concat(c,1),f=r.matMul(h,this.attnMatrix).reshape([-1,1,1,this.attnSize]),d=r.sum(r.mul(this.attnV,r.tanh(r.add(l,f))),[2,3]),m=r.softmax(d),y=r.sum(r.mul(r.reshape(m,[-1,this.attnLength,1,1]),u),[1,2]).reshape([-1,this.attnSize]),g=i.attentionState.reshape([-1,this.attnLength,this.attnSize]),v=r.slice(g,[0,1,0],[g.shape[0],g.shape[1]-1,g.shape[2]]),b=r.add(r.matMul(r.concat([n[2],y],1),this.attnOutputMatrix),this.attnOutputBias),_=y.flatten(),w=r.concat([v,b.as3D(b.shape[0],1,b.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:b,c:t,h:n,attentionState:{attention:_,attentionState:w}}},e}();n.AttentionWrapper=i},{"@tensorflow/tfjs-core":66}],313:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.MusicRNN=r.MusicRNN},{"./model":314}],314:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../core/aux_inputs"),s=e("../core/chords"),u=e("../core/data"),l=e("../core/logging"),c=e("../core/sequences"),p=e("./attention"),h=function(){function e(e,t){this.checkpointURL=e,this.spec=t,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}return e.prototype.isInitialized=function(){return this.initialized},e.prototype.instantiateFromSpec=function(){this.dataConverter=u.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?s.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map((function(e){return a.auxiliaryInputFromSpec(e)})):void 0},e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,a,s,u,c=this;return i(this,(function(i){switch(i.label){case 0:return this.dispose(),e=performance.now(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then((function(e){return e.json()})).then((function(e){if("MusicRNN"!==e.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  "+e.type);c.spec=e}))];case 1:i.sent(),i.label=2;case 2:return this.instantiateFromSpec(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return o.io.loadWeights(e,c.checkpointURL)}))];case 3:for(t=i.sent(),n=p.AttentionWrapper.isWrapped(t),r=n?"rnn/"+p.ATTENTION_PREFIX:"rnn/",this.forgetBias=o.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0,a=0,s=function(){var e=r+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",a.toString());if(!(e+"kernel"in t))return"break";u.lstmCells.push((function(n,r,i){return o.basicLSTMCell(c.forgetBias,t[e+"kernel"],t[e+"bias"],n,r,i)})),u.biasShapes.push(t[e+"bias"].shape[0]),++a},u=this;"break"!==s(););return this.lstmFcW=t["fully_connected/weights"],this.lstmFcB=t["fully_connected/biases"],n&&(this.attentionWrapper=new p.AttentionWrapper(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(t)),this.rawVars=t,this.initialized=!0,l.logWithDuration("Initialized model",e,"MusicRNN"),[2]}}))}))},e.prototype.dispose=function(){var e=this;Object.keys(this.rawVars).forEach((function(t){return e.rawVars[t].dispose()})),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},e.prototype.continueSequence=function(e,t,n,o){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.continueSequenceImpl(e,t,n,o,!1)];case 1:return[2,r.sent().sequence]}}))}))},e.prototype.continueSequenceAndReturnProbabilities=function(e,t,n,o){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,this.continueSequenceImpl(e,t,n,o,!0)]}))}))},e.prototype.continueSequenceImpl=function(e,t,n,a,s){return r(this,void 0,void 0,(function(){var r,u,p,h,f,d,m,y,g=this;return i(this,(function(i){switch(i.label){case 0:if(c.assertIsRelativeQuantizedSequence(e),this.chordEncoder&&!a)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&a)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:i.sent(),i.label=2;case 2:return r=performance.now(),[4,u=o.tidy((function(){var r=g.dataConverter.toTensor(e),i=r.shape[0],u=r.shape[1],l=g.chordEncoder?g.chordEncoder.encodeProgression(a,i+t):void 0,c=g.auxInputs?o.concat(g.auxInputs.map((function(e){return e.getTensors(i+t)})),1):void 0,p=g.sampleRnn(r,t,n,l,c,s),h=p.samples;return{samples:o.stack(h).as2D(h.length,u),probs:p.probs}}))];case 3:if(p=i.sent(),h=this.dataConverter.toNoteSequence(p.samples,e.quantizationInfo.stepsPerQuarter),f=[],!s)return[3,7];d=0,i.label=4;case 4:return d<p.probs.length?(y=(m=f).push,[4,p.probs[d].data()]):[3,7];case 5:y.apply(m,[i.sent()]),p.probs[d].dispose(),i.label=6;case 6:return d++,[3,4];case 7:return u.samples.dispose(),h.then((function(){return l.logWithDuration("Continuation completed",r,"MusicRNN",20)})),[2,{sequence:h,probs:f}]}}))}))},e.prototype.sampleRnn=function(e,t,n,r,i,a){for(var s,u=e.shape[0],l=e.shape[1],c=[],p=[],h=0;h<this.biasShapes.length;h++)c.push(o.zeros([1,this.biasShapes[h]/4])),p.push(o.zeros([1,this.biasShapes[h]/4]));var f,d=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();var m=[],y=[],g=o.split(e.toFloat(),u),v=r?o.split(r,r.shape[0]):void 0,b=i?o.split(i,i.shape[0]):void 0;for(h=0;h<u+t;h++){var _=void 0;if(h<u)_=g[h];else{var w=f.matMul(this.lstmFcW).add(this.lstmFcB).as1D(),S=void 0;n?(w=w.div(o.scalar(n)),S=o.multinomial(w,1).as1D()):S=w.argMax().as1D(),a&&y.push(o.softmax(w)),_=o.oneHot(S,l).toFloat(),m.push(_.as1D())}if(h===u+t-1)break;var x=[];if(v&&x.push(v[h+1]),x.push(_),b&&x.push(b[h]),_=o.concat(x,1),this.attentionWrapper){var T=this.attentionWrapper.call(_,c,p,d);c=T.c,p=T.h,d=T.attentionState,f=T.output}else c=(s=o.multiRNNCell(this.lstmCells,_,c,p))[0],f=(p=s[1])[p.length-1]}return{samples:m,probs:y}},e}();n.MusicRNN=h},{"../core/aux_inputs":298,"../core/chords":299,"../core/data":301,"../core/logging":303,"../core/sequences":308,"./attention":312,"@tensorflow/tfjs-core":66}],315:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.Decoder=r.Decoder,n.Encoder=r.Encoder,n.MusicVAE=r.MusicVAE},{"./model":316}],316:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("../core/chords"),l=e("../core/constants"),c=e("../core/data"),p=e("../core/logging"),h=function(e,t){if(void 0===e)throw Error("`kernel` is undefined.");if(void 0===t)throw Error("`bias` is undefined.");this.kernel=e,this.bias=t};function f(e,t){return t.matMul(e.kernel).add(e.bias)}n.LayerVars=h;var d=function(){};n.Encoder=d;var m=function(e){function t(t,n,r){var i=e.call(this)||this;return i.lstmFwVars=t,i.lstmBwVars=n,i.muVars=r,i.zDims=r?i.muVars.bias.shape[0]:null,i}return i(t,e),t.prototype.encode=function(e,t){var n=this;if(t)throw new Error("Variable-length segments not supported in flat encoder");return s.tidy((function(){var t=n.singleDirection(e,!0),r=n.singleDirection(e,!1),i=s.concat([t[1],r[1]],1);return n.muVars?f(n.muVars,i):i}))},t.prototype.singleDirection=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=t?this.lstmFwVars:this.lstmBwVars,o=[s.zeros([n,i.bias.shape[0]/4]),s.zeros([n,i.bias.shape[0]/4])],a=s.scalar(1),u=function(e,t){return s.basicLSTMCell(a,i.kernel,i.bias,e,t[0],t[1])},l=s.split(e.toFloat(),r,1),c=0,p=t?l:l.reverse();c<p.length;c++){o=u(p[c].squeeze([1]),o)}return o},t}(d),y=function(e){function t(t,n,r){var i=e.call(this)||this;return i.baseEncoders=t,i.numSteps=n,i.muVars=r,i.zDims=i.muVars.bias.shape[0],i}return i(t,e),t.prototype.encode=function(e,t){var n=this;if(t){if(1!==e.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(t.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return s.tidy((function(){for(var r=e,i=0;i<n.baseEncoders.length;++i){for(var o=n.numSteps[i],a=s.split(r,o,1),u=[],l=0;l<o;++l)u.push(n.baseEncoders[i].encode(0===i&&t?s.slice3d(a[l],[0,0,0],[1,t[l],-1]):a[l]));r=s.stack(u,1)}return f(n.muVars,r.squeeze([1]))}))},t}(d);function g(e,t,n){for(var r=[],i=[],o=[],a=s.split(f(n,e).tanh(),2*t.length,1),u=function(e){var n=t[e],u=s.scalar(1);r.push((function(e,t,r){return s.basicLSTMCell(u,n.kernel,n.bias,e,t,r)})),i.push(a[2*e]),o.push(a[2*e+1])},l=0;l<t.length;++l)u(l);return{cell:r,c:i,h:o}}var v=function(){};n.Decoder=v;var b=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.lstmCellVars=t,o.zToInitStateVars=n,o.outputProjectVars=r,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=i||r.bias.shape[0],o}return i(t,e),t.prototype.decode=function(e,t,n,r,i){var o=this,a=e.shape[0];return s.tidy((function(){for(var u,l=g(e,o.lstmCellVars,o.zToInitStateVars),c=[],p=n||s.zeros([a,o.outputDims]),h=i?s.split(s.tile(i,[a,1]),i.shape[0]):void 0,d=0;d<t;++d){var m=h?[p,e,h[d]]:[p,e];u=s.multiRNNCell(l.cell,s.concat(m,1),l.c,l.h),l.c=u[0],l.h=u[1];var y=f(o.outputProjectVars,l.h[l.h.length-1]);p=o.sample(y,r),c.push(p)}return s.stack(c,1)}))},t}(v),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.sample=function(e,t){var n=e,r=t?s.multinomial(n.div(s.scalar(t)),1).as1D():n.argMax(1).as1D();return s.oneHot(r,this.outputDims).toFloat()},t}(b),w=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i.numDims)||this;return o.nade=i,o}return i(t,e),t.prototype.sample=function(e,t){var n=s.split(e,[this.nade.numHidden,this.nade.numDims],1),r=n[0],i=n[1];return this.nade.sample(r,i)},t}(b),S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}i(t,e),t.prototype.sample=function(e,t){var n=s.split(e,3,1),r=n[0],i=n[1],o=n[2];if(i=s.sigmoid(i),o=s.tanh(o),t){r=s.sigmoid(r.div(s.scalar(t)));var a=s.randomUniform(r.shape,0,1);r=s.greater(r,a).toFloat()}else r=s.greater(s.sigmoid(r),.5).toFloat();return s.concat([r,i,o],1)}}(b),function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.coreDecoders=t,o.lstmCellVars=n,o.zToInitStateVars=r,o.numSteps=i,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=o.coreDecoders.reduce((function(e,t){return e+t.outputDims}),0),o}return i(t,e),t.prototype.decode=function(e,t,n,r,i){var o=this,a=e.shape[0];return s.tidy((function(){for(var n,u=g(e,o.lstmCellVars,o.zToInitStateVars),l=[],c=o.coreDecoders.map((function(e){})),p=s.zeros([a,1]),h=i?s.split(i,o.numSteps):void 0,f=0;f<o.numSteps;++f){n=s.multiRNNCell(u.cell,p,u.c,u.h),u.c=n[0],u.h=n[1];for(var d=[],m=0;m<o.coreDecoders.length;++m)d.push(o.coreDecoders[m].decode(u.h[u.h.length-1],t/o.numSteps,c[m],r,h?h[f]:void 0));l.push(s.concat(d,-1)),c=d.map((function(e){return e.slice([0,-1,0],[a,1,e.shape[e.rank-1]]).squeeze([1]).toFloat()}))}return s.concat(l,1)}))},t}(v)),x=function(){function e(e,t){this.numDims=e.shape[0],this.numHidden=e.shape[2],this.encWeights=e.as2D(this.numDims,this.numHidden),this.decWeightsT=t.as2D(this.numDims,this.numHidden)}return e.prototype.sample=function(e,t){var n=this,r=e.shape[0];return s.tidy((function(){for(var i=[],o=e.clone(),a=0;a<n.numDims;a++){var u=s.sigmoid(o),l=n.encWeights.slice([a,0],[1,n.numHidden]).as1D(),c=n.decWeightsT.slice([a,0],[1,n.numHidden]),p=t.slice([0,a],[r,1]).add(s.matMul(u,c,!1,!0)).sigmoid().greaterEqual(s.scalar(.5)).toFloat().as1D();a<n.numDims-1&&(o=o.add(s.outerProduct(p.toFloat(),l))),i.push(p)}return s.stack(i,1)}))},e}();n.Nade=x;var T=function(){function e(e,t){this.initialized=!1,this.checkpointURL=e,this.spec=t}return e.prototype.instantiateFromSpec=function(){this.dataConverter=c.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?u.chordEncoderFromType(this.spec.chordEncoder):void 0},e.prototype.dispose=function(){var e=this;void 0!==this.rawVars&&Object.keys(this.rawVars).forEach((function(t){return e.rawVars[t].dispose()})),this.encoder=void 0,this.decoder=void 0,this.initialized=!1},e.prototype.getLstmLayers=function(e,t){for(var n=[],r=0;;){var i=e.replace("%d",r.toString());if(!(i+"kernel"in t))break;n.push(new h(t[i+"kernel"],t[i+"bias"])),++r}return n},e.prototype.initialize=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,l,c,f,d,g,v,b,T,P,N,A,k,E,O=this;return a(this,(function(a){switch(a.label){case 0:return this.dispose(),e=performance.now(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then((function(e){return e.json()})).then((function(e){if("MusicVAE"!==e.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  "+e.type);O.spec=e}))];case 1:a.sent(),a.label=2;case 2:return this.instantiateFromSpec(),n="multi_rnn_cell/"+(t="cell_%d/lstm_cell/"),r="decoder/hierarchical_level_0/",o="encoder/"+(i="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/"),u="encoder/hierarchical_level_%d/"+i.replace("%d","0"),[4,fetch(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return s.io.loadWeights(e,O.checkpointURL)}))];case 3:if(l=a.sent(),this.rawVars=l,c=new h(l["encoder/mu/kernel"],l["encoder/mu/bias"]),this.dataConverter.numSegments){if(f=this.getLstmLayers(u.replace("%s","fw"),l),d=this.getLstmLayers(u.replace("%s","bw"),l),f.length!==d.length||2!==f.length)throw Error("Only 2 hierarchical encoder levels are supported. Got "+f.length+" forward and "+d.length+" backward.");g=[0,1].map((function(e){return new m(f[e],d[e])})),this.encoder=new y(g,[this.dataConverter.numSegments,1],c)}else{if(v=this.getLstmLayers(o.replace("%s","fw"),l),b=this.getLstmLayers(o.replace("%s","bw"),l),v.length!==b.length||1!==v.length)throw Error("Only single-layer bidirectional encoders are supported. Got "+v.length+" forward and "+b.length+" backward.");this.encoder=new m(v[0],b[0],c)}if(T=this.dataConverter.numSegments?"core_decoder/":"",P=[],this.dataConverter.NUM_SPLITS)for(N=0;N<this.dataConverter.NUM_SPLITS;++N)P.push(T+"core_decoder_"+N+"/decoder/");else P.push(T+"decoder/");if(A=P.map((function(e){var t=O.getLstmLayers(e+n,l),r=new h(l[e+"z_to_initial_state/kernel"],l[e+"z_to_initial_state/bias"]),i=new h(l[e+"output_projection/kernel"],l[e+"output_projection/bias"]);return e+"nade/w_enc"in l?new w(t,r,i,new x(l[e+"nade/w_enc"],l[e+"nade/w_dec_t"])):new _(t,r,i)})),this.dataConverter.numSegments)k=this.getLstmLayers(r+t,l),E=new h(l[r+"initial_state/kernel"],l[r+"initial_state/bias"]),this.decoder=new S(A,k,E,this.dataConverter.numSegments);else{if(1!==A.length)throw Error("Unexpected number of base decoders without conductor: "+A.length);this.decoder=A[0]}return this.initialized=!0,p.logWithDuration("Initialized model",e,"MusicVAE"),[2]}}))}))},e.prototype.isInitialized=function(){return this.initialized},e.prototype.interpolate=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o,u,l,c=this;return a(this,(function(a){switch(a.label){case 0:if(this.chordEncoder&&!r)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&r)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:a.sent(),a.label=2;case 2:return i=0,[4,this.encode(e,r)];case 3:return o=a.sent(),u=s.tidy((function(){return c.getInterpolatedZs(o,t)})),o.dispose(),l=this.decode(u,n,r),u.dispose(),l.then((function(){return p.logWithDuration("Interpolation completed",i,"MusicVAE",20)})),[2,l]}}))}))},e.prototype.getSegmentLengths=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,u,l,c,p=this;return a(this,(function(a){switch(a.label){case 0:if(e.shape[0]>1)throw new Error("Variable-length segments not supported for batch size > 1.");return t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,[4,(r=s.tidy((function(){return s.min(s.equal(e.squeeze([0]),p.dataConverter.endTensor.expandDims(0)),1)}))).data()];case 1:for(i=a.sent(),r.dispose(),o=t/n,u=[],l=0,c=i.indexOf(1);-1!==c;)u.push(c-l+1),l+=o,c=i.indexOf(1,l);if(u.length!==n)throw new Error("Incorrect number of segments: "+u.length+" != "+n);return[2,u]}}))}))},e.prototype.encodeChordProgression=function(e){var t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,i=this.dataConverter.SEGMENTED_BY_TRACK?s.concat2d([this.chordEncoder.encode(l.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(e,r-1)],0):this.chordEncoder.encodeProgression(e,r);return this.dataConverter.SEGMENTED_BY_TRACK?s.tile(i,[n,1]):i},e.prototype.encode=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o,u,l,c=this;return a(this,(function(a){switch(a.label){case 0:if(this.chordEncoder&&!t)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&t)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&t.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:a.sent(),a.label=2;case 2:return n=performance.now(),r=s.tidy((function(){return s.stack(e.map((function(e){return c.dataConverter.toTensor(e)})))})),this.dataConverter.endTensor?[4,this.getSegmentLengths(r)]:[3,4];case 3:return o=a.sent(),[3,5];case 4:o=void 0,a.label=5;case 5:return i=o,this.chordEncoder&&(u=s.tidy((function(){var n=c.encodeChordProgression(t),i=s.tile(s.expandDims(n,0),[e.length,1,1]);return r.concat(i,2)})),r.dispose(),r=u),l=this.encoder.encode(r,i),r.dispose(),p.logWithDuration("Encoding completed",n,"MusicVAE",20),[2,l]}}))}))},e.prototype.decode=function(e,t,n,r){return void 0===r&&(r=4),o(this,void 0,void 0,(function(){var i,o,u,l,c,h,f,d,m,y=this;return a(this,(function(a){switch(a.label){case 0:if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&n.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:a.sent(),a.label=2;case 2:i=performance.now(),o=this.dataConverter.numSteps,u=s.tidy((function(){var r=y.chordEncoder?y.encodeChordProgression(n):void 0,i=y.decoder.decode(e,o,void 0,t,r);return s.split(i,i.shape[0]).map((function(e){return e.squeeze([0])}))})),l=[],c=0,h=u,a.label=3;case 3:return c<h.length?(f=h[c],m=(d=l).push,[4,this.dataConverter.toNoteSequence(f,r)]):[3,6];case 4:m.apply(d,[a.sent()]),f.dispose(),a.label=5;case 5:return c++,[3,3];case 6:return p.logWithDuration("Decoding completed",i,"MusicVAE",20),[2,l]}}))}))},e.prototype.getInterpolatedZs=function(e,t){if("number"==typeof t&&(t=[t]),2!==e.shape[0]&&4!==e.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==t.length&&2!==t.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");var n=t[0],r=2===t.length?t[1]:n;return s.tidy((function(){var t=s.linspace(0,1,n),i=e.slice([0,0],[1,e.shape[1]]).as1D(),o=e.slice([1,0],[1,e.shape[1]]).as1D();if(2===e.shape[0]){var a=o.sub(i);return s.outerProduct(t,a).add(i)}if(4===e.shape[0]){var u=s.linspace(0,1,r),l=e.slice([2,0],[1,e.shape[1]]).as1D(),c=e.slice([3,0],[1,e.shape[1]]).as1D(),p=s.scalar(1).sub(t),h=s.scalar(1).sub(u),f=i.mul(s.outerProduct(h,p).as3D(r,n,1));return f=s.addStrict(f,o.mul(s.outerProduct(u,p).as3D(r,n,1))),f=s.addStrict(f,l.mul(s.outerProduct(h,t).as3D(r,n,1))),(f=s.addStrict(f,c.mul(s.outerProduct(u,t).as3D(r,n,1)))).as2D(n*r,e.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")}))},e.prototype.sample=function(e,t,n,r){return void 0===t&&(t=.5),void 0===r&&(r=l.DEFAULT_STEPS_PER_QUARTER),o(this,void 0,void 0,(function(){var i,o,u,l=this;return a(this,(function(a){switch(a.label){case 0:if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:a.sent(),a.label=2;case 2:return i=performance.now(),o=s.tidy((function(){return s.randomNormal([e,l.decoder.zDims])})),u=this.decode(o,t,n,r),o.dispose(),u.then((function(){return p.logWithDuration("Sampling completed",i,"MusicVAE",20)})),[2,u]}}))}))},e}();n.MusicVAE=T},{"../core/chords":299,"../core/constants":300,"../core/data":301,"../core/logging":303,"@tensorflow/tfjs-core":66}],317:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./proto").tensorflow.magenta.NoteSequence;n.NoteSequence=r},{"./proto":318}],318:[function(e,t,n){"use strict";var r,i,o=e("protobufjs/minimal"),a=o.Reader,s=o.Writer,u=o.util,l=o.roots.default||(o.roots.default={});l.tensorflow=((i={}).magenta=((r={}).NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=u.emptyArray,e.prototype.keySignatures=u.emptyArray,e.prototype.tempos=u.emptyArray,e.prototype.notes=u.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=u.emptyArray,e.prototype.controlChanges=u.emptyArray,e.prototype.partInfos=u.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=u.emptyArray,e.prototype.sectionAnnotations=u.emptyArray,e.prototype.sectionGroups=u.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)l.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)l.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)l.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)l.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)l.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)l.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)l.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&l.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)l.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&l.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&l.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&l.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)l.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)l.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=u.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(l.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(l.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(l.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(l.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=u.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(l.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(l.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(l.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=l.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(l.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(l.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(l.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=l.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=l.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=l.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!u.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!u.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(u.isInteger(e.referenceNumber)||e.referenceNumber&&u.isInteger(e.referenceNumber.low)&&u.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!u.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!u.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=l.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=l.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=l.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=l.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(u.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&u.isInteger(e.totalQuantizedSteps.low)&&u.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=l.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=l.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=l.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=l.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=l.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=l.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=l.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=l.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=l.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=l.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence)return e;var t=new l.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(u.Long?(t.referenceNumber=u.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new u.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=l.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=l.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=l.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=l.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(u.Long?(t.totalQuantizedSteps=u.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new u.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=l.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=l.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=l.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=l.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=l.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=l.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=l.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=l.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=l.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=l.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,u.Long){var r=new u.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,u.Long?(r=new u.Long(0,0,!1),n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var i=0;i<e.timeSignatures.length;++i)n.timeSignatures[i]=l.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[i],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],i=0;i<e.keySignatures.length;++i)n.keySignatures[i]=l.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[i],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],i=0;i<e.tempos.length;++i)n.tempos[i]=l.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[i],t);if(e.notes&&e.notes.length)for(n.notes=[],i=0;i<e.notes.length;++i)n.notes[i]=l.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[i],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],i=0;i<e.pitchBends.length;++i)n.pitchBends[i]=l.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[i],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],i=0;i<e.controlChanges.length;++i)n.controlChanges[i]=l.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[i],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],i=0;i<e.partInfos.length;++i)n.partInfos[i]=l.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[i],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=l.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],i=0;i<e.textAnnotations.length;++i)n.textAnnotations[i]=l.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[i],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=l.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?u.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new u.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=l.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"==typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?u.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new u.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=l.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],i=0;i<e.sectionAnnotations.length;++i)n.sectionAnnotations[i]=l.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[i],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],i=0;i<e.sectionGroups.length;++i)n.sectionGroups[i]=l.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[i],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=u.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=u.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!u.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!u.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(u.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&u.isInteger(e.quantizedStartStep.low)&&u.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(u.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&u.isInteger(e.quantizedEndStep.low)&&u.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!u.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!u.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!u.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!u.isInteger(e.voice)?"voice: integer expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.Note)return e;var t=new l.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(u.Long?(t.quantizedStartStep=u.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new u.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(u.Long?(t.quantizedEndStep=u.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new u.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,u.Long){var r=new u.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;u.Long?(r=new u.Long(0,0,!1),n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?l.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"==typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?u.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new u.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"==typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?u.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new u.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchName=(t={},(n=Object.create(t))[t[0]="UNKNOWN_PITCH_NAME"]=0,n[t[1]="F_FLAT_FLAT"]=1,n[t[2]="C_FLAT_FLAT"]=2,n[t[3]="G_FLAT_FLAT"]=3,n[t[4]="D_FLAT_FLAT"]=4,n[t[5]="A_FLAT_FLAT"]=5,n[t[6]="E_FLAT_FLAT"]=6,n[t[7]="B_FLAT_FLAT"]=7,n[t[8]="F_FLAT"]=8,n[t[9]="C_FLAT"]=9,n[t[10]="G_FLAT"]=10,n[t[11]="D_FLAT"]=11,n[t[12]="A_FLAT"]=12,n[t[13]="E_FLAT"]=13,n[t[14]="B_FLAT"]=14,n[t[15]="F"]=15,n[t[16]="C"]=16,n[t[17]="G"]=17,n[t[18]="D"]=18,n[t[19]="A"]=19,n[t[20]="E"]=20,n[t[21]="B"]=21,n[t[22]="F_SHARP"]=22,n[t[23]="C_SHARP"]=23,n[t[24]="G_SHARP"]=24,n[t[25]="D_SHARP"]=25,n[t[26]="A_SHARP"]=26,n[t[27]="E_SHARP"]=27,n[t[28]="B_SHARP"]=28,n[t[29]="F_SHARP_SHARP"]=29,n[t[30]="C_SHARP_SHARP"]=30,n[t[31]="G_SHARP_SHARP"]=31,n[t[32]="D_SHARP_SHARP"]=32,n[t[33]="A_SHARP_SHARP"]=33,n[t[34]="E_SHARP_SHARP"]=34,n[t[35]="B_SHARP_SHARP"]=35,n),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!u.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!u.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new l.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new l.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?l.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?l.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new l.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!u.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new l.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=u.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(u.isInteger(e.quantizedStep)||e.quantizedStep&&u.isInteger(e.quantizedStep.low)&&u.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!u.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!u.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new l.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(u.Long?(t.quantizedStep=u.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,u.Long){var r=new u.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?u.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!u.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new l.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new l.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?l.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?l.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?l.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=u.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(u.isInteger(e.quantizedStep)||e.quantizedStep&&u.isInteger(e.quantizedStep.low)&&u.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!u.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new l.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(u.Long?(t.quantizedStep=u.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,u.Long){var r=new u.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?l.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?u.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:u.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:u.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!u.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!u.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new l.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new l.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=u.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(u.isInteger(e.sectionId)||e.sectionId&&u.isInteger(e.sectionId.low)&&u.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new l.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(u.Long?(t.sectionId=u.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,u.Long){var r=new u.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?u.Long.prototype.toString.call(e.sectionId):t.longs===Number?new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:u.oneOfGetter(t=["sectionId","sectionGroup"]),set:u.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&l.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sectionId=u.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=l.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(u.isInteger(e.sectionId)||e.sectionId&&u.isInteger(e.sectionId.low)&&u.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=l.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.Section)return e;var t=new l.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(u.Long?(t.sectionId=u.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=l.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?u.Long.prototype.toString.call(e.sectionId):t.longs===Number?new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=l.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=u.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)l.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(l.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=l.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!u.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new l.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=l.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=l.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),r.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=u.emptyArray,e.prototype.composers=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.SequenceMetadata;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!u.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!u.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!u.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!u.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.SequenceMetadata)return e;var t=new l.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length)for(n.composers=[],r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),r.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.magenta.VelocityRange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!u.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!u.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof l.tensorflow.magenta.VelocityRange)return e;var t=new l.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),r),i),t.exports=l},{"protobufjs/minimal":267}],319:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("fft.js"),a=e("ndarray"),s=e("ndarray-resample"),u=e("../core/logging"),l=e("./constants"),c=window,p=c.webkitOfflineAudioContext,h=p?new c.webkitOfflineAudioContext(1,44100,44100):new c.OfflineAudioContext(1,l.SAMPLE_RATE,l.SAMPLE_RATE);function f(e,t){t.power||(t.power=2);var n=function(e,t){var n=t.nFft||2048,r=t.winLength||n,i=t.hopLength||Math.floor(r/4),o=function(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}(r);o=function(e,t){if(e.length>t)throw new Error("Data is longer than length.");var n=Math.floor((t-e.length)/2),r=t-e.length-n;return b(e,[n,r])}(o,n);for(var a=function(e,t,n){for(var r=Math.floor((e.length-t)/n)+1,i=Array.from({length:r},(function(e,n){return new Float32Array(t)})),o=0;o<r;o++){var a=o*n,s=e.slice(a,a+t);i[o].set(s),s.length}return i}(e=function(e,t){for(var n=b(e,t),r=0;r<t;r++)n[r]=n[2*t-r],n[n.length-r-1]=n[n.length-2*t+r-1];return n}(e,Math.floor(n/2)),n,i),s=[],u=a.length,l=n+2,c=0;c<u;c++){var p=new Float32Array(l);s[c]=p}for(c=0;c<u;c++){p=_(v(a[c],o));s[c].set(p.slice(0,l))}return s}(e,t),r=function(e,t){var n=e.map((function(e){return function(e,t){return e.map((function(e){return Math.pow(e,t)}))}(function(e){for(var t=new Float32Array(e.length/2),n=0;n<e.length/2;n++)t[n]=Math.sqrt(e[2*n]*e[2*n]+e[2*n+1]*e[2*n+1]);return t}(e),t)})),r=e[0].length-1;return[n,r]}(n,t.power),i=r[0],o=r[1];t.nFft=o;var a=function(e){for(var t=e.fMin||0,n=e.fMax||e.sampleRate/2,r=e.nMels||128,i=e.nFft||2048,o=function(e,t){return w(0,e/2,Math.floor(1+t/2))}(e.sampleRate,i),a=function(e,t,n){var r=S(t),i=S(n),o=w(r,i,e);return o.map((function(e){return function(e){return 700*(Math.exp(e/1125)-1)}(e)}))}(r+2,t,n),s=function(e){for(var t=new Float32Array(e.length-1),n=0;n<e.length;n++)t[n]=e[n+1]-e[n];return t}(a),u=function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=new Float32Array(t.length);for(r=0;r<e.length;r++)for(var i=0;i<t.length;i++)n[r][i]=e[r]-t[i];return n}(a,o),l=u[0].length,c=[],p=0;p<r;p++){c[p]=new Float32Array(l);for(var h=0;h<u[p].length;h++){var f=-u[p][h]/s[p],d=u[p+2][h]/s[p+1],m=Math.max(0,Math.min(f,d));c[p][h]=m}}var y=function(e){var t=2/(a[2+e]-a[e]);c[e]=c[e].map((function(e){return e*t}))};for(p=0;p<c.length;p++)y(p);return c}(t);return function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=g(e[r],t);return n}(i,a)}function d(e,t,n){void 0===t&&(t=1e-10),void 0===n&&(n=80);for(var r=e.length,i=e[0].length,o=[],a=0;a<r;a++)o[a]=new Float32Array(i);for(a=0;a<r;a++)for(var s=0;s<i;s++){var u=e[a][s];o[a][s]=10*Math.log10(Math.max(t,u))}if(n){if(n<0)throw new Error("topDb must be non-negative.");for(a=0;a<r;a++){var l=o[a].reduce((function(e,t){return Math.max(e,t)}));for(s=0;s<i;s++)o[a][s]=Math.max(o[a][s],l-n)}}return o}function m(e){if(1===e.numberOfChannels)return e.getChannelData(0);if(2!==e.numberOfChannels)throw Error(e.numberOfChannels+" channel audio is not supported.");for(var t=e.getChannelData(0),n=e.getChannelData(1),r=new Float32Array(e.length),i=0;i<e.length;++i)r[i]=(t[i]+n[i])/2;return r}function y(e,t){return void 0===t&&(t=l.SAMPLE_RATE),r(this,void 0,void 0,(function(){var n,r,o,l,c;return i(this,(function(i){return e.sampleRate===t?[2,m(e)]:(n=e.sampleRate,r=e.length*t/n,p?(u.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5),l=m(e),c=new Float32Array(r),s(a(c,[r]),a(l,[l.length])),[2,c]):((o=h.createBufferSource()).buffer=e,o.connect(h.destination),o.start(),[2,h.startRendering().then((function(e){return e.getChannelData(0)}))]))}))}))}function g(e,t){if(e.length!==t[0].length)throw new Error("Each entry in filterbank should have dimensions matching FFT. |mags| = "+e.length+", |filterbank[0]| = "+t[0].length+".");for(var n=new Float32Array(t.length),r=0;r<t.length;r++){var i=v(e,t[r]);n[r]=i.reduce((function(e,t){return e+t}))}return n}function v(e,t){if(e.length!==t.length)return console.error("Buffer length "+e.length+" != window length "+t.length+"."),null;for(var n=new Float32Array(e.length),r=0;r<e.length;r++)n[r]=t[r]*e[r];return n}function b(e,t){var n,r;"object"==typeof t?(n=t[0],r=t[1]):n=r=t;var i=new Float32Array(e.length+n+r);return i.set(e,n),i}function _(e){var t=new o(e.length),n=t.createComplexArray(),r=t.toComplexArray(e);return t.transform(n,r),n}function w(e,t,n){for(var r=(t-e)/(n-1),i=new Float32Array(n),o=0;o<n;o++)i[o]=e+r*o;return i}function S(e){return 1125*Math.log(1+e/700)}n.loadAudioFromUrl=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return h.decodeAudioData(e)}))]}))}))},n.loadAudioFromFile=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){return t=new FileReader,[2,new Promise((function(n,r){t.onerror=function(){t.abort(),r(new DOMException("Something went wrong reading that file."))},t.onload=function(){n(t.result)},t.readAsArrayBuffer(e)})).then((function(e){return h.decodeAudioData(e)}))]}))}))},n.preprocessAudio=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,y(e)];case 1:return[2,d(f(t.sent(),{sampleRate:l.SAMPLE_RATE,hopLength:l.SPEC_HOP_LENGTH,nMels:l.MEL_SPEC_BINS,nFft:2048,fMin:30}))]}}))}))}},{"../core/logging":303,"./constants":320,"fft.js":255,ndarray:265,"ndarray-resample":263}],320:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SAMPLE_RATE=16e3,n.SPEC_HOP_LENGTH=512,n.FRAME_LENGTH_SECONDS=n.SPEC_HOP_LENGTH/n.SAMPLE_RATE,n.MEL_SPEC_BINS=229,n.MIN_MIDI_PITCH=21,n.MAX_MIDI_PITCH=108,n.MIDI_PITCHES=n.MAX_MIDI_PITCH-n.MIN_MIDI_PITCH+1},{}],321:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.OnsetsAndFrames=r.OnsetsAndFrames},{"./model":322}],322:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs"),a=e("../core/logging"),s=e("./audio_utils"),u=e("./constants"),l=e("./transcription_utils"),c=function(){function e(e,t){void 0===t&&(t=250),this.checkpointURL=e,this.chunkLength=t}return e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){switch(r.label){case 0:return this.dispose(),e=performance.now(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return o.io.loadWeights(e,n.checkpointURL)}))];case 1:return t=r.sent(),this.build(t),Object.keys(t).map((function(e){return t[e].dispose()})),this.initialized=!0,a.logWithDuration("Initialized model",e,"O&F"),[2]}}))}))},e.prototype.dispose=function(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)},e.prototype.isInitialized=function(){return this.initialized},e.prototype.transcribeFromMelSpec=function(e,t){return void 0===t&&(t=4),r(this,void 0,void 0,(function(){var n,r,s,u,c,p,h=this;return i(this,(function(i){return this.isInitialized()||this.initialize(),n=performance.now(),a.log("Computing onsets, frames, and velocities...","O&F",20),r=o.tidy((function(){var n=l.batchInput(e,h.chunkLength);return h.processBatches(n,h.chunkLength,e.length,t)})),s=r[0],u=r[1],c=r[2],a.log("Converting to NoteSequence...","O&F",20),(p=l.pianorollToNoteSequence(s,u,c)).then((function(){s.dispose(),u.dispose(),c.dispose(),a.logWithDuration("Transcribed from mel spec",n,"O&F")})),[2,p]}))}))},e.prototype.transcribeFromAudioBuffer=function(e,t){return void 0===t&&(t=4),r(this,void 0,void 0,(function(){var n,r,o=this;return i(this,(function(i){return n=performance.now(),(r=s.preprocessAudio(e)).then((function(){return a.logWithDuration("Converted audio to mel spec",n,"O&F",20)})),[2,r.then((function(e){return o.transcribeFromMelSpec(e.map((function(e){return Array.from(e)}),t))}))]}))}))},e.prototype.transcribeFromAudioFile=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,s.loadAudioFromFile(e)];case 1:return t=n.sent(),[2,this.transcribeFromAudioBuffer(t)]}}))}))},e.prototype.transcribeFromAudioURL=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,s.loadAudioFromUrl(e)];case 1:return t=n.sent(),[2,this.transcribeFromAudioBuffer(t)]}}))}))},e.prototype.processBatches=function(e,t,n,r){var i,a,s,u,c=this,p=function(e){return[c.onsetsCnn.predict(e,r),c.activationCnn.predict(e,r),c.velocityCnn.predict(e,r)]};if(1===e.shape[0])a=(i=p(e.expandDims(-1)))[0],s=i[1],u=i[2];else{for(var h=p(e.expandDims(-1)),f=[],d=0;d<3;++d)f.push(l.unbatchOutput(h[d],t,n));a=f[0],s=f[1],u=f[2]}var m=this.onsetsRnn.predict(a,this.chunkLength);a.dispose();var y=o.concat3d([m,s],-1);s.dispose();var g=this.frameRnn.predict(y,this.chunkLength),v=o.clipByValue(u,0,1).mul(o.scalar(80)).add(o.scalar(10)).toInt();return u.dispose(),[g.squeeze(),m.squeeze(),v.squeeze()]},e.prototype.build=function(e){var t=this;o.tidy((function(){t.onsetsCnn=new p,t.onsetsCnn.setWeights(e,"onsets"),t.onsetsRnn=new h([null,t.onsetsCnn.outputShape[2]]),t.onsetsRnn.setWeights(e,"onsets","onset_probs"),t.activationCnn=new p("sigmoid"),t.activationCnn.setWeights(e,"frame","activation_probs"),t.frameRnn=new h([null,2*u.MIDI_PITCHES]),t.frameRnn.setWeights(e,"frame","frame_probs"),t.velocityCnn=new p("linear"),t.velocityCnn.setWeights(e,"velocity","onset_velocities")}))},e}();n.OnsetsAndFrames=c;var p=function(){function e(e){this.nn=o.sequential();var t={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,u.MEL_SPEC_BINS,1],trainable:!1},n={scale:!1,trainable:!1};this.nn.add(o.layers.conv2d(t)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),t.inputShape=null,this.nn.add(o.layers.conv2d(t)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),this.nn.add(o.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),t.filters=96,this.nn.add(o.layers.conv2d(t)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),this.nn.add(o.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));var r=this.nn.outputShape;this.nn.add(o.layers.reshape({targetShape:[r[1],r[2]*r[3]]})),this.nn.add(o.layers.dense({units:768,activation:"relu",trainable:!1})),e&&this.nn.add(o.layers.dense({units:u.MIDI_PITCHES,activation:e,trainable:!1})),this.outputShape=this.nn.outputShape}return e.prototype.dispose=function(){this.nn.dispose()},e.prototype.predict=function(e,t){return this.nn.predict(e,{batchSize:t})},e.prototype.setWeights=function(e,t,n){function r(t){var n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}var i=[r(t+"/conv0/weights"),r(t+"/conv0/BatchNorm/beta"),r(t+"/conv0/BatchNorm/moving_mean"),r(t+"/conv0/BatchNorm/moving_variance"),r(t+"/conv1/weights"),r(t+"/conv1/BatchNorm/beta"),r(t+"/conv1/BatchNorm/moving_mean"),r(t+"/conv1/BatchNorm/moving_variance"),r(t+"/conv2/weights"),r(t+"/conv2/BatchNorm/beta"),r(t+"/conv2/BatchNorm/moving_mean"),r(t+"/conv2/BatchNorm/moving_variance"),r(t+"/fc_end/weights"),r(t+"/fc_end/biases")];n&&(i=i.concat([r(t+"/"+n+"/weights"),r(t+"/"+n+"/biases")])),this.nn.setWeights(i)},e}(),h=function(){function e(e,t){var n,r,i;void 0===t&&(t=384),this.dense=o.sequential(),this.units=t,this.lstm=(n=o.layers.lstm({inputShape:e,units:t,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),r=[o.input({shape:e}),o.input({shape:[t]}),o.input({shape:[t]})],i=n.apply(r),o.model({inputs:r,outputs:i})),this.dense.add(o.layers.dense({inputShape:[null,t],units:u.MIDI_PITCHES,activation:"sigmoid",trainable:!1}))}return e.prototype.dispose=function(){this.lstm.dispose(),this.dense.dispose()},e.prototype.setWeights=function(e,t,n){var r=this;function i(t){var n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}var a,s=function(e,t){void 0===t&&(t=0);var n=o.split(e,4,-1),r=n[0],i=n[1],a=n[2],s=n[3];return o.concat([r,a.add(o.scalar(t)),i,s],-1)},u="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell";this.lstm.setWeights((a=i(t+"/"+u+"/kernel"),o.split(s(a),[a.shape[0]-r.units,r.units])).concat(s(i(t+"/"+u+"/bias"),1))),this.dense.setWeights([i(t+"/"+n+"/weights"),i(t+"/"+n+"/biases")])},e.prototype.predict=function(e,t){var n=this;return o.tidy((function(){return n.predictImpl(e,t)}))},e.prototype.predictImpl=function(e,t){for(var n=e.shape[1],r=Math.ceil(n/t),i=[o.zeros([1,this.units]),o.zeros([1,this.units])],a=[],s=0;s<r;++s){var u=e.slice([0,s*t],[-1,s<r-1?t:-1]),l=this.lstm.predict([u,i[0],i[1]]);a.push(this.dense.predict(l[0])),i=l.slice(1)}return 1===a.length?a[0]:o.concat3d(a,1)},e}()},{"../core/logging":303,"./audio_utils":319,"./constants":320,"./transcription_utils":323,"@tensorflow/tfjs":244}],323:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs"),a=e("../protobuf"),s=e("./constants");n.batchInput=function(e,t){var n=Math.ceil(e.length/t),r=e.length%t,i=0;if(n>1&&r>0&&r<=3&&(n-=1,i=r,r=0),1===n)return o.tensor2d(e).expandDims(0);var a,s=t+6,u=o.tensor2d(e.slice(0,s)).expandDims(0),l=o.tensor2d(e.slice(e.length-s)).expandDims(0);if(2===n)return o.concat([u,l],0);a=r?o.tensor2d(e).pad([[0,t-r],[0,0]]).as3D(n,t,-1):o.tensor2d(e.slice(0,e.length-i)).as3D(n,t,-1);var c=o.slice(a,[0,t-3],[n-2,-1]),p=o.slice(a,[2,0],[-1,3]),h=o.concat([c,a.slice(1,n-2),p],1);return o.concat([u,h,l],0)},n.unbatchOutput=function(e,t,n){return 1===e.shape[0]?e:o.tidy((function(){var r=e.slice([0,0],[1,t]),i=n%t;i<=3&&(i+=t);var a=e.slice([e.shape[0]-1,e.shape[1]-i],[-1,-1]),s=[r,a];if(e.shape[0]>2){var u=e.shape[0]-2;s=[r,e.slice([1,3],[u,t]).as3D(1,u*t,-1),a]}return o.concat(s,1)}))},n.pianorollToNoteSequence=function(e,t,n,u,l){return void 0===u&&(u=.5),void 0===l&&(l=.5),r(this,void 0,void 0,(function(){function r(e,t){p.notes.push(a.NoteSequence.Note.create({pitch:e+s.MIN_MIDI_PITCH,startTime:(h[e]-1)*s.FRAME_LENGTH_SECONDS,endTime:t*s.FRAME_LENGTH_SECONDS,velocity:f[e]})),h[e]=0}function c(e,t,n){h[e]?d[e]||(r(e,t),h[e]=t+1,f[e]=n):(h[e]=t+1,f[e]=n)}var p,h,f,d,m,y,g,v,b,_,w,S,x;return i(this,(function(i){switch(i.label){case 0:return p=a.NoteSequence.create(),h=new Uint32Array(s.MIDI_PITCHES),f=new Uint8Array(s.MIDI_PITCHES),d=new Uint8Array(s.MIDI_PITCHES),m=o.tidy((function(){var r=o.greater(t,u),i=o.greater(e,l);return r=r.pad([[0,1],[0,0]]),i=i.pad([[0,1],[0,0]]),n=n.pad([[0,1],[0,0]]),[i=o.logicalOr(i,r),r,n]})),[4,Promise.all(m.map((function(e){return e.data()})))];case 1:for(y=i.sent(),g=y[0],v=y[1],b=y[2],m.forEach((function(e){return e.dispose()})),_=e.shape[0],w=0;w<_+1;++w){for(S=0;S<s.MIDI_PITCHES;++S)x=w*s.MIDI_PITCHES+S,v[x]?c(S,w,b[x]):!g[x]&&h[S]&&r(S,w);d=v.slice(w*s.MIDI_PITCHES,(w+1)*s.MIDI_PITCHES)}return p.totalTime=_*s.FRAME_LENGTH_SECONDS,[2,p]}}))}))}},{"../protobuf":317,"./constants":320,"@tensorflow/tfjs":244}]},{},[311])(311)}));
//# sourceMappingURL=/sm/80775a3c6d2726c6093ee5bffd173655b3bd28e5a191058b21a717a7ccf976fa.map